{"version":3,"file":"angular-auth-oidc-client.js","sources":["../projects/angular-auth-oidc-client/src/lib/api/http-base.service.ts","../projects/angular-auth-oidc-client/src/lib/logging/log-level.ts","../projects/angular-auth-oidc-client/src/lib/config/default-config.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/platform-provider/platform.provider.ts","../projects/angular-auth-oidc-client/src/lib/config/config.provider.ts","../projects/angular-auth-oidc-client/src/lib/api/data.service.ts","../projects/angular-auth-oidc-client/src/lib/public-events/event-types.ts","../projects/angular-auth-oidc-client/src/lib/storage/abstract-security-storage.ts","../projects/angular-auth-oidc-client/src/lib/storage/storage-persistence.service.ts","../projects/angular-auth-oidc-client/src/lib/logging/logger.service.ts","../projects/angular-auth-oidc-client/src/lib/public-events/public-events.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/tokenHelper/oidc-token-helper.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/token-validation.service.ts","../projects/angular-auth-oidc-client/src/lib/authState/auth-state.service.ts","../projects/angular-auth-oidc-client/src/lib/auto-login/auto-login-service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/url/uri-encoder.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/random/random.service.ts","../projects/angular-auth-oidc-client/src/lib/flows/flows-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/flowHelper/flow-helper.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/url/url.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/code-flow-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/userData/user-service.ts","../projects/angular-auth-oidc-client/src/lib/flows/reset-auth-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/implicit-flow-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/authState/authorized-state.ts","../projects/angular-auth-oidc-client/src/lib/validation/validation-result.ts","../projects/angular-auth-oidc-client/src/lib/flows/signin-key-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/history-jwt-keys-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/user-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/state-validation-result.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/equality/equality.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/state-validation.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/state-validation-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/refresh-session-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/refresh-token-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/flows/flows.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/intervall.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/implicit-flow-callback.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/existing-iframe.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/check-session.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/silent-renew.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/code-flow-callback.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/callback.service.ts","../projects/angular-auth-oidc-client/src/lib/config/auth-well-known-data.service.ts","../projects/angular-auth-oidc-client/src/lib/config/auth-well-known.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/refresh-session-iframe.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/refresh-session-refresh-token.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/refresh-session.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/periodically-token-check.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/popup/popup.service.ts","../../projects/angular-auth-oidc-client/src/lib/check-auth.service.ts","../projects/angular-auth-oidc-client/src/lib/config-validation/rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-clientId.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-redirect-url.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-silentRenewUrl-with-no-refreshtokens.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-sts-server.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/use-offline-scope-with-silent-renew.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/index.ts","../projects/angular-auth-oidc-client/src/lib/config-validation/config-validation.service.ts","../projects/angular-auth-oidc-client/src/lib/config/config.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/response-type-validation/response-type-validation.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/redirect/redirect.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/par/par.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/par/par-login.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/popup/popup-login.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/standard/standard-login.service.ts","../projects/angular-auth-oidc-client/src/lib/login/login.service.ts","../projects/angular-auth-oidc-client/src/lib/logoffRevoke/logoff-revocation.service.ts","../../projects/angular-auth-oidc-client/src/lib/oidc.security.service.ts","../projects/angular-auth-oidc-client/src/lib/storage/browser-storage.service.ts","../../projects/angular-auth-oidc-client/src/lib/auth.module.ts","../projects/angular-auth-oidc-client/src/lib/auto-login/auto-login.guard.ts","../projects/angular-auth-oidc-client/src/lib/interceptor/auth.interceptor.ts","../../projects/angular-auth-oidc-client/src/lib/angular-auth-oidc-client.ts","../../../projects/angular-auth-oidc-client/src/public-api.ts","../../../projects/angular-auth-oidc-client/src/angular-auth-oidc-client.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class HttpBaseService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  get<T>(url: string, params?: { [key: string]: any }): Observable<T> {\r\n    return this.http.get<T>(url, params);\r\n  }\r\n\r\n  post<T>(url: string, body: any, params?: { [key: string]: any }): Observable<T> {\r\n    return this.http.post<T>(url, body, params);\r\n  }\r\n}\r\n","// eslint-disable-next-line no-shadow\r\nexport enum LogLevel {\r\n  None,\r\n  Debug,\r\n  Warn,\r\n  Error,\r\n}\r\n","import { LogLevel } from '../logging/log-level';\r\nimport { OpenIdConfiguration } from './openid-configuration';\r\n\r\nexport const DEFAULT_CONFIG: OpenIdConfiguration = {\r\n  stsServer: 'https://please_set',\r\n  authWellknownEndpoint: '',\r\n  redirectUrl: 'https://please_set',\r\n  clientId: 'please_set',\r\n  responseType: 'code',\r\n  scope: 'openid email profile',\r\n  hdParam: '',\r\n  postLogoutRedirectUri: 'https://please_set',\r\n  startCheckSession: false,\r\n  silentRenew: false,\r\n  silentRenewUrl: 'https://please_set',\r\n  silentRenewTimeoutInSeconds: 20,\r\n  renewTimeBeforeTokenExpiresInSeconds: 0,\r\n  useRefreshToken: false,\r\n  usePushedAuthorisationRequests: false,\r\n  ignoreNonceAfterRefresh: false,\r\n  postLoginRoute: '/',\r\n  forbiddenRoute: '/forbidden',\r\n  unauthorizedRoute: '/unauthorized',\r\n  autoUserinfo: true,\r\n  autoCleanStateAfterAuthentication: true,\r\n  triggerAuthorizationResultEvent: false,\r\n  logLevel: LogLevel.Warn,\r\n  issValidationOff: false,\r\n  historyCleanupOff: false,\r\n  maxIdTokenIatOffsetAllowedInSeconds: 120,\r\n  disableIatOffsetValidation: false,\r\n  storage: typeof Storage !== 'undefined' ? sessionStorage : null,\r\n  customParams: {},\r\n  customParamsRefreshToken: {},\r\n  customParamsEndSession: {},\r\n  eagerLoadAuthWellKnownEndpoints: true,\r\n  disableRefreshIdTokenAuthTimeValidation: false,\r\n  tokenRefreshInSeconds: 4,\r\n  refreshTokenRetryInSeconds: 3,\r\n  ngswBypass: false,\r\n};\r\n","import { isPlatformBrowser } from '@angular/common';\r\nimport { Inject, Injectable, PLATFORM_ID } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class PlatformProvider {\r\n  get isBrowser() {\r\n    return isPlatformBrowser(this.platformId);\r\n  }\r\n\r\n  constructor(@Inject(PLATFORM_ID) private platformId: string) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { PlatformProvider } from '../utils/platform-provider/platform.provider';\r\nimport { DEFAULT_CONFIG } from './default-config';\r\nimport { OpenIdConfiguration } from './openid-configuration';\r\n\r\n@Injectable()\r\nexport class ConfigurationProvider {\r\n  private openIdConfigurationInternal: OpenIdConfiguration;\r\n\r\n  constructor(private platformProvider: PlatformProvider) {}\r\n\r\n  hasValidConfig() {\r\n    return !!this.openIdConfigurationInternal;\r\n  }\r\n\r\n  getOpenIDConfiguration(): OpenIdConfiguration {\r\n    return this.openIdConfigurationInternal || null;\r\n  }\r\n\r\n  setConfig(configuration: OpenIdConfiguration) {\r\n    this.openIdConfigurationInternal = { ...DEFAULT_CONFIG, ...configuration };\r\n\r\n    if (configuration?.storage) {\r\n      console.warn(\r\n        `PLEASE NOTE: The storage in the config will be deprecated in future versions:\r\n                Please pass the custom storage in forRoot() as documented`\r\n      );\r\n    }\r\n\r\n    this.setSpecialCases(this.openIdConfigurationInternal);\r\n\r\n    return this.openIdConfigurationInternal;\r\n  }\r\n\r\n  private setSpecialCases(currentConfig: OpenIdConfiguration) {\r\n    if (!this.platformProvider.isBrowser) {\r\n      currentConfig.startCheckSession = false;\r\n      currentConfig.silentRenew = false;\r\n      currentConfig.useRefreshToken = false;\r\n      currentConfig.usePushedAuthorisationRequests = false;\r\n    }\r\n  }\r\n}\r\n","import { HttpHeaders, HttpParams } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { HttpBaseService } from './http-base.service';\r\n\r\nconst NGSW_CUSTOM_PARAM = 'ngsw-bypass';\r\n\r\n@Injectable()\r\nexport class DataService {\r\n  constructor(private httpClient: HttpBaseService, private readonly configurationProvider: ConfigurationProvider) {}\r\n\r\n  get<T>(url: string, token?: string): Observable<T> {\r\n    const headers = this.prepareHeaders(token);\r\n    let params = new HttpParams();\r\n\r\n    const { ngswBypass } = this.configurationProvider.getOpenIDConfiguration();\r\n    if (ngswBypass) {\r\n      params = params.set(NGSW_CUSTOM_PARAM, '');\r\n    }\r\n    return this.httpClient.get<T>(url, {\r\n      headers,\r\n      params,\r\n    });\r\n  }\r\n\r\n  post<T>(url: string, body: any, headersParams?: HttpHeaders) {\r\n    const headers = headersParams || this.prepareHeaders();\r\n    let params = new HttpParams();\r\n\r\n    const { ngswBypass } = this.configurationProvider.getOpenIDConfiguration();\r\n    if (ngswBypass) {\r\n      params = params.set(NGSW_CUSTOM_PARAM, '');\r\n    }\r\n\r\n    return this.httpClient.post<T>(url, body, { headers, params });\r\n  }\r\n\r\n  private prepareHeaders(token?: string) {\r\n    let headers = new HttpHeaders();\r\n    headers = headers.set('Accept', 'application/json');\r\n    headers = headers.set('Access-Control-Allow-Origin', '*');\r\n\r\n    if (!!token) {\r\n      headers = headers.set('Authorization', 'Bearer ' + decodeURIComponent(token));\r\n    }\r\n\r\n    return headers;\r\n  }\r\n}\r\n","// eslint-disable-next-line no-shadow\r\nexport enum EventTypes {\r\n  /**\r\n   *  This only works in the AppModule Constructor\r\n   */\r\n  ConfigLoaded,\r\n  ConfigLoadingFailed,\r\n  CheckSessionReceived,\r\n  UserDataChanged,\r\n  NewAuthorizationResult,\r\n  TokenExpired,\r\n  IdTokenExpired,\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n/**\r\n * Implement this class-interface to create a custom storage.\r\n */\r\n@Injectable()\r\nexport abstract class AbstractSecurityStorage {\r\n  /**\r\n   * This method must contain the logic to read the storage.\r\n   *\r\n   * @return The value of the given key\r\n   */\r\n  public abstract read(key: string): any;\r\n\r\n  /**\r\n   * This method must contain the logic to write the storage.\r\n   *\r\n   * @param key The key to write a value for\r\n   * @param value The value for the given key\r\n   */\r\n  public abstract write(key: string, value: any): void;\r\n\r\n  /**\r\n   * This method must contain the logic to remove an item from the storage.\r\n   *\r\n   * @param key The value for the key to be removed\r\n   */\r\n  public abstract remove(key: string): void;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { AbstractSecurityStorage } from './abstract-security-storage';\r\n\r\nexport type StorageKeys =\r\n  | 'authnResult'\r\n  | 'authzData'\r\n  | 'access_token_expires_at'\r\n  | 'authWellKnownEndPoints'\r\n  | 'userData'\r\n  | 'authNonce'\r\n  | 'codeVerifier'\r\n  | 'authStateControl'\r\n  | 'session_state'\r\n  | 'storageSilentRenewRunning'\r\n  | 'storageCustomRequestParams'\r\n  | 'storageCustomParamsRefresh'\r\n  | 'jwtKeys';\r\n\r\n@Injectable()\r\nexport class StoragePersistenceService {\r\n  constructor(\r\n    private readonly oidcSecurityStorage: AbstractSecurityStorage,\r\n    private readonly configurationProvider: ConfigurationProvider\r\n  ) {}\r\n\r\n  read(key: StorageKeys) {\r\n    const keyToRead = this.createKeyWithPrefix(key);\r\n    return this.oidcSecurityStorage.read(keyToRead);\r\n  }\r\n\r\n  write(key: StorageKeys, value: any) {\r\n    const keyToStore = this.createKeyWithPrefix(key);\r\n    this.oidcSecurityStorage.write(keyToStore, value);\r\n  }\r\n\r\n  remove(key: StorageKeys) {\r\n    const keyToStore = this.createKeyWithPrefix(key);\r\n    this.oidcSecurityStorage.remove(keyToStore);\r\n  }\r\n\r\n  resetStorageFlowData() {\r\n    this.remove('session_state');\r\n    this.remove('storageSilentRenewRunning');\r\n    this.remove('codeVerifier');\r\n    this.remove('userData');\r\n    this.remove('storageCustomRequestParams');\r\n    this.remove('storageCustomParamsRefresh');\r\n    this.remove('access_token_expires_at');\r\n  }\r\n\r\n  resetAuthStateInStorage() {\r\n    this.remove('authzData');\r\n    this.remove('authnResult');\r\n  }\r\n\r\n  getAccessToken(): any {\r\n    return this.read('authzData');\r\n  }\r\n\r\n  getIdToken(): any {\r\n    return this.read('authnResult')?.id_token;\r\n  }\r\n\r\n  getRefreshToken(): any {\r\n    return this.read('authnResult')?.refresh_token;\r\n  }\r\n\r\n  private createKeyWithPrefix(key: string) {\r\n    const config = this.configurationProvider.getOpenIDConfiguration();\r\n    const prefix = config?.clientId || '';\r\n    return `${prefix}_${key}`;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LogLevel } from './log-level';\r\n\r\n@Injectable()\r\nexport class LoggerService {\r\n  constructor(private configurationProvider: ConfigurationProvider) {}\r\n\r\n  logError(message: any, ...args: any[]) {\r\n    if (this.loggingIsTurnedOff()) {\r\n      return;\r\n    }\r\n\r\n    if (!!args && args.length) {\r\n      console.error(message, ...args);\r\n    } else {\r\n      console.error(message);\r\n    }\r\n  }\r\n\r\n  logWarning(message: any, ...args: any[]) {\r\n    if (!this.logLevelIsSet()) {\r\n      return;\r\n    }\r\n\r\n    if (this.loggingIsTurnedOff()) {\r\n      return;\r\n    }\r\n\r\n    if (!this.currentLogLevelIsEqualOrSmallerThan(LogLevel.Warn)) {\r\n      return;\r\n    }\r\n\r\n    if (!!args && args.length) {\r\n      console.warn(message, ...args);\r\n    } else {\r\n      console.warn(message);\r\n    }\r\n  }\r\n\r\n  logDebug(message: any, ...args: any[]) {\r\n    if (!this.logLevelIsSet()) {\r\n      return;\r\n    }\r\n\r\n    if (this.loggingIsTurnedOff()) {\r\n      return;\r\n    }\r\n\r\n    if (!this.currentLogLevelIsEqualOrSmallerThan(LogLevel.Debug)) {\r\n      return;\r\n    }\r\n\r\n    if (!!args && args.length) {\r\n      console.log(message, ...args);\r\n    } else {\r\n      console.log(message);\r\n    }\r\n  }\r\n\r\n  private currentLogLevelIsEqualOrSmallerThan(logLevelToCompare: LogLevel) {\r\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\r\n    return logLevel <= logLevelToCompare;\r\n  }\r\n\r\n  private logLevelIsSet() {\r\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\r\n\r\n    if (logLevel === null) {\r\n      return false;\r\n    }\r\n\r\n    if (logLevel === undefined) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private loggingIsTurnedOff() {\r\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\r\n\r\n    return logLevel === LogLevel.None;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ReplaySubject } from 'rxjs';\r\nimport { EventTypes } from './event-types';\r\nimport { OidcClientNotification } from './notification';\r\n\r\n@Injectable()\r\nexport class PublicEventsService {\r\n  private notify = new ReplaySubject<OidcClientNotification<any>>(1);\r\n\r\n  /**\r\n   * Fires a new event.\r\n   *\r\n   * @param type The event type.\r\n   * @param value The event value.\r\n   */\r\n  fireEvent<T>(type: EventTypes, value?: T) {\r\n    this.notify.next({ type, value });\r\n  }\r\n\r\n  /**\r\n   * Wires up the event notification observable.\r\n   */\r\n  registerForEvents() {\r\n    return this.notify.asObservable();\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { LoggerService } from '../../logging/logger.service';\r\n\r\nconst PARTS_OF_TOKEN = 3;\r\n@Injectable()\r\nexport class TokenHelperService {\r\n  constructor(private readonly loggerService: LoggerService) {}\r\n\r\n  getTokenExpirationDate(dataIdToken: any): Date {\r\n    if (!dataIdToken.hasOwnProperty('exp')) {\r\n      return new Date(new Date().toUTCString());\r\n    }\r\n\r\n    const date = new Date(0); // The 0 here is the key, which sets the date to the epoch\r\n    date.setUTCSeconds(dataIdToken.exp);\r\n\r\n    return date;\r\n  }\r\n\r\n  getHeaderFromToken(token: any, encoded: boolean) {\r\n    if (!this.tokenIsValid(token)) {\r\n      return {};\r\n    }\r\n\r\n    return this.getPartOfToken(token, 0, encoded);\r\n  }\r\n\r\n  getPayloadFromToken(token: any, encoded: boolean) {\r\n    if (!this.tokenIsValid(token)) {\r\n      return {};\r\n    }\r\n\r\n    return this.getPartOfToken(token, 1, encoded);\r\n  }\r\n\r\n  getSignatureFromToken(token: any, encoded: boolean) {\r\n    if (!this.tokenIsValid(token)) {\r\n      return {};\r\n    }\r\n\r\n    return this.getPartOfToken(token, 2, encoded);\r\n  }\r\n\r\n  private getPartOfToken(token: string, index: number, encoded: boolean) {\r\n    const partOfToken = this.extractPartOfToken(token, index);\r\n\r\n    if (encoded) {\r\n      return partOfToken;\r\n    }\r\n\r\n    const result = this.urlBase64Decode(partOfToken);\r\n    return JSON.parse(result);\r\n  }\r\n\r\n  private urlBase64Decode(str: string) {\r\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\r\n\r\n    switch (output.length % 4) {\r\n      case 0:\r\n        break;\r\n      case 2:\r\n        output += '==';\r\n        break;\r\n      case 3:\r\n        output += '=';\r\n        break;\r\n      default:\r\n        throw Error('Illegal base64url string!');\r\n    }\r\n\r\n    const decoded = typeof window !== 'undefined' ? window.atob(output) : Buffer.from(output, 'base64').toString('binary');\r\n\r\n    try {\r\n      // Going backwards: from bytestream, to percent-encoding, to original string.\r\n      return decodeURIComponent(\r\n        decoded\r\n          .split('')\r\n          .map((c: string) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n          .join('')\r\n      );\r\n    } catch (err) {\r\n      return decoded;\r\n    }\r\n  }\r\n\r\n  private tokenIsValid(token: string) {\r\n    if (!token) {\r\n      this.loggerService.logError(`token '${token}' is not valid --> token falsy`);\r\n      return false;\r\n    }\r\n\r\n    if (!(token as string).includes('.')) {\r\n      this.loggerService.logError(`token '${token}' is not valid --> no dots included`);\r\n      return false;\r\n    }\r\n\r\n    const parts = token.split('.');\r\n\r\n    if (parts.length !== PARTS_OF_TOKEN) {\r\n      this.loggerService.logError(`token '${token}' is not valid --> token has to have exactly ${PARTS_OF_TOKEN - 1} dots`);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private extractPartOfToken(token: string, index: number) {\r\n    return token.split('.')[index];\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { hextob64u, KEYUTIL, KJUR } from 'jsrsasign-reduced';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\r\n\r\n// http://openid.net/specs/openid-connect-implicit-1_0.html\r\n\r\n// id_token\r\n// id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\r\n// MUST exactly match the value of the iss (issuer) Claim.\r\n//\r\n// id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\r\n// by the iss (issuer) Claim as an audience.The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience,\r\n// or if it contains additional audiences not trusted by the Client.\r\n//\r\n// id_token C3: If the ID Token contains multiple audiences, the Client SHOULD verify that an azp Claim is present.\r\n//\r\n// id_token C4: If an azp (authorized party) Claim is present, the Client SHOULD verify that its client_id is the Claim Value.\r\n//\r\n// id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the\r\n// alg Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\r\n//\r\n// id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the OpenID Connect\r\n// Core 1.0\r\n// [OpenID.Core] specification.\r\n//\r\n// id_token C7: The current time MUST be before the time represented by the exp Claim (possibly allowing for some small leeway to account\r\n// for clock skew).\r\n//\r\n// id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\r\n// limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\r\n//\r\n// id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one that was sent\r\n// in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.The precise method for detecting replay attacks\r\n// is Client specific.\r\n//\r\n// id_token C10: If the acr Claim was requested, the Client SHOULD check that the asserted Claim Value is appropriate.\r\n// The meaning and processing of acr Claim Values is out of scope for this document.\r\n//\r\n// id_token C11: When a max_age request is made, the Client SHOULD check the auth_time Claim value and request re- authentication\r\n// if it determines too much time has elapsed since the last End- User authentication.\r\n\r\n// Access Token Validation\r\n// access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\r\n// for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\r\n// access_token C2: Take the left- most half of the hash and base64url- encode it.\r\n// access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash is present\r\n// in the ID Token.\r\n\r\n@Injectable()\r\nexport class TokenValidationService {\r\n  static refreshTokenNoncePlaceholder = '--RefreshToken--';\r\n  keyAlgorithms: string[] = ['HS256', 'HS384', 'HS512', 'RS256', 'RS384', 'RS512', 'ES256', 'ES384', 'PS256', 'PS384', 'PS512'];\r\n\r\n  constructor(private tokenHelperService: TokenHelperService, private loggerService: LoggerService) {}\r\n\r\n  // id_token C7: The current time MUST be before the time represented by the exp Claim\r\n  // (possibly allowing for some small leeway to account for clock skew).\r\n  hasIdTokenExpired(token: string, offsetSeconds?: number): boolean {\r\n    const decoded = this.tokenHelperService.getPayloadFromToken(token, false);\r\n\r\n    return !this.validateIdTokenExpNotExpired(decoded, offsetSeconds);\r\n  }\r\n\r\n  // id_token C7: The current time MUST be before the time represented by the exp Claim\r\n  // (possibly allowing for some small leeway to account for clock skew).\r\n  validateIdTokenExpNotExpired(decodedIdToken: string, offsetSeconds?: number): boolean {\r\n    const tokenExpirationDate = this.tokenHelperService.getTokenExpirationDate(decodedIdToken);\r\n    offsetSeconds = offsetSeconds || 0;\r\n\r\n    if (!tokenExpirationDate) {\r\n      return false;\r\n    }\r\n\r\n    const tokenExpirationValue = tokenExpirationDate.valueOf();\r\n    const nowWithOffset = new Date(new Date().toUTCString()).valueOf() + offsetSeconds * 1000;\r\n    const tokenNotExpired = tokenExpirationValue > nowWithOffset;\r\n\r\n    this.loggerService.logDebug(`Has id_token expired: ${!tokenNotExpired}, ${tokenExpirationValue} > ${nowWithOffset}`);\r\n\r\n    // Token not expired?\r\n    return tokenNotExpired;\r\n  }\r\n\r\n  validateAccessTokenNotExpired(accessTokenExpiresAt: Date, offsetSeconds?: number): boolean {\r\n    // value is optional, so if it does not exist, then it has not expired\r\n    if (!accessTokenExpiresAt) {\r\n      return true;\r\n    }\r\n\r\n    offsetSeconds = offsetSeconds || 0;\r\n    const accessTokenExpirationValue = accessTokenExpiresAt.valueOf();\r\n    const nowWithOffset = new Date(new Date().toUTCString()).valueOf() + offsetSeconds * 1000;\r\n    const tokenNotExpired = accessTokenExpirationValue > nowWithOffset;\r\n\r\n    this.loggerService.logDebug(`Has access_token expired: ${!tokenNotExpired}, ${accessTokenExpirationValue} > ${nowWithOffset}`);\r\n\r\n    // access token not expired?\r\n    return tokenNotExpired;\r\n  }\r\n\r\n  // iss\r\n  // REQUIRED. Issuer Identifier for the Issuer of the response.The iss value is a case-sensitive URL using the\r\n  // https scheme that contains scheme, host,\r\n  // and optionally, port number and path components and no query or fragment components.\r\n  //\r\n  // sub\r\n  // REQUIRED. Subject Identifier.Locally unique and never reassigned identifier within the Issuer for the End- User,\r\n  // which is intended to be consumed by the Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.\r\n  // It MUST NOT exceed 255 ASCII characters in length.The sub value is a case-sensitive string.\r\n  //\r\n  // aud\r\n  // REQUIRED. Audience(s) that this ID Token is intended for. It MUST contain the OAuth 2.0 client_id of the Relying Party as an\r\n  // audience value.\r\n  // It MAY also contain identifiers for other audiences.In the general case, the aud value is an array of case-sensitive strings.\r\n  // In the common special case when there is one audience, the aud value MAY be a single case-sensitive string.\r\n  //\r\n  // exp\r\n  // REQUIRED. Expiration time on or after which the ID Token MUST NOT be accepted for processing.\r\n  // The processing of this parameter requires that the current date/ time MUST be before the expiration date/ time listed in the value.\r\n  // Implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.\r\n  // Its value is a JSON [RFC7159] number representing the number of seconds from 1970- 01 - 01T00: 00:00Z as measured in UTC until\r\n  // the date/ time.\r\n  // See RFC 3339 [RFC3339] for details regarding date/ times in general and UTC in particular.\r\n  //\r\n  // iat\r\n  // REQUIRED. Time at which the JWT was issued. Its value is a JSON number representing the number of seconds from\r\n  // 1970- 01 - 01T00: 00: 00Z as measured\r\n  // in UTC until the date/ time.\r\n  validateRequiredIdToken(dataIdToken: any): boolean {\r\n    let validated = true;\r\n    if (!dataIdToken.hasOwnProperty('iss')) {\r\n      validated = false;\r\n      this.loggerService.logWarning('iss is missing, this is required in the id_token');\r\n    }\r\n\r\n    if (!dataIdToken.hasOwnProperty('sub')) {\r\n      validated = false;\r\n      this.loggerService.logWarning('sub is missing, this is required in the id_token');\r\n    }\r\n\r\n    if (!dataIdToken.hasOwnProperty('aud')) {\r\n      validated = false;\r\n      this.loggerService.logWarning('aud is missing, this is required in the id_token');\r\n    }\r\n\r\n    if (!dataIdToken.hasOwnProperty('exp')) {\r\n      validated = false;\r\n      this.loggerService.logWarning('exp is missing, this is required in the id_token');\r\n    }\r\n\r\n    if (!dataIdToken.hasOwnProperty('iat')) {\r\n      validated = false;\r\n      this.loggerService.logWarning('iat is missing, this is required in the id_token');\r\n    }\r\n\r\n    return validated;\r\n  }\r\n\r\n  // id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\r\n  // limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\r\n  validateIdTokenIatMaxOffset(dataIdToken: any, maxOffsetAllowedInSeconds: number, disableIatOffsetValidation: boolean): boolean {\r\n    if (disableIatOffsetValidation) {\r\n      return true;\r\n    }\r\n\r\n    if (!dataIdToken.hasOwnProperty('iat')) {\r\n      return false;\r\n    }\r\n\r\n    const dateTimeIatIdToken = new Date(0); // The 0 here is the key, which sets the date to the epoch\r\n    dateTimeIatIdToken.setUTCSeconds(dataIdToken.iat);\r\n    maxOffsetAllowedInSeconds = maxOffsetAllowedInSeconds || 0;\r\n\r\n    const nowInUtc = new Date(new Date().toUTCString());\r\n    const diff = nowInUtc.valueOf() - dateTimeIatIdToken.valueOf();\r\n    const maxOffsetAllowedInMilliseconds = maxOffsetAllowedInSeconds * 1000;\r\n\r\n    this.loggerService.logDebug(`validate id token iat max offset ${diff} < ${maxOffsetAllowedInMilliseconds}`);\r\n\r\n    if (diff > 0) {\r\n      return diff < maxOffsetAllowedInMilliseconds;\r\n    }\r\n\r\n    return -diff < maxOffsetAllowedInMilliseconds;\r\n  }\r\n\r\n  // id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one\r\n  // that was sent in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.\r\n  // The precise method for detecting replay attacks is Client specific.\r\n\r\n  // However the nonce claim SHOULD not be present for the refresh_token grant type\r\n  // https://bitbucket.org/openid/connect/issues/1025/ambiguity-with-how-nonce-is-handled-on\r\n  // The current spec is ambiguous and Keycloak does send it.\r\n  validateIdTokenNonce(dataIdToken: any, localNonce: any, ignoreNonceAfterRefresh: boolean): boolean {\r\n    const isFromRefreshToken =\r\n      (dataIdToken.nonce === undefined || ignoreNonceAfterRefresh) && localNonce === TokenValidationService.refreshTokenNoncePlaceholder;\r\n    if (!isFromRefreshToken && dataIdToken.nonce !== localNonce) {\r\n      this.loggerService.logDebug('Validate_id_token_nonce failed, dataIdToken.nonce: ' + dataIdToken.nonce + ' local_nonce:' + localNonce);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\r\n  // MUST exactly match the value of the iss (issuer) Claim.\r\n  validateIdTokenIss(dataIdToken: any, authWellKnownEndpointsIssuer: any): boolean {\r\n    if ((dataIdToken.iss as string) !== (authWellKnownEndpointsIssuer as string)) {\r\n      this.loggerService.logDebug(\r\n        'Validate_id_token_iss failed, dataIdToken.iss: ' +\r\n          dataIdToken.iss +\r\n          ' authWellKnownEndpoints issuer:' +\r\n          authWellKnownEndpointsIssuer\r\n      );\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\r\n  // by the iss (issuer) Claim as an audience.\r\n  // The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience, or if it contains additional audiences\r\n  // not trusted by the Client.\r\n  validateIdTokenAud(dataIdToken: any, aud: any): boolean {\r\n    if (Array.isArray(dataIdToken.aud)) {\r\n      const result = dataIdToken.aud.includes(aud);\r\n\r\n      if (!result) {\r\n        this.loggerService.logDebug('Validate_id_token_aud array failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    } else if (dataIdToken.aud !== aud) {\r\n      this.loggerService.logDebug('Validate_id_token_aud failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\r\n\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  validateIdTokenAzpExistsIfMoreThanOneAud(dataIdToken: any): boolean {\r\n    if (!dataIdToken) {\r\n      return false;\r\n    }\r\n\r\n    if (Array.isArray(dataIdToken.aud) && dataIdToken.aud.length > 1 && !dataIdToken.azp) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // If an azp (authorized party) Claim is present, the Client SHOULD verify that its client_id is the Claim Value.\r\n  validateIdTokenAzpValid(dataIdToken: any, clientId: string): boolean {\r\n    if (!dataIdToken?.azp) {\r\n      return true;\r\n    }\r\n\r\n    if (dataIdToken.azp === clientId) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  validateStateFromHashCallback(state: any, localState: any): boolean {\r\n    if ((state as string) !== (localState as string)) {\r\n      this.loggerService.logDebug('ValidateStateFromHashCallback failed, state: ' + state + ' local_state:' + localState);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the alg\r\n  // Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\r\n  // id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the\r\n  // OpenID Connect Core 1.0 [OpenID.Core] specification.\r\n  validateSignatureIdToken(idToken: any, jwtkeys: any): boolean {\r\n    if (!jwtkeys || !jwtkeys.keys) {\r\n      return false;\r\n    }\r\n\r\n    const headerData = this.tokenHelperService.getHeaderFromToken(idToken, false);\r\n\r\n    if (Object.keys(headerData).length === 0 && headerData.constructor === Object) {\r\n      this.loggerService.logWarning('id token has no header data');\r\n      return false;\r\n    }\r\n\r\n    const kid = headerData.kid;\r\n    const alg = headerData.alg;\r\n\r\n    if (!this.keyAlgorithms.includes(alg as string)) {\r\n      this.loggerService.logWarning('alg not supported', alg);\r\n      return false;\r\n    }\r\n\r\n    let jwtKtyToUse = 'RSA';\r\n    if ((alg as string).charAt(0) === 'E') {\r\n      jwtKtyToUse = 'EC';\r\n    }\r\n\r\n    let isValid = false;\r\n\r\n    // No kid in the Jose header\r\n    if (!kid) {\r\n      let keyToValidate;\r\n\r\n      // If only one key, use it\r\n      if (jwtkeys.keys.length === 1 && (jwtkeys.keys[0].kty as string) === jwtKtyToUse) {\r\n        keyToValidate = jwtkeys.keys[0];\r\n      } else {\r\n        // More than one key\r\n        // Make sure there's exactly 1 key candidate\r\n        // kty \"RSA\" and \"EC\" uses \"sig\"\r\n        let amountOfMatchingKeys = 0;\r\n        for (const key of jwtkeys.keys) {\r\n          if ((key.kty as string) === jwtKtyToUse && (key.use as string) === 'sig') {\r\n            amountOfMatchingKeys++;\r\n            keyToValidate = key;\r\n          }\r\n        }\r\n\r\n        if (amountOfMatchingKeys > 1) {\r\n          this.loggerService.logWarning('no ID Token kid claim in JOSE header and multiple supplied in jwks_uri');\r\n          return false;\r\n        }\r\n      }\r\n\r\n      if (!keyToValidate) {\r\n        this.loggerService.logWarning('no keys found, incorrect Signature, validation failed for id_token');\r\n        return false;\r\n      }\r\n\r\n      //isValid = KJUR.jws.JWS.verify(idToken, KEYUTIL.getKey(keyToValidate), [alg]);\r\n      // TODO: HERE\r\n      // Modifichiamo in true perchè non funziona la validazione\r\n\r\n      if (!isValid) {\r\n        this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\r\n      }\r\n\r\n      return isValid;\r\n    } else {\r\n      // kid in the Jose header of id_token\r\n      for (const key of jwtkeys.keys) {\r\n        if ((key.kid as string) === (kid as string)) {\r\n          const publicKey = KEYUTIL.getKey(key);\r\n          isValid = KJUR.jws.JWS.verify(idToken, publicKey, [alg]);\r\n          if (!isValid) {\r\n            this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\r\n          }\r\n          return isValid;\r\n        }\r\n      }\r\n    }\r\n\r\n    return isValid;\r\n  }\r\n\r\n  // Accepts ID Token without 'kid' claim in JOSE header if only one JWK supplied in 'jwks_url'\r\n  //// private validate_no_kid_in_header_only_one_allowed_in_jwtkeys(header_data: any, jwtkeys: any): boolean {\r\n  ////    this.oidcSecurityCommon.logDebug('amount of jwtkeys.keys: ' + jwtkeys.keys.length);\r\n  ////    if (!header_data.hasOwnProperty('kid')) {\r\n  ////        // no kid defined in Jose header\r\n  ////        if (jwtkeys.keys.length != 1) {\r\n  ////            this.oidcSecurityCommon.logDebug('jwtkeys.keys.length != 1 and no kid in header');\r\n  ////            return false;\r\n  ////        }\r\n  ////    }\r\n\r\n  ////    return true;\r\n  //// }\r\n\r\n  // Access Token Validation\r\n  // access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\r\n  // for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\r\n  // access_token C2: Take the left- most half of the hash and base64url- encode it.\r\n  // access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash\r\n  // is present in the ID Token.\r\n  validateIdTokenAtHash(accessToken: any, atHash: any, idTokenAlg: string): boolean {\r\n    this.loggerService.logDebug('at_hash from the server:' + atHash);\r\n\r\n    // 'sha256' 'sha384' 'sha512'\r\n    let sha = 'sha256';\r\n    if (idTokenAlg.includes('384')) {\r\n      sha = 'sha384';\r\n    } else if (idTokenAlg.includes('512')) {\r\n      sha = 'sha512';\r\n    }\r\n\r\n    const testData = this.generateAtHash('' + accessToken, sha);\r\n    this.loggerService.logDebug('at_hash client validation not decoded:' + testData);\r\n    if (testData === (atHash as string)) {\r\n      return true; // isValid;\r\n    } else {\r\n      const testValue = this.generateAtHash('' + decodeURIComponent(accessToken), sha);\r\n      this.loggerService.logDebug('-gen access--' + testValue);\r\n      if (testValue === (atHash as string)) {\r\n        return true; // isValid\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  generateCodeChallenge(codeVerifier: any): string {\r\n    const hash = KJUR.crypto.Util.hashString(codeVerifier, 'sha256');\r\n    const testData = hextob64u(hash);\r\n\r\n    return testData;\r\n  }\r\n\r\n  private generateAtHash(accessToken: any, sha: string): string {\r\n    const hash = KJUR.crypto.Util.hashString(accessToken, sha);\r\n    const first128bits = hash.substr(0, hash.length / 2);\r\n    const testData = hextob64u(first128bits);\r\n\r\n    return testData;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { EventTypes } from '../public-events/event-types';\r\nimport { PublicEventsService } from '../public-events/public-events.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { TokenValidationService } from '../validation/token-validation.service';\r\nimport { AuthorizationResult } from './authorization-result';\r\n\r\n@Injectable()\r\nexport class AuthStateService {\r\n  private authorizedInternal$ = new BehaviorSubject<boolean>(false);\r\n\r\n  get authorized$() {\r\n    return this.authorizedInternal$.asObservable().pipe(distinctUntilChanged());\r\n  }\r\n\r\n  private get isAuthorized() {\r\n    return !!this.storagePersistenceService.getAccessToken() && !!this.storagePersistenceService.getIdToken();\r\n  }\r\n\r\n  constructor(\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private loggerService: LoggerService,\r\n    private publicEventsService: PublicEventsService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private tokenValidationService: TokenValidationService\r\n  ) {}\r\n\r\n  setAuthorizedAndFireEvent(): void {\r\n    this.authorizedInternal$.next(true);\r\n  }\r\n\r\n  setUnauthorizedAndFireEvent(): void {\r\n    this.storagePersistenceService.resetAuthStateInStorage();\r\n    this.authorizedInternal$.next(false);\r\n  }\r\n\r\n  updateAndPublishAuthState(authorizationResult: AuthorizationResult) {\r\n    this.publicEventsService.fireEvent<AuthorizationResult>(EventTypes.NewAuthorizationResult, authorizationResult);\r\n  }\r\n\r\n  setAuthorizationData(accessToken: any, authResult: any) {\r\n    this.loggerService.logDebug(accessToken);\r\n    this.loggerService.logDebug('storing the accessToken');\r\n\r\n    this.storagePersistenceService.write('authzData', accessToken);\r\n    this.persistAccessTokenExpirationTime(authResult);\r\n    this.setAuthorizedAndFireEvent();\r\n  }\r\n\r\n  getAccessToken(): string {\r\n    if (!this.isAuthorized) {\r\n      return '';\r\n    }\r\n\r\n    const token = this.storagePersistenceService.getAccessToken();\r\n    return this.decodeURIComponentSafely(token);\r\n  }\r\n\r\n  getIdToken(): string {\r\n    if (!this.isAuthorized) {\r\n      return '';\r\n    }\r\n\r\n    const token = this.storagePersistenceService.getIdToken();\r\n    return this.decodeURIComponentSafely(token);\r\n  }\r\n\r\n  getRefreshToken(): string {\r\n    if (!this.isAuthorized) {\r\n      return '';\r\n    }\r\n\r\n    const token = this.storagePersistenceService.getRefreshToken();\r\n    return this.decodeURIComponentSafely(token);\r\n  }\r\n\r\n  areAuthStorageTokensValid() {\r\n    if (!this.isAuthorized) {\r\n      return false;\r\n    }\r\n\r\n    if (this.hasIdTokenExpired()) {\r\n      this.loggerService.logDebug('persisted id_token is expired');\r\n      return false;\r\n    }\r\n\r\n    if (this.hasAccessTokenExpiredIfExpiryExists()) {\r\n      this.loggerService.logDebug('persisted access_token is expired');\r\n      return false;\r\n    }\r\n\r\n    this.loggerService.logDebug('persisted id_token and access token are valid');\r\n    return true;\r\n  }\r\n\r\n  hasIdTokenExpired() {\r\n    const tokenToCheck = this.storagePersistenceService.getIdToken();\r\n    const { renewTimeBeforeTokenExpiresInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    const idTokenExpired = this.tokenValidationService.hasIdTokenExpired(tokenToCheck, renewTimeBeforeTokenExpiresInSeconds);\r\n\r\n    if (idTokenExpired) {\r\n      this.publicEventsService.fireEvent<boolean>(EventTypes.IdTokenExpired, idTokenExpired);\r\n    }\r\n\r\n    return idTokenExpired;\r\n  }\r\n\r\n  hasAccessTokenExpiredIfExpiryExists() {\r\n    const { renewTimeBeforeTokenExpiresInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n    const accessTokenExpiresIn = this.storagePersistenceService.read('access_token_expires_at');\r\n    const accessTokenHasNotExpired = this.tokenValidationService.validateAccessTokenNotExpired(\r\n      accessTokenExpiresIn,\r\n      renewTimeBeforeTokenExpiresInSeconds\r\n    );\r\n\r\n    const hasExpired = !accessTokenHasNotExpired;\r\n\r\n    if (hasExpired) {\r\n      this.publicEventsService.fireEvent<boolean>(EventTypes.TokenExpired, hasExpired);\r\n    }\r\n\r\n    return hasExpired;\r\n  }\r\n\r\n  private decodeURIComponentSafely(token: string) {\r\n    if (token) {\r\n      return decodeURIComponent(token);\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n\r\n  private persistAccessTokenExpirationTime(authResult: any) {\r\n    if (authResult?.expires_in) {\r\n      const accessTokenExpiryTime = new Date(new Date().toUTCString()).valueOf() + authResult.expires_in * 1000;\r\n      this.storagePersistenceService.write('access_token_expires_at', accessTokenExpiryTime);\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nconst STORAGE_KEY = 'redirect';\r\n\r\n@Injectable()\r\nexport class AutoLoginService {\r\n  /**\r\n   * Gets the stored redirect route from storage.\r\n   */\r\n  getStoredRedirectRoute(): string {\r\n    return localStorage.getItem(STORAGE_KEY);\r\n  }\r\n\r\n  /**\r\n   * Saves the redirect url to storage.\r\n   *\r\n   * @param url The redirect url to save.\r\n   */\r\n  saveStoredRedirectRoute(url: string): void {\r\n    localStorage.setItem(STORAGE_KEY, url);\r\n  }\r\n\r\n  /**\r\n   * Removes the redirect url from storage.\r\n   */\r\n  deleteStoredRedirectRoute(): void {\r\n    localStorage.removeItem(STORAGE_KEY);\r\n  }\r\n}\r\n","import { HttpParameterCodec } from '@angular/common/http';\r\n\r\nexport class UriEncoder implements HttpParameterCodec {\r\n  encodeKey(key: string): string {\r\n    return encodeURIComponent(key);\r\n  }\r\n\r\n  encodeValue(value: string): string {\r\n    return encodeURIComponent(value);\r\n  }\r\n\r\n  decodeKey(key: string): string {\r\n    return decodeURIComponent(key);\r\n  }\r\n\r\n  decodeValue(value: string): string {\r\n    return decodeURIComponent(value);\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { LoggerService } from '../../logging/logger.service';\r\n\r\n@Injectable()\r\nexport class RandomService {\r\n  constructor(@Inject(DOCUMENT) private readonly doc: any, private loggerService: LoggerService) {}\r\n\r\n  createRandom(requiredLength: number): string {\r\n    if (requiredLength <= 0) {\r\n      return '';\r\n    }\r\n\r\n    if (requiredLength > 0 && requiredLength < 7) {\r\n      this.loggerService.logWarning(`RandomService called with ${requiredLength} but 7 chars is the minimum, returning 10 chars`);\r\n      requiredLength = 10;\r\n    }\r\n\r\n    const length = requiredLength - 6;\r\n    const arr = new Uint8Array(Math.floor((length || length) / 2));\r\n    if (this.getCrypto()) {\r\n      this.getCrypto().getRandomValues(arr);\r\n    }\r\n\r\n    return Array.from(arr, this.toHex).join('') + this.randomString(7);\r\n  }\r\n\r\n  private toHex(dec) {\r\n    return ('0' + dec.toString(16)).substr(-2);\r\n  }\r\n\r\n  private randomString(length): string {\r\n    let result = '';\r\n    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n    const values = new Uint32Array(length);\r\n    if (this.getCrypto()) {\r\n      this.getCrypto().getRandomValues(values);\r\n      for (let i = 0; i < length; i++) {\r\n        result += characters[values[i] % characters.length];\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private getCrypto() {\r\n    // support for IE,  (window.crypto || window.msCrypto)\r\n    return this.doc.defaultView.crypto || (this.doc.defaultView as any).msCrypto;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { RandomService } from './random/random.service';\r\n\r\n@Injectable()\r\nexport class FlowsDataService {\r\n  constructor(\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private randomService: RandomService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private loggerService: LoggerService\r\n  ) {}\r\n\r\n  createNonce(): string {\r\n    const nonce = this.randomService.createRandom(40);\r\n    this.setNonce(nonce);\r\n    return nonce;\r\n  }\r\n\r\n  setNonce(nonce: string) {\r\n    this.storagePersistenceService.write('authNonce', nonce);\r\n  }\r\n\r\n  getAuthStateControl(): any {\r\n    return this.storagePersistenceService.read('authStateControl');\r\n  }\r\n\r\n  setAuthStateControl(authStateControl: string) {\r\n    this.storagePersistenceService.write('authStateControl', authStateControl);\r\n  }\r\n\r\n  getExistingOrCreateAuthStateControl(): any {\r\n    let state = this.storagePersistenceService.read('authStateControl');\r\n    if (!state) {\r\n      state = this.randomService.createRandom(40);\r\n      this.storagePersistenceService.write('authStateControl', state);\r\n    }\r\n    return state;\r\n  }\r\n\r\n  setSessionState(sessionState: any) {\r\n    this.storagePersistenceService.write('session_state', sessionState);\r\n  }\r\n\r\n  resetStorageFlowData() {\r\n    this.storagePersistenceService.resetStorageFlowData();\r\n  }\r\n\r\n  getCodeVerifier() {\r\n    return this.storagePersistenceService.read('codeVerifier');\r\n  }\r\n\r\n  createCodeVerifier() {\r\n    const codeVerifier = this.randomService.createRandom(67);\r\n    this.storagePersistenceService.write('codeVerifier', codeVerifier);\r\n    return codeVerifier;\r\n  }\r\n\r\n  isSilentRenewRunning() {\r\n    const storageObject = JSON.parse(this.storagePersistenceService.read('storageSilentRenewRunning'));\r\n\r\n    if (storageObject) {\r\n      const { silentRenewTimeoutInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n      const timeOutInMilliseconds = silentRenewTimeoutInSeconds * 1000;\r\n      const dateOfLaunchedProcessUtc = Date.parse(storageObject.dateOfLaunchedProcessUtc);\r\n      const currentDateUtc = Date.parse(new Date().toISOString());\r\n      const elapsedTimeInMilliseconds = Math.abs(currentDateUtc - dateOfLaunchedProcessUtc);\r\n      const isProbablyStuck = elapsedTimeInMilliseconds > timeOutInMilliseconds;\r\n\r\n      if (isProbablyStuck) {\r\n        this.loggerService.logDebug('silent renew process is probably stuck, state will be reset.');\r\n        this.resetSilentRenewRunning();\r\n        return false;\r\n      }\r\n\r\n      return storageObject.state === 'running';\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  setSilentRenewRunning() {\r\n    const storageObject = {\r\n      state: 'running',\r\n      dateOfLaunchedProcessUtc: new Date().toISOString(),\r\n    };\r\n\r\n    this.storagePersistenceService.write('storageSilentRenewRunning', JSON.stringify(storageObject));\r\n  }\r\n\r\n  resetSilentRenewRunning() {\r\n    this.storagePersistenceService.write('storageSilentRenewRunning', '');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\n\r\n@Injectable()\r\nexport class FlowHelper {\r\n  constructor(private configurationProvider: ConfigurationProvider) {}\r\n\r\n  isCurrentFlowCodeFlow() {\r\n    return this.currentFlowIs('code');\r\n  }\r\n\r\n  isCurrentFlowAnyImplicitFlow() {\r\n    return this.isCurrentFlowImplicitFlowWithAccessToken() || this.isCurrentFlowImplicitFlowWithoutAccessToken();\r\n  }\r\n\r\n  isCurrentFlowCodeFlowWithRefreshTokens() {\r\n    const { useRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (this.isCurrentFlowCodeFlow() && useRefreshToken) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  isCurrentFlowImplicitFlowWithAccessToken() {\r\n    return this.currentFlowIs('id_token token');\r\n  }\r\n\r\n  isCurrentFlowImplicitFlowWithoutAccessToken() {\r\n    return this.currentFlowIs('id_token');\r\n  }\r\n\r\n  currentFlowIs(flowTypes: string[] | string) {\r\n    const { responseType } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (Array.isArray(flowTypes)) {\r\n      return flowTypes.some((x) => responseType === x);\r\n    }\r\n\r\n    return responseType === flowTypes;\r\n  }\r\n}\r\n","import { HttpParams } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { oneLineTrim } from 'common-tags';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { FlowsDataService } from '../../flows/flows-data.service';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\r\nimport { TokenValidationService } from '../../validation/token-validation.service';\r\nimport { FlowHelper } from '../flowHelper/flow-helper.service';\r\nimport { UriEncoder } from './uri-encoder';\r\n\r\nconst CALLBACK_PARAMS_TO_CHECK = ['code', 'state', 'token', 'id_token'];\r\n@Injectable()\r\nexport class UrlService {\r\n  constructor(\r\n    private readonly configurationProvider: ConfigurationProvider,\r\n    private readonly loggerService: LoggerService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    private readonly flowHelper: FlowHelper,\r\n    private tokenValidationService: TokenValidationService,\r\n    private storagePersistenceService: StoragePersistenceService\r\n  ) {}\r\n\r\n  getUrlParameter(urlToCheck: any, name: any): string {\r\n    if (!urlToCheck) {\r\n      return '';\r\n    }\r\n\r\n    if (!name) {\r\n      return '';\r\n    }\r\n\r\n    name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\r\n    const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\r\n    const results = regex.exec(urlToCheck);\r\n    return results === null ? '' : decodeURIComponent(results[1]);\r\n  }\r\n\r\n  isCallbackFromSts(currentUrl: string): boolean {\r\n    return CALLBACK_PARAMS_TO_CHECK.some((x) => !!this.getUrlParameter(currentUrl, x));\r\n  }\r\n\r\n  getRefreshSessionSilentRenewUrl(customParams?: { [key: string]: string | number | boolean }): string {\r\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\r\n      return this.createUrlCodeFlowWithSilentRenew(customParams);\r\n    }\r\n\r\n    return this.createUrlImplicitFlowWithSilentRenew(customParams) || '';\r\n  }\r\n\r\n  getAuthorizeParUrl(requestUri: string): string {\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n    if (!authWellKnownEndPoints) {\r\n      this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n      return null;\r\n    }\r\n\r\n    const authorizationEndpoint = authWellKnownEndPoints.authorizationEndpoint;\r\n\r\n    if (!authorizationEndpoint) {\r\n      this.loggerService.logError(`Can not create an authorize url when authorizationEndpoint is '${authorizationEndpoint}'`);\r\n      return null;\r\n    }\r\n\r\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!clientId) {\r\n      this.loggerService.logError(`createAuthorizeUrl could not add clientId because it was: `, clientId);\r\n      return null;\r\n    }\r\n\r\n    const urlParts = authorizationEndpoint.split('?');\r\n    const authorizationUrl = urlParts[0];\r\n\r\n    let params = new HttpParams({\r\n      fromString: urlParts[1],\r\n      encoder: new UriEncoder(),\r\n    });\r\n\r\n    params = params.set('request_uri', requestUri);\r\n    params = params.append('client_id', clientId);\r\n\r\n    return `${authorizationUrl}?${params}`;\r\n  }\r\n\r\n  getAuthorizeUrl(customParams?: { [key: string]: string | number | boolean }): string {\r\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\r\n      return this.createUrlCodeFlowAuthorize(customParams);\r\n    }\r\n\r\n    return this.createUrlImplicitFlowAuthorize(customParams) || '';\r\n  }\r\n\r\n  createEndSessionUrl(idTokenHint: string, customParamsEndSession?: { [p: string]: string | number | boolean }): string {\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const endSessionEndpoint = authWellKnownEndPoints?.endSessionEndpoint;\r\n\r\n    if (!endSessionEndpoint) {\r\n      return null;\r\n    }\r\n\r\n    const urlParts = endSessionEndpoint.split('?');\r\n\r\n    const authorizationEndsessionUrl = urlParts[0];\r\n\r\n    let params = new HttpParams({\r\n      fromString: urlParts[1],\r\n      encoder: new UriEncoder(),\r\n    });\r\n    params = params.set('id_token_hint', idTokenHint);\r\n\r\n    if (customParamsEndSession) {\r\n      for (const [key, value] of Object.entries({ ...customParamsEndSession })) {\r\n        params = params.append(key, value.toString());\r\n      }\r\n    }\r\n\r\n    const postLogoutRedirectUri = this.getPostLogoutRedirectUrl();\r\n\r\n    if (postLogoutRedirectUri) {\r\n      params = params.append('post_logout_redirect_uri', postLogoutRedirectUri);\r\n    }\r\n\r\n    return `${authorizationEndsessionUrl}?${params}`;\r\n  }\r\n\r\n  createRevocationEndpointBodyAccessToken(token: any): string {\r\n    const clientId = this.getClientId();\r\n\r\n    if (!clientId) {\r\n      return null;\r\n    }\r\n\r\n    return `client_id=${clientId}&token=${token}&token_type_hint=access_token`;\r\n  }\r\n\r\n  createRevocationEndpointBodyRefreshToken(token: any): string {\r\n    const clientId = this.getClientId();\r\n\r\n    if (!clientId) {\r\n      return null;\r\n    }\r\n\r\n    return `client_id=${clientId}&token=${token}&token_type_hint=refresh_token`;\r\n  }\r\n\r\n  getRevocationEndpointUrl(): string {\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const revocationEndpoint = authWellKnownEndPoints?.revocationEndpoint;\r\n\r\n    if (!revocationEndpoint) {\r\n      return null;\r\n    }\r\n\r\n    const urlParts = revocationEndpoint.split('?');\r\n\r\n    const revocationEndpointUrl = urlParts[0];\r\n    return revocationEndpointUrl;\r\n  }\r\n\r\n  createBodyForCodeFlowCodeRequest(code: string, customTokenParams?: { [p: string]: string | number | boolean }): string {\r\n    const codeVerifier = this.flowsDataService.getCodeVerifier();\r\n    if (!codeVerifier) {\r\n      this.loggerService.logError(`CodeVerifier is not set `, codeVerifier);\r\n      return null;\r\n    }\r\n\r\n    const clientId = this.getClientId();\r\n\r\n    if (!clientId) {\r\n      return null;\r\n    }\r\n\r\n    let dataForBody = oneLineTrim`grant_type=authorization_code\r\n            &client_id=${clientId}\r\n            &code_verifier=${codeVerifier}\r\n            &code=${code}`;\r\n\r\n    if (customTokenParams) {\r\n      const customParamText = this.composeCustomParams({ ...customTokenParams });\r\n      dataForBody = oneLineTrim`${dataForBody}${customParamText}`;\r\n    }\r\n\r\n    const silentRenewUrl = this.getSilentRenewUrl();\r\n\r\n    if (this.flowsDataService.isSilentRenewRunning() && silentRenewUrl) {\r\n      return oneLineTrim`${dataForBody}&redirect_uri=${silentRenewUrl}`;\r\n    }\r\n\r\n    const redirectUrl = this.getRedirectUrl();\r\n\r\n    if (!redirectUrl) {\r\n      return null;\r\n    }\r\n\r\n    return oneLineTrim`${dataForBody}&redirect_uri=${redirectUrl}`;\r\n  }\r\n\r\n  createBodyForCodeFlowRefreshTokensRequest(\r\n    refreshToken: string,\r\n    customParamsRefresh?: { [key: string]: string | number | boolean }\r\n  ): string {\r\n    const clientId = this.getClientId();\r\n\r\n    if (!clientId) {\r\n      return null;\r\n    }\r\n\r\n    let dataForBody = oneLineTrim`grant_type=refresh_token\r\n            &client_id=${clientId}\r\n            &refresh_token=${refreshToken}`;\r\n\r\n    if (customParamsRefresh) {\r\n      const customParamText = this.composeCustomParams({ ...customParamsRefresh });\r\n      dataForBody = `${dataForBody}${customParamText}`;\r\n    }\r\n\r\n    return dataForBody;\r\n  }\r\n\r\n  createBodyForParCodeFlowRequest(customParamsRequest?: { [key: string]: string | number | boolean }): string {\r\n    const redirectUrl = this.getRedirectUrl();\r\n\r\n    if (!redirectUrl) {\r\n      return null;\r\n    }\r\n\r\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    const nonce = this.flowsDataService.createNonce();\r\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\r\n\r\n    // code_challenge with \"S256\"\r\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\r\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\r\n\r\n    const { clientId, responseType, scope, hdParam, customParams } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    let dataForBody = oneLineTrim`client_id=${clientId}\r\n            &redirect_uri=${redirectUrl}\r\n            &response_type=${responseType}\r\n            &scope=${scope}\r\n            &nonce=${nonce}\r\n            &state=${state}\r\n            &code_challenge=${codeChallenge}\r\n            &code_challenge_method=S256`;\r\n\r\n    if (hdParam) {\r\n      dataForBody = `${dataForBody}&hd=${hdParam}`;\r\n    }\r\n\r\n    if (customParams) {\r\n      const customParamText = this.composeCustomParams({ ...customParams });\r\n      dataForBody = `${dataForBody}${customParamText}`;\r\n    }\r\n\r\n    if (customParamsRequest) {\r\n      const customParamText = this.composeCustomParams({ ...customParamsRequest });\r\n      dataForBody = `${dataForBody}${customParamText}`;\r\n    }\r\n\r\n    return dataForBody;\r\n  }\r\n\r\n  private createAuthorizeUrl(\r\n    codeChallenge: string,\r\n    redirectUrl: string,\r\n    nonce: string,\r\n    state: string,\r\n    prompt?: string,\r\n    customRequestParams?: { [key: string]: string | number | boolean }\r\n  ): string {\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const authorizationEndpoint = authWellKnownEndPoints?.authorizationEndpoint;\r\n\r\n    if (!authorizationEndpoint) {\r\n      this.loggerService.logError(`Can not create an authorize url when authorizationEndpoint is '${authorizationEndpoint}'`);\r\n      return null;\r\n    }\r\n\r\n    const { clientId, responseType, scope, hdParam, customParams } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!clientId) {\r\n      this.loggerService.logError(`createAuthorizeUrl could not add clientId because it was: `, clientId);\r\n      return null;\r\n    }\r\n\r\n    if (!responseType) {\r\n      this.loggerService.logError(`createAuthorizeUrl could not add responseType because it was: `, responseType);\r\n      return null;\r\n    }\r\n\r\n    if (!scope) {\r\n      this.loggerService.logError(`createAuthorizeUrl could not add scope because it was: `, scope);\r\n      return null;\r\n    }\r\n\r\n    const urlParts = authorizationEndpoint.split('?');\r\n    const authorizationUrl = urlParts[0];\r\n\r\n    let params = new HttpParams({\r\n      fromString: urlParts[1],\r\n      encoder: new UriEncoder(),\r\n    });\r\n\r\n    params = params.set('client_id', clientId);\r\n    params = params.append('redirect_uri', redirectUrl);\r\n    params = params.append('response_type', responseType);\r\n    params = params.append('scope', scope);\r\n    params = params.append('nonce', nonce);\r\n    params = params.append('state', state);\r\n\r\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\r\n      params = params.append('code_challenge', codeChallenge);\r\n      params = params.append('code_challenge_method', 'S256');\r\n    }\r\n\r\n    if (prompt) {\r\n      params = params.append('prompt', prompt);\r\n    }\r\n\r\n    if (hdParam) {\r\n      params = params.append('hd', hdParam);\r\n    }\r\n\r\n    if (customParams) {\r\n      for (const [key, value] of Object.entries({ ...customParams })) {\r\n        params = params.append(key, value.toString());\r\n      }\r\n    }\r\n\r\n    if (customRequestParams) {\r\n      for (const [key, value] of Object.entries({ ...customRequestParams })) {\r\n        params = params.append(key, value.toString());\r\n      }\r\n    }\r\n\r\n    return `${authorizationUrl}?${params}`;\r\n  }\r\n\r\n  private createUrlImplicitFlowWithSilentRenew(customParams?: { [key: string]: string | number | boolean }): string {\r\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    const nonce = this.flowsDataService.createNonce();\r\n\r\n    const silentRenewUrl = this.getSilentRenewUrl();\r\n\r\n    if (!silentRenewUrl) {\r\n      return null;\r\n    }\r\n\r\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ', state);\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    if (authWellKnownEndPoints) {\r\n      return this.createAuthorizeUrl('', silentRenewUrl, nonce, state, 'none', customParams);\r\n    }\r\n\r\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n    return null;\r\n  }\r\n\r\n  private createUrlCodeFlowWithSilentRenew(customParams?: { [key: string]: string | number | boolean }): string {\r\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    const nonce = this.flowsDataService.createNonce();\r\n\r\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ' + state);\r\n\r\n    // code_challenge with \"S256\"\r\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\r\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\r\n\r\n    const silentRenewUrl = this.getSilentRenewUrl();\r\n\r\n    if (!silentRenewUrl) {\r\n      return null;\r\n    }\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    if (authWellKnownEndPoints) {\r\n      return this.createAuthorizeUrl(codeChallenge, silentRenewUrl, nonce, state, 'none', customParams);\r\n    }\r\n\r\n    this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n    return null;\r\n  }\r\n\r\n  private createUrlImplicitFlowAuthorize(customParams?: { [key: string]: string | number | boolean }): string {\r\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    const nonce = this.flowsDataService.createNonce();\r\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\r\n\r\n    const redirectUrl = this.getRedirectUrl();\r\n\r\n    if (!redirectUrl) {\r\n      return null;\r\n    }\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    if (authWellKnownEndPoints) {\r\n      return this.createAuthorizeUrl('', redirectUrl, nonce, state, null, customParams);\r\n    }\r\n\r\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n    return null;\r\n  }\r\n\r\n  private createUrlCodeFlowAuthorize(customParams?: { [key: string]: string | number | boolean }): string {\r\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    const nonce = this.flowsDataService.createNonce();\r\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\r\n\r\n    const redirectUrl = this.getRedirectUrl();\r\n\r\n    if (!redirectUrl) {\r\n      return null;\r\n    }\r\n\r\n    // code_challenge with \"S256\"\r\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\r\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    if (authWellKnownEndPoints) {\r\n      return this.createAuthorizeUrl(codeChallenge, redirectUrl, nonce, state, null, customParams);\r\n    }\r\n\r\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\r\n    return null;\r\n  }\r\n\r\n  private getRedirectUrl(): string {\r\n    const { redirectUrl } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!redirectUrl) {\r\n      this.loggerService.logError(`could not get redirectUrl, was: `, redirectUrl);\r\n      return null;\r\n    }\r\n\r\n    return redirectUrl;\r\n  }\r\n\r\n  private getSilentRenewUrl(): string {\r\n    const { silentRenewUrl } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!silentRenewUrl) {\r\n      this.loggerService.logError(`could not get silentRenewUrl, was: `, silentRenewUrl);\r\n      return null;\r\n    }\r\n\r\n    return silentRenewUrl;\r\n  }\r\n\r\n  private getPostLogoutRedirectUrl(): string {\r\n    const { postLogoutRedirectUri } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!postLogoutRedirectUri) {\r\n      this.loggerService.logError(`could not get postLogoutRedirectUri, was: `, postLogoutRedirectUri);\r\n      return null;\r\n    }\r\n\r\n    return postLogoutRedirectUri;\r\n  }\r\n\r\n  private getClientId(): string {\r\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!clientId) {\r\n      this.loggerService.logError(`could not get clientId, was: `, clientId);\r\n      return null;\r\n    }\r\n\r\n    return clientId;\r\n  }\r\n\r\n  private composeCustomParams(customParams: { [key: string]: string | number | boolean }) {\r\n    let customParamText = '';\r\n\r\n    for (const [key, value] of Object.entries(customParams)) {\r\n      customParamText = customParamText.concat(`&${key}=${value.toString()}`);\r\n    }\r\n\r\n    return customParamText;\r\n  }\r\n}\r\n","import { HttpErrorResponse, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError, timer } from 'rxjs';\r\nimport { catchError, mergeMap, retryWhen, switchMap } from 'rxjs/operators';\r\nimport { DataService } from '../../api/data.service';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { TokenValidationService } from '../../validation/token-validation.service';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { FlowsDataService } from '../flows-data.service';\r\n\r\n@Injectable()\r\nexport class CodeFlowCallbackHandlerService {\r\n  constructor(\r\n    private readonly urlService: UrlService,\r\n    private readonly loggerService: LoggerService,\r\n    private readonly tokenValidationService: TokenValidationService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    private readonly configurationProvider: ConfigurationProvider,\r\n    private readonly storagePersistenceService: StoragePersistenceService,\r\n    private readonly dataService: DataService\r\n  ) {}\r\n\r\n  // STEP 1 Code Flow\r\n  codeFlowCallback(urlToCheck: string): Observable<CallbackContext> {\r\n    const code = this.urlService.getUrlParameter(urlToCheck, 'code');\r\n    const state = this.urlService.getUrlParameter(urlToCheck, 'state');\r\n    const sessionState = this.urlService.getUrlParameter(urlToCheck, 'session_state') || null;\r\n\r\n    if (!state) {\r\n      this.loggerService.logDebug('no state in url');\r\n      return throwError('no state in url');\r\n    }\r\n\r\n    if (!code) {\r\n      this.loggerService.logDebug('no code in url');\r\n      return throwError('no code in url');\r\n    }\r\n\r\n    this.loggerService.logDebug('running validation for callback', urlToCheck);\r\n\r\n    const initialCallbackContext = {\r\n      code,\r\n      refreshToken: null,\r\n      state,\r\n      sessionState,\r\n      authResult: null,\r\n      isRenewProcess: false,\r\n      jwtKeys: null,\r\n      validationResult: null,\r\n      existingIdToken: null,\r\n    };\r\n\r\n    return of(initialCallbackContext);\r\n  }\r\n\r\n  // STEP 2 Code Flow //  Code Flow Silent Renew starts here\r\n  codeFlowCodeRequest(callbackContext: CallbackContext): Observable<CallbackContext> {\r\n    const authStateControl = this.flowsDataService.getAuthStateControl();\r\n\r\n    const isStateCorrect = this.tokenValidationService.validateStateFromHashCallback(callbackContext.state, authStateControl);\r\n\r\n    if (!isStateCorrect) {\r\n      this.loggerService.logWarning('codeFlowCodeRequest incorrect state');\r\n      return throwError('codeFlowCodeRequest incorrect state');\r\n    }\r\n\r\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const tokenEndpoint = authWellKnown?.tokenEndpoint;\r\n    if (!tokenEndpoint) {\r\n      return throwError('Token Endpoint not defined');\r\n    }\r\n\r\n    let headers: HttpHeaders = new HttpHeaders();\r\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n    const config = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    const bodyForCodeFlow = this.urlService.createBodyForCodeFlowCodeRequest(callbackContext.code, config?.customTokenParams);\r\n\r\n    return this.dataService.post(tokenEndpoint, bodyForCodeFlow, headers).pipe(\r\n      switchMap((response) => {\r\n        let authResult: any = new Object();\r\n        authResult = response;\r\n        authResult.state = callbackContext.state;\r\n        authResult.session_state = callbackContext.sessionState;\r\n\r\n        callbackContext.authResult = authResult;\r\n        return of(callbackContext);\r\n      }),\r\n      retryWhen((error) => this.handleRefreshRetry(error)),\r\n      catchError((error) => {\r\n        const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\r\n        const errorMessage = `OidcService code request ${stsServer}`;\r\n        this.loggerService.logError(errorMessage, error);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleRefreshRetry(errors: Observable<any>): Observable<any> {\r\n    return errors.pipe(\r\n      mergeMap((error) => {\r\n        // retry token refresh if there is no internet connection\r\n        if (error && error instanceof HttpErrorResponse && error.error instanceof ProgressEvent && error.error.type === 'error') {\r\n          const { stsServer, refreshTokenRetryInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n          const errorMessage = `OidcService code request ${stsServer} - no internet connection`;\r\n          this.loggerService.logWarning(errorMessage, error);\r\n          return timer(refreshTokenRetryInSeconds * 1000);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, of, throwError } from 'rxjs';\r\nimport { map, retry, switchMap } from 'rxjs/operators';\r\nimport { DataService } from '../api/data.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { EventTypes } from '../public-events/event-types';\r\nimport { PublicEventsService } from '../public-events/public-events.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\r\n\r\n@Injectable()\r\nexport class UserService {\r\n  private userDataInternal$ = new BehaviorSubject<any>(null);\r\n\r\n  get userData$() {\r\n    return this.userDataInternal$.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private oidcDataService: DataService,\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private eventService: PublicEventsService,\r\n    private loggerService: LoggerService,\r\n    private tokenHelperService: TokenHelperService,\r\n    private flowHelper: FlowHelper,\r\n    private configurationProvider: ConfigurationProvider\r\n  ) {}\r\n\r\n  // TODO CHECK PARAMETERS\r\n  //  validationResult.idToken can be the complete validationResult\r\n  getAndPersistUserDataInStore(isRenewProcess = false, idToken?: any, decodedIdToken?: any): Observable<any> {\r\n    idToken = idToken || this.storagePersistenceService.getIdToken();\r\n    decodedIdToken = decodedIdToken || this.tokenHelperService.getPayloadFromToken(idToken, false);\r\n\r\n    const existingUserDataFromStorage = this.getUserDataFromStore();\r\n    const haveUserData = !!existingUserDataFromStorage;\r\n    const isCurrentFlowImplicitFlowWithAccessToken = this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken();\r\n    const isCurrentFlowCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\r\n\r\n    const accessToken = this.storagePersistenceService.getAccessToken();\r\n    if (!(isCurrentFlowImplicitFlowWithAccessToken || isCurrentFlowCodeFlow)) {\r\n      this.loggerService.logDebug('authorizedCallback id_token flow');\r\n      this.loggerService.logDebug('accessToken', accessToken);\r\n\r\n      this.setUserDataToStore(decodedIdToken);\r\n      return of(decodedIdToken);\r\n    }\r\n\r\n    const { renewUserInfoAfterTokenRenew } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!isRenewProcess || renewUserInfoAfterTokenRenew || !haveUserData) {\r\n      return this.getUserDataOidcFlowAndSave(decodedIdToken.sub).pipe(\r\n        switchMap((userData) => {\r\n          this.loggerService.logDebug('Received user data', userData);\r\n          if (!!userData) {\r\n            this.loggerService.logDebug('accessToken', accessToken);\r\n            return of(userData);\r\n          } else {\r\n            return throwError('no user data, request failed');\r\n          }\r\n        })\r\n      );\r\n    }\r\n\r\n    return of(existingUserDataFromStorage);\r\n  }\r\n\r\n  getUserDataFromStore(): any {\r\n    return this.storagePersistenceService.read('userData') || null;\r\n  }\r\n\r\n  publishUserDataIfExists() {\r\n    const userData = this.getUserDataFromStore();\r\n    if (userData) {\r\n      this.userDataInternal$.next(userData);\r\n      this.eventService.fireEvent(EventTypes.UserDataChanged, userData);\r\n    }\r\n  }\r\n\r\n  setUserDataToStore(value: any): void {\r\n    this.storagePersistenceService.write('userData', value);\r\n    this.userDataInternal$.next(value);\r\n    this.eventService.fireEvent(EventTypes.UserDataChanged, value);\r\n  }\r\n\r\n  resetUserDataInStore(): void {\r\n    this.storagePersistenceService.remove('userData');\r\n    this.eventService.fireEvent(EventTypes.UserDataChanged, null);\r\n    this.userDataInternal$.next(null);\r\n  }\r\n\r\n  private getUserDataOidcFlowAndSave(idTokenSub: any): Observable<any> {\r\n    return this.getIdentityUserData().pipe(\r\n      map((data: any) => {\r\n        if (this.validateUserDataSubIdToken(idTokenSub, data?.sub)) {\r\n          this.setUserDataToStore(data);\r\n          return data;\r\n        } else {\r\n          // something went wrong, userdata sub does not match that from id_token\r\n          this.loggerService.logWarning('authorizedCallback, User data sub does not match sub in id_token');\r\n          this.loggerService.logDebug('authorizedCallback, token(s) validation failed, resetting');\r\n          this.resetUserDataInStore();\r\n          return null;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  private getIdentityUserData(): Observable<any> {\r\n    const token = this.storagePersistenceService.getAccessToken();\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n    if (!authWellKnownEndPoints) {\r\n      this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined');\r\n      return throwError('authWellKnownEndpoints is undefined');\r\n    }\r\n\r\n    const userinfoEndpoint = authWellKnownEndPoints.userinfoEndpoint;\r\n\r\n    if (!userinfoEndpoint) {\r\n      this.loggerService.logError(\r\n        'init check session: authWellKnownEndpoints.userinfo_endpoint is undefined; set auto_userinfo = false in config'\r\n      );\r\n      // TODO: HERE\r\n      // Bisogna modificare il path e far intervenire proxy\r\n      if (window.location.href.includes('localhost')) {\r\n        let myArray = userinfoEndpoint.split('/');\r\n        myArray.splice(0, 3);\r\n        let pathModified = myArray.join('/');\r\n        console.log(myArray.join('/'));\r\n\r\n        return this.oidcDataService.get(pathModified, token).pipe(retry(2));\r\n      }\r\n      return throwError('authWellKnownEndpoints.userinfo_endpoint is undefined');\r\n    }\r\n\r\n    return this.oidcDataService.get(userinfoEndpoint, token).pipe(retry(2));\r\n  }\r\n\r\n  private validateUserDataSubIdToken(idTokenSub: any, userdataSub: any): boolean {\r\n    if (!idTokenSub) {\r\n      return false;\r\n    }\r\n\r\n    if (!userdataSub) {\r\n      return false;\r\n    }\r\n\r\n    if ((idTokenSub as string) !== (userdataSub as string)) {\r\n      this.loggerService.logDebug('validateUserDataSubIdToken failed', idTokenSub, userdataSub);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { UserService } from '../userData/user-service';\r\nimport { FlowsDataService } from './flows-data.service';\r\n\r\n@Injectable()\r\nexport class ResetAuthDataService {\r\n  constructor(\r\n    private readonly authStateService: AuthStateService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    private readonly userService: UserService\r\n  ) {}\r\n\r\n  resetAuthorizationData(): void {\r\n    this.userService.resetUserDataInStore();\r\n    this.flowsDataService.resetStorageFlowData();\r\n    this.authStateService.setUnauthorizedAndFireEvent();\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { Observable, of } from 'rxjs';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { FlowsDataService } from '../flows-data.service';\r\nimport { ResetAuthDataService } from '../reset-auth-data.service';\r\n\r\n@Injectable()\r\nexport class ImplicitFlowCallbackHandlerService {\r\n  constructor(\r\n    private readonly resetAuthDataService: ResetAuthDataService,\r\n    private readonly loggerService: LoggerService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    @Inject(DOCUMENT) private readonly doc: any\r\n  ) {}\r\n\r\n  // STEP 1 Code Flow\r\n  // STEP 1 Implicit Flow\r\n  implicitFlowCallback(hash?: string): Observable<CallbackContext> {\r\n    const isRenewProcessData = this.flowsDataService.isSilentRenewRunning();\r\n\r\n    this.loggerService.logDebug('BEGIN authorizedCallback, no auth data');\r\n    if (!isRenewProcessData) {\r\n      this.resetAuthDataService.resetAuthorizationData();\r\n    }\r\n\r\n    hash = hash || this.doc.location.hash.substr(1);\r\n\r\n    const authResult: any = hash.split('&').reduce((resultData: any, item: string) => {\r\n      const parts = item.split('=');\r\n      resultData[parts.shift() as string] = parts.join('=');\r\n      return resultData;\r\n    }, {});\r\n\r\n    const callbackContext = {\r\n      code: null,\r\n      refreshToken: null,\r\n      state: null,\r\n      sessionState: null,\r\n      authResult,\r\n      isRenewProcess: isRenewProcessData,\r\n      jwtKeys: null,\r\n      validationResult: null,\r\n      existingIdToken: null,\r\n    };\r\n\r\n    return of(callbackContext);\r\n  }\r\n}\r\n","/* eslint-disable no-shadow */\r\nexport enum AuthorizedState {\r\n  Authorized = 'Authorized',\r\n  Unauthorized = 'Unauthorized',\r\n  Unknown = 'Unknown',\r\n}\r\n","/* eslint-disable no-shadow */\r\nexport enum ValidationResult {\r\n  NotSet = 'NotSet',\r\n  StatesDoNotMatch = 'StatesDoNotMatch',\r\n  SignatureFailed = 'SignatureFailed',\r\n  IncorrectNonce = 'IncorrectNonce',\r\n  RequiredPropertyMissing = 'RequiredPropertyMissing',\r\n  MaxOffsetExpired = 'MaxOffsetExpired',\r\n  IssDoesNotMatchIssuer = 'IssDoesNotMatchIssuer',\r\n  NoAuthWellKnownEndPoints = 'NoAuthWellKnownEndPoints',\r\n  IncorrectAud = 'IncorrectAud',\r\n  IncorrectIdTokenClaimsAfterRefresh = 'IncorrectIdTokenClaimsAfterRefresh',\r\n  IncorrectAzp = 'IncorrectAzp',\r\n  TokenExpired = 'TokenExpired',\r\n  IncorrectAtHash = 'IncorrectAtHash',\r\n  Ok = 'Ok',\r\n  LoginRequired = 'LoginRequired',\r\n  SecureTokenServerError = 'SecureTokenServerError',\r\n}\r\n","import { HttpResponse } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError, retry } from 'rxjs/operators';\r\nimport { DataService } from '../api/data.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { JwtKeys } from '../validation/jwtkeys';\r\n\r\n@Injectable()\r\nexport class SigninKeyDataService {\r\n  constructor(\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private loggerService: LoggerService,\r\n    private dataService: DataService\r\n  ) {}\r\n\r\n  getSigningKeys() {\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const jwksUri = authWellKnownEndPoints?.jwksUri;\r\n    if (!jwksUri) {\r\n      const error = `getSigningKeys: authWellKnownEndpoints.jwksUri is: '${jwksUri}'`;\r\n      this.loggerService.logWarning(error);\r\n      return throwError(error);\r\n    }\r\n\r\n    this.loggerService.logDebug('Getting signinkeys from ', jwksUri);\r\n\r\n    return this.dataService.get<JwtKeys>(jwksUri).pipe(retry(2), catchError(this.handleErrorGetSigningKeys));\r\n  }\r\n\r\n  private handleErrorGetSigningKeys(errorResponse: HttpResponse<any> | any) {\r\n    let errMsg = '';\r\n    if (errorResponse instanceof HttpResponse) {\r\n      const body = errorResponse.body || {};\r\n      const err = JSON.stringify(body);\r\n      const { status, statusText } = errorResponse;\r\n      errMsg = `${status || ''} - ${statusText || ''} ${err || ''}`;\r\n    } else {\r\n      const { message } = errorResponse;\r\n      errMsg = !!message ? message : `${errorResponse}`;\r\n    }\r\n    this.loggerService.logError(errMsg);\r\n    return throwError(new Error(errMsg));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { catchError, switchMap, tap } from 'rxjs/operators';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { AuthorizedState } from '../../authState/authorized-state';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\r\nimport { JwtKeys } from '../../validation/jwtkeys';\r\nimport { ValidationResult } from '../../validation/validation-result';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { FlowsDataService } from '../flows-data.service';\r\nimport { ResetAuthDataService } from '../reset-auth-data.service';\r\nimport { SigninKeyDataService } from '../signin-key-data.service';\r\n\r\nconst JWT_KEYS = 'jwtKeys';\r\n\r\n@Injectable()\r\nexport class HistoryJwtKeysCallbackHandlerService {\r\n  constructor(\r\n    private readonly loggerService: LoggerService,\r\n    private readonly configurationProvider: ConfigurationProvider,\r\n    private readonly authStateService: AuthStateService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    private readonly signInKeyDataService: SigninKeyDataService,\r\n    private readonly storagePersistenceService: StoragePersistenceService,\r\n    private readonly resetAuthDataService: ResetAuthDataService\r\n  ) {}\r\n\r\n  // STEP 3 Code Flow, STEP 2 Implicit Flow, STEP 3 Refresh Token\r\n  callbackHistoryAndResetJwtKeys(callbackContext: CallbackContext): Observable<CallbackContext> {\r\n    this.storagePersistenceService.write('authnResult', callbackContext.authResult);\r\n\r\n    if (this.historyCleanUpTurnedOn() && !callbackContext.isRenewProcess) {\r\n      this.resetBrowserHistory();\r\n    } else {\r\n      this.loggerService.logDebug('history clean up inactive');\r\n    }\r\n\r\n    if (callbackContext.authResult.error) {\r\n      const errorMessage = `authorizedCallbackProcedure came with error: ${callbackContext.authResult.error}`;\r\n      this.loggerService.logDebug(errorMessage);\r\n      this.resetAuthDataService.resetAuthorizationData();\r\n      this.flowsDataService.setNonce('');\r\n      this.handleResultErrorFromCallback(callbackContext.authResult, callbackContext.isRenewProcess);\r\n      return throwError(errorMessage);\r\n    }\r\n\r\n    this.loggerService.logDebug(callbackContext.authResult);\r\n    this.loggerService.logDebug('authorizedCallback created, begin token validation');\r\n\r\n    return this.signInKeyDataService.getSigningKeys().pipe(\r\n      tap((jwtKeys: JwtKeys) => this.storeSigningKeys(jwtKeys)),\r\n      catchError((err) => {\r\n        // fallback: try to load jwtKeys from storage\r\n        const storedJwtKeys = this.readSigningKeys();\r\n        if (!!storedJwtKeys) {\r\n          this.loggerService.logWarning(`Failed to retrieve signing keys, fallback to stored keys`);\r\n          return of(storedJwtKeys);\r\n        }\r\n\r\n        return throwError(err);\r\n      }),\r\n      switchMap((jwtKeys) => {\r\n        if (jwtKeys) {\r\n          callbackContext.jwtKeys = jwtKeys;\r\n\r\n          return of(callbackContext);\r\n        }\r\n\r\n        const errorMessage = `Failed to retrieve signing key`;\r\n        this.loggerService.logWarning(errorMessage);\r\n        return throwError(errorMessage);\r\n      }),\r\n      catchError((err) => {\r\n        const errorMessage = `Failed to retrieve signing key with error: ${err}`;\r\n        this.loggerService.logWarning(errorMessage);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleResultErrorFromCallback(result: any, isRenewProcess: boolean) {\r\n    let validationResult = ValidationResult.SecureTokenServerError;\r\n\r\n    if ((result.error as string) === 'login_required') {\r\n      validationResult = ValidationResult.LoginRequired;\r\n    }\r\n\r\n    this.authStateService.updateAndPublishAuthState({\r\n      authorizationState: AuthorizedState.Unauthorized,\r\n      validationResult,\r\n      isRenewProcess,\r\n    });\r\n  }\r\n\r\n  private historyCleanUpTurnedOn() {\r\n    const { historyCleanupOff } = this.configurationProvider.getOpenIDConfiguration();\r\n    return !historyCleanupOff;\r\n  }\r\n\r\n  private resetBrowserHistory() {\r\n    window.history.replaceState({}, window.document.title, window.location.origin + window.location.pathname);\r\n  }\r\n\r\n  private storeSigningKeys(jwtKeys: JwtKeys) {\r\n    this.storagePersistenceService.write(JWT_KEYS, jwtKeys);\r\n  }\r\n\r\n  private readSigningKeys() {\r\n    return this.storagePersistenceService.read(JWT_KEYS);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { catchError, switchMap } from 'rxjs/operators';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { AuthorizedState } from '../../authState/authorized-state';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { UserService } from '../../userData/user-service';\r\nimport { StateValidationResult } from '../../validation/state-validation-result';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { FlowsDataService } from '../flows-data.service';\r\nimport { ResetAuthDataService } from '../reset-auth-data.service';\r\n\r\n@Injectable()\r\nexport class UserCallbackHandlerService {\r\n  constructor(\r\n    private readonly loggerService: LoggerService,\r\n    private readonly configurationProvider: ConfigurationProvider,\r\n    private readonly authStateService: AuthStateService,\r\n    private readonly flowsDataService: FlowsDataService,\r\n    private readonly userService: UserService,\r\n    private readonly resetAuthDataService: ResetAuthDataService\r\n  ) {}\r\n\r\n  // STEP 5 userData\r\n  callbackUser(callbackContext: CallbackContext): Observable<CallbackContext> {\r\n    const { isRenewProcess, validationResult, authResult, refreshToken } = callbackContext;\r\n    const { autoUserinfo, renewUserInfoAfterTokenRenew } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!autoUserinfo) {\r\n      if (!isRenewProcess || renewUserInfoAfterTokenRenew) {\r\n        // userData is set to the id_token decoded, auto get user data set to false\r\n        if (validationResult.decodedIdToken) {\r\n          this.userService.setUserDataToStore(validationResult.decodedIdToken);\r\n        }\r\n      }\r\n\r\n      if (!isRenewProcess && !refreshToken) {\r\n        this.flowsDataService.setSessionState(authResult.session_state);\r\n      }\r\n\r\n      this.publishAuthorizedState(validationResult, isRenewProcess);\r\n      return of(callbackContext);\r\n    }\r\n\r\n    return this.userService.getAndPersistUserDataInStore(isRenewProcess, validationResult.idToken, validationResult.decodedIdToken).pipe(\r\n      switchMap((userData) => {\r\n        if (!!userData) {\r\n          if (!refreshToken) {\r\n            this.flowsDataService.setSessionState(authResult.session_state);\r\n          }\r\n\r\n          this.publishAuthorizedState(validationResult, isRenewProcess);\r\n\r\n          return of(callbackContext);\r\n        } else {\r\n          this.resetAuthDataService.resetAuthorizationData();\r\n          this.publishUnauthorizedState(validationResult, isRenewProcess);\r\n          const errorMessage = `Called for userData but they were ${userData}`;\r\n          this.loggerService.logWarning(errorMessage);\r\n          return throwError(errorMessage);\r\n        }\r\n      }),\r\n      catchError((err) => {\r\n        const errorMessage = `Failed to retrieve user info with error:  ${err}`;\r\n        this.loggerService.logWarning(errorMessage);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  private publishAuthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\r\n    this.authStateService.updateAndPublishAuthState({\r\n      authorizationState: AuthorizedState.Authorized,\r\n      validationResult: stateValidationResult.state,\r\n      isRenewProcess,\r\n    });\r\n  }\r\n\r\n  private publishUnauthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\r\n    this.authStateService.updateAndPublishAuthState({\r\n      authorizationState: AuthorizedState.Unauthorized,\r\n      validationResult: stateValidationResult.state,\r\n      isRenewProcess,\r\n    });\r\n  }\r\n}\r\n","import { ValidationResult } from './validation-result';\r\n\r\nexport class StateValidationResult {\r\n  constructor(\r\n    public accessToken = '',\r\n    public idToken = '',\r\n    public authResponseIsValid = false,\r\n    public decodedIdToken: any = {},\r\n    public state: ValidationResult = ValidationResult.NotSet\r\n  ) {}\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class EqualityService {\r\n  isStringEqualOrNonOrderedArrayEqual(value1: string | any[], value2: string | any[]) {\r\n    if (this.isNullOrUndefined(value1)) {\r\n      return false;\r\n    }\r\n\r\n    if (this.isNullOrUndefined(value2)) {\r\n      return false;\r\n    }\r\n\r\n    if (this.oneValueIsStringAndTheOtherIsArray(value1, value2)) {\r\n      return false;\r\n    }\r\n\r\n    if (this.bothValuesAreStrings(value1, value2)) {\r\n      return value1 === value2;\r\n    }\r\n\r\n    if (this.bothValuesAreArrays(value1, value2)) {\r\n      return this.arraysHaveEqualContent(value1 as any[], value2 as any[]);\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  areEqual(value1: string | any[] | any | null | undefined, value2: string | any[] | any | null | undefined) {\r\n    if (!value1 || !value2) {\r\n      return false;\r\n    }\r\n\r\n    if (this.bothValuesAreArrays(value1, value2)) {\r\n      return this.arraysStrictEqual(value1 as any[], value2 as any[]);\r\n    }\r\n\r\n    if (this.bothValuesAreStrings(value1, value2)) {\r\n      return value1 === value2;\r\n    }\r\n\r\n    if (this.bothValuesAreObjects(value1, value2)) {\r\n      return JSON.stringify(value1).toLowerCase() === JSON.stringify(value2).toLowerCase();\r\n    }\r\n\r\n    if (this.oneValueIsStringAndTheOtherIsArray(value1, value2)) {\r\n      if (Array.isArray(value1) && this.valueIsString(value2)) {\r\n        return value1[0] === value2;\r\n      }\r\n      if (Array.isArray(value2) && this.valueIsString(value1)) {\r\n        return value2[0] === value1;\r\n      }\r\n    }\r\n  }\r\n\r\n  private oneValueIsStringAndTheOtherIsArray(value1: string | any | any[], value2: string | any | any[]) {\r\n    return (Array.isArray(value1) && this.valueIsString(value2)) || (Array.isArray(value2) && this.valueIsString(value1));\r\n  }\r\n\r\n  private bothValuesAreObjects(value1: string | any | any[], value2: string | any | any[]) {\r\n    return this.valueIsObject(value1) && this.valueIsObject(value2);\r\n  }\r\n\r\n  private bothValuesAreStrings(value1: string | any | any[], value2: string | any | any[]) {\r\n    return this.valueIsString(value1) && this.valueIsString(value2);\r\n  }\r\n\r\n  private bothValuesAreArrays(value1: string | any | any[], value2: string | any | any[]) {\r\n    return Array.isArray(value1) && Array.isArray(value2);\r\n  }\r\n\r\n  private valueIsString(value: any) {\r\n    return typeof value === 'string' || value instanceof String;\r\n  }\r\n\r\n  private valueIsObject(value: any) {\r\n    return typeof value === 'object';\r\n  }\r\n\r\n  private arraysStrictEqual(arr1: Array<string>, arr2: Array<string>) {\r\n    if (arr1.length !== arr2.length) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = arr1.length; i--; ) {\r\n      if (arr1[i] !== arr2[i]) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private arraysHaveEqualContent(arr1: Array<string>, arr2: Array<string>) {\r\n    if (arr1.length !== arr2.length) {\r\n      return false;\r\n    }\r\n\r\n    return arr1.some((v) => arr2.includes(v));\r\n  }\r\n\r\n  private isNullOrUndefined(val: any) {\r\n    return val === null || val === undefined;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { CallbackContext } from '../flows/callback-context';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { EqualityService } from '../utils/equality/equality.service';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\r\nimport { StateValidationResult } from './state-validation-result';\r\nimport { TokenValidationService } from './token-validation.service';\r\nimport { ValidationResult } from './validation-result';\r\n\r\n@Injectable()\r\nexport class StateValidationService {\r\n  constructor(\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private tokenValidationService: TokenValidationService,\r\n    private tokenHelperService: TokenHelperService,\r\n    private loggerService: LoggerService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private equalityService: EqualityService,\r\n    private flowHelper: FlowHelper\r\n  ) {}\r\n\r\n  getValidatedStateResult(callbackContext: CallbackContext): StateValidationResult {\r\n    if (!callbackContext) {\r\n      return new StateValidationResult('', '', false, {});\r\n    }\r\n\r\n    if (callbackContext.authResult.error) {\r\n      return new StateValidationResult('', '', false, {});\r\n    }\r\n\r\n    return this.validateState(callbackContext);\r\n  }\r\n\r\n  validateState(callbackContext): StateValidationResult {\r\n    const toReturn = new StateValidationResult();\r\n    const authStateControl = this.storagePersistenceService.read('authStateControl');\r\n\r\n    if (!this.tokenValidationService.validateStateFromHashCallback(callbackContext.authResult.state, authStateControl)) {\r\n      this.loggerService.logWarning('authorizedCallback incorrect state');\r\n      toReturn.state = ValidationResult.StatesDoNotMatch;\r\n      this.handleUnsuccessfulValidation();\r\n      return toReturn;\r\n    }\r\n\r\n    const isCurrentFlowImplicitFlowWithAccessToken = this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken();\r\n    const isCurrentFlowCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\r\n\r\n    if (isCurrentFlowImplicitFlowWithAccessToken || isCurrentFlowCodeFlow) {\r\n      toReturn.accessToken = callbackContext.authResult.access_token;\r\n    }\r\n\r\n    if (callbackContext.authResult.id_token) {\r\n      const {\r\n        clientId,\r\n        issValidationOff,\r\n        maxIdTokenIatOffsetAllowedInSeconds,\r\n        disableIatOffsetValidation,\r\n        ignoreNonceAfterRefresh,\r\n      } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n      toReturn.idToken = callbackContext.authResult.id_token;\r\n\r\n      toReturn.decodedIdToken = this.tokenHelperService.getPayloadFromToken(toReturn.idToken, false);\r\n\r\n      if (!this.tokenValidationService.validateSignatureIdToken(toReturn.idToken, callbackContext.jwtKeys)) {\r\n        this.loggerService.logDebug('authorizedCallback Signature validation failed id_token');\r\n        toReturn.state = ValidationResult.SignatureFailed;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      const authNonce = this.storagePersistenceService.read('authNonce');\r\n\r\n      if (!this.tokenValidationService.validateIdTokenNonce(toReturn.decodedIdToken, authNonce, ignoreNonceAfterRefresh)) {\r\n        this.loggerService.logWarning('authorizedCallback incorrect nonce');\r\n        toReturn.state = ValidationResult.IncorrectNonce;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.tokenValidationService.validateRequiredIdToken(toReturn.decodedIdToken)) {\r\n        this.loggerService.logDebug('authorizedCallback Validation, one of the REQUIRED properties missing from id_token');\r\n        toReturn.state = ValidationResult.RequiredPropertyMissing;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (\r\n        !this.tokenValidationService.validateIdTokenIatMaxOffset(\r\n          toReturn.decodedIdToken,\r\n          maxIdTokenIatOffsetAllowedInSeconds,\r\n          disableIatOffsetValidation\r\n        )\r\n      ) {\r\n        this.loggerService.logWarning('authorizedCallback Validation, iat rejected id_token was issued too far away from the current time');\r\n        toReturn.state = ValidationResult.MaxOffsetExpired;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n      if (authWellKnownEndPoints) {\r\n        if (issValidationOff) {\r\n          this.loggerService.logDebug('iss validation is turned off, this is not recommended!');\r\n        } else if (\r\n          !issValidationOff &&\r\n          !this.tokenValidationService.validateIdTokenIss(toReturn.decodedIdToken, authWellKnownEndPoints.issuer)\r\n        ) {\r\n          this.loggerService.logWarning('authorizedCallback incorrect iss does not match authWellKnownEndpoints issuer');\r\n          toReturn.state = ValidationResult.IssDoesNotMatchIssuer;\r\n          this.handleUnsuccessfulValidation();\r\n          return toReturn;\r\n        }\r\n      } else {\r\n        this.loggerService.logWarning('authWellKnownEndpoints is undefined');\r\n        toReturn.state = ValidationResult.NoAuthWellKnownEndPoints;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.tokenValidationService.validateIdTokenAud(toReturn.decodedIdToken, clientId)) {\r\n        this.loggerService.logWarning('authorizedCallback incorrect aud');\r\n        toReturn.state = ValidationResult.IncorrectAud;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.tokenValidationService.validateIdTokenAzpExistsIfMoreThanOneAud(toReturn.decodedIdToken)) {\r\n        this.loggerService.logWarning('authorizedCallback missing azp');\r\n        toReturn.state = ValidationResult.IncorrectAzp;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.tokenValidationService.validateIdTokenAzpValid(toReturn.decodedIdToken, clientId)) {\r\n        this.loggerService.logWarning('authorizedCallback incorrect azp');\r\n        toReturn.state = ValidationResult.IncorrectAzp;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.isIdTokenAfterRefreshTokenRequestValid(callbackContext, toReturn.decodedIdToken)) {\r\n        this.loggerService.logWarning('authorizedCallback pre, post id_token claims do not match in refresh');\r\n        toReturn.state = ValidationResult.IncorrectIdTokenClaimsAfterRefresh;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n\r\n      if (!this.tokenValidationService.validateIdTokenExpNotExpired(toReturn.decodedIdToken)) {\r\n        this.loggerService.logWarning('authorizedCallback id token expired');\r\n        toReturn.state = ValidationResult.TokenExpired;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n    } else {\r\n      this.loggerService.logDebug('No id_token found, skipping id_token validation');\r\n    }\r\n\r\n    // flow id_token\r\n    if (!isCurrentFlowImplicitFlowWithAccessToken && !isCurrentFlowCodeFlow) {\r\n      toReturn.authResponseIsValid = true;\r\n      toReturn.state = ValidationResult.Ok;\r\n      this.handleSuccessfulValidation();\r\n      this.handleUnsuccessfulValidation();\r\n      return toReturn;\r\n    }\r\n\r\n    // only do check if id_token returned, no always the case when using refresh tokens\r\n    if (callbackContext.authResult.id_token) {\r\n      const idTokenHeader = this.tokenHelperService.getHeaderFromToken(toReturn.idToken, false);\r\n\r\n      // The at_hash is optional for the code flow\r\n      if (isCurrentFlowCodeFlow && !(toReturn.decodedIdToken.at_hash as string)) {\r\n        this.loggerService.logDebug('Code Flow active, and no at_hash in the id_token, skipping check!');\r\n      } else if (\r\n        !this.tokenValidationService.validateIdTokenAtHash(\r\n          toReturn.accessToken,\r\n          toReturn.decodedIdToken.at_hash,\r\n          idTokenHeader.alg // 'RSA256'\r\n        ) ||\r\n        !toReturn.accessToken\r\n      ) {\r\n        this.loggerService.logWarning('authorizedCallback incorrect at_hash');\r\n        toReturn.state = ValidationResult.IncorrectAtHash;\r\n        this.handleUnsuccessfulValidation();\r\n        return toReturn;\r\n      }\r\n    }\r\n\r\n    toReturn.authResponseIsValid = true;\r\n    toReturn.state = ValidationResult.Ok;\r\n    this.handleSuccessfulValidation();\r\n    return toReturn;\r\n  }\r\n\r\n  private isIdTokenAfterRefreshTokenRequestValid(callbackContext: CallbackContext, newIdToken: any): boolean {\r\n    const { useRefreshToken, disableRefreshIdTokenAuthTimeValidation } = this.configurationProvider.getOpenIDConfiguration();\r\n    if (!useRefreshToken) {\r\n      return true;\r\n    }\r\n\r\n    if (!callbackContext.existingIdToken) {\r\n      return true;\r\n    }\r\n    const decodedIdToken = this.tokenHelperService.getPayloadFromToken(callbackContext.existingIdToken, false);\r\n\r\n    // Upon successful validation of the Refresh Token, the response body is the Token Response of Section 3.1.3.3\r\n    // except that it might not contain an id_token.\r\n\r\n    // If an ID Token is returned as a result of a token refresh request, the following requirements apply:\r\n\r\n    // its iss Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\r\n    if (decodedIdToken.iss !== newIdToken.iss) {\r\n      this.loggerService.logDebug(`iss do not match: ${decodedIdToken.iss} ${newIdToken.iss}`);\r\n      return false;\r\n    }\r\n    // its azp Claim Value MUST be the same as in the ID Token issued when the original authentication occurred;\r\n    //   if no azp Claim was present in the original ID Token, one MUST NOT be present in the new ID Token, and\r\n    // otherwise, the same rules apply as apply when issuing an ID Token at the time of the original authentication.\r\n    if (decodedIdToken.azp !== newIdToken.azp) {\r\n      this.loggerService.logDebug(`azp do not match: ${decodedIdToken.azp} ${newIdToken.azp}`);\r\n      return false;\r\n    }\r\n    // its sub Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\r\n    if (decodedIdToken.sub !== newIdToken.sub) {\r\n      this.loggerService.logDebug(`sub do not match: ${decodedIdToken.sub} ${newIdToken.sub}`);\r\n      return false;\r\n    }\r\n\r\n    // its aud Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\r\n    if (!this.equalityService.isStringEqualOrNonOrderedArrayEqual(decodedIdToken?.aud, newIdToken?.aud)) {\r\n      this.loggerService.logDebug(`aud in new id_token is not valid: '${decodedIdToken?.aud}' '${newIdToken.aud}'`);\r\n      return false;\r\n    }\r\n\r\n    if (disableRefreshIdTokenAuthTimeValidation) {\r\n      return true;\r\n    }\r\n\r\n    // its iat Claim MUST represent the time that the new ID Token is issued,\r\n    // if the ID Token contains an auth_time Claim, its value MUST represent the time of the original authentication\r\n    // - not the time that the new ID token is issued,\r\n    if (decodedIdToken.auth_time !== newIdToken.auth_time) {\r\n      this.loggerService.logDebug(`auth_time do not match: ${decodedIdToken.auth_time} ${newIdToken.auth_time}`);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private handleSuccessfulValidation(): void {\r\n    const { autoCleanStateAfterAuthentication } = this.configurationProvider.getOpenIDConfiguration();\r\n    this.storagePersistenceService.write('authNonce', '');\r\n\r\n    if (autoCleanStateAfterAuthentication) {\r\n      this.storagePersistenceService.write('authStateControl', '');\r\n    }\r\n    this.loggerService.logDebug('AuthorizedCallback token(s) validated, continue');\r\n  }\r\n\r\n  private handleUnsuccessfulValidation(): void {\r\n    const { autoCleanStateAfterAuthentication } = this.configurationProvider.getOpenIDConfiguration();\r\n    this.storagePersistenceService.write('authNonce', '');\r\n\r\n    if (autoCleanStateAfterAuthentication) {\r\n      this.storagePersistenceService.write('authStateControl', '');\r\n    }\r\n    this.loggerService.logDebug('AuthorizedCallback token(s) invalid');\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { AuthorizedState } from '../../authState/authorized-state';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StateValidationResult } from '../../validation/state-validation-result';\r\nimport { StateValidationService } from '../../validation/state-validation.service';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { ResetAuthDataService } from '../reset-auth-data.service';\r\n\r\n@Injectable()\r\nexport class StateValidationCallbackHandlerService {\r\n  constructor(\r\n    private readonly loggerService: LoggerService,\r\n    private readonly stateValidationService: StateValidationService,\r\n    private readonly authStateService: AuthStateService,\r\n    private readonly resetAuthDataService: ResetAuthDataService,\r\n    @Inject(DOCUMENT) private readonly doc: any\r\n  ) {}\r\n\r\n  // STEP 4 All flows\r\n\r\n  callbackStateValidation(callbackContext: CallbackContext): Observable<CallbackContext> {\r\n    const validationResult = this.stateValidationService.getValidatedStateResult(callbackContext);\r\n    callbackContext.validationResult = validationResult;\r\n\r\n    if (validationResult.authResponseIsValid) {\r\n      this.authStateService.setAuthorizationData(validationResult.accessToken, callbackContext.authResult);\r\n      return of(callbackContext);\r\n    } else {\r\n      const errorMessage = `authorizedCallback, token(s) validation failed, resetting. Hash: ${this.doc.location.hash}`;\r\n      this.loggerService.logWarning(errorMessage);\r\n      this.resetAuthDataService.resetAuthorizationData();\r\n      this.publishUnauthorizedState(callbackContext.validationResult, callbackContext.isRenewProcess);\r\n      return throwError(errorMessage);\r\n    }\r\n  }\r\n\r\n  private publishUnauthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\r\n    this.authStateService.updateAndPublishAuthState({\r\n      authorizationState: AuthorizedState.Unauthorized,\r\n      validationResult: stateValidationResult.state,\r\n      isRenewProcess,\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { TokenValidationService } from '../../validation/token-validation.service';\r\nimport { CallbackContext } from '../callback-context';\r\nimport { FlowsDataService } from '../flows-data.service';\r\n\r\n@Injectable()\r\nexport class RefreshSessionCallbackHandlerService {\r\n  constructor(\r\n    private readonly loggerService: LoggerService,\r\n    private readonly authStateService: AuthStateService,\r\n    private readonly flowsDataService: FlowsDataService\r\n  ) {}\r\n\r\n  // STEP 1 Refresh session\r\n  refreshSessionWithRefreshTokens(): Observable<CallbackContext> {\r\n    const stateData = this.flowsDataService.getExistingOrCreateAuthStateControl();\r\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ' + stateData);\r\n    const refreshToken = this.authStateService.getRefreshToken();\r\n    const idToken = this.authStateService.getIdToken();\r\n\r\n    if (refreshToken) {\r\n      const callbackContext = {\r\n        code: null,\r\n        refreshToken,\r\n        state: stateData,\r\n        sessionState: null,\r\n        authResult: null,\r\n        isRenewProcess: true,\r\n        jwtKeys: null,\r\n        validationResult: null,\r\n        existingIdToken: idToken,\r\n      };\r\n\r\n      this.loggerService.logDebug('found refresh code, obtaining new credentials with refresh code');\r\n      // Nonce is not used with refresh tokens; but Keycloak may send it anyway\r\n      this.flowsDataService.setNonce(TokenValidationService.refreshTokenNoncePlaceholder);\r\n\r\n      return of(callbackContext);\r\n    } else {\r\n      const errorMessage = 'no refresh token found, please login';\r\n      this.loggerService.logError(errorMessage);\r\n      return throwError(errorMessage);\r\n    }\r\n  }\r\n}\r\n","import { HttpErrorResponse, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError, timer } from 'rxjs';\r\nimport { catchError, mergeMap, retryWhen, switchMap } from 'rxjs/operators';\r\nimport { DataService } from '../../api/data.service';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { CallbackContext } from '../callback-context';\r\n\r\n@Injectable()\r\nexport class RefreshTokenCallbackHandlerService {\r\n  constructor(\r\n    private readonly urlService: UrlService,\r\n    private readonly loggerService: LoggerService,\r\n    private readonly configurationProvider: ConfigurationProvider,\r\n    private readonly dataService: DataService,\r\n    private readonly storagePersistenceService: StoragePersistenceService\r\n  ) {}\r\n\r\n  // STEP 2 Refresh Token\r\n  refreshTokensRequestTokens(\r\n    callbackContext: CallbackContext,\r\n    customParamsRefresh?: { [key: string]: string | number | boolean }\r\n  ): Observable<CallbackContext> {\r\n    let headers: HttpHeaders = new HttpHeaders();\r\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const tokenEndpoint = authWellKnown?.tokenEndpoint;\r\n    if (!tokenEndpoint) {\r\n      return throwError('Token Endpoint not defined');\r\n    }\r\n\r\n    const data = this.urlService.createBodyForCodeFlowRefreshTokensRequest(callbackContext.refreshToken, customParamsRefresh);\r\n\r\n    return this.dataService.post(tokenEndpoint, data, headers).pipe(\r\n      switchMap((response: any) => {\r\n        this.loggerService.logDebug('token refresh response: ', response);\r\n        let authResult: any = new Object();\r\n        authResult = response;\r\n        authResult.state = callbackContext.state;\r\n\r\n        callbackContext.authResult = authResult;\r\n        return of(callbackContext);\r\n      }),\r\n      retryWhen((error) => this.handleRefreshRetry(error)),\r\n      catchError((error) => {\r\n        const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\r\n        const errorMessage = `OidcService code request ${stsServer}`;\r\n        this.loggerService.logError(errorMessage, error);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  private handleRefreshRetry(errors: Observable<any>): Observable<any> {\r\n    return errors.pipe(\r\n      mergeMap((error) => {\r\n        // retry token refresh if there is no internet connection\r\n        if (error && error instanceof HttpErrorResponse && error.error instanceof ProgressEvent && error.error.type === 'error') {\r\n          const { stsServer, refreshTokenRetryInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n          const errorMessage = `OidcService code request ${stsServer} - no internet connection`;\r\n          this.loggerService.logWarning(errorMessage, error);\r\n          return timer(refreshTokenRetryInSeconds * 1000);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { CallbackContext } from './callback-context';\r\nimport { CodeFlowCallbackHandlerService } from './callback-handling/code-flow-callback-handler.service';\r\nimport { HistoryJwtKeysCallbackHandlerService } from './callback-handling/history-jwt-keys-callback-handler.service';\r\nimport { ImplicitFlowCallbackHandlerService } from './callback-handling/implicit-flow-callback-handler.service';\r\nimport { RefreshSessionCallbackHandlerService } from './callback-handling/refresh-session-callback-handler.service';\r\nimport { RefreshTokenCallbackHandlerService } from './callback-handling/refresh-token-callback-handler.service';\r\nimport { StateValidationCallbackHandlerService } from './callback-handling/state-validation-callback-handler.service';\r\nimport { UserCallbackHandlerService } from './callback-handling/user-callback-handler.service';\r\n\r\n@Injectable()\r\nexport class FlowsService {\r\n  constructor(\r\n    private readonly codeFlowCallbackHandlerService: CodeFlowCallbackHandlerService,\r\n    private readonly implicitFlowCallbackHandlerService: ImplicitFlowCallbackHandlerService,\r\n    private readonly historyJwtKeysCallbackHandlerService: HistoryJwtKeysCallbackHandlerService,\r\n    private readonly userHandlerService: UserCallbackHandlerService,\r\n    private readonly stateValidationCallbackHandlerService: StateValidationCallbackHandlerService,\r\n    private readonly refreshSessionCallbackHandlerService: RefreshSessionCallbackHandlerService,\r\n    private readonly refreshTokenCallbackHandlerService: RefreshTokenCallbackHandlerService\r\n  ) {}\r\n\r\n  processCodeFlowCallback(urlToCheck: string): Observable<CallbackContext> {\r\n    return this.codeFlowCallbackHandlerService.codeFlowCallback(urlToCheck).pipe(\r\n      switchMap((callbackContext) => this.codeFlowCallbackHandlerService.codeFlowCodeRequest(callbackContext)),\r\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\r\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\r\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\r\n    );\r\n  }\r\n\r\n  processSilentRenewCodeFlowCallback(firstContext: CallbackContext): Observable<CallbackContext> {\r\n    return this.codeFlowCallbackHandlerService.codeFlowCodeRequest(firstContext).pipe(\r\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\r\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\r\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\r\n    );\r\n  }\r\n\r\n  processImplicitFlowCallback(hash?: string): Observable<CallbackContext> {\r\n    return this.implicitFlowCallbackHandlerService.implicitFlowCallback(hash).pipe(\r\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\r\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\r\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\r\n    );\r\n  }\r\n\r\n  processRefreshToken(customParamsRefresh?: { [key: string]: string | number | boolean }): Observable<CallbackContext> {\r\n    return this.refreshSessionCallbackHandlerService.refreshSessionWithRefreshTokens().pipe(\r\n      switchMap((callbackContext) =>\r\n        this.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(callbackContext, customParamsRefresh)\r\n      ),\r\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\r\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\r\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\r\n    );\r\n  }\r\n}\r\n","import { Injectable, NgZone } from '@angular/core';\r\nimport { Observable, Subscription } from 'rxjs';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class IntervallService {\r\n  runTokenValidationRunning: Subscription = null;\r\n\r\n  constructor(private zone: NgZone) {}\r\n\r\n  stopPeriodicallTokenCheck(): void {\r\n    if (this.runTokenValidationRunning) {\r\n      this.runTokenValidationRunning.unsubscribe();\r\n      this.runTokenValidationRunning = null;\r\n    }\r\n  }\r\n\r\n  startPeriodicTokenCheck(repeatAfterSeconds: number) {\r\n    const millisecondsDelayBetweenTokenCheck = repeatAfterSeconds * 1000;\r\n\r\n    return new Observable((subscriber) => {\r\n      let intervalId;\r\n      this.zone.runOutsideAngular(() => {\r\n        intervalId = setInterval(() => this.zone.run(() => subscriber.next()), millisecondsDelayBetweenTokenCheck);\r\n      });\r\n\r\n      return () => {\r\n        clearInterval(intervalId);\r\n      };\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { FlowsDataService } from '../flows/flows-data.service';\r\nimport { FlowsService } from '../flows/flows.service';\r\nimport { IntervallService } from './intervall.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class ImplicitFlowCallbackService {\r\n  constructor(\r\n    private flowsService: FlowsService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private router: Router,\r\n    private flowsDataService: FlowsDataService,\r\n    private intervalService: IntervallService\r\n  ) {}\r\n\r\n  authorizedImplicitFlowCallback(hash?: string) {\r\n    const isRenewProcess = this.flowsDataService.isSilentRenewRunning();\r\n    const { triggerAuthorizationResultEvent, postLoginRoute, unauthorizedRoute } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    return this.flowsService.processImplicitFlowCallback(hash).pipe(\r\n      tap((callbackContext) => {\r\n        if (!triggerAuthorizationResultEvent && !callbackContext.isRenewProcess) {\r\n          this.router.navigateByUrl(postLoginRoute);\r\n        }\r\n      }),\r\n      catchError((error) => {\r\n        this.flowsDataService.resetSilentRenewRunning();\r\n        this.intervalService.stopPeriodicallTokenCheck();\r\n        if (!triggerAuthorizationResultEvent && !isRenewProcess) {\r\n          this.router.navigateByUrl(unauthorizedRoute);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { LoggerService } from '../logging/logger.service';\r\n\r\n@Injectable()\r\nexport class IFrameService {\r\n  constructor(@Inject(DOCUMENT) private readonly doc: any, private loggerService: LoggerService) {}\r\n\r\n  getExistingIFrame(identifier: string): HTMLIFrameElement | null {\r\n    const iFrameOnParent = this.getIFrameFromParentWindow(identifier);\r\n    if (this.isIFrameElement(iFrameOnParent)) {\r\n      return iFrameOnParent;\r\n    }\r\n\r\n    const iFrameOnSelf = this.getIFrameFromWindow(identifier);\r\n    if (this.isIFrameElement(iFrameOnSelf)) {\r\n      return iFrameOnSelf;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  addIFrameToWindowBody(identifier: string): HTMLIFrameElement {\r\n    const sessionIframe = this.doc.createElement('iframe');\r\n    sessionIframe.id = identifier;\r\n    sessionIframe.title = identifier;\r\n    this.loggerService.logDebug(sessionIframe);\r\n    sessionIframe.style.display = 'none';\r\n    this.doc.body.appendChild(sessionIframe);\r\n    return sessionIframe;\r\n  }\r\n\r\n  private getIFrameFromParentWindow(identifier: string): HTMLIFrameElement | null {\r\n    try {\r\n      const iFrameElement = this.doc.defaultView.parent.document.getElementById(identifier);\r\n      if (this.isIFrameElement(iFrameElement)) {\r\n        return iFrameElement;\r\n      }\r\n      return null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private getIFrameFromWindow(identifier: string): HTMLIFrameElement | null {\r\n    const iFrameElement = this.doc.getElementById(identifier);\r\n    if (this.isIFrameElement(iFrameElement)) {\r\n      return iFrameElement;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private isIFrameElement(element: HTMLElement | null): element is HTMLIFrameElement {\r\n    return !!element && element instanceof HTMLIFrameElement;\r\n  }\r\n}\r\n","import { Injectable, NgZone } from '@angular/core';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { take } from 'rxjs/operators';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { EventTypes } from '../public-events/event-types';\r\nimport { PublicEventsService } from '../public-events/public-events.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { IFrameService } from './existing-iframe.service';\r\n\r\nconst IFRAME_FOR_CHECK_SESSION_IDENTIFIER = 'myiFrameForCheckSession';\r\n\r\n// http://openid.net/specs/openid-connect-session-1_0-ID4.html\r\n\r\n@Injectable()\r\nexport class CheckSessionService {\r\n  private checkSessionReceived = false;\r\n  private scheduledHeartBeatRunning: any;\r\n  private lastIFrameRefresh = 0;\r\n  private outstandingMessages = 0;\r\n  private heartBeatInterval = 3000;\r\n  private iframeRefreshInterval = 60000;\r\n  private checkSessionChangedInternal$ = new BehaviorSubject<boolean>(false);\r\n\r\n  get checkSessionChanged$() {\r\n    return this.checkSessionChangedInternal$.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private loggerService: LoggerService,\r\n    private iFrameService: IFrameService,\r\n    private eventService: PublicEventsService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private zone: NgZone\r\n  ) {}\r\n\r\n  isCheckSessionConfigured() {\r\n    const { startCheckSession } = this.configurationProvider.getOpenIDConfiguration();\r\n    return startCheckSession;\r\n  }\r\n\r\n  start(): void {\r\n    if (!!this.scheduledHeartBeatRunning) {\r\n      return;\r\n    }\r\n\r\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\r\n    this.pollServerSession(clientId);\r\n  }\r\n\r\n  stop(): void {\r\n    if (!this.scheduledHeartBeatRunning) {\r\n      return;\r\n    }\r\n\r\n    this.clearScheduledHeartBeat();\r\n    this.checkSessionReceived = false;\r\n  }\r\n\r\n  serverStateChanged() {\r\n    const { startCheckSession } = this.configurationProvider.getOpenIDConfiguration();\r\n    return startCheckSession && this.checkSessionReceived;\r\n  }\r\n\r\n  getExistingIframe() {\r\n    return this.iFrameService.getExistingIFrame(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\r\n  }\r\n\r\n  private init(): Observable<any> {\r\n    if (this.lastIFrameRefresh + this.iframeRefreshInterval > Date.now()) {\r\n      return of(undefined);\r\n    }\r\n\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n    if (!authWellKnownEndPoints) {\r\n      this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined. Returning.');\r\n      return of();\r\n    }\r\n\r\n    const existingIframe = this.getOrCreateIframe();\r\n    const checkSessionIframe = authWellKnownEndPoints.checkSessionIframe;\r\n\r\n    if (checkSessionIframe) {\r\n      existingIframe.contentWindow.location.replace(checkSessionIframe);\r\n    } else {\r\n      this.loggerService.logWarning('init check session: checkSessionIframe is not configured to run');\r\n    }\r\n\r\n    return new Observable((observer) => {\r\n      existingIframe.onload = () => {\r\n        this.lastIFrameRefresh = Date.now();\r\n        observer.next();\r\n        observer.complete();\r\n      };\r\n    });\r\n  }\r\n\r\n  private pollServerSession(clientId: string) {\r\n    this.outstandingMessages = 0;\r\n    const pollServerSessionRecur = () => {\r\n      this.init()\r\n        .pipe(take(1))\r\n        .subscribe(() => {\r\n          const existingIframe = this.getExistingIframe();\r\n          if (existingIframe && clientId) {\r\n            this.loggerService.logDebug(existingIframe);\r\n            const sessionState = this.storagePersistenceService.read('session_state');\r\n            const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n            if (sessionState && authWellKnownEndPoints?.checkSessionIframe) {\r\n              const iframeOrigin = new URL(authWellKnownEndPoints.checkSessionIframe)?.origin;\r\n              this.outstandingMessages++;\r\n              existingIframe.contentWindow.postMessage(clientId + ' ' + sessionState, iframeOrigin);\r\n            } else {\r\n              this.loggerService.logDebug(`OidcSecurityCheckSession pollServerSession session_state is '${sessionState}'`);\r\n              this.loggerService.logDebug(`AuthWellKnownEndPoints is '${JSON.stringify(authWellKnownEndPoints)}'`);\r\n              this.checkSessionChangedInternal$.next(true);\r\n            }\r\n          } else {\r\n            this.loggerService.logWarning('OidcSecurityCheckSession pollServerSession checkSession IFrame does not exist');\r\n            this.loggerService.logDebug(clientId);\r\n            this.loggerService.logDebug(existingIframe);\r\n          }\r\n\r\n          // after sending three messages with no response, fail.\r\n          if (this.outstandingMessages > 3) {\r\n            this.loggerService.logError(\r\n              `OidcSecurityCheckSession not receiving check session response messages.\r\n                            Outstanding messages: ${this.outstandingMessages}. Server unreachable?`\r\n            );\r\n          }\r\n\r\n          this.zone.runOutsideAngular(() => {\r\n            this.scheduledHeartBeatRunning = setTimeout(() => this.zone.run(pollServerSessionRecur), this.heartBeatInterval);\r\n          });\r\n        });\r\n    };\r\n\r\n    pollServerSessionRecur();\r\n  }\r\n\r\n  private clearScheduledHeartBeat() {\r\n    clearTimeout(this.scheduledHeartBeatRunning);\r\n    this.scheduledHeartBeatRunning = null;\r\n  }\r\n\r\n  private messageHandler(e: any) {\r\n    const existingIFrame = this.getExistingIframe();\r\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    const startsWith = !!authWellKnownEndPoints?.checkSessionIframe?.startsWith(e.origin);\r\n    this.outstandingMessages = 0;\r\n    if (existingIFrame && startsWith && e.source === existingIFrame.contentWindow) {\r\n      if (e.data === 'error') {\r\n        this.loggerService.logWarning('error from checksession messageHandler');\r\n      } else if (e.data === 'changed') {\r\n        this.loggerService.logDebug(e);\r\n        this.checkSessionReceived = true;\r\n        this.eventService.fireEvent(EventTypes.CheckSessionReceived, e.data);\r\n        this.checkSessionChangedInternal$.next(true);\r\n      } else {\r\n        this.eventService.fireEvent(EventTypes.CheckSessionReceived, e.data);\r\n        this.loggerService.logDebug(e.data + ' from checksession messageHandler');\r\n      }\r\n    }\r\n  }\r\n\r\n  private bindMessageEventToIframe() {\r\n    const iframeMessageEvent = this.messageHandler.bind(this);\r\n    window.addEventListener('message', iframeMessageEvent, false);\r\n  }\r\n\r\n  private getOrCreateIframe() {\r\n    const existingIframe = this.getExistingIframe();\r\n\r\n    if (!existingIframe) {\r\n      const frame = this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\r\n      this.bindMessageEventToIframe();\r\n      return frame;\r\n    }\r\n\r\n    return existingIframe;\r\n  }\r\n}\r\n","import { HttpParams } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { of, Subject, throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { AuthorizedState } from '../authState/authorized-state';\r\nimport { ImplicitFlowCallbackService } from '../callback/implicit-flow-callback.service';\r\nimport { IntervallService } from '../callback/intervall.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { CallbackContext } from '../flows/callback-context';\r\nimport { FlowsDataService } from '../flows/flows-data.service';\r\nimport { FlowsService } from '../flows/flows.service';\r\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { ValidationResult } from '../validation/validation-result';\r\nimport { IFrameService } from './existing-iframe.service';\r\n\r\nconst IFRAME_FOR_SILENT_RENEW_IDENTIFIER = 'myiFrameForSilentRenew';\r\n\r\n@Injectable()\r\nexport class SilentRenewService {\r\n  private refreshSessionWithIFrameCompletedInternal$ = new Subject<CallbackContext>();\r\n\r\n  get refreshSessionWithIFrameCompleted$() {\r\n    return this.refreshSessionWithIFrameCompletedInternal$.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private configurationProvider: ConfigurationProvider,\r\n    private iFrameService: IFrameService,\r\n    private flowsService: FlowsService,\r\n    private resetAuthDataService: ResetAuthDataService,\r\n    private flowsDataService: FlowsDataService,\r\n    private authStateService: AuthStateService,\r\n    private loggerService: LoggerService,\r\n    private flowHelper: FlowHelper,\r\n    private implicitFlowCallbackService: ImplicitFlowCallbackService,\r\n    private intervalService: IntervallService\r\n  ) {}\r\n\r\n  getOrCreateIframe(): HTMLIFrameElement {\r\n    const existingIframe = this.getExistingIframe();\r\n\r\n    if (!existingIframe) {\r\n      return this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\r\n    }\r\n\r\n    return existingIframe;\r\n  }\r\n\r\n  isSilentRenewConfigured() {\r\n    const { useRefreshToken, silentRenew } = this.configurationProvider.getOpenIDConfiguration();\r\n    return !useRefreshToken && silentRenew;\r\n  }\r\n\r\n  codeFlowCallbackSilentRenewIframe(urlParts) {\r\n    const params = new HttpParams({\r\n      fromString: urlParts[1],\r\n    });\r\n\r\n    const error = params.get('error');\r\n\r\n    if (error) {\r\n      this.authStateService.updateAndPublishAuthState({\r\n        authorizationState: AuthorizedState.Unauthorized,\r\n        validationResult: ValidationResult.LoginRequired,\r\n        isRenewProcess: true,\r\n      });\r\n      this.resetAuthDataService.resetAuthorizationData();\r\n      this.flowsDataService.setNonce('');\r\n      this.intervalService.stopPeriodicallTokenCheck();\r\n      return throwError(error);\r\n    }\r\n\r\n    const code = params.get('code');\r\n    const state = params.get('state');\r\n    const sessionState = params.get('session_state');\r\n\r\n    const callbackContext = {\r\n      code,\r\n      refreshToken: null,\r\n      state,\r\n      sessionState,\r\n      authResult: null,\r\n      isRenewProcess: true,\r\n      jwtKeys: null,\r\n      validationResult: null,\r\n      existingIdToken: null,\r\n    };\r\n\r\n    return this.flowsService.processSilentRenewCodeFlowCallback(callbackContext).pipe(\r\n      catchError((errorFromFlow) => {\r\n        this.intervalService.stopPeriodicallTokenCheck();\r\n        this.resetAuthDataService.resetAuthorizationData();\r\n        return throwError(errorFromFlow);\r\n      })\r\n    );\r\n  }\r\n\r\n  silentRenewEventHandler(e: CustomEvent) {\r\n    this.loggerService.logDebug('silentRenewEventHandler');\r\n    if (!e.detail) {\r\n      return;\r\n    }\r\n\r\n    let callback$ = of(null);\r\n\r\n    const isCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\r\n\r\n    if (isCodeFlow) {\r\n      const urlParts = e.detail.toString().split('?');\r\n      callback$ = this.codeFlowCallbackSilentRenewIframe(urlParts);\r\n    } else {\r\n      callback$ = this.implicitFlowCallbackService.authorizedImplicitFlowCallback(e.detail);\r\n    }\r\n\r\n    callback$.subscribe(\r\n      (callbackContext) => {\r\n        this.refreshSessionWithIFrameCompletedInternal$.next(callbackContext);\r\n        this.flowsDataService.resetSilentRenewRunning();\r\n      },\r\n      (err: any) => {\r\n        this.loggerService.logError('Error: ' + err);\r\n        this.refreshSessionWithIFrameCompletedInternal$.next(null);\r\n        this.flowsDataService.resetSilentRenewRunning();\r\n      }\r\n    );\r\n  }\r\n\r\n  private getExistingIframe() {\r\n    return this.iFrameService.getExistingIFrame(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { FlowsDataService } from '../flows/flows-data.service';\r\nimport { FlowsService } from '../flows/flows.service';\r\nimport { IntervallService } from './intervall.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class CodeFlowCallbackService {\r\n  constructor(\r\n    private flowsService: FlowsService,\r\n    private flowsDataService: FlowsDataService,\r\n    private intervallService: IntervallService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private router: Router\r\n  ) {}\r\n\r\n  authorizedCallbackWithCode(urlToCheck: string) {\r\n    const isRenewProcess = this.flowsDataService.isSilentRenewRunning();\r\n    const { triggerAuthorizationResultEvent, postLoginRoute, unauthorizedRoute } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    return this.flowsService.processCodeFlowCallback(urlToCheck).pipe(\r\n      tap((callbackContext) => {\r\n        if (!triggerAuthorizationResultEvent && !callbackContext.isRenewProcess) {\r\n          this.router.navigateByUrl(postLoginRoute);\r\n        }\r\n      }),\r\n      catchError((error) => {\r\n        this.flowsDataService.resetSilentRenewRunning();\r\n        this.intervallService.stopPeriodicallTokenCheck();\r\n        if (!triggerAuthorizationResultEvent && !isRenewProcess) {\r\n          this.router.navigateByUrl(unauthorizedRoute);\r\n        }\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { CallbackContext } from '../flows/callback-context';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { UrlService } from '../utils/url/url.service';\r\nimport { CodeFlowCallbackService } from './code-flow-callback.service';\r\nimport { ImplicitFlowCallbackService } from './implicit-flow-callback.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class CallbackService {\r\n  private stsCallbackInternal$ = new Subject();\r\n\r\n  get stsCallback$() {\r\n    return this.stsCallbackInternal$.asObservable();\r\n  }\r\n\r\n  constructor(\r\n    private urlService: UrlService,\r\n    private flowHelper: FlowHelper,\r\n    private implicitFlowCallbackService: ImplicitFlowCallbackService,\r\n    private codeFlowCallbackService: CodeFlowCallbackService\r\n  ) {}\r\n\r\n  isCallback(currentUrl: string): boolean {\r\n    return this.urlService.isCallbackFromSts(currentUrl);\r\n  }\r\n\r\n  handleCallbackAndFireEvents(currentCallbackUrl: string): Observable<CallbackContext> {\r\n    let callback$: Observable<any>;\r\n\r\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\r\n      callback$ = this.codeFlowCallbackService.authorizedCallbackWithCode(currentCallbackUrl);\r\n    } else if (this.flowHelper.isCurrentFlowAnyImplicitFlow()) {\r\n      callback$ = this.implicitFlowCallbackService.authorizedImplicitFlowCallback();\r\n    }\r\n\r\n    return callback$.pipe(tap(() => this.stsCallbackInternal$.next()));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { map, retry } from 'rxjs/operators';\r\nimport { DataService } from '../api/data.service';\r\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\r\n\r\nconst WELL_KNOWN_SUFFIX = `/.well-known/openid-configuration`;\r\n\r\n@Injectable()\r\nexport class AuthWellKnownDataService {\r\n  constructor(private readonly http: DataService) {}\r\n\r\n  getWellKnownEndPointsFromUrl(authWellknownEndpoint: string) {\r\n    return this.getWellKnownDocument(authWellknownEndpoint).pipe(\r\n      map(\r\n        (wellKnownEndpoints) =>\r\n          ({\r\n            issuer: wellKnownEndpoints.issuer,\r\n            jwksUri: wellKnownEndpoints.jwks_uri,\r\n            authorizationEndpoint: wellKnownEndpoints.authorization_endpoint,\r\n            tokenEndpoint: wellKnownEndpoints.token_endpoint,\r\n            userinfoEndpoint: wellKnownEndpoints.userinfo_endpoint,\r\n            endSessionEndpoint: wellKnownEndpoints.end_session_endpoint,\r\n            checkSessionIframe: wellKnownEndpoints.check_session_iframe,\r\n            revocationEndpoint: wellKnownEndpoints.revocation_endpoint,\r\n            introspectionEndpoint: wellKnownEndpoints.introspection_endpoint,\r\n            parEndpoint: wellKnownEndpoints.pushed_authorization_request_endpoint,\r\n          } as AuthWellKnownEndpoints)\r\n      )\r\n    );\r\n  }\r\n\r\n  private getWellKnownDocument(wellKnownEndpoint: string) {\r\n    let url = wellKnownEndpoint;\r\n\r\n    if (!wellKnownEndpoint.includes(WELL_KNOWN_SUFFIX)) {\r\n      url = `${wellKnownEndpoint}${WELL_KNOWN_SUFFIX}`;\r\n    }\r\n\r\n    return this.http.get<any>(url).pipe(retry(2));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { of, throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { EventTypes } from '../public-events/event-types';\r\nimport { PublicEventsService } from '../public-events/public-events.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { AuthWellKnownDataService } from './auth-well-known-data.service';\r\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\r\nimport { PublicConfiguration } from './public-configuration';\r\n\r\n@Injectable()\r\nexport class AuthWellKnownService {\r\n  constructor(\r\n    private publicEventsService: PublicEventsService,\r\n    private dataService: AuthWellKnownDataService,\r\n    private storagePersistenceService: StoragePersistenceService\r\n  ) {}\r\n\r\n  getAuthWellKnownEndPoints(authWellknownEndpointUrl: string) {\r\n    const alreadySavedWellKnownEndpoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n    if (!!alreadySavedWellKnownEndpoints) {\r\n      return of(alreadySavedWellKnownEndpoints);\r\n    }\r\n\r\n    return this.getWellKnownEndPointsFromUrl(authWellknownEndpointUrl).pipe(\r\n      tap((mappedWellKnownEndpoints) => this.storeWellKnownEndpoints(mappedWellKnownEndpoints)),\r\n      catchError((error) => {\r\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoadingFailed, null);\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n\r\n  storeWellKnownEndpoints(mappedWellKnownEndpoints: AuthWellKnownEndpoints) {\r\n    this.storagePersistenceService.write('authWellKnownEndPoints', mappedWellKnownEndpoints);\r\n  }\r\n\r\n  private getWellKnownEndPointsFromUrl(authWellknownEndpoint: string) {\r\n    return this.dataService.getWellKnownEndPointsFromUrl(authWellknownEndpoint);\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable, Renderer2, RendererFactory2 } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { UrlService } from '../utils/url/url.service';\r\nimport { SilentRenewService } from './silent-renew.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class RefreshSessionIframeService {\r\n  private renderer: Renderer2;\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private readonly doc: any,\r\n    private loggerService: LoggerService,\r\n    private urlService: UrlService,\r\n    private silentRenewService: SilentRenewService,\r\n    rendererFactory: RendererFactory2\r\n  ) {\r\n    this.renderer = rendererFactory.createRenderer(null, null);\r\n  }\r\n\r\n  refreshSessionWithIframe(customParams?: { [key: string]: string | number | boolean }): Observable<boolean> {\r\n    this.loggerService.logDebug('BEGIN refresh session Authorize Iframe renew');\r\n    const url = this.urlService.getRefreshSessionSilentRenewUrl(customParams);\r\n    return this.sendAuthorizeRequestUsingSilentRenew(url);\r\n  }\r\n\r\n  private sendAuthorizeRequestUsingSilentRenew(url: string): Observable<boolean> {\r\n    const sessionIframe = this.silentRenewService.getOrCreateIframe();\r\n    this.initSilentRenewRequest();\r\n    this.loggerService.logDebug('sendAuthorizeRequestUsingSilentRenew for URL:' + url);\r\n\r\n    return new Observable((observer) => {\r\n      const onLoadHandler = () => {\r\n        sessionIframe.removeEventListener('load', onLoadHandler);\r\n        this.loggerService.logDebug('removed event listener from IFrame');\r\n        observer.next(true);\r\n        observer.complete();\r\n      };\r\n      sessionIframe.addEventListener('load', onLoadHandler);\r\n      sessionIframe.contentWindow.location.replace(url);\r\n    });\r\n  }\r\n\r\n  private initSilentRenewRequest(): void {\r\n    const instanceId = Math.random();\r\n\r\n    const initDestroyHandler = this.renderer.listen('window', 'oidc-silent-renew-init', (e: CustomEvent) => {\r\n      if (e.detail !== instanceId) {\r\n        initDestroyHandler();\r\n        renewDestroyHandler();\r\n      }\r\n    });\r\n    const renewDestroyHandler = this.renderer.listen('window', 'oidc-silent-renew-message', (e) =>\r\n      this.silentRenewService.silentRenewEventHandler(e)\r\n    );\r\n\r\n    this.doc.defaultView.dispatchEvent(\r\n      new CustomEvent('oidc-silent-renew-init', {\r\n        detail: instanceId,\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { CallbackContext } from '../flows/callback-context';\r\nimport { FlowsService } from '../flows/flows.service';\r\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { IntervallService } from './intervall.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class RefreshSessionRefreshTokenService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private resetAuthDataService: ResetAuthDataService,\r\n    private flowsService: FlowsService,\r\n    private intervalService: IntervallService\r\n  ) {}\r\n\r\n  refreshSessionWithRefreshTokens(customParamsRefresh?: { [key: string]: string | number | boolean }): Observable<CallbackContext> {\r\n    this.loggerService.logDebug('BEGIN refresh session Authorize');\r\n\r\n    return this.flowsService.processRefreshToken(customParamsRefresh).pipe(\r\n      catchError((error) => {\r\n        this.intervalService.stopPeriodicallTokenCheck();\r\n        this.resetAuthDataService.resetAuthorizationData();\r\n        return throwError(error);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { forkJoin, Observable, of, throwError, TimeoutError, timer } from 'rxjs';\r\nimport { map, mergeMap, retryWhen, switchMap, take, timeout } from 'rxjs/operators';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { AuthWellKnownService } from '../config/auth-well-known.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { CallbackContext } from '../flows/callback-context';\r\nimport { FlowsDataService } from '../flows/flows-data.service';\r\nimport { RefreshSessionIframeService } from '../iframe/refresh-session-iframe.service';\r\nimport { SilentRenewService } from '../iframe/silent-renew.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { TokenResponse } from '../tokens/token-response';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { RefreshSessionRefreshTokenService } from './refresh-session-refresh-token.service';\r\n\r\nexport const MAX_RETRY_ATTEMPTS = 3;\r\n@Injectable({ providedIn: 'root' })\r\nexport class RefreshSessionService {\r\n  constructor(\r\n    private flowHelper: FlowHelper,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private flowsDataService: FlowsDataService,\r\n    private loggerService: LoggerService,\r\n    private silentRenewService: SilentRenewService,\r\n    private authStateService: AuthStateService,\r\n    private authWellKnownService: AuthWellKnownService,\r\n    private refreshSessionIframeService: RefreshSessionIframeService,\r\n    private refreshSessionRefreshTokenService: RefreshSessionRefreshTokenService\r\n  ) {}\r\n\r\n  forceRefreshSession(extraCustomParams?: { [key: string]: string | number | boolean }): Observable<TokenResponse | null> {\r\n    if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\r\n      const { customParamsRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\r\n      const mergedParams = { ...extraCustomParams, ...customParamsRefreshToken };\r\n      return this.startRefreshSession(mergedParams).pipe(\r\n        map(() => {\r\n          const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\r\n          if (isAuthenticated) {\r\n            return {\r\n              idToken: this.authStateService.getIdToken(),\r\n              accessToken: this.authStateService.getAccessToken(),\r\n            };\r\n          }\r\n\r\n          return null;\r\n        })\r\n      );\r\n    }\r\n\r\n    const { silentRenewTimeoutInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n    const timeOutTime = silentRenewTimeoutInSeconds * 1000;\r\n\r\n    return forkJoin([\r\n      this.startRefreshSession(extraCustomParams),\r\n      this.silentRenewService.refreshSessionWithIFrameCompleted$.pipe(take(1)),\r\n    ]).pipe(\r\n      timeout(timeOutTime),\r\n      retryWhen(this.timeoutRetryStrategy.bind(this)),\r\n      map(([_, callbackContext]) => {\r\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\r\n        if (isAuthenticated) {\r\n          return {\r\n            idToken: callbackContext?.authResult?.id_token,\r\n            accessToken: callbackContext?.authResult?.access_token,\r\n          };\r\n        }\r\n\r\n        return null;\r\n      })\r\n    );\r\n  }\r\n\r\n  private startRefreshSession(extraCustomParams?: {\r\n    [key: string]: string | number | boolean;\r\n  }): Observable<boolean | CallbackContext | null> {\r\n    const isSilentRenewRunning = this.flowsDataService.isSilentRenewRunning();\r\n    this.loggerService.logDebug(`Checking: silentRenewRunning: ${isSilentRenewRunning}`);\r\n    const shouldBeExecuted = !isSilentRenewRunning;\r\n\r\n    if (!shouldBeExecuted) {\r\n      return of(null);\r\n    }\r\n\r\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration() || {};\r\n\r\n    if (!authWellknownEndpoint) {\r\n      this.loggerService.logError('no authwellknownendpoint given!');\r\n      return of(null);\r\n    }\r\n\r\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\r\n      switchMap(() => {\r\n        this.flowsDataService.setSilentRenewRunning();\r\n\r\n        if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\r\n          // Refresh Session using Refresh tokens\r\n          return this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(extraCustomParams);\r\n        }\r\n\r\n        return this.refreshSessionIframeService.refreshSessionWithIframe(extraCustomParams);\r\n      })\r\n    );\r\n  }\r\n\r\n  private timeoutRetryStrategy(errorAttempts: Observable<any>): Observable<number> {\r\n    return errorAttempts.pipe(\r\n      mergeMap((error, index) => {\r\n        const scalingDuration = 1000;\r\n        const currentAttempt = index + 1;\r\n\r\n        if (!(error instanceof TimeoutError) || currentAttempt > MAX_RETRY_ATTEMPTS) {\r\n          return throwError(error);\r\n        }\r\n\r\n        this.loggerService.logDebug(`forceRefreshSession timeout. Attempt #${currentAttempt}`);\r\n\r\n        this.flowsDataService.resetSilentRenewRunning();\r\n        return timer(currentAttempt * scalingDuration);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { of, throwError } from 'rxjs';\r\nimport { catchError, switchMap } from 'rxjs/operators';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { FlowsDataService } from '../flows/flows-data.service';\r\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\r\nimport { RefreshSessionIframeService } from '../iframe/refresh-session-iframe.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { UserService } from '../userData/user-service';\r\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\r\nimport { IntervallService } from './intervall.service';\r\nimport { RefreshSessionRefreshTokenService } from './refresh-session-refresh-token.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class PeriodicallyTokenCheckService {\r\n  constructor(\r\n    private resetAuthDataService: ResetAuthDataService,\r\n    private flowHelper: FlowHelper,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private flowsDataService: FlowsDataService,\r\n    private loggerService: LoggerService,\r\n    private userService: UserService,\r\n    private authStateService: AuthStateService,\r\n    private refreshSessionIframeService: RefreshSessionIframeService,\r\n    private refreshSessionRefreshTokenService: RefreshSessionRefreshTokenService,\r\n    private intervalService: IntervallService,\r\n    private storagePersistenceService: StoragePersistenceService\r\n  ) {}\r\n\r\n  startTokenValidationPeriodically(repeatAfterSeconds: number) {\r\n    const { silentRenew } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!!this.intervalService.runTokenValidationRunning || !silentRenew) {\r\n      return;\r\n    }\r\n\r\n    this.loggerService.logDebug(`starting token validation check every ${repeatAfterSeconds}s`);\r\n\r\n    const periodicallyCheck$ = this.intervalService.startPeriodicTokenCheck(repeatAfterSeconds).pipe(\r\n      switchMap(() => {\r\n        const idToken = this.authStateService.getIdToken();\r\n        const isSilentRenewRunning = this.flowsDataService.isSilentRenewRunning();\r\n        const userDataFromStore = this.userService.getUserDataFromStore();\r\n\r\n        this.loggerService.logDebug(\r\n          `Checking: silentRenewRunning: ${isSilentRenewRunning} id_token: ${!!idToken} userData: ${!!userDataFromStore}`\r\n        );\r\n\r\n        const shouldBeExecuted = userDataFromStore && !isSilentRenewRunning && idToken;\r\n\r\n        if (!shouldBeExecuted) {\r\n          return of(null);\r\n        }\r\n\r\n        const idTokenHasExpired = this.authStateService.hasIdTokenExpired();\r\n        const accessTokenHasExpired = this.authStateService.hasAccessTokenExpiredIfExpiryExists();\r\n\r\n        if (!idTokenHasExpired && !accessTokenHasExpired) {\r\n          return of(null);\r\n        }\r\n\r\n        const config = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n        if (!config?.silentRenew) {\r\n          this.resetAuthDataService.resetAuthorizationData();\r\n          return of(null);\r\n        }\r\n\r\n        this.loggerService.logDebug('starting silent renew...');\r\n\r\n        this.flowsDataService.setSilentRenewRunning();\r\n\r\n        if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\r\n          // Retrieve Dynamically Set Custom Params for refresh body\r\n          const customParamsRefresh: { [key: string]: string | number | boolean } =\r\n            this.storagePersistenceService.read('storageCustomParamsRefresh') || {};\r\n\r\n          const { customParamsRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n          const mergedParams = { ...customParamsRefresh, ...customParamsRefreshToken };\r\n\r\n          // Refresh Session using Refresh tokens\r\n          return this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(mergedParams);\r\n        }\r\n\r\n        // Retrieve Dynamically Set Custom Params\r\n        const customParams: { [key: string]: string | number | boolean } = this.storagePersistenceService.read(\r\n          'storageCustomRequestParams'\r\n        );\r\n\r\n        return this.refreshSessionIframeService.refreshSessionWithIframe(customParams);\r\n      })\r\n    );\r\n\r\n    this.intervalService.runTokenValidationRunning = periodicallyCheck$\r\n      .pipe(\r\n        catchError(() => {\r\n          this.flowsDataService.resetSilentRenewRunning();\r\n          return throwError('periodically check failed');\r\n        })\r\n      )\r\n      .subscribe(\r\n        () => {\r\n          this.loggerService.logDebug('silent renew, periodic check finished!');\r\n          if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\r\n            this.flowsDataService.resetSilentRenewRunning();\r\n          }\r\n        },\r\n        (err) => {\r\n          this.loggerService.logError('silent renew failed!', err);\r\n        }\r\n      );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { PopupOptions } from './popup-options';\r\nimport { PopupResult } from './popup-result';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class PopUpService {\r\n  private STORAGE_IDENTIFIER = 'popupauth';\r\n  private popUp: Window;\r\n  private handle: number;\r\n  private resultInternal$ = new Subject<PopupResult>();\r\n\r\n  get result$(): Observable<PopupResult> {\r\n    return this.resultInternal$.asObservable();\r\n  }\r\n\r\n  isCurrentlyInPopup(): boolean {\r\n    const popup = sessionStorage.getItem(this.STORAGE_IDENTIFIER);\r\n    return !!window.opener && window.opener !== window && !!popup;\r\n  }\r\n\r\n  openPopUp(url: string, popupOptions?: PopupOptions): void {\r\n    const optionsToPass = this.getOptions(popupOptions);\r\n    this.popUp = window.open(url, '_blank', optionsToPass);\r\n    this.popUp.sessionStorage.setItem(this.STORAGE_IDENTIFIER, 'true');\r\n\r\n    const listener = (event: MessageEvent): void => {\r\n      if (!event?.data || typeof event.data !== 'string') {\r\n        return;\r\n      }\r\n\r\n      this.resultInternal$.next({ userClosed: false, receivedUrl: event.data });\r\n\r\n      this.cleanUp(listener);\r\n    };\r\n\r\n    window.addEventListener('message', listener, false);\r\n\r\n    this.handle = window.setInterval(() => {\r\n      if (this.popUp.closed) {\r\n        this.resultInternal$.next({ userClosed: true });\r\n\r\n        this.cleanUp(listener);\r\n      }\r\n    }, 200);\r\n  }\r\n\r\n  sendMessageToMainWindow(url: string): void {\r\n    if (window.opener) {\r\n      this.sendMessage(url, window.location.href);\r\n    }\r\n  }\r\n\r\n  private cleanUp(listener: any): void {\r\n    window.removeEventListener('message', listener, false);\r\n\r\n    window.clearInterval(this.handle);\r\n\r\n    if (this.popUp) {\r\n      this.popUp.sessionStorage?.removeItem(this.STORAGE_IDENTIFIER);\r\n      this.popUp.close();\r\n      this.popUp = null;\r\n    }\r\n  }\r\n\r\n  private sendMessage(url: string, href: string): void {\r\n    window.opener.postMessage(url, href);\r\n  }\r\n\r\n  private getOptions(popupOptions?: PopupOptions): string {\r\n    const popupDefaultOptions = { width: 500, height: 500, left: 50, top: 50 };\r\n\r\n    const options = { ...popupDefaultOptions, ...(popupOptions || {}) };\r\n\r\n    return Object.entries(options)\r\n      .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)\r\n      .join(',');\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Observable, of } from 'rxjs';\r\nimport { catchError, map, switchMap, tap } from 'rxjs/operators';\r\nimport { AuthStateService } from './authState/auth-state.service';\r\nimport { AutoLoginService } from './auto-login/auto-login-service';\r\nimport { CallbackService } from './callback/callback.service';\r\nimport { PeriodicallyTokenCheckService } from './callback/periodically-token-check.service';\r\nimport { RefreshSessionService } from './callback/refresh-session.service';\r\nimport { ConfigurationProvider } from './config/config.provider';\r\nimport { CheckSessionService } from './iframe/check-session.service';\r\nimport { SilentRenewService } from './iframe/silent-renew.service';\r\nimport { LoggerService } from './logging/logger.service';\r\nimport { PopUpService } from './login/popup/popup.service';\r\nimport { UserService } from './userData/user-service';\r\n\r\n@Injectable()\r\nexport class CheckAuthService {\r\n  constructor(\r\n    @Inject(DOCUMENT) private readonly doc: any,\r\n    private checkSessionService: CheckSessionService,\r\n    private silentRenewService: SilentRenewService,\r\n    private userService: UserService,\r\n    private loggerService: LoggerService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authStateService: AuthStateService,\r\n    private callbackService: CallbackService,\r\n    private refreshSessionService: RefreshSessionService,\r\n    private periodicallyTokenCheckService: PeriodicallyTokenCheckService,\r\n    private popupService: PopUpService,\r\n    private autoLoginService: AutoLoginService,\r\n    private router: Router\r\n  ) {}\r\n\r\n  checkAuth(url?: string): Observable<boolean> {\r\n    if (!this.configurationProvider.hasValidConfig()) {\r\n      this.loggerService.logError('Please provide a configuration before setting up the module');\r\n      return of(false);\r\n    }\r\n\r\n    const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    this.loggerService.logDebug('STS server: ', stsServer);\r\n\r\n    const currentUrl = url || this.doc.defaultView.location.toString();\r\n\r\n    if (this.popupService.isCurrentlyInPopup()) {\r\n      this.popupService.sendMessageToMainWindow(currentUrl);\r\n      return of(null);\r\n    }\r\n\r\n    const isCallback = this.callbackService.isCallback(currentUrl);\r\n\r\n    this.loggerService.logDebug('currentUrl to check auth with: ', currentUrl);\r\n\r\n    const callback$ = isCallback ? this.callbackService.handleCallbackAndFireEvents(currentUrl) : of(null);\r\n\r\n    return callback$.pipe(\r\n      map(() => {\r\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\r\n        if (isAuthenticated) {\r\n          this.startCheckSessionAndValidation();\r\n\r\n          if (!isCallback) {\r\n            this.authStateService.setAuthorizedAndFireEvent();\r\n            this.userService.publishUserDataIfExists();\r\n          }\r\n        }\r\n\r\n        this.loggerService.logDebug('checkAuth completed fired events, auth: ' + isAuthenticated);\r\n\r\n        return isAuthenticated;\r\n      }),\r\n      tap(() => {\r\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\r\n\r\n        if (isAuthenticated) {\r\n          const savedRouteForRedirect = this.autoLoginService.getStoredRedirectRoute();\r\n\r\n          if (savedRouteForRedirect) {\r\n            this.autoLoginService.deleteStoredRedirectRoute();\r\n            this.router.navigateByUrl(savedRouteForRedirect);\r\n          }\r\n        }\r\n      }),\r\n      catchError((error) => {\r\n        this.loggerService.logError(error);\r\n        return of(false);\r\n      })\r\n    );\r\n  }\r\n\r\n  checkAuthIncludingServer(): Observable<boolean> {\r\n    return this.checkAuth().pipe(\r\n      switchMap((isAuthenticated) => {\r\n        if (isAuthenticated) {\r\n          return of(isAuthenticated);\r\n        }\r\n\r\n        return this.refreshSessionService.forceRefreshSession().pipe(\r\n          map((result) => !!result?.idToken && !!result?.accessToken),\r\n          switchMap((isAuth) => {\r\n            if (isAuth) {\r\n              this.startCheckSessionAndValidation();\r\n            }\r\n\r\n            return of(isAuth);\r\n          })\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  private startCheckSessionAndValidation() {\r\n    if (this.checkSessionService.isCheckSessionConfigured()) {\r\n      this.checkSessionService.start();\r\n    }\r\n\r\n    const { tokenRefreshInSeconds } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    this.periodicallyTokenCheckService.startTokenValidationPeriodically(tokenRefreshInSeconds);\r\n\r\n    if (this.silentRenewService.isSilentRenewConfigured()) {\r\n      this.silentRenewService.getOrCreateIframe();\r\n    }\r\n  }\r\n}\r\n","import { OpenIdConfiguration } from '../config/openid-configuration';\r\n\r\nexport interface Rule {\r\n  validate(passedConfig: OpenIdConfiguration): RuleValidationResult;\r\n}\r\n\r\nexport interface RuleValidationResult {\r\n  result: boolean;\r\n  messages: string[];\r\n  level: Level;\r\n}\r\n\r\nexport const POSITIVE_VALIDATION_RESULT = {\r\n  result: true,\r\n  messages: [],\r\n  level: null,\r\n};\r\n\r\nexport type Level = 'warning' | 'error';\r\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\r\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\r\n\r\nexport const ensureClientId = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\r\n  if (!passedConfig.clientId) {\r\n    return {\r\n      result: false,\r\n      messages: ['The clientId is required and missing from your config!'],\r\n      level: 'error',\r\n    };\r\n  }\r\n\r\n  return POSITIVE_VALIDATION_RESULT;\r\n};\r\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\r\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\r\n\r\nexport const ensureRedirectRule = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\r\n  if (!passedConfig.redirectUrl) {\r\n    return {\r\n      result: false,\r\n      messages: ['The redirectURL is required and missing from your config'],\r\n      level: 'error',\r\n    };\r\n  }\r\n\r\n  return POSITIVE_VALIDATION_RESULT;\r\n};\r\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\r\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\r\n\r\nexport const ensureSilentRenewUrlWhenNoRefreshTokenUsed = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\r\n  const usesSilentRenew = passedConfig.silentRenew;\r\n  const usesRefreshToken = passedConfig.useRefreshToken;\r\n  const hasSilentRenewUrl = passedConfig.silentRenewUrl;\r\n\r\n  if (usesSilentRenew && !usesRefreshToken && !hasSilentRenewUrl) {\r\n    return {\r\n      result: false,\r\n      messages: ['Please provide a silent renew URL if using renew and not refresh tokens'],\r\n      level: 'error',\r\n    };\r\n  }\r\n\r\n  return POSITIVE_VALIDATION_RESULT;\r\n};\r\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\r\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\r\n\r\nexport const ensureStsServer = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\r\n  if (!passedConfig.stsServer) {\r\n    return {\r\n      result: false,\r\n      messages: ['The STS URL MUST be provided in the configuration!'],\r\n      level: 'error',\r\n    };\r\n  }\r\n\r\n  return POSITIVE_VALIDATION_RESULT;\r\n};\r\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\r\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\r\n\r\nexport const useOfflineScopeWithSilentRenew = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\r\n  const hasRefreshToken = passedConfig.useRefreshToken;\r\n  const hasSilentRenew = passedConfig.silentRenew;\r\n  const scope = passedConfig.scope || '';\r\n  const hasOfflineScope = scope.split(' ').includes('offline_access');\r\n\r\n  if (hasRefreshToken && hasSilentRenew && !hasOfflineScope) {\r\n    return {\r\n      result: false,\r\n      messages: ['When using silent renew and refresh tokens please set the `offline_access` scope'],\r\n      level: 'warning',\r\n    };\r\n  }\r\n\r\n  return POSITIVE_VALIDATION_RESULT;\r\n};\r\n","import { ensureClientId } from './ensure-clientId.rule';\r\nimport { ensureRedirectRule } from './ensure-redirect-url.rule';\r\nimport { ensureSilentRenewUrlWhenNoRefreshTokenUsed } from './ensure-silentRenewUrl-with-no-refreshtokens.rule';\r\nimport { ensureStsServer } from './ensure-sts-server.rule';\r\nimport { useOfflineScopeWithSilentRenew } from './use-offline-scope-with-silent-renew.rule';\r\n\r\nexport const allRules = [\r\n  ensureStsServer,\r\n  useOfflineScopeWithSilentRenew,\r\n  ensureRedirectRule,\r\n  ensureClientId,\r\n  ensureSilentRenewUrlWhenNoRefreshTokenUsed,\r\n];\r\n","import { Injectable } from '@angular/core';\r\nimport { OpenIdConfiguration } from '../angular-auth-oidc-client';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { Level, RuleValidationResult } from './rule';\r\nimport { allRules } from './rules';\r\n\r\n@Injectable()\r\nexport class ConfigValidationService {\r\n  constructor(private loggerService: LoggerService) {}\r\n\r\n  validateConfig(passedConfig: OpenIdConfiguration): boolean {\r\n    const allValidationResults = allRules.map((rule) => rule(passedConfig));\r\n\r\n    const allMessages = allValidationResults.filter((x) => x.messages.length > 0);\r\n\r\n    const allErrorMessages = this.getAllMessagesOfType('error', allMessages);\r\n    const allWarnings = this.getAllMessagesOfType('warning', allMessages);\r\n    allErrorMessages.map((message) => this.loggerService.logError(message));\r\n    allWarnings.map((message) => this.loggerService.logWarning(message));\r\n\r\n    return allErrorMessages.length === 0;\r\n  }\r\n\r\n  private getAllMessagesOfType(type: Level, results: RuleValidationResult[]) {\r\n    const allMessages = results.filter((x) => x.level === type).map((result) => result.messages);\r\n    return allMessages.reduce((acc, val) => acc.concat(val), []);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { ConfigValidationService } from '../config-validation/config-validation.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { EventTypes } from '../public-events/event-types';\r\nimport { PublicEventsService } from '../public-events/public-events.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\r\nimport { AuthWellKnownService } from './auth-well-known.service';\r\nimport { OpenIdConfiguration } from './openid-configuration';\r\nimport { PublicConfiguration } from './public-configuration';\r\n\r\n@Injectable()\r\nexport class OidcConfigService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private publicEventsService: PublicEventsService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authWellKnownService: AuthWellKnownService,\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private configValidationService: ConfigValidationService\r\n  ) {}\r\n\r\n  withConfig(passedConfig: OpenIdConfiguration, passedAuthWellKnownEndpoints?: AuthWellKnownEndpoints): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      if (!this.configValidationService.validateConfig(passedConfig)) {\r\n        this.loggerService.logError('Validation of config rejected with errors. Config is NOT set.');\r\n        resolve();\r\n      }\r\n\r\n      if (!passedConfig.authWellknownEndpoint) {\r\n        passedConfig.authWellknownEndpoint = passedConfig.stsServer;\r\n      }\r\n\r\n      const usedConfig = this.configurationProvider.setConfig(passedConfig);\r\n\r\n      const alreadyExistingAuthWellKnownEndpoints = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n      if (!!alreadyExistingAuthWellKnownEndpoints) {\r\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\r\n          configuration: passedConfig,\r\n          wellknown: alreadyExistingAuthWellKnownEndpoints,\r\n        });\r\n\r\n        resolve();\r\n      }\r\n\r\n      if (!!passedAuthWellKnownEndpoints) {\r\n        this.authWellKnownService.storeWellKnownEndpoints(passedAuthWellKnownEndpoints);\r\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\r\n          configuration: passedConfig,\r\n          wellknown: passedAuthWellKnownEndpoints,\r\n        });\r\n\r\n        resolve();\r\n      }\r\n      if (usedConfig.eagerLoadAuthWellKnownEndpoints) {\r\n        this.authWellKnownService\r\n          .getAuthWellKnownEndPoints(usedConfig.authWellknownEndpoint)\r\n          .pipe(\r\n            catchError((error) => {\r\n              this.loggerService.logError('Getting auth well known endpoints failed on start', error);\r\n              return throwError(error);\r\n            }),\r\n            tap((wellknownEndPoints) =>\r\n              this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\r\n                configuration: passedConfig,\r\n                wellknown: wellknownEndPoints,\r\n              })\r\n            )\r\n          )\r\n          .subscribe(\r\n            () => resolve(),\r\n            () => reject()\r\n          );\r\n      } else {\r\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\r\n          configuration: passedConfig,\r\n          wellknown: null,\r\n        });\r\n        resolve();\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { FlowHelper } from '../../utils/flowHelper/flow-helper.service';\r\n\r\n@Injectable()\r\nexport class ResponseTypeValidationService {\r\n  constructor(private loggerService: LoggerService, private flowHelper: FlowHelper) {}\r\n\r\n  hasConfigValidResponseType(): boolean {\r\n    if (this.flowHelper.isCurrentFlowAnyImplicitFlow()) {\r\n      return true;\r\n    }\r\n\r\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\r\n      return true;\r\n    }\r\n\r\n    this.loggerService.logWarning('module configured incorrectly, invalid response_type. Check the responseType in the config');\r\n    return false;\r\n  }\r\n}\r\n","import { DOCUMENT } from '@angular/common';\r\nimport { Inject, Injectable } from '@angular/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class RedirectService {\r\n  constructor(@Inject(DOCUMENT) private readonly doc: any) {}\r\n\r\n  redirectTo(url) {\r\n    this.doc.location.href = url;\r\n  }\r\n}\r\n","import { HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, map, retry } from 'rxjs/operators';\r\nimport { DataService } from '../../api/data.service';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { ParResponse } from './par-response';\r\n\r\n@Injectable()\r\nexport class ParService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private urlService: UrlService,\r\n    private dataService: DataService,\r\n    private storagePersistenceService: StoragePersistenceService\r\n  ) {}\r\n\r\n  postParRequest(customParams?: { [key: string]: string | number | boolean }): Observable<ParResponse> {\r\n    let headers: HttpHeaders = new HttpHeaders();\r\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\r\n\r\n    if (!authWellKnown) {\r\n      return throwError('Could not read PAR endpoint because authWellKnownEndPoints are not given');\r\n    }\r\n\r\n    const parEndpoint = authWellKnown.parEndpoint;\r\n    if (!parEndpoint) {\r\n      return throwError('Could not read PAR endpoint from authWellKnownEndpoints');\r\n    }\r\n\r\n    const data = this.urlService.createBodyForParCodeFlowRequest(customParams);\r\n\r\n    return this.dataService.post(parEndpoint, data, headers).pipe(\r\n      retry(2),\r\n      map((response: any) => {\r\n        this.loggerService.logDebug('par response: ', response);\r\n\r\n        return {\r\n          expiresIn: response.expires_in,\r\n          requestUri: response.request_uri,\r\n        };\r\n      }),\r\n      catchError((error) => {\r\n        const errorMessage = `There was an error on ParService postParRequest`;\r\n        this.loggerService.logError(errorMessage, error);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { map, switchMap, take } from 'rxjs/operators';\r\nimport { AuthOptions } from '../../auth-options';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { CheckAuthService } from '../../check-auth.service';\r\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { UserService } from '../../userData/user-service';\r\nimport { RedirectService } from '../../utils/redirect/redirect.service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { LoginResponse } from '../login-response';\r\nimport { PopupOptions } from '../popup/popup-options';\r\nimport { PopUpService } from '../popup/popup.service';\r\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\r\nimport { ParResponse } from './par-response';\r\nimport { ParService } from './par.service';\r\n\r\n@Injectable()\r\nexport class ParLoginService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private responseTypeValidationService: ResponseTypeValidationService,\r\n    private urlService: UrlService,\r\n    private redirectService: RedirectService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authWellKnownService: AuthWellKnownService,\r\n    private popupService: PopUpService,\r\n    private checkAuthService: CheckAuthService,\r\n    private userService: UserService,\r\n    private authStateService: AuthStateService,\r\n    private parService: ParService\r\n  ) {}\r\n\r\n  loginPar(authOptions?: AuthOptions): void {\r\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\r\n      this.loggerService.logError('Invalid response type!');\r\n      return;\r\n    }\r\n\r\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!authWellknownEndpoint) {\r\n      this.loggerService.logError('no authWellknownEndpoint given!');\r\n      return;\r\n    }\r\n\r\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow, no auth data');\r\n\r\n    const { urlHandler, customParams } = authOptions || {};\r\n\r\n    this.authWellKnownService\r\n      .getAuthWellKnownEndPoints(authWellknownEndpoint)\r\n      .pipe(switchMap(() => this.parService.postParRequest(customParams)))\r\n      .subscribe((response) => {\r\n        this.loggerService.logDebug('par response: ', response);\r\n\r\n        const url = this.urlService.getAuthorizeParUrl(response.requestUri);\r\n\r\n        this.loggerService.logDebug('par request url: ', url);\r\n\r\n        if (!url) {\r\n          this.loggerService.logError(`Could not create url with param ${response.requestUri}: '${url}'`);\r\n          return;\r\n        }\r\n\r\n        if (urlHandler) {\r\n          urlHandler(url);\r\n        } else {\r\n          this.redirectService.redirectTo(url);\r\n        }\r\n      });\r\n  }\r\n\r\n  loginWithPopUpPar(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\r\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\r\n      const errorMessage = 'Invalid response type!';\r\n      this.loggerService.logError(errorMessage);\r\n      return throwError(errorMessage);\r\n    }\r\n\r\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!authWellknownEndpoint) {\r\n      const errorMessage = 'no authWellknownEndpoint given!';\r\n      this.loggerService.logError(errorMessage);\r\n      return throwError(errorMessage);\r\n    }\r\n\r\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow with popup, no auth data');\r\n\r\n    const { customParams } = authOptions || {};\r\n\r\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\r\n      switchMap(() => this.parService.postParRequest(customParams)),\r\n      switchMap((response: ParResponse) => {\r\n        this.loggerService.logDebug('par response: ', response);\r\n\r\n        const url = this.urlService.getAuthorizeParUrl(response.requestUri);\r\n\r\n        this.loggerService.logDebug('par request url: ', url);\r\n\r\n        if (!url) {\r\n          const errorMessage = `Could not create url with param ${response.requestUri}: 'url'`;\r\n          this.loggerService.logError(errorMessage);\r\n          return throwError(errorMessage);\r\n        }\r\n\r\n        this.popupService.openPopUp(url, popupOptions);\r\n\r\n        return this.popupService.result$.pipe(\r\n          take(1),\r\n          switchMap((result) =>\r\n            result.userClosed === true\r\n              ? of({ isAuthenticated: false, errorMessage: 'User closed popup' })\r\n              : this.checkAuthService.checkAuth(result.receivedUrl).pipe(\r\n                  map((isAuthenticated) => ({\r\n                    isAuthenticated,\r\n                    userData: this.userService.getUserDataFromStore(),\r\n                    accessToken: this.authStateService.getAccessToken(),\r\n                  }))\r\n                )\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { map, switchMap, take } from 'rxjs/operators';\r\nimport { AuthOptions } from '../../auth-options';\r\nimport { AuthStateService } from '../../authState/auth-state.service';\r\nimport { CheckAuthService } from '../../check-auth.service';\r\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { UserService } from '../../userData/user-service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { LoginResponse } from '../login-response';\r\nimport { PopupOptions } from '../popup/popup-options';\r\nimport { PopUpService } from '../popup/popup.service';\r\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\r\n\r\n@Injectable()\r\nexport class PopUpLoginService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private responseTypeValidationService: ResponseTypeValidationService,\r\n    private urlService: UrlService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authWellKnownService: AuthWellKnownService,\r\n    private popupService: PopUpService,\r\n    private checkAuthService: CheckAuthService,\r\n    private userService: UserService,\r\n    private authStateService: AuthStateService\r\n  ) {}\r\n\r\n  loginWithPopUpStandard(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\r\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\r\n      const errorMessage = 'Invalid response type!';\r\n      this.loggerService.logError(errorMessage);\r\n      return throwError(errorMessage);\r\n    }\r\n\r\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!authWellknownEndpoint) {\r\n      const errorMessage = 'no authWellknownEndpoint given!';\r\n      this.loggerService.logError(errorMessage);\r\n      return throwError(errorMessage);\r\n    }\r\n\r\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow with popup, no auth data');\r\n\r\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\r\n      switchMap(() => {\r\n        const { customParams } = authOptions || {};\r\n\r\n        const authUrl = this.urlService.getAuthorizeUrl(customParams);\r\n\r\n        this.popupService.openPopUp(authUrl, popupOptions);\r\n\r\n        return this.popupService.result$.pipe(\r\n          take(1),\r\n          switchMap((result) =>\r\n            result.userClosed === true\r\n              ? of({ isAuthenticated: false, errorMessage: 'User closed popup' })\r\n              : this.checkAuthService.checkAuth(result.receivedUrl).pipe(\r\n                  map((isAuthenticated) => ({\r\n                    isAuthenticated,\r\n                    userData: this.userService.getUserDataFromStore(),\r\n                    accessToken: this.authStateService.getAccessToken(),\r\n                  }))\r\n                )\r\n          )\r\n        );\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { AuthOptions } from '../../auth-options';\r\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\r\nimport { ConfigurationProvider } from '../../config/config.provider';\r\nimport { LoggerService } from '../../logging/logger.service';\r\nimport { RedirectService } from '../../utils/redirect/redirect.service';\r\nimport { UrlService } from '../../utils/url/url.service';\r\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\r\n\r\n@Injectable()\r\nexport class StandardLoginService {\r\n  constructor(\r\n    private loggerService: LoggerService,\r\n    private responseTypeValidationService: ResponseTypeValidationService,\r\n    private urlService: UrlService,\r\n    private redirectService: RedirectService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authWellKnownService: AuthWellKnownService\r\n  ) {}\r\n\r\n  loginStandard(authOptions?: AuthOptions): void {\r\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\r\n      this.loggerService.logError('Invalid response type!');\r\n      return;\r\n    }\r\n\r\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!authWellknownEndpoint) {\r\n      this.loggerService.logError('no authWellknownEndpoint given!');\r\n      return;\r\n    }\r\n\r\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow, no auth data');\r\n\r\n    this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).subscribe(() => {\r\n      const { urlHandler, customParams } = authOptions || {};\r\n\r\n      const url = this.urlService.getAuthorizeUrl(customParams);\r\n\r\n      if (!url) {\r\n        this.loggerService.logError('Could not create url', url);\r\n        return;\r\n      }\r\n\r\n      if (urlHandler) {\r\n        urlHandler(url);\r\n      } else {\r\n        this.redirectService.redirectTo(url);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { AuthOptions } from '../auth-options';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoginResponse } from './login-response';\r\nimport { ParLoginService } from './par/par-login.service';\r\nimport { PopUpLoginService } from './popup/popup-login.service';\r\nimport { PopupOptions } from './popup/popup-options';\r\nimport { StandardLoginService } from './standard/standard-login.service';\r\n\r\n@Injectable()\r\nexport class LoginService {\r\n  constructor(\r\n    private configurationProvider: ConfigurationProvider,\r\n    private parLoginService: ParLoginService,\r\n    private popUpLoginService: PopUpLoginService,\r\n    private standardLoginService: StandardLoginService\r\n  ) {}\r\n\r\n  login(authOptions?: AuthOptions): void {\r\n    const { usePushedAuthorisationRequests } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (usePushedAuthorisationRequests) {\r\n      return this.parLoginService.loginPar(authOptions);\r\n    } else {\r\n      return this.standardLoginService.loginStandard(authOptions);\r\n    }\r\n  }\r\n\r\n  loginWithPopUp(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\r\n    const { usePushedAuthorisationRequests } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (usePushedAuthorisationRequests) {\r\n      return this.parLoginService.loginWithPopUpPar(authOptions, popupOptions);\r\n    } else {\r\n      return this.popUpLoginService.loginWithPopUpStandard(authOptions, popupOptions);\r\n    }\r\n  }\r\n}\r\n","import { HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, of, throwError } from 'rxjs';\r\nimport { catchError, retry, switchMap, tap } from 'rxjs/operators';\r\nimport { DataService } from '../api/data.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\r\nimport { CheckSessionService } from '../iframe/check-session.service';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\r\nimport { UrlService } from '../utils/url/url.service';\r\n\r\n@Injectable()\r\nexport class LogoffRevocationService {\r\n  constructor(\r\n    private dataService: DataService,\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private loggerService: LoggerService,\r\n    private urlService: UrlService,\r\n    private checkSessionService: CheckSessionService,\r\n    private resetAuthDataService: ResetAuthDataService,\r\n    // TODO: HERE\r\n    //private redirectService: RedirectService,\r\n    private configurationProvider: ConfigurationProvider\r\n  ) {}\r\n\r\n  // Logs out on the server and the local client.\r\n  // If the server state has changed, checksession, then only a local logout.\r\n  logoff(urlHandler?: (url: string) => any): void {\r\n    this.loggerService.logDebug('logoff, remove auth ');\r\n    const endSessionUrl = this.getEndSessionUrl();\r\n    this.resetAuthDataService.resetAuthorizationData();\r\n\r\n    if (!endSessionUrl) {\r\n      this.loggerService.logDebug('only local login cleaned up, no end_session_endpoint');\r\n      return;\r\n    }\r\n\r\n    if (this.checkSessionService.serverStateChanged()) {\r\n      this.loggerService.logDebug('only local login cleaned up, server session has changed');\r\n    } else if (urlHandler) {\r\n      urlHandler(endSessionUrl);\r\n    } else {\r\n      // TODO: HERE\r\n      //this.redirectService.redirectTo(endSessionUrl);\r\n      this.dataService.get(endSessionUrl).subscribe(\r\n        (result) => {\r\n          console.log(result);\r\n        },\r\n        (error) => {\r\n          console.log('error', error);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  logoffLocal(): void {\r\n    this.resetAuthDataService.resetAuthorizationData();\r\n    this.checkSessionService.stop();\r\n  }\r\n\r\n  // The refresh token and and the access token are revoked on the server. If the refresh token does not exist\r\n  // only the access token is revoked. Then the logout run.\r\n  logoffAndRevokeTokens(urlHandler?: (url: string) => any): Observable<any> {\r\n    if (!this.storagePersistenceService.read('authWellKnownEndPoints')?.revocationEndpoint) {\r\n      this.loggerService.logDebug('revocation endpoint not supported');\r\n      this.logoff(urlHandler);\r\n    }\r\n\r\n    if (this.storagePersistenceService.getRefreshToken()) {\r\n      return this.revokeRefreshToken().pipe(\r\n        switchMap((result) => this.revokeAccessToken(result)),\r\n        catchError((error) => {\r\n          const errorMessage = `revoke token failed`;\r\n          this.loggerService.logError(errorMessage, error);\r\n          return throwError(errorMessage);\r\n        }),\r\n        tap(() => this.logoff(urlHandler))\r\n      );\r\n    } else {\r\n      return this.revokeAccessToken().pipe(\r\n        catchError((error) => {\r\n          const errorMessage = `revoke access token failed`;\r\n          this.loggerService.logError(errorMessage, error);\r\n          return throwError(errorMessage);\r\n        }),\r\n        tap(() => this.logoff(urlHandler))\r\n      );\r\n    }\r\n  }\r\n\r\n  // https://tools.ietf.org/html/rfc7009\r\n  // revokes an access token on the STS. If no token is provided, then the token from\r\n  // the storage is revoked. You can pass any token to revoke. This makes it possible to\r\n  // manage your own tokens. The is a public API.\r\n  revokeAccessToken(accessToken?: any): Observable<any> {\r\n    const accessTok = accessToken || this.storagePersistenceService.getAccessToken();\r\n    const body = this.urlService.createRevocationEndpointBodyAccessToken(accessTok);\r\n    const url = this.urlService.getRevocationEndpointUrl();\r\n\r\n    let headers: HttpHeaders = new HttpHeaders();\r\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n    return this.dataService.post(url, body, headers).pipe(\r\n      retry(2),\r\n      switchMap((response: any) => {\r\n        this.loggerService.logDebug('revocation endpoint post response: ', response);\r\n        return of(response);\r\n      }),\r\n      catchError((error) => {\r\n        const errorMessage = `Revocation request failed`;\r\n        this.loggerService.logError(errorMessage, error);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  // https://tools.ietf.org/html/rfc7009\r\n  // revokes an refresh token on the STS. This is only required in the code flow with refresh tokens.\r\n  // If no token is provided, then the token from the storage is revoked. You can pass any token to revoke.\r\n  // This makes it possible to manage your own tokens.\r\n  revokeRefreshToken(refreshToken?: any): Observable<any> {\r\n    const refreshTok = refreshToken || this.storagePersistenceService.getRefreshToken();\r\n    const body = this.urlService.createRevocationEndpointBodyRefreshToken(refreshTok);\r\n    const url = this.urlService.getRevocationEndpointUrl();\r\n\r\n    let headers: HttpHeaders = new HttpHeaders();\r\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\r\n\r\n    return this.dataService.post(url, body, headers).pipe(\r\n      retry(2),\r\n      switchMap((response: any) => {\r\n        this.loggerService.logDebug('revocation endpoint post response: ', response);\r\n        return of(response);\r\n      }),\r\n      catchError((error) => {\r\n        const errorMessage = `Revocation request failed`;\r\n        this.loggerService.logError(errorMessage, error);\r\n        return throwError(errorMessage);\r\n      })\r\n    );\r\n  }\r\n\r\n  getEndSessionUrl(customParams?: { [key: string]: string | number | boolean }): string | null {\r\n    const idToken = this.storagePersistenceService.getIdToken();\r\n\r\n    const { customParamsEndSession } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    const mergedParams = { ...customParams, ...customParamsEndSession };\r\n\r\n    return this.urlService.createEndSessionUrl(idToken, mergedParams);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { AuthOptions } from './auth-options';\r\nimport { AuthStateService } from './authState/auth-state.service';\r\nimport { CallbackService } from './callback/callback.service';\r\nimport { RefreshSessionService } from './callback/refresh-session.service';\r\nimport { CheckAuthService } from './check-auth.service';\r\nimport { ConfigurationProvider } from './config/config.provider';\r\nimport { PublicConfiguration } from './config/public-configuration';\r\nimport { FlowsDataService } from './flows/flows-data.service';\r\nimport { CheckSessionService } from './iframe/check-session.service';\r\nimport { LoginResponse } from './login/login-response';\r\nimport { LoginService } from './login/login.service';\r\nimport { PopupOptions } from './login/popup/popup-options';\r\nimport { LogoffRevocationService } from './logoffRevoke/logoff-revocation.service';\r\nimport { StoragePersistenceService } from './storage/storage-persistence.service';\r\nimport { TokenResponse } from './tokens/token-response';\r\nimport { UserService } from './userData/user-service';\r\nimport { TokenHelperService } from './utils/tokenHelper/oidc-token-helper.service';\r\n\r\n@Injectable()\r\nexport class OidcSecurityService {\r\n  /**\r\n   * Gets the currently active OpenID configuration.\r\n   */\r\n  get configuration(): PublicConfiguration {\r\n    const openIDConfiguration = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    return {\r\n      configuration: openIDConfiguration,\r\n      wellknown: this.storagePersistenceService.read('authWellKnownEndPoints'),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Provides information about the user after they have logged in.\r\n   */\r\n  get userData$(): Observable<any> {\r\n    return this.userService.userData$;\r\n  }\r\n\r\n  /**\r\n   * Emits each time an authorization event occurs. Returns true if the user is authenticated and false if they are not.\r\n   */\r\n  get isAuthenticated$(): Observable<boolean> {\r\n    return this.authStateService.authorized$;\r\n  }\r\n\r\n  /**\r\n   * Emits each time the server sends a CheckSession event and the value changed. This property will always return\r\n   * true.\r\n   */\r\n  get checkSessionChanged$(): Observable<boolean> {\r\n    return this.checkSessionService.checkSessionChanged$;\r\n  }\r\n\r\n  /**\r\n   * Emits on possible STS callback. The observable will never contain a value.\r\n   */\r\n  get stsCallback$(): Observable<any> {\r\n    return this.callbackService.stsCallback$;\r\n  }\r\n\r\n  constructor(\r\n    private checkSessionService: CheckSessionService,\r\n    private checkAuthService: CheckAuthService,\r\n    private userService: UserService,\r\n    private tokenHelperService: TokenHelperService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private authStateService: AuthStateService,\r\n    private flowsDataService: FlowsDataService,\r\n    private callbackService: CallbackService,\r\n    private logoffRevocationService: LogoffRevocationService,\r\n    private loginService: LoginService,\r\n    private storagePersistenceService: StoragePersistenceService,\r\n    private refreshSessionService: RefreshSessionService\r\n  ) {}\r\n\r\n  /**\r\n   * Starts the complete setup flow. Calling will start the entire authentication flow, and the returned observable\r\n   * will denote whether the user was successfully authenticated.\r\n   *\r\n   * @param url The url to perform the authorization on the behalf of.\r\n   */\r\n  checkAuth(url?: string): Observable<boolean> {\r\n    return this.checkAuthService.checkAuth(url);\r\n  }\r\n\r\n  /**\r\n   * Checks the server for an authenticated session using the iframe silent renew if not locally authenticated.\r\n   */\r\n  checkAuthIncludingServer(): Observable<boolean> {\r\n    return this.checkAuthService.checkAuthIncludingServer();\r\n  }\r\n\r\n  /**\r\n   * Returns the access token for the login scenario.\r\n   */\r\n  getToken(): string {\r\n    return this.authStateService.getAccessToken();\r\n  }\r\n\r\n  /**\r\n   * Returns the ID token for the login scenario.\r\n   */\r\n  getIdToken(): string {\r\n    return this.authStateService.getIdToken();\r\n  }\r\n\r\n  /**\r\n   * Returns the refresh token, if present, for the login scenario.\r\n   */\r\n  getRefreshToken(): string {\r\n    return this.authStateService.getRefreshToken();\r\n  }\r\n\r\n  /**\r\n   * Returns the payload from the ID token.\r\n   *\r\n   * @param encode Set to true if the payload is base64 encoded\r\n   */\r\n  getPayloadFromIdToken(encode = false): any {\r\n    const token = this.getIdToken();\r\n    return this.tokenHelperService.getPayloadFromToken(token, encode);\r\n  }\r\n\r\n  /**\r\n   * Sets a custom state for the authorize request.\r\n   *\r\n   * @param state The state to set.\r\n   */\r\n  setState(state: string): void {\r\n    this.flowsDataService.setAuthStateControl(state);\r\n  }\r\n\r\n  /**\r\n   * Gets the state value used for the authorize request.\r\n   */\r\n  getState(): string {\r\n    return this.flowsDataService.getAuthStateControl();\r\n  }\r\n\r\n  /**\r\n   * Redirects the user to the STS to begin the authentication process.\r\n   *\r\n   * @param authOptions The custom options for the the authentication request.\r\n   */\r\n  // Code Flow with PCKE or Implicit Flow\r\n  authorize(authOptions?: AuthOptions): void {\r\n    if (authOptions?.customParams) {\r\n      this.storagePersistenceService.write('storageCustomRequestParams', authOptions.customParams);\r\n    }\r\n\r\n    this.loginService.login(authOptions);\r\n  }\r\n\r\n  /**\r\n   * Opens the STS in a new window to begin the authentication process.\r\n   *\r\n   * @param authOptions The custom options for the authentication request.\r\n   * @param popupOptions The configuration for the popup window.\r\n   */\r\n  authorizeWithPopUp(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\r\n    if (authOptions?.customParams) {\r\n      this.storagePersistenceService.write('storageCustomRequestParams', authOptions.customParams);\r\n    }\r\n\r\n    return this.loginService.loginWithPopUp(authOptions, popupOptions);\r\n  }\r\n\r\n  /**\r\n   * Manually refreshes the session.\r\n   *\r\n   * @param customParams Custom parameters to pass to the refresh request.\r\n   */\r\n  forceRefreshSession(customParams?: { [key: string]: string | number | boolean }): Observable<TokenResponse> {\r\n    const { useRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (customParams) {\r\n      if (useRefreshToken) {\r\n        this.storagePersistenceService.write('storageCustomParamsRefresh', customParams);\r\n      } else {\r\n        this.storagePersistenceService.write('storageCustomRequestParams', customParams);\r\n      }\r\n    }\r\n\r\n    return this.refreshSessionService.forceRefreshSession(customParams);\r\n  }\r\n\r\n  /**\r\n   * Revokes the refresh token (if present) and the access token on the server and then performs the logoff operation.\r\n   *\r\n   * @param urlHandler An optional url handler for the logoff request.\r\n   */\r\n  // The refresh token and and the access token are revoked on the server. If the refresh token does not exist\r\n  // only the access token is revoked. Then the logout run.\r\n  logoffAndRevokeTokens(urlHandler?: (url: string) => any): Observable<any> {\r\n    return this.logoffRevocationService.logoffAndRevokeTokens(urlHandler);\r\n  }\r\n\r\n  /**\r\n   * Logs out on the server and the local client. If the server state has changed, confirmed via checksession,\r\n   * then only a local logout is performed.\r\n   *\r\n   * @param urlHandler\r\n   */\r\n  logoff(urlHandler?: (url: string) => any): void {\r\n    return this.logoffRevocationService.logoff(urlHandler);\r\n  }\r\n\r\n  /**\r\n   * Logs the user out of the application without logging them out of the server.\r\n   */\r\n  logoffLocal(): void {\r\n    return this.logoffRevocationService.logoffLocal();\r\n  }\r\n\r\n  /**\r\n   * Revokes an access token on the STS. This is only required in the code flow with refresh tokens. If no token is\r\n   * provided, then the token from the storage is revoked. You can pass any token to revoke.\r\n   * https://tools.ietf.org/html/rfc7009\r\n   *\r\n   * @param accessToken The access token to revoke.\r\n   */\r\n  revokeAccessToken(accessToken?: any): Observable<any> {\r\n    return this.logoffRevocationService.revokeAccessToken(accessToken);\r\n  }\r\n\r\n  /**\r\n   * Revokes a refresh token on the STS. This is only required in the code flow with refresh tokens. If no token is\r\n   * provided, then the token from the storage is revoked. You can pass any token to revoke.\r\n   * https://tools.ietf.org/html/rfc7009\r\n   *\r\n   * @param refreshToken The access token to revoke.\r\n   */\r\n  revokeRefreshToken(refreshToken?: any): Observable<any> {\r\n    return this.logoffRevocationService.revokeRefreshToken(refreshToken);\r\n  }\r\n\r\n  /**\r\n   * Creates the end session URL which can be used to implement an alternate server logout.\r\n   */\r\n  getEndSessionUrl(customParams?: { [key: string]: string | number | boolean }): string | null {\r\n    return this.logoffRevocationService.getEndSessionUrl(customParams);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from '../logging/logger.service';\r\nimport { AbstractSecurityStorage } from './abstract-security-storage';\r\n\r\n@Injectable()\r\nexport class BrowserStorageService implements AbstractSecurityStorage {\r\n  constructor(private configProvider: ConfigurationProvider, private loggerService: LoggerService) {}\r\n\r\n  read(key: string): any {\r\n    if (!this.hasStorage()) {\r\n      this.loggerService.logDebug(`Wanted to read '${key}' but Storage was undefined`);\r\n      return false;\r\n    }\r\n\r\n    const item = this.getStorage()?.getItem(key);\r\n\r\n    if (!item) {\r\n      this.loggerService.logDebug(`Wanted to read '${key}' but nothing was found`);\r\n      return null;\r\n    }\r\n\r\n    return JSON.parse(item);\r\n  }\r\n\r\n  write(key: string, value: any): boolean {\r\n    if (!this.hasStorage()) {\r\n      this.loggerService.logDebug(`Wanted to write '${key}/${value}' but Storage was falsy`);\r\n      return false;\r\n    }\r\n\r\n    const storage = this.getStorage();\r\n    if (!storage) {\r\n      this.loggerService.logDebug(`Wanted to write '${key}/${value}' but Storage was falsy`);\r\n      return false;\r\n    }\r\n\r\n    value = value || null;\r\n\r\n    storage.setItem(`${key}`, JSON.stringify(value));\r\n    return true;\r\n  }\r\n\r\n  remove(key: string): boolean {\r\n    if (!this.hasStorage()) {\r\n      this.loggerService.logDebug(`Wanted to remove '${key}' but Storage was falsy`);\r\n      return false;\r\n    }\r\n\r\n    const storage = this.getStorage();\r\n    if (!storage) {\r\n      this.loggerService.logDebug(`Wanted to write '${key}' but Storage was falsy`);\r\n      return false;\r\n    }\r\n\r\n    storage.removeItem(`${key}`);\r\n    return true;\r\n  }\r\n\r\n  private getStorage() {\r\n    const config = this.configProvider.getOpenIDConfiguration();\r\n    if (!config) {\r\n      return null;\r\n    }\r\n\r\n    return config.storage;\r\n  }\r\n\r\n  private hasStorage() {\r\n    return typeof Storage !== 'undefined';\r\n  }\r\n}\r\n","import { CommonModule } from '@angular/common';\r\nimport { HttpClientModule } from '@angular/common/http';\r\nimport { NgModule } from '@angular/core';\r\nimport { DataService } from './api/data.service';\r\nimport { HttpBaseService } from './api/http-base.service';\r\nimport { AuthStateService } from './authState/auth-state.service';\r\nimport { AutoLoginService } from './auto-login/auto-login-service';\r\nimport { ImplicitFlowCallbackService } from './callback/implicit-flow-callback.service';\r\nimport { CheckAuthService } from './check-auth.service';\r\nimport { ConfigValidationService } from './config-validation/config-validation.service';\r\nimport { AuthWellKnownDataService } from './config/auth-well-known-data.service';\r\nimport { AuthWellKnownService } from './config/auth-well-known.service';\r\nimport { ConfigurationProvider } from './config/config.provider';\r\nimport { OidcConfigService } from './config/config.service';\r\nimport { CodeFlowCallbackHandlerService } from './flows/callback-handling/code-flow-callback-handler.service';\r\nimport { HistoryJwtKeysCallbackHandlerService } from './flows/callback-handling/history-jwt-keys-callback-handler.service';\r\nimport { ImplicitFlowCallbackHandlerService } from './flows/callback-handling/implicit-flow-callback-handler.service';\r\nimport { RefreshSessionCallbackHandlerService } from './flows/callback-handling/refresh-session-callback-handler.service';\r\nimport { RefreshTokenCallbackHandlerService } from './flows/callback-handling/refresh-token-callback-handler.service';\r\nimport { StateValidationCallbackHandlerService } from './flows/callback-handling/state-validation-callback-handler.service';\r\nimport { UserCallbackHandlerService } from './flows/callback-handling/user-callback-handler.service';\r\nimport { FlowsDataService } from './flows/flows-data.service';\r\nimport { FlowsService } from './flows/flows.service';\r\nimport { RandomService } from './flows/random/random.service';\r\nimport { ResetAuthDataService } from './flows/reset-auth-data.service';\r\nimport { SigninKeyDataService } from './flows/signin-key-data.service';\r\nimport { CheckSessionService } from './iframe/check-session.service';\r\nimport { IFrameService } from './iframe/existing-iframe.service';\r\nimport { SilentRenewService } from './iframe/silent-renew.service';\r\nimport { LoggerService } from './logging/logger.service';\r\nimport { LoginService } from './login/login.service';\r\nimport { ParLoginService } from './login/par/par-login.service';\r\nimport { ParService } from './login/par/par.service';\r\nimport { PopUpLoginService } from './login/popup/popup-login.service';\r\nimport { ResponseTypeValidationService } from './login/response-type-validation/response-type-validation.service';\r\nimport { StandardLoginService } from './login/standard/standard-login.service';\r\nimport { LogoffRevocationService } from './logoffRevoke/logoff-revocation.service';\r\nimport { OidcSecurityService } from './oidc.security.service';\r\nimport { PublicEventsService } from './public-events/public-events.service';\r\nimport { AbstractSecurityStorage } from './storage/abstract-security-storage';\r\nimport { BrowserStorageService } from './storage/browser-storage.service';\r\nimport { StoragePersistenceService } from './storage/storage-persistence.service';\r\nimport { UserService } from './userData/user-service';\r\nimport { EqualityService } from './utils/equality/equality.service';\r\nimport { FlowHelper } from './utils/flowHelper/flow-helper.service';\r\nimport { PlatformProvider } from './utils/platform-provider/platform.provider';\r\nimport { TokenHelperService } from './utils/tokenHelper/oidc-token-helper.service';\r\nimport { UrlService } from './utils/url/url.service';\r\nimport { StateValidationService } from './validation/state-validation.service';\r\nimport { TokenValidationService } from './validation/token-validation.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, HttpClientModule],\r\n  declarations: [],\r\n  exports: [],\r\n})\r\nexport class AuthModule {\r\n  static forRoot(token: Token = {}) {\r\n    return {\r\n      ngModule: AuthModule,\r\n      providers: [\r\n        OidcConfigService,\r\n        PublicEventsService,\r\n        FlowHelper,\r\n        OidcSecurityService,\r\n        TokenValidationService,\r\n        PlatformProvider,\r\n        CheckSessionService,\r\n        FlowsDataService,\r\n        FlowsService,\r\n        SilentRenewService,\r\n        ConfigurationProvider,\r\n        LogoffRevocationService,\r\n        UserService,\r\n        RandomService,\r\n        HttpBaseService,\r\n        UrlService,\r\n        AuthStateService,\r\n        SigninKeyDataService,\r\n        StoragePersistenceService,\r\n        TokenHelperService,\r\n        LoggerService,\r\n        IFrameService,\r\n        EqualityService,\r\n        LoginService,\r\n        ParService,\r\n        AuthWellKnownDataService,\r\n        AuthWellKnownService,\r\n        DataService,\r\n        StateValidationService,\r\n        ConfigValidationService,\r\n        CheckAuthService,\r\n        ResetAuthDataService,\r\n        ImplicitFlowCallbackService,\r\n        HistoryJwtKeysCallbackHandlerService,\r\n        ResponseTypeValidationService,\r\n        UserCallbackHandlerService,\r\n        StateValidationCallbackHandlerService,\r\n        RefreshSessionCallbackHandlerService,\r\n        RefreshTokenCallbackHandlerService,\r\n        CodeFlowCallbackHandlerService,\r\n        ImplicitFlowCallbackHandlerService,\r\n        ParLoginService,\r\n        PopUpLoginService,\r\n        StandardLoginService,\r\n        AutoLoginService,\r\n        {\r\n          provide: AbstractSecurityStorage,\r\n          useClass: token.storage || BrowserStorageService,\r\n        },\r\n      ],\r\n    };\r\n  }\r\n}\r\n\r\nexport type Type<T> = new (...args: any[]) => T;\r\n\r\nexport interface Token {\r\n  storage?: Type<any>;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { ActivatedRouteSnapshot, CanActivate, CanLoad, Route, Router, RouterStateSnapshot, UrlSegment } from '@angular/router';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { AutoLoginService } from '../auto-login/auto-login-service';\r\nimport { CheckAuthService } from '../check-auth.service';\r\nimport { LoginService } from '../login/login.service';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class AutoLoginGuard implements CanActivate, CanLoad {\r\n  constructor(\r\n    private autoLoginService: AutoLoginService,\r\n    private authStateService: AuthStateService,\r\n    private checkAuthService: CheckAuthService,\r\n    private loginService: LoginService,\r\n    private router: Router\r\n  ) {}\r\n\r\n  canLoad(route: Route, segments: UrlSegment[]): Observable<boolean> {\r\n    const routeToRedirect = segments.join('/');\r\n\r\n    return this.checkAuth(routeToRedirect);\r\n  }\r\n\r\n  canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean> {\r\n    return this.checkAuth(state.url);\r\n  }\r\n\r\n  private checkAuth(url: string) {\r\n    const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\r\n\r\n    if (isAuthenticated) {\r\n      return of(true);\r\n    }\r\n\r\n    return this.checkAuthService.checkAuth().pipe(\r\n      map((isAuthorized) => {\r\n        const storedRoute = this.autoLoginService.getStoredRedirectRoute();\r\n\r\n        if (isAuthorized) {\r\n          if (storedRoute) {\r\n            this.autoLoginService.deleteStoredRedirectRoute();\r\n            this.router.navigateByUrl(storedRoute);\r\n          }\r\n          return true;\r\n        }\r\n\r\n        this.autoLoginService.saveStoredRedirectRoute(url);\r\n        this.loginService.login();\r\n        return false;\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable } from 'rxjs';\r\nimport { AuthStateService } from '../authState/auth-state.service';\r\nimport { ConfigurationProvider } from '../config/config.provider';\r\nimport { LoggerService } from './../logging/logger.service';\r\n\r\n@Injectable()\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  constructor(\r\n    private authStateService: AuthStateService,\r\n    private configurationProvider: ConfigurationProvider,\r\n    private loggerService: LoggerService\r\n  ) {}\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    // Ensure we send the token only to routes which are secured\r\n    const { secureRoutes } = this.configurationProvider.getOpenIDConfiguration();\r\n\r\n    if (!secureRoutes) {\r\n      this.loggerService.logDebug(`No routes to check configured`);\r\n      return next.handle(req);\r\n    }\r\n\r\n    const matchingRoute = secureRoutes.find((x) => req.url.startsWith(x));\r\n\r\n    if (!matchingRoute) {\r\n      this.loggerService.logDebug(`Did not find matching route for ${req.url}`);\r\n      return next.handle(req);\r\n    }\r\n\r\n    this.loggerService.logDebug(`'${req.url}' matches configured route '${matchingRoute}'`);\r\n\r\n    const token = this.authStateService.getAccessToken();\r\n\r\n    if (!token) {\r\n      this.loggerService.logDebug(`Wanted to add token to ${req.url} but found no token: '${token}'`);\r\n      return next.handle(req);\r\n    }\r\n\r\n    this.loggerService.logDebug(`'${req.url}' matches configured route '${matchingRoute}', adding token`);\r\n    req = req.clone({\r\n      headers: req.headers.set('Authorization', 'Bearer ' + token),\r\n    });\r\n\r\n    return next.handle(req);\r\n  }\r\n}\r\n","// Public classes.\r\n\r\nexport * from './auth-options';\r\nexport * from './auth.module';\r\nexport * from './authState/authorization-result';\r\nexport * from './authState/authorized-state';\r\nexport * from './auto-login/auto-login.guard';\r\nexport * from './config/auth-well-known-endpoints';\r\nexport * from './config/config.service';\r\nexport * from './config/openid-configuration';\r\nexport * from './config/public-configuration';\r\nexport * from './interceptor/auth.interceptor';\r\nexport * from './logging/log-level';\r\nexport * from './logging/logger.service';\r\nexport * from './oidc.security.service';\r\nexport * from './public-events/event-types';\r\nexport * from './public-events/notification';\r\nexport * from './public-events/public-events.service';\r\nexport * from './storage/abstract-security-storage';\r\nexport * from './utils/tokenHelper/oidc-token-helper.service';\r\nexport * from './validation/jwtkeys';\r\nexport * from './validation/state-validation-result';\r\nexport * from './validation/token-validation.service';\r\nexport * from './validation/validation-result';\r\n","/*\r\n * Public API Surface of angular-auth-oidc-client\r\n */\r\n\r\nexport * from './lib/angular-auth-oidc-client';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":";;;;;;;;;MAKa,eAAe;IAC1B,YAAoB,IAAgB;QAAhB,SAAI,GAAJ,IAAI,CAAY;KAAI;IAExC,GAAG,CAAI,GAAW,EAAE,MAA+B;QACjD,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAI,GAAG,EAAE,MAAM,CAAC,CAAC;KACtC;IAED,IAAI,CAAI,GAAW,EAAE,IAAS,EAAE,MAA+B;QAC7D,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAI,GAAG,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;KAC7C;;8EATU,eAAe;oDAAf,eAAe,WAAf,eAAe;+CAAf,eAAe;cAD3B,UAAU;;;ACJX;IACY;AAAZ,WAAY,QAAQ;IAClB,uCAAI,CAAA;IACJ,yCAAK,CAAA;IACL,uCAAI,CAAA;IACJ,yCAAK,CAAA;AACP,CAAC,EALW,QAAQ,KAAR,QAAQ;;ACEb,MAAM,cAAc,GAAwB;IACjD,SAAS,EAAE,oBAAoB;IAC/B,qBAAqB,EAAE,EAAE;IACzB,WAAW,EAAE,oBAAoB;IACjC,QAAQ,EAAE,YAAY;IACtB,YAAY,EAAE,MAAM;IACpB,KAAK,EAAE,sBAAsB;IAC7B,OAAO,EAAE,EAAE;IACX,qBAAqB,EAAE,oBAAoB;IAC3C,iBAAiB,EAAE,KAAK;IACxB,WAAW,EAAE,KAAK;IAClB,cAAc,EAAE,oBAAoB;IACpC,2BAA2B,EAAE,EAAE;IAC/B,oCAAoC,EAAE,CAAC;IACvC,eAAe,EAAE,KAAK;IACtB,8BAA8B,EAAE,KAAK;IACrC,uBAAuB,EAAE,KAAK;IAC9B,cAAc,EAAE,GAAG;IACnB,cAAc,EAAE,YAAY;IAC5B,iBAAiB,EAAE,eAAe;IAClC,YAAY,EAAE,IAAI;IAClB,iCAAiC,EAAE,IAAI;IACvC,+BAA+B,EAAE,KAAK;IACtC,QAAQ,EAAE,QAAQ,CAAC,IAAI;IACvB,gBAAgB,EAAE,KAAK;IACvB,iBAAiB,EAAE,KAAK;IACxB,mCAAmC,EAAE,GAAG;IACxC,0BAA0B,EAAE,KAAK;IACjC,OAAO,EAAE,OAAO,OAAO,KAAK,WAAW,GAAG,cAAc,GAAG,IAAI;IAC/D,YAAY,EAAE,EAAE;IAChB,wBAAwB,EAAE,EAAE;IAC5B,sBAAsB,EAAE,EAAE;IAC1B,+BAA+B,EAAE,IAAI;IACrC,uCAAuC,EAAE,KAAK;IAC9C,qBAAqB,EAAE,CAAC;IACxB,0BAA0B,EAAE,CAAC;IAC7B,UAAU,EAAE,KAAK;CAClB;;MCpCY,gBAAgB;IAK3B,YAAyC,UAAkB;QAAlB,eAAU,GAAV,UAAU,CAAQ;KAAI;IAJ/D,IAAI,SAAS;QACX,OAAO,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KAC3C;;gFAHU,gBAAgB,WAKP,WAAW;qDALpB,gBAAgB,WAAhB,gBAAgB;+CAAhB,gBAAgB;cAD5B,UAAU;;sBAMI,MAAM;uBAAC,WAAW;;;MCHpB,qBAAqB;IAGhC,YAAoB,gBAAkC;QAAlC,qBAAgB,GAAhB,gBAAgB,CAAkB;KAAI;IAE1D,cAAc;QACZ,OAAO,CAAC,CAAC,IAAI,CAAC,2BAA2B,CAAC;KAC3C;IAED,sBAAsB;QACpB,OAAO,IAAI,CAAC,2BAA2B,IAAI,IAAI,CAAC;KACjD;IAED,SAAS,CAAC,aAAkC;QAC1C,IAAI,CAAC,2BAA2B,mCAAQ,cAAc,GAAK,aAAa,CAAE,CAAC;QAE3E,IAAI,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,OAAO,EAAE;YAC1B,OAAO,CAAC,IAAI,CACV;0EACkE,CACnE,CAAC;SACH;QAED,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC;QAEvD,OAAO,IAAI,CAAC,2BAA2B,CAAC;KACzC;IAEO,eAAe,CAAC,aAAkC;QACxD,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE;YACpC,aAAa,CAAC,iBAAiB,GAAG,KAAK,CAAC;YACxC,aAAa,CAAC,WAAW,GAAG,KAAK,CAAC;YAClC,aAAa,CAAC,eAAe,GAAG,KAAK,CAAC;YACtC,aAAa,CAAC,8BAA8B,GAAG,KAAK,CAAC;SACtD;KACF;;0FAnCU,qBAAqB;0DAArB,qBAAqB,WAArB,qBAAqB;+CAArB,qBAAqB;cADjC,UAAU;;;ACCX,MAAM,iBAAiB,GAAG,aAAa,CAAC;MAG3B,WAAW;IACtB,YAAoB,UAA2B,EAAmB,qBAA4C;QAA1F,eAAU,GAAV,UAAU,CAAiB;QAAmB,0BAAqB,GAArB,qBAAqB,CAAuB;KAAI;IAElH,GAAG,CAAI,GAAW,EAAE,KAAc;QAChC,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QAC3C,IAAI,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;QAE9B,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAC3E,IAAI,UAAU,EAAE;YACd,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;SAC5C;QACD,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAI,GAAG,EAAE;YACjC,OAAO;YACP,MAAM;SACP,CAAC,CAAC;KACJ;IAED,IAAI,CAAI,GAAW,EAAE,IAAS,EAAE,aAA2B;QACzD,MAAM,OAAO,GAAG,aAAa,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;QACvD,IAAI,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;QAE9B,MAAM,EAAE,UAAU,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAC3E,IAAI,UAAU,EAAE;YACd,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;SAC5C;QAED,OAAO,IAAI,CAAC,UAAU,CAAC,IAAI,CAAI,GAAG,EAAE,IAAI,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;KAChE;IAEO,cAAc,CAAC,KAAc;QACnC,IAAI,OAAO,GAAG,IAAI,WAAW,EAAE,CAAC;QAChC,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CAAC;QACpD,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC;QAE1D,IAAI,CAAC,CAAC,KAAK,EAAE;YACX,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,SAAS,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC;SAC/E;QAED,OAAO,OAAO,CAAC;KAChB;;sEAvCU,WAAW;gDAAX,WAAW,WAAX,WAAW;+CAAX,WAAW;cADvB,UAAU;;;ACRX;IACY;AAAZ,WAAY,UAAU;;;;IAIpB,2DAAY,CAAA;IACZ,yEAAmB,CAAA;IACnB,2EAAoB,CAAA;IACpB,iEAAe,CAAA;IACf,+EAAsB,CAAA;IACtB,2DAAY,CAAA;IACZ,+DAAc,CAAA;AAChB,CAAC,EAXW,UAAU,KAAV,UAAU;;ACCtB;;;MAIsB,uBAAuB;;8FAAvB,uBAAuB;4DAAvB,uBAAuB,WAAvB,uBAAuB;+CAAvB,uBAAuB;cAD5C,UAAU;;;MCeE,yBAAyB;IACpC,YACmB,mBAA4C,EAC5C,qBAA4C;QAD5C,wBAAmB,GAAnB,mBAAmB,CAAyB;QAC5C,0BAAqB,GAArB,qBAAqB,CAAuB;KAC3D;IAEJ,IAAI,CAAC,GAAgB;QACnB,MAAM,SAAS,GAAG,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;QAChD,OAAO,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACjD;IAED,KAAK,CAAC,GAAgB,EAAE,KAAU;QAChC,MAAM,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;QACjD,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;KACnD;IAED,MAAM,CAAC,GAAgB;QACrB,MAAM,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;QACjD,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;KAC7C;IAED,oBAAoB;QAClB,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAC7B,IAAI,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QAC5B,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACxB,IAAI,CAAC,MAAM,CAAC,4BAA4B,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,CAAC,4BAA4B,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,CAAC,yBAAyB,CAAC,CAAC;KACxC;IAED,uBAAuB;QACrB,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QACzB,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;KAC5B;IAED,cAAc;QACZ,OAAO,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;KAC/B;IAED,UAAU;;QACR,aAAO,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,0CAAE,QAAQ,CAAC;KAC3C;IAED,eAAe;;QACb,aAAO,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,0CAAE,aAAa,CAAC;KAChD;IAEO,mBAAmB,CAAC,GAAW;QACrC,MAAM,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QACnE,MAAM,MAAM,GAAG,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,QAAQ,KAAI,EAAE,CAAC;QACtC,OAAO,GAAG,MAAM,IAAI,GAAG,EAAE,CAAC;KAC3B;;kGApDU,yBAAyB;8DAAzB,yBAAyB,WAAzB,yBAAyB;+CAAzB,yBAAyB;cADrC,UAAU;;;MCdE,aAAa;IACxB,YAAoB,qBAA4C;QAA5C,0BAAqB,GAArB,qBAAqB,CAAuB;KAAI;IAEpE,QAAQ,CAAC,OAAY,EAAE,GAAG,IAAW;QACnC,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE;YAC7B,OAAO;SACR;QAED,IAAI,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;YACzB,OAAO,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;SACjC;aAAM;YACL,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;SACxB;KACF;IAED,UAAU,CAAC,OAAY,EAAE,GAAG,IAAW;QACrC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE;YACzB,OAAO;SACR;QAED,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE;YAC7B,OAAO;SACR;QAED,IAAI,CAAC,IAAI,CAAC,mCAAmC,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;YAC5D,OAAO;SACR;QAED,IAAI,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;YACzB,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;SAChC;aAAM;YACL,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;SACvB;KACF;IAED,QAAQ,CAAC,OAAY,EAAE,GAAG,IAAW;QACnC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE;YACzB,OAAO;SACR;QAED,IAAI,IAAI,CAAC,kBAAkB,EAAE,EAAE;YAC7B,OAAO;SACR;QAED,IAAI,CAAC,IAAI,CAAC,mCAAmC,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YAC7D,OAAO;SACR;QAED,IAAI,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;YACzB,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;SAC/B;aAAM;YACL,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SACtB;KACF;IAEO,mCAAmC,CAAC,iBAA2B;QACrE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,IAAI,EAAE,CAAC;QAC/E,OAAO,QAAQ,IAAI,iBAAiB,CAAC;KACtC;IAEO,aAAa;QACnB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,IAAI,EAAE,CAAC;QAE/E,IAAI,QAAQ,KAAK,IAAI,EAAE;YACrB,OAAO,KAAK,CAAC;SACd;QAED,IAAI,QAAQ,KAAK,SAAS,EAAE;YAC1B,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;IAEO,kBAAkB;QACxB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,IAAI,EAAE,CAAC;QAE/E,OAAO,QAAQ,KAAK,QAAQ,CAAC,IAAI,CAAC;KACnC;;0EA9EU,aAAa;kDAAb,aAAa,WAAb,aAAa;+CAAb,aAAa;cADzB,UAAU;;;MCEE,mBAAmB;IADhC;QAEU,WAAM,GAAG,IAAI,aAAa,CAA8B,CAAC,CAAC,CAAC;KAkBpE;;;;;;;IAVC,SAAS,CAAI,IAAgB,EAAE,KAAS;QACtC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,CAAC;KACnC;;;;IAKD,iBAAiB;QACf,OAAO,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC;KACnC;;sFAlBU,mBAAmB;wDAAnB,mBAAmB,WAAnB,mBAAmB;+CAAnB,mBAAmB;cAD/B,UAAU;;;ACFX,MAAM,cAAc,GAAG,CAAC,CAAC;MAEZ,kBAAkB;IAC7B,YAA6B,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;KAAI;IAE7D,sBAAsB,CAAC,WAAgB;QACrC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,OAAO,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC;SAC3C;QAED,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;QACzB,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAEpC,OAAO,IAAI,CAAC;KACb;IAED,kBAAkB,CAAC,KAAU,EAAE,OAAgB;QAC7C,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;YAC7B,OAAO,EAAE,CAAC;SACX;QAED,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC;KAC/C;IAED,mBAAmB,CAAC,KAAU,EAAE,OAAgB;QAC9C,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;YAC7B,OAAO,EAAE,CAAC;SACX;QAED,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC;KAC/C;IAED,qBAAqB,CAAC,KAAU,EAAE,OAAgB;QAChD,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;YAC7B,OAAO,EAAE,CAAC;SACX;QAED,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC,EAAE,OAAO,CAAC,CAAC;KAC/C;IAEO,cAAc,CAAC,KAAa,EAAE,KAAa,EAAE,OAAgB;QACnE,MAAM,WAAW,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAE1D,IAAI,OAAO,EAAE;YACX,OAAO,WAAW,CAAC;SACpB;QAED,MAAM,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,WAAW,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;KAC3B;IAEO,eAAe,CAAC,GAAW;QACjC,IAAI,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAEvD,QAAQ,MAAM,CAAC,MAAM,GAAG,CAAC;YACvB,KAAK,CAAC;gBACJ,MAAM;YACR,KAAK,CAAC;gBACJ,MAAM,IAAI,IAAI,CAAC;gBACf,MAAM;YACR,KAAK,CAAC;gBACJ,MAAM,IAAI,GAAG,CAAC;gBACd,MAAM;YACR;gBACE,MAAM,KAAK,CAAC,2BAA2B,CAAC,CAAC;SAC5C;QAED,MAAM,OAAO,GAAG,OAAO,MAAM,KAAK,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAEvH,IAAI;;YAEF,OAAO,kBAAkB,CACvB,OAAO;iBACJ,KAAK,CAAC,EAAE,CAAC;iBACT,GAAG,CAAC,CAAC,CAAS,KAAK,GAAG,GAAG,CAAC,IAAI,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;iBACzE,IAAI,CAAC,EAAE,CAAC,CACZ,CAAC;SACH;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,OAAO,CAAC;SAChB;KACF;IAEO,YAAY,CAAC,KAAa;QAChC,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,UAAU,KAAK,gCAAgC,CAAC,CAAC;YAC7E,OAAO,KAAK,CAAC;SACd;QAED,IAAI,CAAE,KAAgB,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;YACpC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,UAAU,KAAK,qCAAqC,CAAC,CAAC;YAClF,OAAO,KAAK,CAAC;SACd;QAED,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAE/B,IAAI,KAAK,CAAC,MAAM,KAAK,cAAc,EAAE;YACnC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,UAAU,KAAK,gDAAgD,cAAc,GAAG,CAAC,OAAO,CAAC,CAAC;YACtH,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;IAEO,kBAAkB,CAAC,KAAa,EAAE,KAAa;QACrD,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;KAChC;;oFAvGU,kBAAkB;uDAAlB,kBAAkB,WAAlB,kBAAkB;+CAAlB,kBAAkB;cAD9B,UAAU;;;ACCX;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;MAGa,sBAAsB;IAIjC,YAAoB,kBAAsC,EAAU,aAA4B;QAA5E,uBAAkB,GAAlB,kBAAkB,CAAoB;QAAU,kBAAa,GAAb,aAAa,CAAe;QAFhG,kBAAa,GAAa,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;KAE1B;;;IAIpG,iBAAiB,CAAC,KAAa,EAAE,aAAsB;QACrD,MAAM,OAAO,GAAG,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QAE1E,OAAO,CAAC,IAAI,CAAC,4BAA4B,CAAC,OAAO,EAAE,aAAa,CAAC,CAAC;KACnE;;;IAID,4BAA4B,CAAC,cAAsB,EAAE,aAAsB;QACzE,MAAM,mBAAmB,GAAG,IAAI,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,cAAc,CAAC,CAAC;QAC3F,aAAa,GAAG,aAAa,IAAI,CAAC,CAAC;QAEnC,IAAI,CAAC,mBAAmB,EAAE;YACxB,OAAO,KAAK,CAAC;SACd;QAED,MAAM,oBAAoB,GAAG,mBAAmB,CAAC,OAAO,EAAE,CAAC;QAC3D,MAAM,aAAa,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC,OAAO,EAAE,GAAG,aAAa,GAAG,IAAI,CAAC;QAC1F,MAAM,eAAe,GAAG,oBAAoB,GAAG,aAAa,CAAC;QAE7D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yBAAyB,CAAC,eAAe,KAAK,oBAAoB,MAAM,aAAa,EAAE,CAAC,CAAC;;QAGrH,OAAO,eAAe,CAAC;KACxB;IAED,6BAA6B,CAAC,oBAA0B,EAAE,aAAsB;;QAE9E,IAAI,CAAC,oBAAoB,EAAE;YACzB,OAAO,IAAI,CAAC;SACb;QAED,aAAa,GAAG,aAAa,IAAI,CAAC,CAAC;QACnC,MAAM,0BAA0B,GAAG,oBAAoB,CAAC,OAAO,EAAE,CAAC;QAClE,MAAM,aAAa,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC,OAAO,EAAE,GAAG,aAAa,GAAG,IAAI,CAAC;QAC1F,MAAM,eAAe,GAAG,0BAA0B,GAAG,aAAa,CAAC;QAEnE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,6BAA6B,CAAC,eAAe,KAAK,0BAA0B,MAAM,aAAa,EAAE,CAAC,CAAC;;QAG/H,OAAO,eAAe,CAAC;KACxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IA8BD,uBAAuB,CAAC,WAAgB;QACtC,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,SAAS,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kDAAkD,CAAC,CAAC;SACnF;QAED,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,SAAS,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kDAAkD,CAAC,CAAC;SACnF;QAED,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,SAAS,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kDAAkD,CAAC,CAAC;SACnF;QAED,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,SAAS,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kDAAkD,CAAC,CAAC;SACnF;QAED,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,SAAS,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kDAAkD,CAAC,CAAC;SACnF;QAED,OAAO,SAAS,CAAC;KAClB;;;IAID,2BAA2B,CAAC,WAAgB,EAAE,yBAAiC,EAAE,0BAAmC;QAClH,IAAI,0BAA0B,EAAE;YAC9B,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,KAAK,CAAC,EAAE;YACtC,OAAO,KAAK,CAAC;SACd;QAED,MAAM,kBAAkB,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;QACvC,kBAAkB,CAAC,aAAa,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QAClD,yBAAyB,GAAG,yBAAyB,IAAI,CAAC,CAAC;QAE3D,MAAM,QAAQ,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC;QACpD,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,EAAE,GAAG,kBAAkB,CAAC,OAAO,EAAE,CAAC;QAC/D,MAAM,8BAA8B,GAAG,yBAAyB,GAAG,IAAI,CAAC;QAExE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oCAAoC,IAAI,MAAM,8BAA8B,EAAE,CAAC,CAAC;QAE5G,IAAI,IAAI,GAAG,CAAC,EAAE;YACZ,OAAO,IAAI,GAAG,8BAA8B,CAAC;SAC9C;QAED,OAAO,CAAC,IAAI,GAAG,8BAA8B,CAAC;KAC/C;;;;;;;IASD,oBAAoB,CAAC,WAAgB,EAAE,UAAe,EAAE,uBAAgC;QACtF,MAAM,kBAAkB,GACtB,CAAC,WAAW,CAAC,KAAK,KAAK,SAAS,IAAI,uBAAuB,KAAK,UAAU,KAAK,sBAAsB,CAAC,4BAA4B,CAAC;QACrI,IAAI,CAAC,kBAAkB,IAAI,WAAW,CAAC,KAAK,KAAK,UAAU,EAAE;YAC3D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qDAAqD,GAAG,WAAW,CAAC,KAAK,GAAG,eAAe,GAAG,UAAU,CAAC,CAAC;YACtI,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;;;IAID,kBAAkB,CAAC,WAAgB,EAAE,4BAAiC;QACpE,IAAK,WAAW,CAAC,GAAc,KAAM,4BAAuC,EAAE;YAC5E,IAAI,CAAC,aAAa,CAAC,QAAQ,CACzB,iDAAiD;gBAC/C,WAAW,CAAC,GAAG;gBACf,iCAAiC;gBACjC,4BAA4B,CAC/B,CAAC;YACF,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;;;;;IAMD,kBAAkB,CAAC,WAAgB,EAAE,GAAQ;QAC3C,IAAI,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,EAAE;YAClC,MAAM,MAAM,GAAG,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAE7C,IAAI,CAAC,MAAM,EAAE;gBACX,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,uDAAuD,GAAG,WAAW,CAAC,GAAG,GAAG,aAAa,GAAG,GAAG,CAAC,CAAC;gBAC7H,OAAO,KAAK,CAAC;aACd;YAED,OAAO,IAAI,CAAC;SACb;aAAM,IAAI,WAAW,CAAC,GAAG,KAAK,GAAG,EAAE;YAClC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iDAAiD,GAAG,WAAW,CAAC,GAAG,GAAG,aAAa,GAAG,GAAG,CAAC,CAAC;YAEvH,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;IAED,wCAAwC,CAAC,WAAgB;QACvD,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,KAAK,CAAC;SACd;QAED,IAAI,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,GAAG,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE;YACpF,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;;IAGD,uBAAuB,CAAC,WAAgB,EAAE,QAAgB;QACxD,IAAI,EAAC,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,GAAG,CAAA,EAAE;YACrB,OAAO,IAAI,CAAC;SACb;QAED,IAAI,WAAW,CAAC,GAAG,KAAK,QAAQ,EAAE;YAChC,OAAO,IAAI,CAAC;SACb;QAED,OAAO,KAAK,CAAC;KACd;IAED,6BAA6B,CAAC,KAAU,EAAE,UAAe;QACvD,IAAK,KAAgB,KAAM,UAAqB,EAAE;YAChD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+CAA+C,GAAG,KAAK,GAAG,eAAe,GAAG,UAAU,CAAC,CAAC;YACpH,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;;;;;IAMD,wBAAwB,CAAC,OAAY,EAAE,OAAY;QACjD,IAAI,CAAC,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;YAC7B,OAAO,KAAK,CAAC;SACd;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAE9E,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,KAAK,CAAC,IAAI,UAAU,CAAC,WAAW,KAAK,MAAM,EAAE;YAC7E,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,6BAA6B,CAAC,CAAC;YAC7D,OAAO,KAAK,CAAC;SACd;QAED,MAAM,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;QAC3B,MAAM,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;QAE3B,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAa,CAAC,EAAE;YAC/C,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;YACxD,OAAO,KAAK,CAAC;SACd;QAED,IAAI,WAAW,GAAG,KAAK,CAAC;QACxB,IAAK,GAAc,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YACrC,WAAW,GAAG,IAAI,CAAC;SACpB;QAED,IAAI,OAAO,GAAG,KAAK,CAAC;;QAGpB,IAAI,CAAC,GAAG,EAAE;YACR,IAAI,aAAa,CAAC;;YAGlB,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,IAAK,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAc,KAAK,WAAW,EAAE;gBAChF,aAAa,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACjC;iBAAM;;;;gBAIL,IAAI,oBAAoB,GAAG,CAAC,CAAC;gBAC7B,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,IAAI,EAAE;oBAC9B,IAAK,GAAG,CAAC,GAAc,KAAK,WAAW,IAAK,GAAG,CAAC,GAAc,KAAK,KAAK,EAAE;wBACxE,oBAAoB,EAAE,CAAC;wBACvB,aAAa,GAAG,GAAG,CAAC;qBACrB;iBACF;gBAED,IAAI,oBAAoB,GAAG,CAAC,EAAE;oBAC5B,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,wEAAwE,CAAC,CAAC;oBACxG,OAAO,KAAK,CAAC;iBACd;aACF;YAED,IAAI,CAAC,aAAa,EAAE;gBAClB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,oEAAoE,CAAC,CAAC;gBACpG,OAAO,KAAK,CAAC;aACd;;;;YAMD,IAAI,CAAC,OAAO,EAAE;gBACZ,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qDAAqD,CAAC,CAAC;aACtF;YAED,OAAO,OAAO,CAAC;SAChB;aAAM;;YAEL,KAAK,MAAM,GAAG,IAAI,OAAO,CAAC,IAAI,EAAE;gBAC9B,IAAK,GAAG,CAAC,GAAc,KAAM,GAAc,EAAE;oBAC3C,MAAM,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;oBACtC,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE,SAAS,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;oBACzD,IAAI,CAAC,OAAO,EAAE;wBACZ,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qDAAqD,CAAC,CAAC;qBACtF;oBACD,OAAO,OAAO,CAAC;iBAChB;aACF;SACF;QAED,OAAO,OAAO,CAAC;KAChB;;;;;;;;;;;;;;;;;;;IAsBD,qBAAqB,CAAC,WAAgB,EAAE,MAAW,EAAE,UAAkB;QACrE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,GAAG,MAAM,CAAC,CAAC;;QAGjE,IAAI,GAAG,GAAG,QAAQ,CAAC;QACnB,IAAI,UAAU,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YAC9B,GAAG,GAAG,QAAQ,CAAC;SAChB;aAAM,IAAI,UAAU,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YACrC,GAAG,GAAG,QAAQ,CAAC;SAChB;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,EAAE,GAAG,WAAW,EAAE,GAAG,CAAC,CAAC;QAC5D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wCAAwC,GAAG,QAAQ,CAAC,CAAC;QACjF,IAAI,QAAQ,KAAM,MAAiB,EAAE;YACnC,OAAO,IAAI,CAAC;SACb;aAAM;YACL,MAAM,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC,EAAE,GAAG,kBAAkB,CAAC,WAAW,CAAC,EAAE,GAAG,CAAC,CAAC;YACjF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,eAAe,GAAG,SAAS,CAAC,CAAC;YACzD,IAAI,SAAS,KAAM,MAAiB,EAAE;gBACpC,OAAO,IAAI,CAAC;aACb;SACF;QAED,OAAO,KAAK,CAAC;KACd;IAED,qBAAqB,CAAC,YAAiB;QACrC,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC;QACjE,MAAM,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;QAEjC,OAAO,QAAQ,CAAC;KACjB;IAEO,cAAc,CAAC,WAAgB,EAAE,GAAW;QAClD,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;QAC3D,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACrD,MAAM,QAAQ,GAAG,SAAS,CAAC,YAAY,CAAC,CAAC;QAEzC,OAAO,QAAQ,CAAC;KACjB;;AArXM,mDAA4B,GAAG,kBAAkB,CAAC;4FAD9C,sBAAsB;2DAAtB,sBAAsB,WAAtB,sBAAsB;+CAAtB,sBAAsB;cADlC,UAAU;;;MCrCE,gBAAgB;IAW3B,YACU,yBAAoD,EACpD,aAA4B,EAC5B,mBAAwC,EACxC,qBAA4C,EAC5C,sBAA8C;QAJ9C,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,2BAAsB,GAAtB,sBAAsB,CAAwB;QAfhD,wBAAmB,GAAG,IAAI,eAAe,CAAU,KAAK,CAAC,CAAC;KAgB9D;IAdJ,IAAI,WAAW;QACb,OAAO,IAAI,CAAC,mBAAmB,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC;KAC7E;IAED,IAAY,YAAY;QACtB,OAAO,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,CAAC;KAC3G;IAUD,yBAAyB;QACvB,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACrC;IAED,2BAA2B;QACzB,IAAI,CAAC,yBAAyB,CAAC,uBAAuB,EAAE,CAAC;QACzD,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KACtC;IAED,yBAAyB,CAAC,mBAAwC;QAChE,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,sBAAsB,EAAE,mBAAmB,CAAC,CAAC;KACjH;IAED,oBAAoB,CAAC,WAAgB,EAAE,UAAe;QACpD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QACzC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yBAAyB,CAAC,CAAC;QAEvD,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;QAC/D,IAAI,CAAC,gCAAgC,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,CAAC,yBAAyB,EAAE,CAAC;KAClC;IAED,cAAc;QACZ,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO,EAAE,CAAC;SACX;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,yBAAyB,CAAC,cAAc,EAAE,CAAC;QAC9D,OAAO,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;KAC7C;IAED,UAAU;QACR,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO,EAAE,CAAC;SACX;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,CAAC;QAC1D,OAAO,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;KAC7C;IAED,eAAe;QACb,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO,EAAE,CAAC;SACX;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,yBAAyB,CAAC,eAAe,EAAE,CAAC;QAC/D,OAAO,IAAI,CAAC,wBAAwB,CAAC,KAAK,CAAC,CAAC;KAC7C;IAED,yBAAyB;QACvB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,iBAAiB,EAAE,EAAE;YAC5B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+BAA+B,CAAC,CAAC;YAC7D,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,mCAAmC,EAAE,EAAE;YAC9C,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mCAAmC,CAAC,CAAC;YACjE,OAAO,KAAK,CAAC;SACd;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+CAA+C,CAAC,CAAC;QAC7E,OAAO,IAAI,CAAC;KACb;IAED,iBAAiB;QACf,MAAM,YAAY,GAAG,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,CAAC;QACjE,MAAM,EAAE,oCAAoC,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAErG,MAAM,cAAc,GAAG,IAAI,CAAC,sBAAsB,CAAC,iBAAiB,CAAC,YAAY,EAAE,oCAAoC,CAAC,CAAC;QAEzH,IAAI,cAAc,EAAE;YAClB,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAU,UAAU,CAAC,cAAc,EAAE,cAAc,CAAC,CAAC;SACxF;QAED,OAAO,cAAc,CAAC;KACvB;IAED,mCAAmC;QACjC,MAAM,EAAE,oCAAoC,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QACrG,MAAM,oBAAoB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QAC5F,MAAM,wBAAwB,GAAG,IAAI,CAAC,sBAAsB,CAAC,6BAA6B,CACxF,oBAAoB,EACpB,oCAAoC,CACrC,CAAC;QAEF,MAAM,UAAU,GAAG,CAAC,wBAAwB,CAAC;QAE7C,IAAI,UAAU,EAAE;YACd,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAU,UAAU,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;SAClF;QAED,OAAO,UAAU,CAAC;KACnB;IAEO,wBAAwB,CAAC,KAAa;QAC5C,IAAI,KAAK,EAAE;YACT,OAAO,kBAAkB,CAAC,KAAK,CAAC,CAAC;SAClC;aAAM;YACL,OAAO,EAAE,CAAC;SACX;KACF;IAEO,gCAAgC,CAAC,UAAe;QACtD,IAAI,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,UAAU,EAAE;YAC1B,MAAM,qBAAqB,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC,OAAO,EAAE,GAAG,UAAU,CAAC,UAAU,GAAG,IAAI,CAAC;YAC1G,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,yBAAyB,EAAE,qBAAqB,CAAC,CAAC;SACxF;KACF;;gFAlIU,gBAAgB;qDAAhB,gBAAgB,WAAhB,gBAAgB;+CAAhB,gBAAgB;cAD5B,UAAU;;;ACTX,MAAM,WAAW,GAAG,UAAU,CAAC;MAGlB,gBAAgB;;;;IAI3B,sBAAsB;QACpB,OAAO,YAAY,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;KAC1C;;;;;;IAOD,uBAAuB,CAAC,GAAW;QACjC,YAAY,CAAC,OAAO,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;KACxC;;;;IAKD,yBAAyB;QACvB,YAAY,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;KACtC;;gFAtBU,gBAAgB;qDAAhB,gBAAgB,WAAhB,gBAAgB;+CAAhB,gBAAgB;cAD5B,UAAU;;;MCFE,UAAU;IACrB,SAAS,CAAC,GAAW;QACnB,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC;KAChC;IAED,WAAW,CAAC,KAAa;QACvB,OAAO,kBAAkB,CAAC,KAAK,CAAC,CAAC;KAClC;IAED,SAAS,CAAC,GAAW;QACnB,OAAO,kBAAkB,CAAC,GAAG,CAAC,CAAC;KAChC;IAED,WAAW,CAAC,KAAa;QACvB,OAAO,kBAAkB,CAAC,KAAK,CAAC,CAAC;KAClC;;;MCZU,aAAa;IACxB,YAA+C,GAAQ,EAAU,aAA4B;QAA9C,QAAG,GAAH,GAAG,CAAK;QAAU,kBAAa,GAAb,aAAa,CAAe;KAAI;IAEjG,YAAY,CAAC,cAAsB;QACjC,IAAI,cAAc,IAAI,CAAC,EAAE;YACvB,OAAO,EAAE,CAAC;SACX;QAED,IAAI,cAAc,GAAG,CAAC,IAAI,cAAc,GAAG,CAAC,EAAE;YAC5C,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,6BAA6B,cAAc,iDAAiD,CAAC,CAAC;YAC5H,cAAc,GAAG,EAAE,CAAC;SACrB;QAED,MAAM,MAAM,GAAG,cAAc,GAAG,CAAC,CAAC;QAClC,MAAM,GAAG,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,IAAI,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC;QAC/D,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;YACpB,IAAI,CAAC,SAAS,EAAE,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;SACvC;QAED,OAAO,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;KACpE;IAEO,KAAK,CAAC,GAAG;QACf,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;KAC5C;IAEO,YAAY,CAAC,MAAM;QACzB,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,MAAM,UAAU,GAAG,gEAAgE,CAAC;QAEpF,MAAM,MAAM,GAAG,IAAI,WAAW,CAAC,MAAM,CAAC,CAAC;QACvC,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE;YACpB,IAAI,CAAC,SAAS,EAAE,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YACzC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC/B,MAAM,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,UAAU,CAAC,MAAM,CAAC,CAAC;aACrD;SACF;QAED,OAAO,MAAM,CAAC;KACf;IAEO,SAAS;;QAEf,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,IAAK,IAAI,CAAC,GAAG,CAAC,WAAmB,CAAC,QAAQ,CAAC;KAC9E;;0EA5CU,aAAa,WACJ,QAAQ;kDADjB,aAAa,WAAb,aAAa;+CAAb,aAAa;cADzB,UAAU;;sBAEI,MAAM;uBAAC,QAAQ;;;MCCjB,gBAAgB;IAC3B,YACU,yBAAoD,EACpD,aAA4B,EAC5B,qBAA4C,EAC5C,aAA4B;QAH5B,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kBAAa,GAAb,aAAa,CAAe;KAClC;IAEJ,WAAW;QACT,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;QAClD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACrB,OAAO,KAAK,CAAC;KACd;IAED,QAAQ,CAAC,KAAa;QACpB,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;KAC1D;IAED,mBAAmB;QACjB,OAAO,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;KAChE;IAED,mBAAmB,CAAC,gBAAwB;QAC1C,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,kBAAkB,EAAE,gBAAgB,CAAC,CAAC;KAC5E;IAED,mCAAmC;QACjC,IAAI,KAAK,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACpE,IAAI,CAAC,KAAK,EAAE;YACV,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;YAC5C,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,CAAC,CAAC;SACjE;QACD,OAAO,KAAK,CAAC;KACd;IAED,eAAe,CAAC,YAAiB;QAC/B,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,eAAe,EAAE,YAAY,CAAC,CAAC;KACrE;IAED,oBAAoB;QAClB,IAAI,CAAC,yBAAyB,CAAC,oBAAoB,EAAE,CAAC;KACvD;IAED,eAAe;QACb,OAAO,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;KAC5D;IAED,kBAAkB;QAChB,MAAM,YAAY,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;QACzD,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC;QACnE,OAAO,YAAY,CAAC;KACrB;IAED,oBAAoB;QAClB,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,2BAA2B,CAAC,CAAC,CAAC;QAEnG,IAAI,aAAa,EAAE;YACjB,MAAM,EAAE,2BAA2B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YAC5F,MAAM,qBAAqB,GAAG,2BAA2B,GAAG,IAAI,CAAC;YACjE,MAAM,wBAAwB,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,wBAAwB,CAAC,CAAC;YACpF,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC;YAC5D,MAAM,yBAAyB,GAAG,IAAI,CAAC,GAAG,CAAC,cAAc,GAAG,wBAAwB,CAAC,CAAC;YACtF,MAAM,eAAe,GAAG,yBAAyB,GAAG,qBAAqB,CAAC;YAE1E,IAAI,eAAe,EAAE;gBACnB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8DAA8D,CAAC,CAAC;gBAC5F,IAAI,CAAC,uBAAuB,EAAE,CAAC;gBAC/B,OAAO,KAAK,CAAC;aACd;YAED,OAAO,aAAa,CAAC,KAAK,KAAK,SAAS,CAAC;SAC1C;QAED,OAAO,KAAK,CAAC;KACd;IAED,qBAAqB;QACnB,MAAM,aAAa,GAAG;YACpB,KAAK,EAAE,SAAS;YAChB,wBAAwB,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;SACnD,CAAC;QAEF,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,2BAA2B,EAAE,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC;KAClG;IAED,uBAAuB;QACrB,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,2BAA2B,EAAE,EAAE,CAAC,CAAC;KACvE;;gFAvFU,gBAAgB;qDAAhB,gBAAgB,WAAhB,gBAAgB;+CAAhB,gBAAgB;cAD5B,UAAU;;;MCFE,UAAU;IACrB,YAAoB,qBAA4C;QAA5C,0BAAqB,GAArB,qBAAqB,CAAuB;KAAI;IAEpE,qBAAqB;QACnB,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;KACnC;IAED,4BAA4B;QAC1B,OAAO,IAAI,CAAC,wCAAwC,EAAE,IAAI,IAAI,CAAC,2CAA2C,EAAE,CAAC;KAC9G;IAED,sCAAsC;QACpC,MAAM,EAAE,eAAe,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEhF,IAAI,IAAI,CAAC,qBAAqB,EAAE,IAAI,eAAe,EAAE;YACnD,OAAO,IAAI,CAAC;SACb;QAED,OAAO,KAAK,CAAC;KACd;IAED,wCAAwC;QACtC,OAAO,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,CAAC;KAC7C;IAED,2CAA2C;QACzC,OAAO,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC;KACvC;IAED,aAAa,CAAC,SAA4B;QACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE7E,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;YAC5B,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC;SAClD;QAED,OAAO,YAAY,KAAK,SAAS,CAAC;KACnC;;oEArCU,UAAU;+CAAV,UAAU,WAAV,UAAU;+CAAV,UAAU;cADtB,UAAU;;;ACQX,MAAM,wBAAwB,GAAG,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC;MAE3D,UAAU;IACrB,YACmB,qBAA4C,EAC5C,aAA4B,EAC5B,gBAAkC,EAClC,UAAsB,EAC/B,sBAA8C,EAC9C,yBAAoD;QAL3C,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kBAAa,GAAb,aAAa,CAAe;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,eAAU,GAAV,UAAU,CAAY;QAC/B,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,8BAAyB,GAAzB,yBAAyB,CAA2B;KAC1D;IAEJ,eAAe,CAAC,UAAe,EAAE,IAAS;QACxC,IAAI,CAAC,UAAU,EAAE;YACf,OAAO,EAAE,CAAC;SACX;QAED,IAAI,CAAC,IAAI,EAAE;YACT,OAAO,EAAE,CAAC;SACX;QAED,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAC1D,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,QAAQ,GAAG,IAAI,GAAG,WAAW,CAAC,CAAC;QACxD,MAAM,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACvC,OAAO,OAAO,KAAK,IAAI,GAAG,EAAE,GAAG,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;KAC/D;IAED,iBAAiB,CAAC,UAAkB;QAClC,OAAO,wBAAwB,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,CAAC;KACpF;IAED,+BAA+B,CAAC,YAA2D;QACzF,IAAI,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,EAAE;YAC3C,OAAO,IAAI,CAAC,gCAAgC,CAAC,YAAY,CAAC,CAAC;SAC5D;QAED,OAAO,IAAI,CAAC,oCAAoC,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;KACtE;IAED,kBAAkB,CAAC,UAAkB;QACnC,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAE7F,IAAI,CAAC,sBAAsB,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,CAAC,CAAC;YACnE,OAAO,IAAI,CAAC;SACb;QAED,MAAM,qBAAqB,GAAG,sBAAsB,CAAC,qBAAqB,CAAC;QAE3E,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,kEAAkE,qBAAqB,GAAG,CAAC,CAAC;YACxH,OAAO,IAAI,CAAC;SACb;QAED,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEzE,IAAI,CAAC,QAAQ,EAAE;YACb,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,4DAA4D,EAAE,QAAQ,CAAC,CAAC;YACpG,OAAO,IAAI,CAAC;SACb;QAED,MAAM,QAAQ,GAAG,qBAAqB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAClD,MAAM,gBAAgB,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QAErC,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC;YAC1B,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;YACvB,OAAO,EAAE,IAAI,UAAU,EAAE;SAC1B,CAAC,CAAC;QAEH,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QAC/C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QAE9C,OAAO,GAAG,gBAAgB,IAAI,MAAM,EAAE,CAAC;KACxC;IAED,eAAe,CAAC,YAA2D;QACzE,IAAI,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,EAAE;YAC3C,OAAO,IAAI,CAAC,0BAA0B,CAAC,YAAY,CAAC,CAAC;SACtD;QAED,OAAO,IAAI,CAAC,8BAA8B,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;KAChE;IAED,mBAAmB,CAAC,WAAmB,EAAE,sBAAmE;QAC1G,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,MAAM,kBAAkB,GAAG,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,kBAAkB,CAAC;QAEtE,IAAI,CAAC,kBAAkB,EAAE;YACvB,OAAO,IAAI,CAAC;SACb;QAED,MAAM,QAAQ,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAE/C,MAAM,0BAA0B,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QAE/C,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC;YAC1B,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;YACvB,OAAO,EAAE,IAAI,UAAU,EAAE;SAC1B,CAAC,CAAC;QACH,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,EAAE,WAAW,CAAC,CAAC;QAElD,IAAI,sBAAsB,EAAE;YAC1B,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,mBAAM,sBAAsB,EAAG,EAAE;gBACxE,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;aAC/C;SACF;QAED,MAAM,qBAAqB,GAAG,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAE9D,IAAI,qBAAqB,EAAE;YACzB,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,0BAA0B,EAAE,qBAAqB,CAAC,CAAC;SAC3E;QAED,OAAO,GAAG,0BAA0B,IAAI,MAAM,EAAE,CAAC;KAClD;IAED,uCAAuC,CAAC,KAAU;QAChD,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEpC,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;QAED,OAAO,aAAa,QAAQ,UAAU,KAAK,+BAA+B,CAAC;KAC5E;IAED,wCAAwC,CAAC,KAAU;QACjD,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEpC,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;QAED,OAAO,aAAa,QAAQ,UAAU,KAAK,gCAAgC,CAAC;KAC7E;IAED,wBAAwB;QACtB,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,MAAM,kBAAkB,GAAG,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,kBAAkB,CAAC;QAEtE,IAAI,CAAC,kBAAkB,EAAE;YACvB,OAAO,IAAI,CAAC;SACb;QAED,MAAM,QAAQ,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAE/C,MAAM,qBAAqB,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QAC1C,OAAO,qBAAqB,CAAC;KAC9B;IAED,gCAAgC,CAAC,IAAY,EAAE,iBAA8D;QAC3G,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC;QAC7D,IAAI,CAAC,YAAY,EAAE;YACjB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,EAAE,YAAY,CAAC,CAAC;YACtE,OAAO,IAAI,CAAC;SACb;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEpC,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;QAED,IAAI,WAAW,GAAG,WAAW,CAAA;yBACR,QAAQ;6BACJ,YAAY;oBACrB,IAAI,EAAE,CAAC;QAEvB,IAAI,iBAAiB,EAAE;YACrB,MAAM,eAAe,GAAG,IAAI,CAAC,mBAAmB,mBAAM,iBAAiB,EAAG,CAAC;YAC3E,WAAW,GAAG,WAAW,CAAA,GAAG,WAAW,GAAG,eAAe,EAAE,CAAC;SAC7D;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEhD,IAAI,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,IAAI,cAAc,EAAE;YAClE,OAAO,WAAW,CAAA,GAAG,WAAW,iBAAiB,cAAc,EAAE,CAAC;SACnE;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAE1C,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC;SACb;QAED,OAAO,WAAW,CAAA,GAAG,WAAW,iBAAiB,WAAW,EAAE,CAAC;KAChE;IAED,yCAAyC,CACvC,YAAoB,EACpB,mBAAkE;QAElE,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAEpC,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;QAED,IAAI,WAAW,GAAG,WAAW,CAAA;yBACR,QAAQ;6BACJ,YAAY,EAAE,CAAC;QAExC,IAAI,mBAAmB,EAAE;YACvB,MAAM,eAAe,GAAG,IAAI,CAAC,mBAAmB,mBAAM,mBAAmB,EAAG,CAAC;YAC7E,WAAW,GAAG,GAAG,WAAW,GAAG,eAAe,EAAE,CAAC;SAClD;QAED,OAAO,WAAW,CAAC;KACpB;IAED,+BAA+B,CAAC,mBAAkE;QAChG,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAE1C,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC;SACb;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;QAClD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,GAAG,KAAK,CAAC,CAAC;;QAG/E,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;QAChE,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,YAAY,CAAC,CAAC;QAEtF,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAErH,IAAI,WAAW,GAAG,WAAW,CAAA,aAAa,QAAQ;4BAC1B,WAAW;6BACV,YAAY;qBACpB,KAAK;qBACL,KAAK;qBACL,KAAK;8BACI,aAAa;wCACH,CAAC;QAErC,IAAI,OAAO,EAAE;YACX,WAAW,GAAG,GAAG,WAAW,OAAO,OAAO,EAAE,CAAC;SAC9C;QAED,IAAI,YAAY,EAAE;YAChB,MAAM,eAAe,GAAG,IAAI,CAAC,mBAAmB,mBAAM,YAAY,EAAG,CAAC;YACtE,WAAW,GAAG,GAAG,WAAW,GAAG,eAAe,EAAE,CAAC;SAClD;QAED,IAAI,mBAAmB,EAAE;YACvB,MAAM,eAAe,GAAG,IAAI,CAAC,mBAAmB,mBAAM,mBAAmB,EAAG,CAAC;YAC7E,WAAW,GAAG,GAAG,WAAW,GAAG,eAAe,EAAE,CAAC;SAClD;QAED,OAAO,WAAW,CAAC;KACpB;IAEO,kBAAkB,CACxB,aAAqB,EACrB,WAAmB,EACnB,KAAa,EACb,KAAa,EACb,MAAe,EACf,mBAAkE;QAElE,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,MAAM,qBAAqB,GAAG,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,qBAAqB,CAAC;QAE5E,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,kEAAkE,qBAAqB,GAAG,CAAC,CAAC;YACxH,OAAO,IAAI,CAAC;SACb;QAED,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAErH,IAAI,CAAC,QAAQ,EAAE;YACb,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,4DAA4D,EAAE,QAAQ,CAAC,CAAC;YACpG,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,YAAY,EAAE;YACjB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gEAAgE,EAAE,YAAY,CAAC,CAAC;YAC5G,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yDAAyD,EAAE,KAAK,CAAC,CAAC;YAC9F,OAAO,IAAI,CAAC;SACb;QAED,MAAM,QAAQ,GAAG,qBAAqB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAClD,MAAM,gBAAgB,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QAErC,IAAI,MAAM,GAAG,IAAI,UAAU,CAAC;YAC1B,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;YACvB,OAAO,EAAE,IAAI,UAAU,EAAE;SAC1B,CAAC,CAAC;QAEH,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QAC3C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC;QACpD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,eAAe,EAAE,YAAY,CAAC,CAAC;QACtD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACvC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACvC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAEvC,IAAI,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,EAAE;YAC3C,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,gBAAgB,EAAE,aAAa,CAAC,CAAC;YACxD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,uBAAuB,EAAE,MAAM,CAAC,CAAC;SACzD;QAED,IAAI,MAAM,EAAE;YACV,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SAC1C;QAED,IAAI,OAAO,EAAE;YACX,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;SACvC;QAED,IAAI,YAAY,EAAE;YAChB,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,mBAAM,YAAY,EAAG,EAAE;gBAC9D,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;aAC/C;SACF;QAED,IAAI,mBAAmB,EAAE;YACvB,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,mBAAM,mBAAmB,EAAG,EAAE;gBACrE,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;aAC/C;SACF;QAED,OAAO,GAAG,gBAAgB,IAAI,MAAM,EAAE,CAAC;KACxC;IAEO,oCAAoC,CAAC,YAA2D;QACtG,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;QAElD,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEhD,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8CAA8C,EAAE,KAAK,CAAC,CAAC;QAEnF,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,IAAI,sBAAsB,EAAE;YAC1B,OAAO,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;SACxF;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,CAAC,CAAC;QACnE,OAAO,IAAI,CAAC;KACb;IAEO,gCAAgC,CAAC,YAA2D;QAClG,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;QAElD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8CAA8C,GAAG,KAAK,CAAC,CAAC;;QAGpF,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;QAChE,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,YAAY,CAAC,CAAC;QAEtF,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEhD,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,IAAI,CAAC;SACb;QAED,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,IAAI,sBAAsB,EAAE;YAC1B,OAAO,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;SACnG;QAED,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qCAAqC,CAAC,CAAC;QACrE,OAAO,IAAI,CAAC;KACb;IAEO,8BAA8B,CAAC,YAA2D;QAChG,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;QAClD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,GAAG,KAAK,CAAC,CAAC;QAE/E,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAE1C,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC;SACb;QAED,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,IAAI,sBAAsB,EAAE;YAC1B,OAAO,IAAI,CAAC,kBAAkB,CAAC,EAAE,EAAE,WAAW,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC;SACnF;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,CAAC,CAAC;QACnE,OAAO,IAAI,CAAC;KACb;IAEO,0BAA0B,CAAC,YAA2D;QAC5F,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC1E,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC;QAClD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,GAAG,KAAK,CAAC,CAAC;QAE/E,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,EAAE,CAAC;QAE1C,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,IAAI,CAAC;SACb;;QAGD,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,CAAC;QAChE,MAAM,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,YAAY,CAAC,CAAC;QAEtF,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,IAAI,sBAAsB,EAAE;YAC1B,OAAO,IAAI,CAAC,kBAAkB,CAAC,aAAa,EAAE,WAAW,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC;SAC9F;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,CAAC,CAAC;QACnE,OAAO,IAAI,CAAC;KACb;IAEO,cAAc;QACpB,MAAM,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE5E,IAAI,CAAC,WAAW,EAAE;YAChB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,kCAAkC,EAAE,WAAW,CAAC,CAAC;YAC7E,OAAO,IAAI,CAAC;SACb;QAED,OAAO,WAAW,CAAC;KACpB;IAEO,iBAAiB;QACvB,MAAM,EAAE,cAAc,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE/E,IAAI,CAAC,cAAc,EAAE;YACnB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,EAAE,cAAc,CAAC,CAAC;YACnF,OAAO,IAAI,CAAC;SACb;QAED,OAAO,cAAc,CAAC;KACvB;IAEO,wBAAwB;QAC9B,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,4CAA4C,EAAE,qBAAqB,CAAC,CAAC;YACjG,OAAO,IAAI,CAAC;SACb;QAED,OAAO,qBAAqB,CAAC;KAC9B;IAEO,WAAW;QACjB,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEzE,IAAI,CAAC,QAAQ,EAAE;YACb,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+BAA+B,EAAE,QAAQ,CAAC,CAAC;YACvE,OAAO,IAAI,CAAC;SACb;QAED,OAAO,QAAQ,CAAC;KACjB;IAEO,mBAAmB,CAAC,YAA0D;QACpF,IAAI,eAAe,GAAG,EAAE,CAAC;QAEzB,KAAK,MAAM,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;YACvD,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,KAAK,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;SACzE;QAED,OAAO,eAAe,CAAC;KACxB;;oEArdU,UAAU;+CAAV,UAAU,WAAV,UAAU;+CAAV,UAAU;cADtB,UAAU;;;MCEE,8BAA8B;IACzC,YACmB,UAAsB,EACtB,aAA4B,EAC5B,sBAA8C,EAC9C,gBAAkC,EAClC,qBAA4C,EAC5C,yBAAoD,EACpD,WAAwB;QANxB,eAAU,GAAV,UAAU,CAAY;QACtB,kBAAa,GAAb,aAAa,CAAe;QAC5B,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,gBAAW,GAAX,WAAW,CAAa;KACvC;;IAGJ,gBAAgB,CAAC,UAAkB;QACjC,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;QACjE,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;QACnE,MAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,UAAU,EAAE,eAAe,CAAC,IAAI,IAAI,CAAC;QAE1F,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;YAC/C,OAAO,UAAU,CAAC,iBAAiB,CAAC,CAAC;SACtC;QAED,IAAI,CAAC,IAAI,EAAE;YACT,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;YAC9C,OAAO,UAAU,CAAC,gBAAgB,CAAC,CAAC;SACrC;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,EAAE,UAAU,CAAC,CAAC;QAE3E,MAAM,sBAAsB,GAAG;YAC7B,IAAI;YACJ,YAAY,EAAE,IAAI;YAClB,KAAK;YACL,YAAY;YACZ,UAAU,EAAE,IAAI;YAChB,cAAc,EAAE,KAAK;YACrB,OAAO,EAAE,IAAI;YACb,gBAAgB,EAAE,IAAI;YACtB,eAAe,EAAE,IAAI;SACtB,CAAC;QAEF,OAAO,EAAE,CAAC,sBAAsB,CAAC,CAAC;KACnC;;IAGD,mBAAmB,CAAC,eAAgC;QAClD,MAAM,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,CAAC;QAErE,MAAM,cAAc,GAAG,IAAI,CAAC,sBAAsB,CAAC,6BAA6B,CAAC,eAAe,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC;QAE1H,IAAI,CAAC,cAAc,EAAE;YACnB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qCAAqC,CAAC,CAAC;YACrE,OAAO,UAAU,CAAC,qCAAqC,CAAC,CAAC;SAC1D;QAED,MAAM,aAAa,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACpF,MAAM,aAAa,GAAG,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,aAAa,CAAC;QACnD,IAAI,CAAC,aAAa,EAAE;YAClB,OAAO,UAAU,CAAC,4BAA4B,CAAC,CAAC;SACjD;QAED,IAAI,OAAO,GAAgB,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,mCAAmC,CAAC,CAAC;QAE3E,MAAM,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEnE,MAAM,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,gCAAgC,CAAC,eAAe,CAAC,IAAI,EAAE,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,iBAAiB,CAAC,CAAC;QAE1H,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,EAAE,eAAe,EAAE,OAAO,CAAC,CAAC,IAAI,CACxE,SAAS,CAAC,CAAC,QAAQ;YACjB,IAAI,UAAU,GAAQ,IAAI,MAAM,EAAE,CAAC;YACnC,UAAU,GAAG,QAAQ,CAAC;YACtB,UAAU,CAAC,KAAK,GAAG,eAAe,CAAC,KAAK,CAAC;YACzC,UAAU,CAAC,aAAa,GAAG,eAAe,CAAC,YAAY,CAAC;YAExD,eAAe,CAAC,UAAU,GAAG,UAAU,CAAC;YACxC,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;SAC5B,CAAC,EACF,SAAS,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,EACpD,UAAU,CAAC,CAAC,KAAK;YACf,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YAC1E,MAAM,YAAY,GAAG,4BAA4B,SAAS,EAAE,CAAC;YAC7D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;IAEO,kBAAkB,CAAC,MAAuB;QAChD,OAAO,MAAM,CAAC,IAAI,CAChB,QAAQ,CAAC,CAAC,KAAK;;YAEb,IAAI,KAAK,IAAI,KAAK,YAAY,iBAAiB,IAAI,KAAK,CAAC,KAAK,YAAY,aAAa,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;gBACvH,MAAM,EAAE,SAAS,EAAE,0BAA0B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;gBACtG,MAAM,YAAY,GAAG,4BAA4B,SAAS,2BAA2B,CAAC;gBACtF,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACnD,OAAO,KAAK,CAAC,0BAA0B,GAAG,IAAI,CAAC,CAAC;aACjD;YACD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;;4GArGU,8BAA8B;mEAA9B,8BAA8B,WAA9B,8BAA8B;+CAA9B,8BAA8B;cAD1C,UAAU;;;MCAE,WAAW;IAOtB,YACU,eAA4B,EAC5B,yBAAoD,EACpD,YAAiC,EACjC,aAA4B,EAC5B,kBAAsC,EACtC,UAAsB,EACtB,qBAA4C;QAN5C,oBAAe,GAAf,eAAe,CAAa;QAC5B,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,iBAAY,GAAZ,YAAY,CAAqB;QACjC,kBAAa,GAAb,aAAa,CAAe;QAC5B,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,eAAU,GAAV,UAAU,CAAY;QACtB,0BAAqB,GAArB,qBAAqB,CAAuB;QAb9C,sBAAiB,GAAG,IAAI,eAAe,CAAM,IAAI,CAAC,CAAC;KAcvD;IAZJ,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,CAAC;KAC9C;;;IAcD,4BAA4B,CAAC,cAAc,GAAG,KAAK,EAAE,OAAa,EAAE,cAAoB;QACtF,OAAO,GAAG,OAAO,IAAI,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,CAAC;QACjE,cAAc,GAAG,cAAc,IAAI,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QAE/F,MAAM,2BAA2B,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAChE,MAAM,YAAY,GAAG,CAAC,CAAC,2BAA2B,CAAC;QACnD,MAAM,wCAAwC,GAAG,IAAI,CAAC,UAAU,CAAC,wCAAwC,EAAE,CAAC;QAC5G,MAAM,qBAAqB,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,CAAC;QAEtE,MAAM,WAAW,GAAG,IAAI,CAAC,yBAAyB,CAAC,cAAc,EAAE,CAAC;QACpE,IAAI,EAAE,wCAAwC,IAAI,qBAAqB,CAAC,EAAE;YACxE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,kCAAkC,CAAC,CAAC;YAChE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;YAExD,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;YACxC,OAAO,EAAE,CAAC,cAAc,CAAC,CAAC;SAC3B;QAED,MAAM,EAAE,4BAA4B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE7F,IAAI,CAAC,cAAc,IAAI,4BAA4B,IAAI,CAAC,YAAY,EAAE;YACpE,OAAO,IAAI,CAAC,0BAA0B,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,IAAI,CAC7D,SAAS,CAAC,CAAC,QAAQ;gBACjB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oBAAoB,EAAE,QAAQ,CAAC,CAAC;gBAC5D,IAAI,CAAC,CAAC,QAAQ,EAAE;oBACd,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;oBACxD,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC;iBACrB;qBAAM;oBACL,OAAO,UAAU,CAAC,8BAA8B,CAAC,CAAC;iBACnD;aACF,CAAC,CACH,CAAC;SACH;QAED,OAAO,EAAE,CAAC,2BAA2B,CAAC,CAAC;KACxC;IAED,oBAAoB;QAClB,OAAO,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC;KAChE;IAED,uBAAuB;QACrB,MAAM,QAAQ,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAC7C,IAAI,QAAQ,EAAE;YACZ,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC;SACnE;KACF;IAED,kBAAkB,CAAC,KAAU;QAC3B,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QACxD,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;KAChE;IAED,oBAAoB;QAClB,IAAI,CAAC,yBAAyB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QAC9D,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACnC;IAEO,0BAA0B,CAAC,UAAe;QAChD,OAAO,IAAI,CAAC,mBAAmB,EAAE,CAAC,IAAI,CACpC,GAAG,CAAC,CAAC,IAAS;YACZ,IAAI,IAAI,CAAC,0BAA0B,CAAC,UAAU,EAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,GAAG,CAAC,EAAE;gBAC1D,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;gBAC9B,OAAO,IAAI,CAAC;aACb;iBAAM;;gBAEL,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kEAAkE,CAAC,CAAC;gBAClG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,2DAA2D,CAAC,CAAC;gBACzF,IAAI,CAAC,oBAAoB,EAAE,CAAC;gBAC5B,OAAO,IAAI,CAAC;aACb;SACF,CAAC,CACH,CAAC;KACH;IAEO,mBAAmB;QACzB,MAAM,KAAK,GAAG,IAAI,CAAC,yBAAyB,CAAC,cAAc,EAAE,CAAC;QAE9D,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAE7F,IAAI,CAAC,sBAAsB,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,yDAAyD,CAAC,CAAC;YACzF,OAAO,UAAU,CAAC,qCAAqC,CAAC,CAAC;SAC1D;QAED,MAAM,gBAAgB,GAAG,sBAAsB,CAAC,gBAAgB,CAAC;QAEjE,IAAI,CAAC,gBAAgB,EAAE;YACrB,IAAI,CAAC,aAAa,CAAC,QAAQ,CACzB,gHAAgH,CACjH,CAAC;;;YAGF,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;gBAC9C,IAAI,OAAO,GAAG,gBAAgB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBAC1C,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;gBACrB,IAAI,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACrC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gBAE/B,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;aACrE;YACD,OAAO,UAAU,CAAC,uDAAuD,CAAC,CAAC;SAC5E;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;KACzE;IAEO,0BAA0B,CAAC,UAAe,EAAE,WAAgB;QAClE,IAAI,CAAC,UAAU,EAAE;YACf,OAAO,KAAK,CAAC;SACd;QAED,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,KAAK,CAAC;SACd;QAED,IAAK,UAAqB,KAAM,WAAsB,EAAE;YACtD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mCAAmC,EAAE,UAAU,EAAE,WAAW,CAAC,CAAC;YAC1F,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;;sEAhJU,WAAW;gDAAX,WAAW,WAAX,WAAW;+CAAX,WAAW;cADvB,UAAU;;;MCNE,oBAAoB;IAC/B,YACmB,gBAAkC,EAClC,gBAAkC,EAClC,WAAwB;QAFxB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gBAAW,GAAX,WAAW,CAAa;KACvC;IAEJ,sBAAsB;QACpB,IAAI,CAAC,WAAW,CAAC,oBAAoB,EAAE,CAAC;QACxC,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;QAC7C,IAAI,CAAC,gBAAgB,CAAC,2BAA2B,EAAE,CAAC;KACrD;;wFAXU,oBAAoB;yDAApB,oBAAoB,WAApB,oBAAoB;+CAApB,oBAAoB;cADhC,UAAU;;;MCIE,kCAAkC;IAC7C,YACmB,oBAA0C,EAC1C,aAA4B,EAC5B,gBAAkC,EAChB,GAAQ;QAH1B,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,kBAAa,GAAb,aAAa,CAAe;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAChB,QAAG,GAAH,GAAG,CAAK;KACzC;;;IAIJ,oBAAoB,CAAC,IAAa;QAChC,MAAM,kBAAkB,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;QAExE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wCAAwC,CAAC,CAAC;QACtE,IAAI,CAAC,kBAAkB,EAAE;YACvB,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;SACpD;QAED,IAAI,GAAG,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAEhD,MAAM,UAAU,GAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,UAAe,EAAE,IAAY;YAC3E,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC9B,UAAU,CAAC,KAAK,CAAC,KAAK,EAAY,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACtD,OAAO,UAAU,CAAC;SACnB,EAAE,EAAE,CAAC,CAAC;QAEP,MAAM,eAAe,GAAG;YACtB,IAAI,EAAE,IAAI;YACV,YAAY,EAAE,IAAI;YAClB,KAAK,EAAE,IAAI;YACX,YAAY,EAAE,IAAI;YAClB,UAAU;YACV,cAAc,EAAE,kBAAkB;YAClC,OAAO,EAAE,IAAI;YACb,gBAAgB,EAAE,IAAI;YACtB,eAAe,EAAE,IAAI;SACtB,CAAC;QAEF,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;KAC5B;;oHAvCU,kCAAkC,gGAKnC,QAAQ;uEALP,kCAAkC,WAAlC,kCAAkC;+CAAlC,kCAAkC;cAD9C,UAAU;;sBAMN,MAAM;uBAAC,QAAQ;;;ACdpB;IACY;AAAZ,WAAY,eAAe;IACzB,4CAAyB,CAAA;IACzB,gDAA6B,CAAA;IAC7B,sCAAmB,CAAA;AACrB,CAAC,EAJW,eAAe,KAAf,eAAe;;ACD3B;IACY;AAAZ,WAAY,gBAAgB;IAC1B,qCAAiB,CAAA;IACjB,yDAAqC,CAAA;IACrC,uDAAmC,CAAA;IACnC,qDAAiC,CAAA;IACjC,uEAAmD,CAAA;IACnD,yDAAqC,CAAA;IACrC,mEAA+C,CAAA;IAC/C,yEAAqD,CAAA;IACrD,iDAA6B,CAAA;IAC7B,6FAAyE,CAAA;IACzE,iDAA6B,CAAA;IAC7B,iDAA6B,CAAA;IAC7B,uDAAmC,CAAA;IACnC,6BAAS,CAAA;IACT,mDAA+B,CAAA;IAC/B,qEAAiD,CAAA;AACnD,CAAC,EAjBW,gBAAgB,KAAhB,gBAAgB;;MCSf,oBAAoB;IAC/B,YACU,yBAAoD,EACpD,aAA4B,EAC5B,WAAwB;QAFxB,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,gBAAW,GAAX,WAAW,CAAa;KAC9B;IAEJ,cAAc;QACZ,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,MAAM,OAAO,GAAG,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,OAAO,CAAC;QAChD,IAAI,CAAC,OAAO,EAAE;YACZ,MAAM,KAAK,GAAG,uDAAuD,OAAO,GAAG,CAAC;YAChF,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;YACrC,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,EAAE,OAAO,CAAC,CAAC;QAEjE,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAU,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC,CAAC;KAC1G;IAEO,yBAAyB,CAAC,aAAsC;QACtE,IAAI,MAAM,GAAG,EAAE,CAAC;QAChB,IAAI,aAAa,YAAY,YAAY,EAAE;YACzC,MAAM,IAAI,GAAG,aAAa,CAAC,IAAI,IAAI,EAAE,CAAC;YACtC,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACjC,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG,aAAa,CAAC;YAC7C,MAAM,GAAG,GAAG,MAAM,IAAI,EAAE,MAAM,UAAU,IAAI,EAAE,IAAI,GAAG,IAAI,EAAE,EAAE,CAAC;SAC/D;aAAM;YACL,MAAM,EAAE,OAAO,EAAE,GAAG,aAAa,CAAC;YAClC,MAAM,GAAG,CAAC,CAAC,OAAO,GAAG,OAAO,GAAG,GAAG,aAAa,EAAE,CAAC;SACnD;QACD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACpC,OAAO,UAAU,CAAC,IAAI,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;KACtC;;wFAlCU,oBAAoB;yDAApB,oBAAoB,WAApB,oBAAoB;+CAApB,oBAAoB;cADhC,UAAU;;;ACMX,MAAM,QAAQ,GAAG,SAAS,CAAC;MAGd,oCAAoC;IAC/C,YACmB,aAA4B,EAC5B,qBAA4C,EAC5C,gBAAkC,EAClC,gBAAkC,EAClC,oBAA0C,EAC1C,yBAAoD,EACpD,oBAA0C;QAN1C,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,yBAAoB,GAApB,oBAAoB,CAAsB;KACzD;;IAGJ,8BAA8B,CAAC,eAAgC;QAC7D,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,aAAa,EAAE,eAAe,CAAC,UAAU,CAAC,CAAC;QAEhF,IAAI,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE;YACpE,IAAI,CAAC,mBAAmB,EAAE,CAAC;SAC5B;aAAM;YACL,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,2BAA2B,CAAC,CAAC;SAC1D;QAED,IAAI,eAAe,CAAC,UAAU,CAAC,KAAK,EAAE;YACpC,MAAM,YAAY,GAAG,gDAAgD,eAAe,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;YACxG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;YACnD,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;YACnC,IAAI,CAAC,6BAA6B,CAAC,eAAe,CAAC,UAAU,EAAE,eAAe,CAAC,cAAc,CAAC,CAAC;YAC/F,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;QACxD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oDAAoD,CAAC,CAAC;QAElF,OAAO,IAAI,CAAC,oBAAoB,CAAC,cAAc,EAAE,CAAC,IAAI,CACpD,GAAG,CAAC,CAAC,OAAgB,KAAK,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,EACzD,UAAU,CAAC,CAAC,GAAG;;YAEb,MAAM,aAAa,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;YAC7C,IAAI,CAAC,CAAC,aAAa,EAAE;gBACnB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,0DAA0D,CAAC,CAAC;gBAC1F,OAAO,EAAE,CAAC,aAAa,CAAC,CAAC;aAC1B;YAED,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB,CAAC,EACF,SAAS,CAAC,CAAC,OAAO;YAChB,IAAI,OAAO,EAAE;gBACX,eAAe,CAAC,OAAO,GAAG,OAAO,CAAC;gBAElC,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;aAC5B;YAED,MAAM,YAAY,GAAG,gCAAgC,CAAC;YACtD,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YAC5C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,EACF,UAAU,CAAC,CAAC,GAAG;YACb,MAAM,YAAY,GAAG,8CAA8C,GAAG,EAAE,CAAC;YACzE,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YAC5C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;IAEO,6BAA6B,CAAC,MAAW,EAAE,cAAuB;QACxE,IAAI,gBAAgB,GAAG,gBAAgB,CAAC,sBAAsB,CAAC;QAE/D,IAAK,MAAM,CAAC,KAAgB,KAAK,gBAAgB,EAAE;YACjD,gBAAgB,GAAG,gBAAgB,CAAC,aAAa,CAAC;SACnD;QAED,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC;YAC9C,kBAAkB,EAAE,eAAe,CAAC,YAAY;YAChD,gBAAgB;YAChB,cAAc;SACf,CAAC,CAAC;KACJ;IAEO,sBAAsB;QAC5B,MAAM,EAAE,iBAAiB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClF,OAAO,CAAC,iBAAiB,CAAC;KAC3B;IAEO,mBAAmB;QACzB,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,EAAE,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;KAC3G;IAEO,gBAAgB,CAAC,OAAgB;QACvC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;KACzD;IAEO,eAAe;QACrB,OAAO,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KACtD;;wHA7FU,oCAAoC;yEAApC,oCAAoC,WAApC,oCAAoC;+CAApC,oCAAoC;cADhD,UAAU;;;MCHE,0BAA0B;IACrC,YACmB,aAA4B,EAC5B,qBAA4C,EAC5C,gBAAkC,EAClC,gBAAkC,EAClC,WAAwB,EACxB,oBAA0C;QAL1C,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gBAAW,GAAX,WAAW,CAAa;QACxB,yBAAoB,GAApB,oBAAoB,CAAsB;KACzD;;IAGJ,YAAY,CAAC,eAAgC;QAC3C,MAAM,EAAE,cAAc,EAAE,gBAAgB,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,eAAe,CAAC;QACvF,MAAM,EAAE,YAAY,EAAE,4BAA4B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE3G,IAAI,CAAC,YAAY,EAAE;YACjB,IAAI,CAAC,cAAc,IAAI,4BAA4B,EAAE;;gBAEnD,IAAI,gBAAgB,CAAC,cAAc,EAAE;oBACnC,IAAI,CAAC,WAAW,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;iBACtE;aACF;YAED,IAAI,CAAC,cAAc,IAAI,CAAC,YAAY,EAAE;gBACpC,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;aACjE;YAED,IAAI,CAAC,sBAAsB,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;YAC9D,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;SAC5B;QAED,OAAO,IAAI,CAAC,WAAW,CAAC,4BAA4B,CAAC,cAAc,EAAE,gBAAgB,CAAC,OAAO,EAAE,gBAAgB,CAAC,cAAc,CAAC,CAAC,IAAI,CAClI,SAAS,CAAC,CAAC,QAAQ;YACjB,IAAI,CAAC,CAAC,QAAQ,EAAE;gBACd,IAAI,CAAC,YAAY,EAAE;oBACjB,IAAI,CAAC,gBAAgB,CAAC,eAAe,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;iBACjE;gBAED,IAAI,CAAC,sBAAsB,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;gBAE9D,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;aAC5B;iBAAM;gBACL,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;gBACnD,IAAI,CAAC,wBAAwB,CAAC,gBAAgB,EAAE,cAAc,CAAC,CAAC;gBAChE,MAAM,YAAY,GAAG,qCAAqC,QAAQ,EAAE,CAAC;gBACrE,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;gBAC5C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;aACjC;SACF,CAAC,EACF,UAAU,CAAC,CAAC,GAAG;YACb,MAAM,YAAY,GAAG,6CAA6C,GAAG,EAAE,CAAC;YACxE,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YAC5C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;IAEO,sBAAsB,CAAC,qBAA4C,EAAE,cAAuB;QAClG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC;YAC9C,kBAAkB,EAAE,eAAe,CAAC,UAAU;YAC9C,gBAAgB,EAAE,qBAAqB,CAAC,KAAK;YAC7C,cAAc;SACf,CAAC,CAAC;KACJ;IAEO,wBAAwB,CAAC,qBAA4C,EAAE,cAAuB;QACpG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC;YAC9C,kBAAkB,EAAE,eAAe,CAAC,YAAY;YAChD,gBAAgB,EAAE,qBAAqB,CAAC,KAAK;YAC7C,cAAc;SACf,CAAC,CAAC;KACJ;;oGAvEU,0BAA0B;+DAA1B,0BAA0B,WAA1B,0BAA0B;+CAA1B,0BAA0B;cADtC,UAAU;;;MCXE,qBAAqB;IAChC,YACS,cAAc,EAAE,EAChB,UAAU,EAAE,EACZ,sBAAsB,KAAK,EAC3B,iBAAsB,EAAE,EACxB,QAA0B,gBAAgB,CAAC,MAAM;QAJjD,gBAAW,GAAX,WAAW,CAAK;QAChB,YAAO,GAAP,OAAO,CAAK;QACZ,wBAAmB,GAAnB,mBAAmB,CAAQ;QAC3B,mBAAc,GAAd,cAAc,CAAU;QACxB,UAAK,GAAL,KAAK,CAA4C;KACtD;;;MCNO,eAAe;IAC1B,mCAAmC,CAAC,MAAsB,EAAE,MAAsB;QAChF,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE;YAClC,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,EAAE;YAClC,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,kCAAkC,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC3D,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC7C,OAAO,MAAM,KAAK,MAAM,CAAC;SAC1B;QAED,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC5C,OAAO,IAAI,CAAC,sBAAsB,CAAC,MAAe,EAAE,MAAe,CAAC,CAAC;SACtE;QAED,OAAO,KAAK,CAAC;KACd;IAED,QAAQ,CAAC,MAA+C,EAAE,MAA+C;QACvG,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,EAAE;YACtB,OAAO,KAAK,CAAC;SACd;QAED,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC5C,OAAO,IAAI,CAAC,iBAAiB,CAAC,MAAe,EAAE,MAAe,CAAC,CAAC;SACjE;QAED,IAAI,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC7C,OAAO,MAAM,KAAK,MAAM,CAAC;SAC1B;QAED,IAAI,IAAI,CAAC,oBAAoB,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC7C,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,KAAK,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;SACtF;QAED,IAAI,IAAI,CAAC,kCAAkC,CAAC,MAAM,EAAE,MAAM,CAAC,EAAE;YAC3D,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;gBACvD,OAAO,MAAM,CAAC,CAAC,CAAC,KAAK,MAAM,CAAC;aAC7B;YACD,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,EAAE;gBACvD,OAAO,MAAM,CAAC,CAAC,CAAC,KAAK,MAAM,CAAC;aAC7B;SACF;KACF;IAEO,kCAAkC,CAAC,MAA4B,EAAE,MAA4B;QACnG,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,CAAC;KACvH;IAEO,oBAAoB,CAAC,MAA4B,EAAE,MAA4B;QACrF,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;KACjE;IAEO,oBAAoB,CAAC,MAA4B,EAAE,MAA4B;QACrF,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;KACjE;IAEO,mBAAmB,CAAC,MAA4B,EAAE,MAA4B;QACpF,OAAO,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;KACvD;IAEO,aAAa,CAAC,KAAU;QAC9B,OAAO,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,YAAY,MAAM,CAAC;KAC7D;IAEO,aAAa,CAAC,KAAU;QAC9B,OAAO,OAAO,KAAK,KAAK,QAAQ,CAAC;KAClC;IAEO,iBAAiB,CAAC,IAAmB,EAAE,IAAmB;QAChE,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE;YAC/B,OAAO,KAAK,CAAC;SACd;QAED,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,GAAI;YAC/B,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE;gBACvB,OAAO,KAAK,CAAC;aACd;SACF;QAED,OAAO,IAAI,CAAC;KACb;IAEO,sBAAsB,CAAC,IAAmB,EAAE,IAAmB;QACrE,IAAI,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,MAAM,EAAE;YAC/B,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;KAC3C;IAEO,iBAAiB,CAAC,GAAQ;QAChC,OAAO,GAAG,KAAK,IAAI,IAAI,GAAG,KAAK,SAAS,CAAC;KAC1C;;8EApGU,eAAe;oDAAf,eAAe,WAAf,eAAe;+CAAf,eAAe;cAD3B,UAAU;;;MCWE,sBAAsB;IACjC,YACU,yBAAoD,EACpD,sBAA8C,EAC9C,kBAAsC,EACtC,aAA4B,EAC5B,qBAA4C,EAC5C,eAAgC,EAChC,UAAsB;QANtB,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,oBAAe,GAAf,eAAe,CAAiB;QAChC,eAAU,GAAV,UAAU,CAAY;KAC5B;IAEJ,uBAAuB,CAAC,eAAgC;QACtD,IAAI,CAAC,eAAe,EAAE;YACpB,OAAO,IAAI,qBAAqB,CAAC,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;SACrD;QAED,IAAI,eAAe,CAAC,UAAU,CAAC,KAAK,EAAE;YACpC,OAAO,IAAI,qBAAqB,CAAC,EAAE,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;SACrD;QAED,OAAO,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;KAC5C;IAED,aAAa,CAAC,eAAe;QAC3B,MAAM,QAAQ,GAAG,IAAI,qBAAqB,EAAE,CAAC;QAC7C,MAAM,gBAAgB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAEjF,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,6BAA6B,CAAC,eAAe,CAAC,UAAU,CAAC,KAAK,EAAE,gBAAgB,CAAC,EAAE;YAClH,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,oCAAoC,CAAC,CAAC;YACpE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,gBAAgB,CAAC;YACnD,IAAI,CAAC,4BAA4B,EAAE,CAAC;YACpC,OAAO,QAAQ,CAAC;SACjB;QAED,MAAM,wCAAwC,GAAG,IAAI,CAAC,UAAU,CAAC,wCAAwC,EAAE,CAAC;QAC5G,MAAM,qBAAqB,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,CAAC;QAEtE,IAAI,wCAAwC,IAAI,qBAAqB,EAAE;YACrE,QAAQ,CAAC,WAAW,GAAG,eAAe,CAAC,UAAU,CAAC,YAAY,CAAC;SAChE;QAED,IAAI,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE;YACvC,MAAM,EACJ,QAAQ,EACR,gBAAgB,EAChB,mCAAmC,EACnC,0BAA0B,EAC1B,uBAAuB,GACxB,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YAExD,QAAQ,CAAC,OAAO,GAAG,eAAe,CAAC,UAAU,CAAC,QAAQ,CAAC;YAEvD,QAAQ,CAAC,cAAc,GAAG,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,QAAQ,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;YAE/F,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,wBAAwB,CAAC,QAAQ,CAAC,OAAO,EAAE,eAAe,CAAC,OAAO,CAAC,EAAE;gBACpG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yDAAyD,CAAC,CAAC;gBACvF,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,eAAe,CAAC;gBAClD,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,MAAM,SAAS,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAEnE,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,oBAAoB,CAAC,QAAQ,CAAC,cAAc,EAAE,SAAS,EAAE,uBAAuB,CAAC,EAAE;gBAClH,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,oCAAoC,CAAC,CAAC;gBACpE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,cAAc,CAAC;gBACjD,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;gBACjF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qFAAqF,CAAC,CAAC;gBACnH,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,uBAAuB,CAAC;gBAC1D,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IACE,CAAC,IAAI,CAAC,sBAAsB,CAAC,2BAA2B,CACtD,QAAQ,CAAC,cAAc,EACvB,mCAAmC,EACnC,0BAA0B,CAC3B,EACD;gBACA,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,oGAAoG,CAAC,CAAC;gBACpI,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,gBAAgB,CAAC;gBACnD,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAE7F,IAAI,sBAAsB,EAAE;gBAC1B,IAAI,gBAAgB,EAAE;oBACpB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wDAAwD,CAAC,CAAC;iBACvF;qBAAM,IACL,CAAC,gBAAgB;oBACjB,CAAC,IAAI,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,QAAQ,CAAC,cAAc,EAAE,sBAAsB,CAAC,MAAM,CAAC,EACvG;oBACA,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,+EAA+E,CAAC,CAAC;oBAC/G,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,qBAAqB,CAAC;oBACxD,IAAI,CAAC,4BAA4B,EAAE,CAAC;oBACpC,OAAO,QAAQ,CAAC;iBACjB;aACF;iBAAM;gBACL,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qCAAqC,CAAC,CAAC;gBACrE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,wBAAwB,CAAC;gBAC3D,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,QAAQ,CAAC,cAAc,EAAE,QAAQ,CAAC,EAAE;gBACtF,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kCAAkC,CAAC,CAAC;gBAClE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,YAAY,CAAC;gBAC/C,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,wCAAwC,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;gBAClG,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,gCAAgC,CAAC,CAAC;gBAChE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,YAAY,CAAC;gBAC/C,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,QAAQ,CAAC,cAAc,EAAE,QAAQ,CAAC,EAAE;gBAC3F,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,kCAAkC,CAAC,CAAC;gBAClE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,YAAY,CAAC;gBAC/C,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sCAAsC,CAAC,eAAe,EAAE,QAAQ,CAAC,cAAc,CAAC,EAAE;gBAC1F,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,sEAAsE,CAAC,CAAC;gBACtG,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,kCAAkC,CAAC;gBACrE,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;YAED,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,4BAA4B,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;gBACtF,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qCAAqC,CAAC,CAAC;gBACrE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,YAAY,CAAC;gBAC/C,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;SACF;aAAM;YACL,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iDAAiD,CAAC,CAAC;SAChF;;QAGD,IAAI,CAAC,wCAAwC,IAAI,CAAC,qBAAqB,EAAE;YACvE,QAAQ,CAAC,mBAAmB,GAAG,IAAI,CAAC;YACpC,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,EAAE,CAAC;YACrC,IAAI,CAAC,0BAA0B,EAAE,CAAC;YAClC,IAAI,CAAC,4BAA4B,EAAE,CAAC;YACpC,OAAO,QAAQ,CAAC;SACjB;;QAGD,IAAI,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE;YACvC,MAAM,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,QAAQ,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;;YAG1F,IAAI,qBAAqB,IAAI,CAAE,QAAQ,CAAC,cAAc,CAAC,OAAkB,EAAE;gBACzE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mEAAmE,CAAC,CAAC;aAClG;iBAAM,IACL,CAAC,IAAI,CAAC,sBAAsB,CAAC,qBAAqB,CAChD,QAAQ,CAAC,WAAW,EACpB,QAAQ,CAAC,cAAc,CAAC,OAAO,EAC/B,aAAa,CAAC,GAAG;aAClB;gBACD,CAAC,QAAQ,CAAC,WAAW,EACrB;gBACA,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,sCAAsC,CAAC,CAAC;gBACtE,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,eAAe,CAAC;gBAClD,IAAI,CAAC,4BAA4B,EAAE,CAAC;gBACpC,OAAO,QAAQ,CAAC;aACjB;SACF;QAED,QAAQ,CAAC,mBAAmB,GAAG,IAAI,CAAC;QACpC,QAAQ,CAAC,KAAK,GAAG,gBAAgB,CAAC,EAAE,CAAC;QACrC,IAAI,CAAC,0BAA0B,EAAE,CAAC;QAClC,OAAO,QAAQ,CAAC;KACjB;IAEO,sCAAsC,CAAC,eAAgC,EAAE,UAAe;QAC9F,MAAM,EAAE,eAAe,EAAE,uCAAuC,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QACzH,IAAI,CAAC,eAAe,EAAE;YACpB,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,eAAe,CAAC,eAAe,EAAE;YACpC,OAAO,IAAI,CAAC;SACb;QACD,MAAM,cAAc,GAAG,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,eAAe,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;;;;;QAQ3G,IAAI,cAAc,CAAC,GAAG,KAAK,UAAU,CAAC,GAAG,EAAE;YACzC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qBAAqB,cAAc,CAAC,GAAG,IAAI,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;YACzF,OAAO,KAAK,CAAC;SACd;;;;QAID,IAAI,cAAc,CAAC,GAAG,KAAK,UAAU,CAAC,GAAG,EAAE;YACzC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qBAAqB,cAAc,CAAC,GAAG,IAAI,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;YACzF,OAAO,KAAK,CAAC;SACd;;QAED,IAAI,cAAc,CAAC,GAAG,KAAK,UAAU,CAAC,GAAG,EAAE;YACzC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qBAAqB,cAAc,CAAC,GAAG,IAAI,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;YACzF,OAAO,KAAK,CAAC;SACd;;QAGD,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,mCAAmC,CAAC,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,EAAE,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,GAAG,CAAC,EAAE;YACnG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,sCAAsC,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,GAAG,MAAM,UAAU,CAAC,GAAG,GAAG,CAAC,CAAC;YAC9G,OAAO,KAAK,CAAC;SACd;QAED,IAAI,uCAAuC,EAAE;YAC3C,OAAO,IAAI,CAAC;SACb;;;;QAKD,IAAI,cAAc,CAAC,SAAS,KAAK,UAAU,CAAC,SAAS,EAAE;YACrD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,2BAA2B,cAAc,CAAC,SAAS,IAAI,UAAU,CAAC,SAAS,EAAE,CAAC,CAAC;YAC3G,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;KACb;IAEO,0BAA0B;QAChC,MAAM,EAAE,iCAAiC,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClG,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;QAEtD,IAAI,iCAAiC,EAAE;YACrC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC;SAC9D;QACD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iDAAiD,CAAC,CAAC;KAChF;IAEO,4BAA4B;QAClC,MAAM,EAAE,iCAAiC,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClG,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;QAEtD,IAAI,iCAAiC,EAAE;YACrC,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,kBAAkB,EAAE,EAAE,CAAC,CAAC;SAC9D;QACD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,CAAC,CAAC;KACpE;;4FAnQU,sBAAsB;2DAAtB,sBAAsB,WAAtB,sBAAsB;+CAAtB,sBAAsB;cADlC,UAAU;;;MCAE,qCAAqC;IAChD,YACmB,aAA4B,EAC5B,sBAA8C,EAC9C,gBAAkC,EAClC,oBAA0C,EACxB,GAAQ;QAJ1B,kBAAa,GAAb,aAAa,CAAe;QAC5B,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,yBAAoB,GAApB,oBAAoB,CAAsB;QACxB,QAAG,GAAH,GAAG,CAAK;KACzC;;IAIJ,uBAAuB,CAAC,eAAgC;QACtD,MAAM,gBAAgB,GAAG,IAAI,CAAC,sBAAsB,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC;QAC9F,eAAe,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QAEpD,IAAI,gBAAgB,CAAC,mBAAmB,EAAE;YACxC,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,CAAC,gBAAgB,CAAC,WAAW,EAAE,eAAe,CAAC,UAAU,CAAC,CAAC;YACrG,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;SAC5B;aAAM;YACL,MAAM,YAAY,GAAG,oEAAoE,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YAClH,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;YAC5C,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;YACnD,IAAI,CAAC,wBAAwB,CAAC,eAAe,CAAC,gBAAgB,EAAE,eAAe,CAAC,cAAc,CAAC,CAAC;YAChG,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;KACF;IAEO,wBAAwB,CAAC,qBAA4C,EAAE,cAAuB;QACpG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC;YAC9C,kBAAkB,EAAE,eAAe,CAAC,YAAY;YAChD,gBAAgB,EAAE,qBAAqB,CAAC,KAAK;YAC7C,cAAc;SACf,CAAC,CAAC;KACJ;;0HAjCU,qCAAqC,kIAMtC,QAAQ;0EANP,qCAAqC,WAArC,qCAAqC;+CAArC,qCAAqC;cADjD,UAAU;;sBAON,MAAM;uBAAC,QAAQ;;;MCTP,oCAAoC;IAC/C,YACmB,aAA4B,EAC5B,gBAAkC,EAClC,gBAAkC;QAFlC,kBAAa,GAAb,aAAa,CAAe;QAC5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;KACjD;;IAGJ,+BAA+B;QAC7B,MAAM,SAAS,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;QAC9E,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8CAA8C,GAAG,SAAS,CAAC,CAAC;QACxF,MAAM,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC;QAC7D,MAAM,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC;QAEnD,IAAI,YAAY,EAAE;YAChB,MAAM,eAAe,GAAG;gBACtB,IAAI,EAAE,IAAI;gBACV,YAAY;gBACZ,KAAK,EAAE,SAAS;gBAChB,YAAY,EAAE,IAAI;gBAClB,UAAU,EAAE,IAAI;gBAChB,cAAc,EAAE,IAAI;gBACpB,OAAO,EAAE,IAAI;gBACb,gBAAgB,EAAE,IAAI;gBACtB,eAAe,EAAE,OAAO;aACzB,CAAC;YAEF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iEAAiE,CAAC,CAAC;;YAE/F,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,sBAAsB,CAAC,4BAA4B,CAAC,CAAC;YAEpF,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;SAC5B;aAAM;YACL,MAAM,YAAY,GAAG,sCAAsC,CAAC;YAC5D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;KACF;;wHArCU,oCAAoC;yEAApC,oCAAoC,WAApC,oCAAoC;+CAApC,oCAAoC;cADhD,UAAU;;;MCIE,kCAAkC;IAC7C,YACmB,UAAsB,EACtB,aAA4B,EAC5B,qBAA4C,EAC5C,WAAwB,EACxB,yBAAoD;QAJpD,eAAU,GAAV,UAAU,CAAY;QACtB,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,gBAAW,GAAX,WAAW,CAAa;QACxB,8BAAyB,GAAzB,yBAAyB,CAA2B;KACnE;;IAGJ,0BAA0B,CACxB,eAAgC,EAChC,mBAAkE;QAElE,IAAI,OAAO,GAAgB,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,mCAAmC,CAAC,CAAC;QAE3E,MAAM,aAAa,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACpF,MAAM,aAAa,GAAG,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,aAAa,CAAC;QACnD,IAAI,CAAC,aAAa,EAAE;YAClB,OAAO,UAAU,CAAC,4BAA4B,CAAC,CAAC;SACjD;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,yCAAyC,CAAC,eAAe,CAAC,YAAY,EAAE,mBAAmB,CAAC,CAAC;QAE1H,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,IAAI,CAC7D,SAAS,CAAC,CAAC,QAAa;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,EAAE,QAAQ,CAAC,CAAC;YAClE,IAAI,UAAU,GAAQ,IAAI,MAAM,EAAE,CAAC;YACnC,UAAU,GAAG,QAAQ,CAAC;YACtB,UAAU,CAAC,KAAK,GAAG,eAAe,CAAC,KAAK,CAAC;YAEzC,eAAe,CAAC,UAAU,GAAG,UAAU,CAAC;YACxC,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;SAC5B,CAAC,EACF,SAAS,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,EACpD,UAAU,CAAC,CAAC,KAAK;YACf,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YAC1E,MAAM,YAAY,GAAG,4BAA4B,SAAS,EAAE,CAAC;YAC7D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;IAEO,kBAAkB,CAAC,MAAuB;QAChD,OAAO,MAAM,CAAC,IAAI,CAChB,QAAQ,CAAC,CAAC,KAAK;;YAEb,IAAI,KAAK,IAAI,KAAK,YAAY,iBAAiB,IAAI,KAAK,CAAC,KAAK,YAAY,aAAa,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,OAAO,EAAE;gBACvH,MAAM,EAAE,SAAS,EAAE,0BAA0B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;gBACtG,MAAM,YAAY,GAAG,4BAA4B,SAAS,2BAA2B,CAAC;gBACtF,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACnD,OAAO,KAAK,CAAC,0BAA0B,GAAG,IAAI,CAAC,CAAC;aACjD;YACD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;;oHA1DU,kCAAkC;uEAAlC,kCAAkC,WAAlC,kCAAkC;+CAAlC,kCAAkC;cAD9C,UAAU;;;MCEE,YAAY;IACvB,YACmB,8BAA8D,EAC9D,kCAAsE,EACtE,oCAA0E,EAC1E,kBAA8C,EAC9C,qCAA4E,EAC5E,oCAA0E,EAC1E,kCAAsE;QANtE,mCAA8B,GAA9B,8BAA8B,CAAgC;QAC9D,uCAAkC,GAAlC,kCAAkC,CAAoC;QACtE,yCAAoC,GAApC,oCAAoC,CAAsC;QAC1E,uBAAkB,GAAlB,kBAAkB,CAA4B;QAC9C,0CAAqC,GAArC,qCAAqC,CAAuC;QAC5E,yCAAoC,GAApC,oCAAoC,CAAsC;QAC1E,uCAAkC,GAAlC,kCAAkC,CAAoC;KACrF;IAEJ,uBAAuB,CAAC,UAAkB;QACxC,OAAO,IAAI,CAAC,8BAA8B,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,IAAI,CAC1E,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,8BAA8B,CAAC,mBAAmB,CAAC,eAAe,CAAC,CAAC,EACxG,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,oCAAoC,CAAC,8BAA8B,CAAC,eAAe,CAAC,CAAC,EACzH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,qCAAqC,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC,EACnH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CACtF,CAAC;KACH;IAED,kCAAkC,CAAC,YAA6B;QAC9D,OAAO,IAAI,CAAC,8BAA8B,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC,IAAI,CAC/E,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,oCAAoC,CAAC,8BAA8B,CAAC,eAAe,CAAC,CAAC,EACzH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,qCAAqC,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC,EACnH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CACtF,CAAC;KACH;IAED,2BAA2B,CAAC,IAAa;QACvC,OAAO,IAAI,CAAC,kCAAkC,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,IAAI,CAC5E,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,oCAAoC,CAAC,8BAA8B,CAAC,eAAe,CAAC,CAAC,EACzH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,qCAAqC,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC,EACnH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CACtF,CAAC;KACH;IAED,mBAAmB,CAAC,mBAAkE;QACpF,OAAO,IAAI,CAAC,oCAAoC,CAAC,+BAA+B,EAAE,CAAC,IAAI,CACrF,SAAS,CAAC,CAAC,eAAe,KACxB,IAAI,CAAC,kCAAkC,CAAC,0BAA0B,CAAC,eAAe,EAAE,mBAAmB,CAAC,CACzG,EACD,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,oCAAoC,CAAC,8BAA8B,CAAC,eAAe,CAAC,CAAC,EACzH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,qCAAqC,CAAC,uBAAuB,CAAC,eAAe,CAAC,CAAC,EACnH,SAAS,CAAC,CAAC,eAAe,KAAK,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CACtF,CAAC;KACH;;wEA7CU,YAAY;iDAAZ,YAAY,WAAZ,YAAY;+CAAZ,YAAY;cADxB,UAAU;;;MCRE,gBAAgB;IAG3B,YAAoB,IAAY;QAAZ,SAAI,GAAJ,IAAI,CAAQ;QAFhC,8BAAyB,GAAiB,IAAI,CAAC;KAEX;IAEpC,yBAAyB;QACvB,IAAI,IAAI,CAAC,yBAAyB,EAAE;YAClC,IAAI,CAAC,yBAAyB,CAAC,WAAW,EAAE,CAAC;YAC7C,IAAI,CAAC,yBAAyB,GAAG,IAAI,CAAC;SACvC;KACF;IAED,uBAAuB,CAAC,kBAA0B;QAChD,MAAM,kCAAkC,GAAG,kBAAkB,GAAG,IAAI,CAAC;QAErE,OAAO,IAAI,UAAU,CAAC,CAAC,UAAU;YAC/B,IAAI,UAAU,CAAC;YACf,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;gBAC1B,UAAU,GAAG,WAAW,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC,EAAE,kCAAkC,CAAC,CAAC;aAC5G,CAAC,CAAC;YAEH,OAAO;gBACL,aAAa,CAAC,UAAU,CAAC,CAAC;aAC3B,CAAC;SACH,CAAC,CAAC;KACJ;;gFAzBU,gBAAgB;qDAAhB,gBAAgB,WAAhB,gBAAgB,mBADH,MAAM;+CACnB,gBAAgB;cAD5B,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCOrB,2BAA2B;IACtC,YACU,YAA0B,EAC1B,qBAA4C,EAC5C,MAAc,EACd,gBAAkC,EAClC,eAAiC;QAJjC,iBAAY,GAAZ,YAAY,CAAc;QAC1B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,WAAM,GAAN,MAAM,CAAQ;QACd,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAkB;KACvC;IAEJ,8BAA8B,CAAC,IAAa;QAC1C,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;QACpE,MAAM,EAAE,+BAA+B,EAAE,cAAc,EAAE,iBAAiB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEnI,OAAO,IAAI,CAAC,YAAY,CAAC,2BAA2B,CAAC,IAAI,CAAC,CAAC,IAAI,CAC7D,GAAG,CAAC,CAAC,eAAe;YAClB,IAAI,CAAC,+BAA+B,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE;gBACvE,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;aAC3C;SACF,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;YAChD,IAAI,CAAC,eAAe,CAAC,yBAAyB,EAAE,CAAC;YACjD,IAAI,CAAC,+BAA+B,IAAI,CAAC,cAAc,EAAE;gBACvD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;aAC9C;YACD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;;sGA5BU,2BAA2B;gEAA3B,2BAA2B,WAA3B,2BAA2B,mBADd,MAAM;+CACnB,2BAA2B;cADvC,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCJrB,aAAa;IACxB,YAA+C,GAAQ,EAAU,aAA4B;QAA9C,QAAG,GAAH,GAAG,CAAK;QAAU,kBAAa,GAAb,aAAa,CAAe;KAAI;IAEjG,iBAAiB,CAAC,UAAkB;QAClC,MAAM,cAAc,GAAG,IAAI,CAAC,yBAAyB,CAAC,UAAU,CAAC,CAAC;QAClE,IAAI,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,EAAE;YACxC,OAAO,cAAc,CAAC;SACvB;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,mBAAmB,CAAC,UAAU,CAAC,CAAC;QAC1D,IAAI,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,EAAE;YACtC,OAAO,YAAY,CAAC;SACrB;QACD,OAAO,IAAI,CAAC;KACb;IAED,qBAAqB,CAAC,UAAkB;QACtC,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACvD,aAAa,CAAC,EAAE,GAAG,UAAU,CAAC;QAC9B,aAAa,CAAC,KAAK,GAAG,UAAU,CAAC;QACjC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;QAC3C,aAAa,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QACrC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;QACzC,OAAO,aAAa,CAAC;KACtB;IAEO,yBAAyB,CAAC,UAAkB;QAClD,IAAI;YACF,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;YACtF,IAAI,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,EAAE;gBACvC,OAAO,aAAa,CAAC;aACtB;YACD,OAAO,IAAI,CAAC;SACb;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,IAAI,CAAC;SACb;KACF;IAEO,mBAAmB,CAAC,UAAkB;QAC5C,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QAC1D,IAAI,IAAI,CAAC,eAAe,CAAC,aAAa,CAAC,EAAE;YACvC,OAAO,aAAa,CAAC;SACtB;QACD,OAAO,IAAI,CAAC;KACb;IAEO,eAAe,CAAC,OAA2B;QACjD,OAAO,CAAC,CAAC,OAAO,IAAI,OAAO,YAAY,iBAAiB,CAAC;KAC1D;;0EAhDU,aAAa,WACJ,QAAQ;kDADjB,aAAa,WAAb,aAAa;+CAAb,aAAa;cADzB,UAAU;;sBAEI,MAAM;uBAAC,QAAQ;;;ACI9B,MAAM,mCAAmC,GAAG,yBAAyB,CAAC;AAEtE;MAGa,mBAAmB;IAa9B,YACU,yBAAoD,EACpD,aAA4B,EAC5B,aAA4B,EAC5B,YAAiC,EACjC,qBAA4C,EAC5C,IAAY;QALZ,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,kBAAa,GAAb,aAAa,CAAe;QAC5B,iBAAY,GAAZ,YAAY,CAAqB;QACjC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,SAAI,GAAJ,IAAI,CAAQ;QAlBd,yBAAoB,GAAG,KAAK,CAAC;QAE7B,sBAAiB,GAAG,CAAC,CAAC;QACtB,wBAAmB,GAAG,CAAC,CAAC;QACxB,sBAAiB,GAAG,IAAI,CAAC;QACzB,0BAAqB,GAAG,KAAK,CAAC;QAC9B,iCAA4B,GAAG,IAAI,eAAe,CAAU,KAAK,CAAC,CAAC;KAavE;IAXJ,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,4BAA4B,CAAC,YAAY,EAAE,CAAC;KACzD;IAWD,wBAAwB;QACtB,MAAM,EAAE,iBAAiB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClF,OAAO,iBAAiB,CAAC;KAC1B;IAED,KAAK;QACH,IAAI,CAAC,CAAC,IAAI,CAAC,yBAAyB,EAAE;YACpC,OAAO;SACR;QAED,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QACzE,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;KAClC;IAED,IAAI;QACF,IAAI,CAAC,IAAI,CAAC,yBAAyB,EAAE;YACnC,OAAO;SACR;QAED,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;KACnC;IAED,kBAAkB;QAChB,MAAM,EAAE,iBAAiB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClF,OAAO,iBAAiB,IAAI,IAAI,CAAC,oBAAoB,CAAC;KACvD;IAED,iBAAiB;QACf,OAAO,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,mCAAmC,CAAC,CAAC;KAClF;IAEO,IAAI;QACV,IAAI,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,GAAG,EAAE,EAAE;YACpE,OAAO,EAAE,CAAC,SAAS,CAAC,CAAC;SACtB;QAED,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAE7F,IAAI,CAAC,sBAAsB,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,qEAAqE,CAAC,CAAC;YACrG,OAAO,EAAE,EAAE,CAAC;SACb;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAChD,MAAM,kBAAkB,GAAG,sBAAsB,CAAC,kBAAkB,CAAC;QAErE,IAAI,kBAAkB,EAAE;YACtB,cAAc,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;SACnE;aAAM;YACL,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,iEAAiE,CAAC,CAAC;SAClG;QAED,OAAO,IAAI,UAAU,CAAC,CAAC,QAAQ;YAC7B,cAAc,CAAC,MAAM,GAAG;gBACtB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;gBACpC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBAChB,QAAQ,CAAC,QAAQ,EAAE,CAAC;aACrB,CAAC;SACH,CAAC,CAAC;KACJ;IAEO,iBAAiB,CAAC,QAAgB;QACxC,IAAI,CAAC,mBAAmB,GAAG,CAAC,CAAC;QAC7B,MAAM,sBAAsB,GAAG;YAC7B,IAAI,CAAC,IAAI,EAAE;iBACR,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;iBACb,SAAS,CAAC;;gBACT,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;gBAChD,IAAI,cAAc,IAAI,QAAQ,EAAE;oBAC9B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;oBAC5C,MAAM,YAAY,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;oBAC1E,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;oBAE7F,IAAI,YAAY,KAAI,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,kBAAkB,CAAA,EAAE;wBAC9D,MAAM,YAAY,SAAG,IAAI,GAAG,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,0CAAE,MAAM,CAAC;wBAChF,IAAI,CAAC,mBAAmB,EAAE,CAAC;wBAC3B,cAAc,CAAC,aAAa,CAAC,WAAW,CAAC,QAAQ,GAAG,GAAG,GAAG,YAAY,EAAE,YAAY,CAAC,CAAC;qBACvF;yBAAM;wBACL,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gEAAgE,YAAY,GAAG,CAAC,CAAC;wBAC7G,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8BAA8B,IAAI,CAAC,SAAS,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;wBACrG,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;qBAC9C;iBACF;qBAAM;oBACL,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,+EAA+E,CAAC,CAAC;oBAC/G,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;oBACtC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;iBAC7C;;gBAGD,IAAI,IAAI,CAAC,mBAAmB,GAAG,CAAC,EAAE;oBAChC,IAAI,CAAC,aAAa,CAAC,QAAQ,CACzB;oDACsC,IAAI,CAAC,mBAAmB,uBAAuB,CACtF,CAAC;iBACH;gBAED,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC;oBAC1B,IAAI,CAAC,yBAAyB,GAAG,UAAU,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,sBAAsB,CAAC,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;iBAClH,CAAC,CAAC;aACJ,CAAC,CAAC;SACN,CAAC;QAEF,sBAAsB,EAAE,CAAC;KAC1B;IAEO,uBAAuB;QAC7B,YAAY,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;QAC7C,IAAI,CAAC,yBAAyB,GAAG,IAAI,CAAC;KACvC;IAEO,cAAc,CAAC,CAAM;;QAC3B,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAChD,MAAM,sBAAsB,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAC7F,MAAM,UAAU,GAAG,CAAC,QAAC,sBAAsB,aAAtB,sBAAsB,uBAAtB,sBAAsB,CAAE,kBAAkB,0CAAE,UAAU,CAAC,CAAC,CAAC,MAAM,EAAC,CAAC;QACtF,IAAI,CAAC,mBAAmB,GAAG,CAAC,CAAC;QAC7B,IAAI,cAAc,IAAI,UAAU,IAAI,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,aAAa,EAAE;YAC7E,IAAI,CAAC,CAAC,IAAI,KAAK,OAAO,EAAE;gBACtB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,wCAAwC,CAAC,CAAC;aACzE;iBAAM,IAAI,CAAC,CAAC,IAAI,KAAK,SAAS,EAAE;gBAC/B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;gBACjC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,oBAAoB,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;gBACrE,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC9C;iBAAM;gBACL,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU,CAAC,oBAAoB,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;gBACrE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,GAAG,mCAAmC,CAAC,CAAC;aAC3E;SACF;KACF;IAEO,wBAAwB;QAC9B,MAAM,kBAAkB,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1D,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,kBAAkB,EAAE,KAAK,CAAC,CAAC;KAC/D;IAEO,iBAAiB;QACvB,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEhD,IAAI,CAAC,cAAc,EAAE;YACnB,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,mCAAmC,CAAC,CAAC;YAC5F,IAAI,CAAC,wBAAwB,EAAE,CAAC;YAChC,OAAO,KAAK,CAAC;SACd;QAED,OAAO,cAAc,CAAC;KACvB;;sFAxKU,mBAAmB;wDAAnB,mBAAmB,WAAnB,mBAAmB;+CAAnB,mBAAmB;cAD/B,UAAU;;;ACIX,MAAM,kCAAkC,GAAG,wBAAwB,CAAC;MAGvD,kBAAkB;IAO7B,YACU,qBAA4C,EAC5C,aAA4B,EAC5B,YAA0B,EAC1B,oBAA0C,EAC1C,gBAAkC,EAClC,gBAAkC,EAClC,aAA4B,EAC5B,UAAsB,EACtB,2BAAwD,EACxD,eAAiC;QATjC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kBAAa,GAAb,aAAa,CAAe;QAC5B,iBAAY,GAAZ,YAAY,CAAc;QAC1B,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,kBAAa,GAAb,aAAa,CAAe;QAC5B,eAAU,GAAV,UAAU,CAAY;QACtB,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,oBAAe,GAAf,eAAe,CAAkB;QAhBnC,+CAA0C,GAAG,IAAI,OAAO,EAAmB,CAAC;KAiBhF;IAfJ,IAAI,kCAAkC;QACpC,OAAO,IAAI,CAAC,0CAA0C,CAAC,YAAY,EAAE,CAAC;KACvE;IAeD,iBAAiB;QACf,MAAM,cAAc,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAEhD,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO,IAAI,CAAC,aAAa,CAAC,qBAAqB,CAAC,kCAAkC,CAAC,CAAC;SACrF;QAED,OAAO,cAAc,CAAC;KACvB;IAED,uBAAuB;QACrB,MAAM,EAAE,eAAe,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAC7F,OAAO,CAAC,eAAe,IAAI,WAAW,CAAC;KACxC;IAED,iCAAiC,CAAC,QAAQ;QACxC,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC;YAC5B,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;SACxB,CAAC,CAAC;QAEH,MAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAElC,IAAI,KAAK,EAAE;YACT,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,CAAC;gBAC9C,kBAAkB,EAAE,eAAe,CAAC,YAAY;gBAChD,gBAAgB,EAAE,gBAAgB,CAAC,aAAa;gBAChD,cAAc,EAAE,IAAI;aACrB,CAAC,CAAC;YACH,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;YACnD,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;YACnC,IAAI,CAAC,eAAe,CAAC,yBAAyB,EAAE,CAAC;YACjD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B;QAED,MAAM,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QAClC,MAAM,YAAY,GAAG,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;QAEjD,MAAM,eAAe,GAAG;YACtB,IAAI;YACJ,YAAY,EAAE,IAAI;YAClB,KAAK;YACL,YAAY;YACZ,UAAU,EAAE,IAAI;YAChB,cAAc,EAAE,IAAI;YACpB,OAAO,EAAE,IAAI;YACb,gBAAgB,EAAE,IAAI;YACtB,eAAe,EAAE,IAAI;SACtB,CAAC;QAEF,OAAO,IAAI,CAAC,YAAY,CAAC,kCAAkC,CAAC,eAAe,CAAC,CAAC,IAAI,CAC/E,UAAU,CAAC,CAAC,aAAa;YACvB,IAAI,CAAC,eAAe,CAAC,yBAAyB,EAAE,CAAC;YACjD,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;YACnD,OAAO,UAAU,CAAC,aAAa,CAAC,CAAC;SAClC,CAAC,CACH,CAAC;KACH;IAED,uBAAuB,CAAC,CAAc;QACpC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yBAAyB,CAAC,CAAC;QACvD,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE;YACb,OAAO;SACR;QAED,IAAI,SAAS,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;QAEzB,MAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,CAAC;QAE3D,IAAI,UAAU,EAAE;YACd,MAAM,QAAQ,GAAG,CAAC,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAChD,SAAS,GAAG,IAAI,CAAC,iCAAiC,CAAC,QAAQ,CAAC,CAAC;SAC9D;aAAM;YACL,SAAS,GAAG,IAAI,CAAC,2BAA2B,CAAC,8BAA8B,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;SACvF;QAED,SAAS,CAAC,SAAS,CACjB,CAAC,eAAe;YACd,IAAI,CAAC,0CAA0C,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACtE,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;SACjD,EACD,CAAC,GAAQ;YACP,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC;YAC7C,IAAI,CAAC,0CAA0C,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC3D,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;SACjD,CACF,CAAC;KACH;IAEO,iBAAiB;QACvB,OAAO,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,kCAAkC,CAAC,CAAC;KACjF;;oFA/GU,kBAAkB;uDAAlB,kBAAkB,WAAlB,kBAAkB;+CAAlB,kBAAkB;cAD9B,UAAU;;;MCVE,uBAAuB;IAClC,YACU,YAA0B,EAC1B,gBAAkC,EAClC,gBAAkC,EAClC,qBAA4C,EAC5C,MAAc;QAJd,iBAAY,GAAZ,YAAY,CAAc;QAC1B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,WAAM,GAAN,MAAM,CAAQ;KACpB;IAEJ,0BAA0B,CAAC,UAAkB;QAC3C,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;QACpE,MAAM,EAAE,+BAA+B,EAAE,cAAc,EAAE,iBAAiB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEnI,OAAO,IAAI,CAAC,YAAY,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC,IAAI,CAC/D,GAAG,CAAC,CAAC,eAAe;YAClB,IAAI,CAAC,+BAA+B,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE;gBACvE,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;aAC3C;SACF,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;YAChD,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;YAClD,IAAI,CAAC,+BAA+B,IAAI,CAAC,cAAc,EAAE;gBACvD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;aAC9C;YACD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;;8FA5BU,uBAAuB;4DAAvB,uBAAuB,WAAvB,uBAAuB,mBADV,MAAM;+CACnB,uBAAuB;cADnC,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCCrB,eAAe;IAO1B,YACU,UAAsB,EACtB,UAAsB,EACtB,2BAAwD,EACxD,uBAAgD;QAHhD,eAAU,GAAV,UAAU,CAAY;QACtB,eAAU,GAAV,UAAU,CAAY;QACtB,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,4BAAuB,GAAvB,uBAAuB,CAAyB;QAVlD,yBAAoB,GAAG,IAAI,OAAO,EAAE,CAAC;KAWzC;IATJ,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,oBAAoB,CAAC,YAAY,EAAE,CAAC;KACjD;IASD,UAAU,CAAC,UAAkB;QAC3B,OAAO,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,UAAU,CAAC,CAAC;KACtD;IAED,2BAA2B,CAAC,kBAA0B;QACpD,IAAI,SAA0B,CAAC;QAE/B,IAAI,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,EAAE;YAC3C,SAAS,GAAG,IAAI,CAAC,uBAAuB,CAAC,0BAA0B,CAAC,kBAAkB,CAAC,CAAC;SACzF;aAAM,IAAI,IAAI,CAAC,UAAU,CAAC,4BAA4B,EAAE,EAAE;YACzD,SAAS,GAAG,IAAI,CAAC,2BAA2B,CAAC,8BAA8B,EAAE,CAAC;SAC/E;QAED,OAAO,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;KACpE;;8EA5BU,eAAe;oDAAf,eAAe,WAAf,eAAe,mBADF,MAAM;+CACnB,eAAe;cAD3B,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;ACJlC,MAAM,iBAAiB,GAAG,mCAAmC,CAAC;MAGjD,wBAAwB;IACnC,YAA6B,IAAiB;QAAjB,SAAI,GAAJ,IAAI,CAAa;KAAI;IAElD,4BAA4B,CAAC,qBAA6B;QACxD,OAAO,IAAI,CAAC,oBAAoB,CAAC,qBAAqB,CAAC,CAAC,IAAI,CAC1D,GAAG,CACD,CAAC,kBAAkB,MAChB;YACC,MAAM,EAAE,kBAAkB,CAAC,MAAM;YACjC,OAAO,EAAE,kBAAkB,CAAC,QAAQ;YACpC,qBAAqB,EAAE,kBAAkB,CAAC,sBAAsB;YAChE,aAAa,EAAE,kBAAkB,CAAC,cAAc;YAChD,gBAAgB,EAAE,kBAAkB,CAAC,iBAAiB;YACtD,kBAAkB,EAAE,kBAAkB,CAAC,oBAAoB;YAC3D,kBAAkB,EAAE,kBAAkB,CAAC,oBAAoB;YAC3D,kBAAkB,EAAE,kBAAkB,CAAC,mBAAmB;YAC1D,qBAAqB,EAAE,kBAAkB,CAAC,sBAAsB;YAChE,WAAW,EAAE,kBAAkB,CAAC,qCAAqC;SAC3C,CAAA,CAC/B,CACF,CAAC;KACH;IAEO,oBAAoB,CAAC,iBAAyB;QACpD,IAAI,GAAG,GAAG,iBAAiB,CAAC;QAE5B,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,iBAAiB,CAAC,EAAE;YAClD,GAAG,GAAG,GAAG,iBAAiB,GAAG,iBAAiB,EAAE,CAAC;SAClD;QAED,OAAO,IAAI,CAAC,IAAI,CAAC,GAAG,CAAM,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;KAC/C;;gGA/BU,wBAAwB;6DAAxB,wBAAwB,WAAxB,wBAAwB;+CAAxB,wBAAwB;cADpC,UAAU;;;MCIE,oBAAoB;IAC/B,YACU,mBAAwC,EACxC,WAAqC,EACrC,yBAAoD;QAFpD,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,gBAAW,GAAX,WAAW,CAA0B;QACrC,8BAAyB,GAAzB,yBAAyB,CAA2B;KAC1D;IAEJ,yBAAyB,CAAC,wBAAgC;QACxD,MAAM,8BAA8B,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACrG,IAAI,CAAC,CAAC,8BAA8B,EAAE;YACpC,OAAO,EAAE,CAAC,8BAA8B,CAAC,CAAC;SAC3C;QAED,OAAO,IAAI,CAAC,4BAA4B,CAAC,wBAAwB,CAAC,CAAC,IAAI,CACrE,GAAG,CAAC,CAAC,wBAAwB,KAAK,IAAI,CAAC,uBAAuB,CAAC,wBAAwB,CAAC,CAAC,EACzF,UAAU,CAAC,CAAC,KAAK;YACf,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC;YAC9F,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;IAED,uBAAuB,CAAC,wBAAgD;QACtE,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,wBAAwB,EAAE,wBAAwB,CAAC,CAAC;KAC1F;IAEO,4BAA4B,CAAC,qBAA6B;QAChE,OAAO,IAAI,CAAC,WAAW,CAAC,4BAA4B,CAAC,qBAAqB,CAAC,CAAC;KAC7E;;wFA5BU,oBAAoB;yDAApB,oBAAoB,WAApB,oBAAoB;+CAApB,oBAAoB;cADhC,UAAU;;;MCFE,2BAA2B;IAGtC,YACqC,GAAQ,EACnC,aAA4B,EAC5B,UAAsB,EACtB,kBAAsC,EAC9C,eAAiC;QAJE,QAAG,GAAH,GAAG,CAAK;QACnC,kBAAa,GAAb,aAAa,CAAe;QAC5B,eAAU,GAAV,UAAU,CAAY;QACtB,uBAAkB,GAAlB,kBAAkB,CAAoB;QAG9C,IAAI,CAAC,QAAQ,GAAG,eAAe,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;KAC5D;IAED,wBAAwB,CAAC,YAA2D;QAClF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,8CAA8C,CAAC,CAAC;QAC5E,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,+BAA+B,CAAC,YAAY,CAAC,CAAC;QAC1E,OAAO,IAAI,CAAC,oCAAoC,CAAC,GAAG,CAAC,CAAC;KACvD;IAEO,oCAAoC,CAAC,GAAW;QACtD,MAAM,aAAa,GAAG,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,EAAE,CAAC;QAClE,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC9B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+CAA+C,GAAG,GAAG,CAAC,CAAC;QAEnF,OAAO,IAAI,UAAU,CAAC,CAAC,QAAQ;YAC7B,MAAM,aAAa,GAAG;gBACpB,aAAa,CAAC,mBAAmB,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;gBACzD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oCAAoC,CAAC,CAAC;gBAClE,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpB,QAAQ,CAAC,QAAQ,EAAE,CAAC;aACrB,CAAC;YACF,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;YACtD,aAAa,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;SACnD,CAAC,CAAC;KACJ;IAEO,sBAAsB;QAC5B,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;QAEjC,MAAM,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,wBAAwB,EAAE,CAAC,CAAc;YACjG,IAAI,CAAC,CAAC,MAAM,KAAK,UAAU,EAAE;gBAC3B,kBAAkB,EAAE,CAAC;gBACrB,mBAAmB,EAAE,CAAC;aACvB;SACF,CAAC,CAAC;QACH,MAAM,mBAAmB,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,2BAA2B,EAAE,CAAC,CAAC,KACxF,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,CAAC,CAAC,CAAC,CACnD,CAAC;QAEF,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,aAAa,CAChC,IAAI,WAAW,CAAC,wBAAwB,EAAE;YACxC,MAAM,EAAE,UAAU;SACnB,CAAC,CACH,CAAC;KACH;;sGAtDU,2BAA2B,WAI5B,QAAQ;gEAJP,2BAA2B,WAA3B,2BAA2B,mBADd,MAAM;+CACnB,2BAA2B;cADvC,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;sBAK7B,MAAM;uBAAC,QAAQ;;;MCFP,iCAAiC;IAC5C,YACU,aAA4B,EAC5B,oBAA0C,EAC1C,YAA0B,EAC1B,eAAiC;QAHjC,kBAAa,GAAb,aAAa,CAAe;QAC5B,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,iBAAY,GAAZ,YAAY,CAAc;QAC1B,oBAAe,GAAf,eAAe,CAAkB;KACvC;IAEJ,+BAA+B,CAAC,mBAAkE;QAChG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,CAAC,CAAC;QAE/D,OAAO,IAAI,CAAC,YAAY,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,CAAC,IAAI,CACpE,UAAU,CAAC,CAAC,KAAK;YACf,IAAI,CAAC,eAAe,CAAC,yBAAyB,EAAE,CAAC;YACjD,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;YACnD,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;SAC1B,CAAC,CACH,CAAC;KACH;;kHAlBU,iCAAiC;sEAAjC,iCAAiC,WAAjC,iCAAiC,mBADpB,MAAM;+CACnB,iCAAiC;cAD7C,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;ACM3B,MAAM,kBAAkB,GAAG,CAAC,CAAC;MAEvB,qBAAqB;IAChC,YACU,UAAsB,EACtB,qBAA4C,EAC5C,gBAAkC,EAClC,aAA4B,EAC5B,kBAAsC,EACtC,gBAAkC,EAClC,oBAA0C,EAC1C,2BAAwD,EACxD,iCAAoE;QARpE,eAAU,GAAV,UAAU,CAAY;QACtB,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,kBAAa,GAAb,aAAa,CAAe;QAC5B,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,sCAAiC,GAAjC,iCAAiC,CAAmC;KAC1E;IAEJ,mBAAmB,CAAC,iBAAgE;QAClF,IAAI,IAAI,CAAC,UAAU,CAAC,sCAAsC,EAAE,EAAE;YAC5D,MAAM,EAAE,wBAAwB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YACzF,MAAM,YAAY,mCAAQ,iBAAiB,GAAK,wBAAwB,CAAE,CAAC;YAC3E,OAAO,IAAI,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC,IAAI,CAChD,GAAG,CAAC;gBACF,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;gBAC1E,IAAI,eAAe,EAAE;oBACnB,OAAO;wBACL,OAAO,EAAE,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE;wBAC3C,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE;qBACpD,CAAC;iBACH;gBAED,OAAO,IAAI,CAAC;aACb,CAAC,CACH,CAAC;SACH;QAED,MAAM,EAAE,2BAA2B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAC5F,MAAM,WAAW,GAAG,2BAA2B,GAAG,IAAI,CAAC;QAEvD,OAAO,QAAQ,CAAC;YACd,IAAI,CAAC,mBAAmB,CAAC,iBAAiB,CAAC;YAC3C,IAAI,CAAC,kBAAkB,CAAC,kCAAkC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;SACzE,CAAC,CAAC,IAAI,CACL,OAAO,CAAC,WAAW,CAAC,EACpB,SAAS,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,EAC/C,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,eAAe,CAAC;;YACvB,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;YAC1E,IAAI,eAAe,EAAE;gBACnB,OAAO;oBACL,OAAO,QAAE,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,UAAU,0CAAE,QAAQ;oBAC9C,WAAW,QAAE,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,UAAU,0CAAE,YAAY;iBACvD,CAAC;aACH;YAED,OAAO,IAAI,CAAC;SACb,CAAC,CACH,CAAC;KACH;IAEO,mBAAmB,CAAC,iBAE3B;QACC,MAAM,oBAAoB,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;QAC1E,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,oBAAoB,EAAE,CAAC,CAAC;QACrF,MAAM,gBAAgB,GAAG,CAAC,oBAAoB,CAAC;QAE/C,IAAI,CAAC,gBAAgB,EAAE;YACrB,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;SACjB;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,IAAI,EAAE,CAAC;QAE5F,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,CAAC,CAAC;YAC/D,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;SACjB;QAED,OAAO,IAAI,CAAC,oBAAoB,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,CAAC,IAAI,CACpF,SAAS,CAAC;YACR,IAAI,CAAC,gBAAgB,CAAC,qBAAqB,EAAE,CAAC;YAE9C,IAAI,IAAI,CAAC,UAAU,CAAC,sCAAsC,EAAE,EAAE;;gBAE5D,OAAO,IAAI,CAAC,iCAAiC,CAAC,+BAA+B,CAAC,iBAAiB,CAAC,CAAC;aAClG;YAED,OAAO,IAAI,CAAC,2BAA2B,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC;SACrF,CAAC,CACH,CAAC;KACH;IAEO,oBAAoB,CAAC,aAA8B;QACzD,OAAO,aAAa,CAAC,IAAI,CACvB,QAAQ,CAAC,CAAC,KAAK,EAAE,KAAK;YACpB,MAAM,eAAe,GAAG,IAAI,CAAC;YAC7B,MAAM,cAAc,GAAG,KAAK,GAAG,CAAC,CAAC;YAEjC,IAAI,EAAE,KAAK,YAAY,YAAY,CAAC,IAAI,cAAc,GAAG,kBAAkB,EAAE;gBAC3E,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;aAC1B;YAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,cAAc,EAAE,CAAC,CAAC;YAEvF,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;YAChD,OAAO,KAAK,CAAC,cAAc,GAAG,eAAe,CAAC,CAAC;SAChD,CAAC,CACH,CAAC;KACH;;0FAvGU,qBAAqB;0DAArB,qBAAqB,WAArB,qBAAqB,mBADR,MAAM;+CACnB,qBAAqB;cADjC,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCArB,6BAA6B;IACxC,YACU,oBAA0C,EAC1C,UAAsB,EACtB,qBAA4C,EAC5C,gBAAkC,EAClC,aAA4B,EAC5B,WAAwB,EACxB,gBAAkC,EAClC,2BAAwD,EACxD,iCAAoE,EACpE,eAAiC,EACjC,yBAAoD;QAVpD,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,eAAU,GAAV,UAAU,CAAY;QACtB,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,kBAAa,GAAb,aAAa,CAAe;QAC5B,gBAAW,GAAX,WAAW,CAAa;QACxB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,sCAAiC,GAAjC,iCAAiC,CAAmC;QACpE,oBAAe,GAAf,eAAe,CAAkB;QACjC,8BAAyB,GAAzB,yBAAyB,CAA2B;KAC1D;IAEJ,gCAAgC,CAAC,kBAA0B;QACzD,MAAM,EAAE,WAAW,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE5E,IAAI,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,yBAAyB,IAAI,CAAC,WAAW,EAAE;YACpE,OAAO;SACR;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,kBAAkB,GAAG,CAAC,CAAC;QAE5F,MAAM,kBAAkB,GAAG,IAAI,CAAC,eAAe,CAAC,uBAAuB,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAC9F,SAAS,CAAC;YACR,MAAM,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC;YACnD,MAAM,oBAAoB,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;YAC1E,MAAM,iBAAiB,GAAG,IAAI,CAAC,WAAW,CAAC,oBAAoB,EAAE,CAAC;YAElE,IAAI,CAAC,aAAa,CAAC,QAAQ,CACzB,iCAAiC,oBAAoB,cAAc,CAAC,CAAC,OAAO,cAAc,CAAC,CAAC,iBAAiB,EAAE,CAChH,CAAC;YAEF,MAAM,gBAAgB,GAAG,iBAAiB,IAAI,CAAC,oBAAoB,IAAI,OAAO,CAAC;YAE/E,IAAI,CAAC,gBAAgB,EAAE;gBACrB,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,MAAM,iBAAiB,GAAG,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,EAAE,CAAC;YACpE,MAAM,qBAAqB,GAAG,IAAI,CAAC,gBAAgB,CAAC,mCAAmC,EAAE,CAAC;YAE1F,IAAI,CAAC,iBAAiB,IAAI,CAAC,qBAAqB,EAAE;gBAChD,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,MAAM,MAAM,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;YAEnE,IAAI,EAAC,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,WAAW,CAAA,EAAE;gBACxB,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;gBACnD,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;aACjB;YAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,CAAC,CAAC;YAExD,IAAI,CAAC,gBAAgB,CAAC,qBAAqB,EAAE,CAAC;YAE9C,IAAI,IAAI,CAAC,UAAU,CAAC,sCAAsC,EAAE,EAAE;;gBAE5D,MAAM,mBAAmB,GACvB,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,4BAA4B,CAAC,IAAI,EAAE,CAAC;gBAE1E,MAAM,EAAE,wBAAwB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;gBAEzF,MAAM,YAAY,mCAAQ,mBAAmB,GAAK,wBAAwB,CAAE,CAAC;;gBAG7E,OAAO,IAAI,CAAC,iCAAiC,CAAC,+BAA+B,CAAC,YAAY,CAAC,CAAC;aAC7F;;YAGD,MAAM,YAAY,GAAiD,IAAI,CAAC,yBAAyB,CAAC,IAAI,CACpG,4BAA4B,CAC7B,CAAC;YAEF,OAAO,IAAI,CAAC,2BAA2B,CAAC,wBAAwB,CAAC,YAAY,CAAC,CAAC;SAChF,CAAC,CACH,CAAC;QAEF,IAAI,CAAC,eAAe,CAAC,yBAAyB,GAAG,kBAAkB;aAChE,IAAI,CACH,UAAU,CAAC;YACT,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;YAChD,OAAO,UAAU,CAAC,2BAA2B,CAAC,CAAC;SAChD,CAAC,CACH;aACA,SAAS,CACR;YACE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wCAAwC,CAAC,CAAC;YACtE,IAAI,IAAI,CAAC,UAAU,CAAC,sCAAsC,EAAE,EAAE;gBAC5D,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,EAAE,CAAC;aACjD;SACF,EACD,CAAC,GAAG;YACF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,sBAAsB,EAAE,GAAG,CAAC,CAAC;SAC1D,CACF,CAAC;KACL;;0GAlGU,6BAA6B;kEAA7B,6BAA6B,WAA7B,6BAA6B,mBADhB,MAAM;+CACnB,6BAA6B;cADzC,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCTrB,YAAY;IADzB;QAEU,uBAAkB,GAAG,WAAW,CAAC;QAGjC,oBAAe,GAAG,IAAI,OAAO,EAAe,CAAC;KAoEtD;IAlEC,IAAI,OAAO;QACT,OAAO,IAAI,CAAC,eAAe,CAAC,YAAY,EAAE,CAAC;KAC5C;IAED,kBAAkB;QAChB,MAAM,KAAK,GAAG,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC9D,OAAO,CAAC,CAAC,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM,IAAI,CAAC,CAAC,KAAK,CAAC;KAC/D;IAED,SAAS,CAAC,GAAW,EAAE,YAA2B;QAChD,MAAM,aAAa,GAAG,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;QACpD,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC;QACvD,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;QAEnE,MAAM,QAAQ,GAAG,CAAC,KAAmB;YACnC,IAAI,EAAC,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,IAAI,CAAA,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;gBAClD,OAAO;aACR;YAED,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;YAE1E,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACxB,CAAC;QAEF,MAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QAEpD,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC;YAC/B,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;gBACrB,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC;gBAEhD,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;aACxB;SACF,EAAE,GAAG,CAAC,CAAC;KACT;IAED,uBAAuB,CAAC,GAAW;QACjC,IAAI,MAAM,CAAC,MAAM,EAAE;YACjB,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SAC7C;KACF;IAEO,OAAO,CAAC,QAAa;;QAC3B,MAAM,CAAC,mBAAmB,CAAC,SAAS,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;QAEvD,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAElC,IAAI,IAAI,CAAC,KAAK,EAAE;YACd,MAAA,IAAI,CAAC,KAAK,CAAC,cAAc,0CAAE,UAAU,CAAC,IAAI,CAAC,kBAAkB,EAAE;YAC/D,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;YACnB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;SACnB;KACF;IAEO,WAAW,CAAC,GAAW,EAAE,IAAY;QAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;KACtC;IAEO,UAAU,CAAC,YAA2B;QAC5C,MAAM,mBAAmB,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,CAAC;QAE3E,MAAM,OAAO,mCAAQ,mBAAmB,IAAM,YAAY,IAAI,EAAE,EAAG,CAAC;QAEpE,OAAO,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC;aAC3B,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,KAAK,GAAG,kBAAkB,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,KAAK,CAAC,EAAE,CAAC;aAChF,IAAI,CAAC,GAAG,CAAC,CAAC;KACd;;wEAvEU,YAAY;iDAAZ,YAAY,WAAZ,YAAY,mBADC,MAAM;+CACnB,YAAY;cADxB,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCarB,gBAAgB;IAC3B,YACqC,GAAQ,EACnC,mBAAwC,EACxC,kBAAsC,EACtC,WAAwB,EACxB,aAA4B,EAC5B,qBAA4C,EAC5C,gBAAkC,EAClC,eAAgC,EAChC,qBAA4C,EAC5C,6BAA4D,EAC5D,YAA0B,EAC1B,gBAAkC,EAClC,MAAc;QAZa,QAAG,GAAH,GAAG,CAAK;QACnC,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,gBAAW,GAAX,WAAW,CAAa;QACxB,kBAAa,GAAb,aAAa,CAAe;QAC5B,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAChC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,iBAAY,GAAZ,YAAY,CAAc;QAC1B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,WAAM,GAAN,MAAM,CAAQ;KACpB;IAEJ,SAAS,CAAC,GAAY;QACpB,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,EAAE;YAChD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,6DAA6D,CAAC,CAAC;YAC3F,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC;SAClB;QAED,MAAM,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE1E,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;QAEvD,MAAM,UAAU,GAAG,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;QAEnE,IAAI,IAAI,CAAC,YAAY,CAAC,kBAAkB,EAAE,EAAE;YAC1C,IAAI,CAAC,YAAY,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC;YACtD,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;SACjB;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAE/D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,EAAE,UAAU,CAAC,CAAC;QAE3E,MAAM,SAAS,GAAG,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,2BAA2B,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;QAEvG,OAAO,SAAS,CAAC,IAAI,CACnB,GAAG,CAAC;YACF,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;YAC1E,IAAI,eAAe,EAAE;gBACnB,IAAI,CAAC,8BAA8B,EAAE,CAAC;gBAEtC,IAAI,CAAC,UAAU,EAAE;oBACf,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;oBAClD,IAAI,CAAC,WAAW,CAAC,uBAAuB,EAAE,CAAC;iBAC5C;aACF;YAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0CAA0C,GAAG,eAAe,CAAC,CAAC;YAE1F,OAAO,eAAe,CAAC;SACxB,CAAC,EACF,GAAG,CAAC;YACF,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;YAE1E,IAAI,eAAe,EAAE;gBACnB,MAAM,qBAAqB,GAAG,IAAI,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,CAAC;gBAE7E,IAAI,qBAAqB,EAAE;oBACzB,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;oBAClD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;iBAClD;aACF;SACF,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACnC,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC;SAClB,CAAC,CACH,CAAC;KACH;IAED,wBAAwB;QACtB,OAAO,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAC1B,SAAS,CAAC,CAAC,eAAe;YACxB,IAAI,eAAe,EAAE;gBACnB,OAAO,EAAE,CAAC,eAAe,CAAC,CAAC;aAC5B;YAED,OAAO,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAC1D,GAAG,CAAC,CAAC,MAAM,KAAK,CAAC,EAAC,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,OAAO,CAAA,IAAI,CAAC,EAAC,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,WAAW,CAAA,CAAC,EAC3D,SAAS,CAAC,CAAC,MAAM;gBACf,IAAI,MAAM,EAAE;oBACV,IAAI,CAAC,8BAA8B,EAAE,CAAC;iBACvC;gBAED,OAAO,EAAE,CAAC,MAAM,CAAC,CAAC;aACnB,CAAC,CACH,CAAC;SACH,CAAC,CACH,CAAC;KACH;IAEO,8BAA8B;QACpC,IAAI,IAAI,CAAC,mBAAmB,CAAC,wBAAwB,EAAE,EAAE;YACvD,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;SAClC;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,6BAA6B,CAAC,gCAAgC,CAAC,qBAAqB,CAAC,CAAC;QAE3F,IAAI,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,EAAE,EAAE;YACrD,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,EAAE,CAAC;SAC7C;KACF;;gFA5GU,gBAAgB,WAEjB,QAAQ;qDAFP,gBAAgB,WAAhB,gBAAgB;+CAAhB,gBAAgB;cAD5B,UAAU;;sBAGN,MAAM;uBAAC,QAAQ;;;ACRb,MAAM,0BAA0B,GAAG;IACxC,MAAM,EAAE,IAAI;IACZ,QAAQ,EAAE,EAAE;IACZ,KAAK,EAAE,IAAI;CACZ;;ACbM,MAAM,cAAc,GAAG,CAAC,YAAiC;IAC9D,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE;QAC1B,OAAO;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,CAAC,wDAAwD,CAAC;YACpE,KAAK,EAAE,OAAO;SACf,CAAC;KACH;IAED,OAAO,0BAA0B,CAAC;AACpC,CAAC;;ACVM,MAAM,kBAAkB,GAAG,CAAC,YAAiC;IAClE,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE;QAC7B,OAAO;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,CAAC,0DAA0D,CAAC;YACtE,KAAK,EAAE,OAAO;SACf,CAAC;KACH;IAED,OAAO,0BAA0B,CAAC;AACpC,CAAC;;ACVM,MAAM,0CAA0C,GAAG,CAAC,YAAiC;IAC1F,MAAM,eAAe,GAAG,YAAY,CAAC,WAAW,CAAC;IACjD,MAAM,gBAAgB,GAAG,YAAY,CAAC,eAAe,CAAC;IACtD,MAAM,iBAAiB,GAAG,YAAY,CAAC,cAAc,CAAC;IAEtD,IAAI,eAAe,IAAI,CAAC,gBAAgB,IAAI,CAAC,iBAAiB,EAAE;QAC9D,OAAO;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,CAAC,yEAAyE,CAAC;YACrF,KAAK,EAAE,OAAO;SACf,CAAC;KACH;IAED,OAAO,0BAA0B,CAAC;AACpC,CAAC;;ACdM,MAAM,eAAe,GAAG,CAAC,YAAiC;IAC/D,IAAI,CAAC,YAAY,CAAC,SAAS,EAAE;QAC3B,OAAO;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,CAAC,oDAAoD,CAAC;YAChE,KAAK,EAAE,OAAO;SACf,CAAC;KACH;IAED,OAAO,0BAA0B,CAAC;AACpC,CAAC;;ACVM,MAAM,8BAA8B,GAAG,CAAC,YAAiC;IAC9E,MAAM,eAAe,GAAG,YAAY,CAAC,eAAe,CAAC;IACrD,MAAM,cAAc,GAAG,YAAY,CAAC,WAAW,CAAC;IAChD,MAAM,KAAK,GAAG,YAAY,CAAC,KAAK,IAAI,EAAE,CAAC;IACvC,MAAM,eAAe,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;IAEpE,IAAI,eAAe,IAAI,cAAc,IAAI,CAAC,eAAe,EAAE;QACzD,OAAO;YACL,MAAM,EAAE,KAAK;YACb,QAAQ,EAAE,CAAC,kFAAkF,CAAC;YAC9F,KAAK,EAAE,SAAS;SACjB,CAAC;KACH;IAED,OAAO,0BAA0B,CAAC;AACpC,CAAC;;ACZM,MAAM,QAAQ,GAAG;IACtB,eAAe;IACf,8BAA8B;IAC9B,kBAAkB;IAClB,cAAc;IACd,0CAA0C;CAC3C;;MCLY,uBAAuB;IAClC,YAAoB,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;KAAI;IAEpD,cAAc,CAAC,YAAiC;QAC9C,MAAM,oBAAoB,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;QAExE,MAAM,WAAW,GAAG,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAE9E,MAAM,gBAAgB,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;QACzE,MAAM,WAAW,GAAG,IAAI,CAAC,oBAAoB,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;QACtE,gBAAgB,CAAC,GAAG,CAAC,CAAC,OAAO,KAAK,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;QACxE,WAAW,CAAC,GAAG,CAAC,CAAC,OAAO,KAAK,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;QAErE,OAAO,gBAAgB,CAAC,MAAM,KAAK,CAAC,CAAC;KACtC;IAEO,oBAAoB,CAAC,IAAW,EAAE,OAA+B;QACvE,MAAM,WAAW,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,KAAK,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,KAAK,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC7F,OAAO,WAAW,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC;KAC9D;;8FAnBU,uBAAuB;4DAAvB,uBAAuB,WAAvB,uBAAuB;+CAAvB,uBAAuB;cADnC,UAAU;;;MCSE,iBAAiB;IAC5B,YACU,aAA4B,EAC5B,mBAAwC,EACxC,qBAA4C,EAC5C,oBAA0C,EAC1C,yBAAoD,EACpD,uBAAgD;QALhD,kBAAa,GAAb,aAAa,CAAe;QAC5B,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,4BAAuB,GAAvB,uBAAuB,CAAyB;KACtD;IAEJ,UAAU,CAAC,YAAiC,EAAE,4BAAqD;QACjG,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM;YACjC,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,cAAc,CAAC,YAAY,CAAC,EAAE;gBAC9D,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+DAA+D,CAAC,CAAC;gBAC7F,OAAO,EAAE,CAAC;aACX;YAED,IAAI,CAAC,YAAY,CAAC,qBAAqB,EAAE;gBACvC,YAAY,CAAC,qBAAqB,GAAG,YAAY,CAAC,SAAS,CAAC;aAC7D;YAED,MAAM,UAAU,GAAG,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;YAEtE,MAAM,qCAAqC,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAC5G,IAAI,CAAC,CAAC,qCAAqC,EAAE;gBAC3C,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,YAAY,EAAE;oBAC/E,aAAa,EAAE,YAAY;oBAC3B,SAAS,EAAE,qCAAqC;iBACjD,CAAC,CAAC;gBAEH,OAAO,EAAE,CAAC;aACX;YAED,IAAI,CAAC,CAAC,4BAA4B,EAAE;gBAClC,IAAI,CAAC,oBAAoB,CAAC,uBAAuB,CAAC,4BAA4B,CAAC,CAAC;gBAChF,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,YAAY,EAAE;oBAC/E,aAAa,EAAE,YAAY;oBAC3B,SAAS,EAAE,4BAA4B;iBACxC,CAAC,CAAC;gBAEH,OAAO,EAAE,CAAC;aACX;YACD,IAAI,UAAU,CAAC,+BAA+B,EAAE;gBAC9C,IAAI,CAAC,oBAAoB;qBACtB,yBAAyB,CAAC,UAAU,CAAC,qBAAqB,CAAC;qBAC3D,IAAI,CACH,UAAU,CAAC,CAAC,KAAK;oBACf,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mDAAmD,EAAE,KAAK,CAAC,CAAC;oBACxF,OAAO,UAAU,CAAC,KAAK,CAAC,CAAC;iBAC1B,CAAC,EACF,GAAG,CAAC,CAAC,kBAAkB,KACrB,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,YAAY,EAAE;oBAC/E,aAAa,EAAE,YAAY;oBAC3B,SAAS,EAAE,kBAAkB;iBAC9B,CAAC,CACH,CACF;qBACA,SAAS,CACR,MAAM,OAAO,EAAE,EACf,MAAM,MAAM,EAAE,CACf,CAAC;aACL;iBAAM;gBACL,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAsB,UAAU,CAAC,YAAY,EAAE;oBAC/E,aAAa,EAAE,YAAY;oBAC3B,SAAS,EAAE,IAAI;iBAChB,CAAC,CAAC;gBACH,OAAO,EAAE,CAAC;aACX;SACF,CAAC,CAAC;KACJ;;kFArEU,iBAAiB;sDAAjB,iBAAiB,WAAjB,iBAAiB;+CAAjB,iBAAiB;cAD7B,UAAU;;;MCTE,6BAA6B;IACxC,YAAoB,aAA4B,EAAU,UAAsB;QAA5D,kBAAa,GAAb,aAAa,CAAe;QAAU,eAAU,GAAV,UAAU,CAAY;KAAI;IAEpF,0BAA0B;QACxB,IAAI,IAAI,CAAC,UAAU,CAAC,4BAA4B,EAAE,EAAE;YAClD,OAAO,IAAI,CAAC;SACb;QAED,IAAI,IAAI,CAAC,UAAU,CAAC,qBAAqB,EAAE,EAAE;YAC3C,OAAO,IAAI,CAAC;SACb;QAED,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,4FAA4F,CAAC,CAAC;QAC5H,OAAO,KAAK,CAAC;KACd;;0GAdU,6BAA6B;kEAA7B,6BAA6B,WAA7B,6BAA6B;+CAA7B,6BAA6B;cADzC,UAAU;;;MCAE,eAAe;IAC1B,YAA+C,GAAQ;QAAR,QAAG,GAAH,GAAG,CAAK;KAAI;IAE3D,UAAU,CAAC,GAAG;QACZ,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,GAAG,GAAG,CAAC;KAC9B;;8EALU,eAAe,WACN,QAAQ;oDADjB,eAAe,WAAf,eAAe,mBADF,MAAM;+CACnB,eAAe;cAD3B,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;sBAEnB,MAAM;uBAAC,QAAQ;;;MCMjB,UAAU;IACrB,YACU,aAA4B,EAC5B,UAAsB,EACtB,WAAwB,EACxB,yBAAoD;QAHpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,eAAU,GAAV,UAAU,CAAY;QACtB,gBAAW,GAAX,WAAW,CAAa;QACxB,8BAAyB,GAAzB,yBAAyB,CAA2B;KAC1D;IAEJ,cAAc,CAAC,YAA2D;QACxE,IAAI,OAAO,GAAgB,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,mCAAmC,CAAC,CAAC;QAE3E,MAAM,aAAa,GAAG,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;QAEpF,IAAI,CAAC,aAAa,EAAE;YAClB,OAAO,UAAU,CAAC,0EAA0E,CAAC,CAAC;SAC/F;QAED,MAAM,WAAW,GAAG,aAAa,CAAC,WAAW,CAAC;QAC9C,IAAI,CAAC,WAAW,EAAE;YAChB,OAAO,UAAU,CAAC,yDAAyD,CAAC,CAAC;SAC9E;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,+BAA+B,CAAC,YAAY,CAAC,CAAC;QAE3E,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,IAAI,CAC3D,KAAK,CAAC,CAAC,CAAC,EACR,GAAG,CAAC,CAAC,QAAa;YAChB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;YAExD,OAAO;gBACL,SAAS,EAAE,QAAQ,CAAC,UAAU;gBAC9B,UAAU,EAAE,QAAQ,CAAC,WAAW;aACjC,CAAC;SACH,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,MAAM,YAAY,GAAG,iDAAiD,CAAC;YACvE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;;oEAzCU,UAAU;+CAAV,UAAU,WAAV,UAAU;+CAAV,UAAU;cADtB,UAAU;;;MCUE,eAAe;IAC1B,YACU,aAA4B,EAC5B,6BAA4D,EAC5D,UAAsB,EACtB,eAAgC,EAChC,qBAA4C,EAC5C,oBAA0C,EAC1C,YAA0B,EAC1B,gBAAkC,EAClC,WAAwB,EACxB,gBAAkC,EAClC,UAAsB;QAVtB,kBAAa,GAAb,aAAa,CAAe;QAC5B,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,eAAU,GAAV,UAAU,CAAY;QACtB,oBAAe,GAAf,eAAe,CAAiB;QAChC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,iBAAY,GAAZ,YAAY,CAAc;QAC1B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gBAAW,GAAX,WAAW,CAAa;QACxB,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,eAAU,GAAV,UAAU,CAAY;KAC5B;IAEJ,QAAQ,CAAC,WAAyB;QAChC,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,0BAA0B,EAAE,EAAE;YACpE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wBAAwB,CAAC,CAAC;YACtD,OAAO;SACR;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,CAAC,CAAC;YAC/D,OAAO;SACR;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,CAAC,CAAC;QAEvE,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,WAAW,IAAI,EAAE,CAAC;QAEvD,IAAI,CAAC,oBAAoB;aACtB,yBAAyB,CAAC,qBAAqB,CAAC;aAChD,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,CAAC;aACnE,SAAS,CAAC,CAAC,QAAQ;YAClB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;YAExD,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YAEpE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;YAEtD,IAAI,CAAC,GAAG,EAAE;gBACR,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mCAAmC,QAAQ,CAAC,UAAU,MAAM,GAAG,GAAG,CAAC,CAAC;gBAChG,OAAO;aACR;YAED,IAAI,UAAU,EAAE;gBACd,UAAU,CAAC,GAAG,CAAC,CAAC;aACjB;iBAAM;gBACL,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;aACtC;SACF,CAAC,CAAC;KACN;IAED,iBAAiB,CAAC,WAAyB,EAAE,YAA2B;QACtE,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,0BAA0B,EAAE,EAAE;YACpE,MAAM,YAAY,GAAG,wBAAwB,CAAC;YAC9C,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,qBAAqB,EAAE;YAC1B,MAAM,YAAY,GAAG,iCAAiC,CAAC;YACvD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oDAAoD,CAAC,CAAC;QAElF,MAAM,EAAE,YAAY,EAAE,GAAG,WAAW,IAAI,EAAE,CAAC;QAE3C,OAAO,IAAI,CAAC,oBAAoB,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,CAAC,IAAI,CACpF,SAAS,CAAC,MAAM,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC,EAC7D,SAAS,CAAC,CAAC,QAAqB;YAC9B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;YAExD,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;YAEpE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;YAEtD,IAAI,CAAC,GAAG,EAAE;gBACR,MAAM,YAAY,GAAG,mCAAmC,QAAQ,CAAC,UAAU,SAAS,CAAC;gBACrF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;gBAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;aACjC;YAED,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;YAE/C,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CACnC,IAAI,CAAC,CAAC,CAAC,EACP,SAAS,CAAC,CAAC,MAAM,KACf,MAAM,CAAC,UAAU,KAAK,IAAI;kBACtB,EAAE,CAAC,EAAE,eAAe,EAAE,KAAK,EAAE,YAAY,EAAE,mBAAmB,EAAE,CAAC;kBACjE,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CACtD,GAAG,CAAC,CAAC,eAAe,MAAM;oBACxB,eAAe;oBACf,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,oBAAoB,EAAE;oBACjD,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE;iBACpD,CAAC,CAAC,CACJ,CACN,CACF,CAAC;SACH,CAAC,CACH,CAAC;KACH;;8EA3GU,eAAe;oDAAf,eAAe,WAAf,eAAe;+CAAf,eAAe;cAD3B,UAAU;;;MCFE,iBAAiB;IAC5B,YACU,aAA4B,EAC5B,6BAA4D,EAC5D,UAAsB,EACtB,qBAA4C,EAC5C,oBAA0C,EAC1C,YAA0B,EAC1B,gBAAkC,EAClC,WAAwB,EACxB,gBAAkC;QARlC,kBAAa,GAAb,aAAa,CAAe;QAC5B,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,eAAU,GAAV,UAAU,CAAY;QACtB,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,yBAAoB,GAApB,oBAAoB,CAAsB;QAC1C,iBAAY,GAAZ,YAAY,CAAc;QAC1B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gBAAW,GAAX,WAAW,CAAa;QACxB,qBAAgB,GAAhB,gBAAgB,CAAkB;KACxC;IAEJ,sBAAsB,CAAC,WAAyB,EAAE,YAA2B;QAC3E,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,0BAA0B,EAAE,EAAE;YACpE,MAAM,YAAY,GAAG,wBAAwB,CAAC;YAC9C,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,qBAAqB,EAAE;YAC1B,MAAM,YAAY,GAAG,iCAAiC,CAAC;YACvD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC1C,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oDAAoD,CAAC,CAAC;QAElF,OAAO,IAAI,CAAC,oBAAoB,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,CAAC,IAAI,CACpF,SAAS,CAAC;YACR,MAAM,EAAE,YAAY,EAAE,GAAG,WAAW,IAAI,EAAE,CAAC;YAE3C,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;YAE9D,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;YAEnD,OAAO,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CACnC,IAAI,CAAC,CAAC,CAAC,EACP,SAAS,CAAC,CAAC,MAAM,KACf,MAAM,CAAC,UAAU,KAAK,IAAI;kBACtB,EAAE,CAAC,EAAE,eAAe,EAAE,KAAK,EAAE,YAAY,EAAE,mBAAmB,EAAE,CAAC;kBACjE,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CACtD,GAAG,CAAC,CAAC,eAAe,MAAM;oBACxB,eAAe;oBACf,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,oBAAoB,EAAE;oBACjD,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE;iBACpD,CAAC,CAAC,CACJ,CACN,CACF,CAAC;SACH,CAAC,CACH,CAAC;KACH;;kFAtDU,iBAAiB;sDAAjB,iBAAiB,WAAjB,iBAAiB;+CAAjB,iBAAiB;cAD7B,UAAU;;;MCNE,oBAAoB;IAC/B,YACU,aAA4B,EAC5B,6BAA4D,EAC5D,UAAsB,EACtB,eAAgC,EAChC,qBAA4C,EAC5C,oBAA0C;QAL1C,kBAAa,GAAb,aAAa,CAAe;QAC5B,kCAA6B,GAA7B,6BAA6B,CAA+B;QAC5D,eAAU,GAAV,UAAU,CAAY;QACtB,oBAAe,GAAf,eAAe,CAAiB;QAChC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,yBAAoB,GAApB,oBAAoB,CAAsB;KAChD;IAEJ,aAAa,CAAC,WAAyB;QACrC,IAAI,CAAC,IAAI,CAAC,6BAA6B,CAAC,0BAA0B,EAAE,EAAE;YACpE,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,wBAAwB,CAAC,CAAC;YACtD,OAAO;SACR;QAED,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEtF,IAAI,CAAC,qBAAqB,EAAE;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,iCAAiC,CAAC,CAAC;YAC/D,OAAO;SACR;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yCAAyC,CAAC,CAAC;QAEvE,IAAI,CAAC,oBAAoB,CAAC,yBAAyB,CAAC,qBAAqB,CAAC,CAAC,SAAS,CAAC;YACnF,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,WAAW,IAAI,EAAE,CAAC;YAEvD,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC;YAE1D,IAAI,CAAC,GAAG,EAAE;gBACR,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,sBAAsB,EAAE,GAAG,CAAC,CAAC;gBACzD,OAAO;aACR;YAED,IAAI,UAAU,EAAE;gBACd,UAAU,CAAC,GAAG,CAAC,CAAC;aACjB;iBAAM;gBACL,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;aACtC;SACF,CAAC,CAAC;KACJ;;wFAzCU,oBAAoB;yDAApB,oBAAoB,WAApB,oBAAoB;+CAApB,oBAAoB;cADhC,UAAU;;;MCEE,YAAY;IACvB,YACU,qBAA4C,EAC5C,eAAgC,EAChC,iBAAoC,EACpC,oBAA0C;QAH1C,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,oBAAe,GAAf,eAAe,CAAiB;QAChC,sBAAiB,GAAjB,iBAAiB,CAAmB;QACpC,yBAAoB,GAApB,oBAAoB,CAAsB;KAChD;IAEJ,KAAK,CAAC,WAAyB;QAC7B,MAAM,EAAE,8BAA8B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE/F,IAAI,8BAA8B,EAAE;YAClC,OAAO,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;SACnD;aAAM;YACL,OAAO,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;SAC7D;KACF;IAED,cAAc,CAAC,WAAyB,EAAE,YAA2B;QACnE,MAAM,EAAE,8BAA8B,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE/F,IAAI,8BAA8B,EAAE;YAClC,OAAO,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC;SAC1E;aAAM;YACL,OAAO,IAAI,CAAC,iBAAiB,CAAC,sBAAsB,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC;SACjF;KACF;;wEA1BU,YAAY;iDAAZ,YAAY,WAAZ,YAAY;+CAAZ,YAAY;cADxB,UAAU;;;MCGE,uBAAuB;IAClC,YACU,WAAwB,EACxB,yBAAoD,EACpD,aAA4B,EAC5B,UAAsB,EACtB,mBAAwC,EACxC,oBAA0C;;;IAG1C,qBAA4C;QAR5C,gBAAW,GAAX,WAAW,CAAa;QACxB,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,kBAAa,GAAb,aAAa,CAAe;QAC5B,eAAU,GAAV,UAAU,CAAY;QACtB,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,yBAAoB,GAApB,oBAAoB,CAAsB;QAG1C,0BAAqB,GAArB,qBAAqB,CAAuB;KAClD;;;IAIJ,MAAM,CAAC,UAAiC;QACtC,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAC;QACpD,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC9C,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;QAEnD,IAAI,CAAC,aAAa,EAAE;YAClB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,sDAAsD,CAAC,CAAC;YACpF,OAAO;SACR;QAED,IAAI,IAAI,CAAC,mBAAmB,CAAC,kBAAkB,EAAE,EAAE;YACjD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,yDAAyD,CAAC,CAAC;SACxF;aAAM,IAAI,UAAU,EAAE;YACrB,UAAU,CAAC,aAAa,CAAC,CAAC;SAC3B;aAAM;;;YAGL,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,SAAS,CAC3C,CAAC,MAAM;gBACL,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;aACrB,EACD,CAAC,KAAK;gBACJ,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;aAC7B,CACF,CAAC;SACH;KACF;IAED,WAAW;QACT,IAAI,CAAC,oBAAoB,CAAC,sBAAsB,EAAE,CAAC;QACnD,IAAI,CAAC,mBAAmB,CAAC,IAAI,EAAE,CAAC;KACjC;;;IAID,qBAAqB,CAAC,UAAiC;;QACrD,IAAI,QAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC,0CAAE,kBAAkB,CAAA,EAAE;YACtF,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mCAAmC,CAAC,CAAC;YACjE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;SACzB;QAED,IAAI,IAAI,CAAC,yBAAyB,CAAC,eAAe,EAAE,EAAE;YACpD,OAAO,IAAI,CAAC,kBAAkB,EAAE,CAAC,IAAI,CACnC,SAAS,CAAC,CAAC,MAAM,KAAK,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC,EACrD,UAAU,CAAC,CAAC,KAAK;gBACf,MAAM,YAAY,GAAG,qBAAqB,CAAC;gBAC3C,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;aACjC,CAAC,EACF,GAAG,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CACnC,CAAC;SACH;aAAM;YACL,OAAO,IAAI,CAAC,iBAAiB,EAAE,CAAC,IAAI,CAClC,UAAU,CAAC,CAAC,KAAK;gBACf,MAAM,YAAY,GAAG,4BAA4B,CAAC;gBAClD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;gBACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;aACjC,CAAC,EACF,GAAG,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CACnC,CAAC;SACH;KACF;;;;;IAMD,iBAAiB,CAAC,WAAiB;QACjC,MAAM,SAAS,GAAG,WAAW,IAAI,IAAI,CAAC,yBAAyB,CAAC,cAAc,EAAE,CAAC;QACjF,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,uCAAuC,CAAC,SAAS,CAAC,CAAC;QAChF,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,wBAAwB,EAAE,CAAC;QAEvD,IAAI,OAAO,GAAgB,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,mCAAmC,CAAC,CAAC;QAE3E,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,IAAI,CACnD,KAAK,CAAC,CAAC,CAAC,EACR,SAAS,CAAC,CAAC,QAAa;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,EAAE,QAAQ,CAAC,CAAC;YAC7E,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC;SACrB,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,MAAM,YAAY,GAAG,2BAA2B,CAAC;YACjD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;;;;;IAMD,kBAAkB,CAAC,YAAkB;QACnC,MAAM,UAAU,GAAG,YAAY,IAAI,IAAI,CAAC,yBAAyB,CAAC,eAAe,EAAE,CAAC;QACpF,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,wCAAwC,CAAC,UAAU,CAAC,CAAC;QAClF,MAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC,wBAAwB,EAAE,CAAC;QAEvD,IAAI,OAAO,GAAgB,IAAI,WAAW,EAAE,CAAC;QAC7C,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,mCAAmC,CAAC,CAAC;QAE3E,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,IAAI,CACnD,KAAK,CAAC,CAAC,CAAC,EACR,SAAS,CAAC,CAAC,QAAa;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qCAAqC,EAAE,QAAQ,CAAC,CAAC;YAC7E,OAAO,EAAE,CAAC,QAAQ,CAAC,CAAC;SACrB,CAAC,EACF,UAAU,CAAC,CAAC,KAAK;YACf,MAAM,YAAY,GAAG,2BAA2B,CAAC;YACjD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;YACjD,OAAO,UAAU,CAAC,YAAY,CAAC,CAAC;SACjC,CAAC,CACH,CAAC;KACH;IAED,gBAAgB,CAAC,YAA2D;QAC1E,MAAM,OAAO,GAAG,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,CAAC;QAE5D,MAAM,EAAE,sBAAsB,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEvF,MAAM,YAAY,mCAAQ,YAAY,GAAK,sBAAsB,CAAE,CAAC;QAEpE,OAAO,IAAI,CAAC,UAAU,CAAC,mBAAmB,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;KACnE;;8FA1IU,uBAAuB;4DAAvB,uBAAuB,WAAvB,uBAAuB;+CAAvB,uBAAuB;cADnC,UAAU;;;MCSE,mBAAmB;IA0C9B,YACU,mBAAwC,EACxC,gBAAkC,EAClC,WAAwB,EACxB,kBAAsC,EACtC,qBAA4C,EAC5C,gBAAkC,EAClC,gBAAkC,EAClC,eAAgC,EAChC,uBAAgD,EAChD,YAA0B,EAC1B,yBAAoD,EACpD,qBAA4C;QAX5C,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,gBAAW,GAAX,WAAW,CAAa;QACxB,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,oBAAe,GAAf,eAAe,CAAiB;QAChC,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,iBAAY,GAAZ,YAAY,CAAc;QAC1B,8BAAyB,GAAzB,yBAAyB,CAA2B;QACpD,0BAAqB,GAArB,qBAAqB,CAAuB;KAClD;;;;IAnDJ,IAAI,aAAa;QACf,MAAM,mBAAmB,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEhF,OAAO;YACL,aAAa,EAAE,mBAAmB;YAClC,SAAS,EAAE,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,wBAAwB,CAAC;SACzE,CAAC;KACH;;;;IAKD,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC;KACnC;;;;IAKD,IAAI,gBAAgB;QAClB,OAAO,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC;KAC1C;;;;;IAMD,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAAC;KACtD;;;;IAKD,IAAI,YAAY;QACd,OAAO,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC;KAC1C;;;;;;;IAuBD,SAAS,CAAC,GAAY;QACpB,OAAO,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;KAC7C;;;;IAKD,wBAAwB;QACtB,OAAO,IAAI,CAAC,gBAAgB,CAAC,wBAAwB,EAAE,CAAC;KACzD;;;;IAKD,QAAQ;QACN,OAAO,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE,CAAC;KAC/C;;;;IAKD,UAAU;QACR,OAAO,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC;KAC3C;;;;IAKD,eAAe;QACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC;KAChD;;;;;;IAOD,qBAAqB,CAAC,MAAM,GAAG,KAAK;QAClC,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,OAAO,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;KACnE;;;;;;IAOD,QAAQ,CAAC,KAAa;QACpB,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;KAClD;;;;IAKD,QAAQ;QACN,OAAO,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,CAAC;KACpD;;;;;;;IAQD,SAAS,CAAC,WAAyB;QACjC,IAAI,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,YAAY,EAAE;YAC7B,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,4BAA4B,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;SAC9F;QAED,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;KACtC;;;;;;;IAQD,kBAAkB,CAAC,WAAyB,EAAE,YAA2B;QACvE,IAAI,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,YAAY,EAAE;YAC7B,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,4BAA4B,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;SAC9F;QAED,OAAO,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC;KACpE;;;;;;IAOD,mBAAmB,CAAC,YAA2D;QAC7E,MAAM,EAAE,eAAe,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAEhF,IAAI,YAAY,EAAE;YAChB,IAAI,eAAe,EAAE;gBACnB,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,4BAA4B,EAAE,YAAY,CAAC,CAAC;aAClF;iBAAM;gBACL,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,4BAA4B,EAAE,YAAY,CAAC,CAAC;aAClF;SACF;QAED,OAAO,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,CAAC,YAAY,CAAC,CAAC;KACrE;;;;;;;;IASD,qBAAqB,CAAC,UAAiC;QACrD,OAAO,IAAI,CAAC,uBAAuB,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;KACvE;;;;;;;IAQD,MAAM,CAAC,UAAiC;QACtC,OAAO,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;KACxD;;;;IAKD,WAAW;QACT,OAAO,IAAI,CAAC,uBAAuB,CAAC,WAAW,EAAE,CAAC;KACnD;;;;;;;;IASD,iBAAiB,CAAC,WAAiB;QACjC,OAAO,IAAI,CAAC,uBAAuB,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;KACpE;;;;;;;;IASD,kBAAkB,CAAC,YAAkB;QACnC,OAAO,IAAI,CAAC,uBAAuB,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC;KACtE;;;;IAKD,gBAAgB,CAAC,YAA2D;QAC1E,OAAO,IAAI,CAAC,uBAAuB,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;KACpE;;sFA/NU,mBAAmB;wDAAnB,mBAAmB,WAAnB,mBAAmB;+CAAnB,mBAAmB;cAD/B,UAAU;;;MCdE,qBAAqB;IAChC,YAAoB,cAAqC,EAAU,aAA4B;QAA3E,mBAAc,GAAd,cAAc,CAAuB;QAAU,kBAAa,GAAb,aAAa,CAAe;KAAI;IAEnG,IAAI,CAAC,GAAW;;QACd,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mBAAmB,GAAG,6BAA6B,CAAC,CAAC;YACjF,OAAO,KAAK,CAAC;SACd;QAED,MAAM,IAAI,SAAG,IAAI,CAAC,UAAU,EAAE,0CAAE,OAAO,CAAC,GAAG,CAAC,CAAC;QAE7C,IAAI,CAAC,IAAI,EAAE;YACT,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mBAAmB,GAAG,yBAAyB,CAAC,CAAC;YAC7E,OAAO,IAAI,CAAC;SACb;QAED,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;KACzB;IAED,KAAK,CAAC,GAAW,EAAE,KAAU;QAC3B,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oBAAoB,GAAG,IAAI,KAAK,yBAAyB,CAAC,CAAC;YACvF,OAAO,KAAK,CAAC;SACd;QAED,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAClC,IAAI,CAAC,OAAO,EAAE;YACZ,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oBAAoB,GAAG,IAAI,KAAK,yBAAyB,CAAC,CAAC;YACvF,OAAO,KAAK,CAAC;SACd;QAED,KAAK,GAAG,KAAK,IAAI,IAAI,CAAC;QAEtB,OAAO,CAAC,OAAO,CAAC,GAAG,GAAG,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC;KACb;IAED,MAAM,CAAC,GAAW;QAChB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;YACtB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,qBAAqB,GAAG,yBAAyB,CAAC,CAAC;YAC/E,OAAO,KAAK,CAAC;SACd;QAED,MAAM,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAClC,IAAI,CAAC,OAAO,EAAE;YACZ,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,oBAAoB,GAAG,yBAAyB,CAAC,CAAC;YAC9E,OAAO,KAAK,CAAC;SACd;QAED,OAAO,CAAC,UAAU,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC;QAC7B,OAAO,IAAI,CAAC;KACb;IAEO,UAAU;QAChB,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,sBAAsB,EAAE,CAAC;QAC5D,IAAI,CAAC,MAAM,EAAE;YACX,OAAO,IAAI,CAAC;SACb;QAED,OAAO,MAAM,CAAC,OAAO,CAAC;KACvB;IAEO,UAAU;QAChB,OAAO,OAAO,OAAO,KAAK,WAAW,CAAC;KACvC;;0FAhEU,qBAAqB;0DAArB,qBAAqB,WAArB,qBAAqB;+CAArB,qBAAqB;cADjC,UAAU;;;MCmDE,UAAU;IACrB,OAAO,OAAO,CAAC,QAAe,EAAE;QAC9B,OAAO;YACL,QAAQ,EAAE,UAAU;YACpB,SAAS,EAAE;gBACT,iBAAiB;gBACjB,mBAAmB;gBACnB,UAAU;gBACV,mBAAmB;gBACnB,sBAAsB;gBACtB,gBAAgB;gBAChB,mBAAmB;gBACnB,gBAAgB;gBAChB,YAAY;gBACZ,kBAAkB;gBAClB,qBAAqB;gBACrB,uBAAuB;gBACvB,WAAW;gBACX,aAAa;gBACb,eAAe;gBACf,UAAU;gBACV,gBAAgB;gBAChB,oBAAoB;gBACpB,yBAAyB;gBACzB,kBAAkB;gBAClB,aAAa;gBACb,aAAa;gBACb,eAAe;gBACf,YAAY;gBACZ,UAAU;gBACV,wBAAwB;gBACxB,oBAAoB;gBACpB,WAAW;gBACX,sBAAsB;gBACtB,uBAAuB;gBACvB,gBAAgB;gBAChB,oBAAoB;gBACpB,2BAA2B;gBAC3B,oCAAoC;gBACpC,6BAA6B;gBAC7B,0BAA0B;gBAC1B,qCAAqC;gBACrC,oCAAoC;gBACpC,kCAAkC;gBAClC,8BAA8B;gBAC9B,kCAAkC;gBAClC,eAAe;gBACf,iBAAiB;gBACjB,oBAAoB;gBACpB,gBAAgB;gBAChB;oBACE,OAAO,EAAE,uBAAuB;oBAChC,QAAQ,EAAE,KAAK,CAAC,OAAO,IAAI,qBAAqB;iBACjD;aACF;SACF,CAAC;KACH;;2CAxDU,UAAU;gGAAV,UAAU,kBAJZ,CAAC,YAAY,EAAE,gBAAgB,CAAC;qFAI9B,UAAU,cAJX,YAAY,EAAE,gBAAgB;+CAI7B,UAAU;cALtB,QAAQ;eAAC;gBACR,OAAO,EAAE,CAAC,YAAY,EAAE,gBAAgB,CAAC;gBACzC,YAAY,EAAE,EAAE;gBAChB,OAAO,EAAE,EAAE;aACZ;;;MC7CY,cAAc;IACzB,YACU,gBAAkC,EAClC,gBAAkC,EAClC,gBAAkC,EAClC,YAA0B,EAC1B,MAAc;QAJd,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,iBAAY,GAAZ,YAAY,CAAc;QAC1B,WAAM,GAAN,MAAM,CAAQ;KACpB;IAEJ,OAAO,CAAC,KAAY,EAAE,QAAsB;QAC1C,MAAM,eAAe,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAE3C,OAAO,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC;KACxC;IAED,WAAW,CAAC,KAA6B,EAAE,KAA0B;QACnE,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;KAClC;IAEO,SAAS,CAAC,GAAW;QAC3B,MAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;QAE1E,IAAI,eAAe,EAAE;YACnB,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;SACjB;QAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,CAAC,IAAI,CAC3C,GAAG,CAAC,CAAC,YAAY;YACf,MAAM,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,sBAAsB,EAAE,CAAC;YAEnE,IAAI,YAAY,EAAE;gBAChB,IAAI,WAAW,EAAE;oBACf,IAAI,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,CAAC;oBAClD,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;iBACxC;gBACD,OAAO,IAAI,CAAC;aACb;YAED,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,CAAC,GAAG,CAAC,CAAC;YACnD,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;YAC1B,OAAO,KAAK,CAAC;SACd,CAAC,CACH,CAAC;KACH;;4EA3CU,cAAc;mDAAd,cAAc,WAAd,cAAc,mBADD,MAAM;+CACnB,cAAc;cAD1B,UAAU;eAAC,EAAE,UAAU,EAAE,MAAM,EAAE;;;MCDrB,eAAe;IAC1B,YACU,gBAAkC,EAClC,qBAA4C,EAC5C,aAA4B;QAF5B,qBAAgB,GAAhB,gBAAgB,CAAkB;QAClC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,kBAAa,GAAb,aAAa,CAAe;KAClC;IAEJ,SAAS,CAAC,GAAqB,EAAE,IAAiB;;QAEhD,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAE7E,IAAI,CAAC,YAAY,EAAE;YACjB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,+BAA+B,CAAC,CAAC;YAC7D,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,MAAM,aAAa,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;QAEtE,IAAI,CAAC,aAAa,EAAE;YAClB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,mCAAmC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC;YAC1E,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAC,GAAG,+BAA+B,aAAa,GAAG,CAAC,CAAC;QAExF,MAAM,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,cAAc,EAAE,CAAC;QAErD,IAAI,CAAC,KAAK,EAAE;YACV,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,0BAA0B,GAAG,CAAC,GAAG,yBAAyB,KAAK,GAAG,CAAC,CAAC;YAChG,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SACzB;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAC,GAAG,+BAA+B,aAAa,iBAAiB,CAAC,CAAC;QACtG,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC;YACd,OAAO,EAAE,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,SAAS,GAAG,KAAK,CAAC;SAC7D,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;KACzB;;8EAtCU,eAAe;oDAAf,eAAe,WAAf,eAAe;+CAAf,eAAe;cAD3B,UAAU;;;ACPX;;ACAA;;;;ACAA;;;;;;"}