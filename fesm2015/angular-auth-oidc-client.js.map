{"version":3,"file":"angular-auth-oidc-client.js","sources":["../projects/angular-auth-oidc-client/src/lib/api/http-base.service.ts","../projects/angular-auth-oidc-client/src/lib/logging/log-level.ts","../projects/angular-auth-oidc-client/src/lib/config/default-config.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/platform-provider/platform.provider.ts","../projects/angular-auth-oidc-client/src/lib/config/config.provider.ts","../projects/angular-auth-oidc-client/src/lib/api/data.service.ts","../projects/angular-auth-oidc-client/src/lib/public-events/event-types.ts","../projects/angular-auth-oidc-client/src/lib/storage/abstract-security-storage.ts","../projects/angular-auth-oidc-client/src/lib/storage/storage-persistence.service.ts","../projects/angular-auth-oidc-client/src/lib/logging/logger.service.ts","../projects/angular-auth-oidc-client/src/lib/public-events/public-events.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/tokenHelper/oidc-token-helper.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/token-validation.service.ts","../projects/angular-auth-oidc-client/src/lib/authState/auth-state.service.ts","../projects/angular-auth-oidc-client/src/lib/auto-login/auto-login-service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/url/uri-encoder.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/random/random.service.ts","../projects/angular-auth-oidc-client/src/lib/flows/flows-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/flowHelper/flow-helper.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/url/url.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/code-flow-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/userData/user-service.ts","../projects/angular-auth-oidc-client/src/lib/flows/reset-auth-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/implicit-flow-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/authState/authorized-state.ts","../projects/angular-auth-oidc-client/src/lib/validation/validation-result.ts","../projects/angular-auth-oidc-client/src/lib/flows/signin-key-data.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/history-jwt-keys-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/user-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/state-validation-result.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/equality/equality.service.ts","../projects/angular-auth-oidc-client/src/lib/validation/state-validation.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/state-validation-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/refresh-session-callback-handler.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/flows/callback-handling/refresh-token-callback-handler.service.ts","../projects/angular-auth-oidc-client/src/lib/flows/flows.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/intervall.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/implicit-flow-callback.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/existing-iframe.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/check-session.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/silent-renew.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/code-flow-callback.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/callback.service.ts","../projects/angular-auth-oidc-client/src/lib/config/auth-well-known-data.service.ts","../projects/angular-auth-oidc-client/src/lib/config/auth-well-known.service.ts","../projects/angular-auth-oidc-client/src/lib/iframe/refresh-session-iframe.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/refresh-session-refresh-token.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/refresh-session.service.ts","../projects/angular-auth-oidc-client/src/lib/callback/periodically-token-check.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/popup/popup.service.ts","../../projects/angular-auth-oidc-client/src/lib/check-auth.service.ts","../projects/angular-auth-oidc-client/src/lib/config-validation/rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-clientId.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-redirect-url.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-silentRenewUrl-with-no-refreshtokens.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/ensure-sts-server.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/use-offline-scope-with-silent-renew.rule.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/config-validation/rules/index.ts","../projects/angular-auth-oidc-client/src/lib/config-validation/config-validation.service.ts","../projects/angular-auth-oidc-client/src/lib/config/config.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/response-type-validation/response-type-validation.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/utils/redirect/redirect.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/par/par.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/par/par-login.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/popup/popup-login.service.ts","../esm2015/projects/angular-auth-oidc-client/src/lib/login/standard/standard-login.service.ts","../projects/angular-auth-oidc-client/src/lib/login/login.service.ts","../projects/angular-auth-oidc-client/src/lib/logoffRevoke/logoff-revocation.service.ts","../../projects/angular-auth-oidc-client/src/lib/oidc.security.service.ts","../projects/angular-auth-oidc-client/src/lib/storage/browser-storage.service.ts","../../projects/angular-auth-oidc-client/src/lib/auth.module.ts","../projects/angular-auth-oidc-client/src/lib/auto-login/auto-login.guard.ts","../projects/angular-auth-oidc-client/src/lib/interceptor/auth.interceptor.ts","../../projects/angular-auth-oidc-client/src/lib/angular-auth-oidc-client.ts","../../../projects/angular-auth-oidc-client/src/public-api.ts","../../../projects/angular-auth-oidc-client/src/angular-auth-oidc-client.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n@Injectable()\nexport class HttpBaseService {\n  constructor(private http: HttpClient) {}\n\n  get<T>(url: string, params?: { [key: string]: any }): Observable<T> {\n    return this.http.get<T>(url, params);\n  }\n\n  post<T>(url: string, body: any, params?: { [key: string]: any }): Observable<T> {\n    return this.http.post<T>(url, body, params);\n  }\n}\n","// eslint-disable-next-line no-shadow\nexport enum LogLevel {\n  None,\n  Debug,\n  Warn,\n  Error,\n}\n","import { LogLevel } from '../logging/log-level';\nimport { OpenIdConfiguration } from './openid-configuration';\n\nexport const DEFAULT_CONFIG: OpenIdConfiguration = {\n  stsServer: 'https://please_set',\n  authWellknownEndpoint: '',\n  redirectUrl: 'https://please_set',\n  clientId: 'please_set',\n  responseType: 'code',\n  scope: 'openid email profile',\n  hdParam: '',\n  postLogoutRedirectUri: 'https://please_set',\n  startCheckSession: false,\n  silentRenew: false,\n  silentRenewUrl: 'https://please_set',\n  silentRenewTimeoutInSeconds: 20,\n  renewTimeBeforeTokenExpiresInSeconds: 0,\n  useRefreshToken: false,\n  usePushedAuthorisationRequests: false,\n  ignoreNonceAfterRefresh: false,\n  postLoginRoute: '/',\n  forbiddenRoute: '/forbidden',\n  unauthorizedRoute: '/unauthorized',\n  autoUserinfo: true,\n  autoCleanStateAfterAuthentication: true,\n  triggerAuthorizationResultEvent: false,\n  logLevel: LogLevel.Warn,\n  issValidationOff: false,\n  historyCleanupOff: false,\n  maxIdTokenIatOffsetAllowedInSeconds: 120,\n  disableIatOffsetValidation: false,\n  storage: typeof Storage !== 'undefined' ? sessionStorage : null,\n  customParams: {},\n  customParamsRefreshToken: {},\n  customParamsEndSession: {},\n  eagerLoadAuthWellKnownEndpoints: true,\n  disableRefreshIdTokenAuthTimeValidation: false,\n  tokenRefreshInSeconds: 4,\n  refreshTokenRetryInSeconds: 3,\n  ngswBypass: false,\n};\n","import { isPlatformBrowser } from '@angular/common';\nimport { Inject, Injectable, PLATFORM_ID } from '@angular/core';\n\n@Injectable()\nexport class PlatformProvider {\n  get isBrowser() {\n    return isPlatformBrowser(this.platformId);\n  }\n\n  constructor(@Inject(PLATFORM_ID) private platformId: string) {}\n}\n","import { Injectable } from '@angular/core';\nimport { PlatformProvider } from '../utils/platform-provider/platform.provider';\nimport { DEFAULT_CONFIG } from './default-config';\nimport { OpenIdConfiguration } from './openid-configuration';\n\n@Injectable()\nexport class ConfigurationProvider {\n  private openIdConfigurationInternal: OpenIdConfiguration;\n\n  constructor(private platformProvider: PlatformProvider) {}\n\n  hasValidConfig() {\n    return !!this.openIdConfigurationInternal;\n  }\n\n  getOpenIDConfiguration(): OpenIdConfiguration {\n    return this.openIdConfigurationInternal || null;\n  }\n\n  setConfig(configuration: OpenIdConfiguration) {\n    this.openIdConfigurationInternal = { ...DEFAULT_CONFIG, ...configuration };\n\n    if (configuration?.storage) {\n      console.warn(\n        `PLEASE NOTE: The storage in the config will be deprecated in future versions:\n                Please pass the custom storage in forRoot() as documented`\n      );\n    }\n\n    this.setSpecialCases(this.openIdConfigurationInternal);\n\n    return this.openIdConfigurationInternal;\n  }\n\n  private setSpecialCases(currentConfig: OpenIdConfiguration) {\n    if (!this.platformProvider.isBrowser) {\n      currentConfig.startCheckSession = false;\n      currentConfig.silentRenew = false;\n      currentConfig.useRefreshToken = false;\n      currentConfig.usePushedAuthorisationRequests = false;\n    }\n  }\n}\n","import { HttpHeaders, HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { HttpBaseService } from './http-base.service';\n\nconst NGSW_CUSTOM_PARAM = 'ngsw-bypass';\n\n@Injectable()\nexport class DataService {\n  constructor(private httpClient: HttpBaseService, private readonly configurationProvider: ConfigurationProvider) {}\n\n  get<T>(url: string, token?: string): Observable<T> {\n    const headers = this.prepareHeaders(token);\n    let params = new HttpParams();\n\n    const { ngswBypass } = this.configurationProvider.getOpenIDConfiguration();\n    if (ngswBypass) {\n      params = params.set(NGSW_CUSTOM_PARAM, '');\n    }\n    return this.httpClient.get<T>(url, {\n      headers,\n      params,\n    });\n  }\n\n  post<T>(url: string, body: any, headersParams?: HttpHeaders) {\n    const headers = headersParams || this.prepareHeaders();\n    let params = new HttpParams();\n\n    const { ngswBypass } = this.configurationProvider.getOpenIDConfiguration();\n    if (ngswBypass) {\n      params = params.set(NGSW_CUSTOM_PARAM, '');\n    }\n\n    return this.httpClient.post<T>(url, body, { headers, params });\n  }\n\n  private prepareHeaders(token?: string) {\n    let headers = new HttpHeaders();\n    headers = headers.set('Accept', 'application/json');\n\n    if (!!token) {\n      headers = headers.set('Authorization', 'Bearer ' + decodeURIComponent(token));\n    }\n\n    return headers;\n  }\n}\n","// eslint-disable-next-line no-shadow\nexport enum EventTypes {\n  /**\n   *  This only works in the AppModule Constructor\n   */\n  ConfigLoaded,\n  ConfigLoadingFailed,\n  CheckSessionReceived,\n  UserDataChanged,\n  NewAuthorizationResult,\n  TokenExpired,\n  IdTokenExpired,\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Implement this class-interface to create a custom storage.\n */\n@Injectable()\nexport abstract class AbstractSecurityStorage {\n  /**\n   * This method must contain the logic to read the storage.\n   *\n   * @return The value of the given key\n   */\n  public abstract read(key: string): any;\n\n  /**\n   * This method must contain the logic to write the storage.\n   *\n   * @param key The key to write a value for\n   * @param value The value for the given key\n   */\n  public abstract write(key: string, value: any): void;\n\n  /**\n   * This method must contain the logic to remove an item from the storage.\n   *\n   * @param key The value for the key to be removed\n   */\n  public abstract remove(key: string): void;\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { AbstractSecurityStorage } from './abstract-security-storage';\n\nexport type StorageKeys =\n  | 'authnResult'\n  | 'authzData'\n  | 'access_token_expires_at'\n  | 'authWellKnownEndPoints'\n  | 'userData'\n  | 'authNonce'\n  | 'codeVerifier'\n  | 'authStateControl'\n  | 'session_state'\n  | 'storageSilentRenewRunning'\n  | 'storageCustomRequestParams'\n  | 'storageCustomParamsRefresh'\n  | 'jwtKeys';\n\n@Injectable()\nexport class StoragePersistenceService {\n  constructor(\n    private readonly oidcSecurityStorage: AbstractSecurityStorage,\n    private readonly configurationProvider: ConfigurationProvider\n  ) {}\n\n  read(key: StorageKeys) {\n    const keyToRead = this.createKeyWithPrefix(key);\n    return this.oidcSecurityStorage.read(keyToRead);\n  }\n\n  write(key: StorageKeys, value: any) {\n    const keyToStore = this.createKeyWithPrefix(key);\n    this.oidcSecurityStorage.write(keyToStore, value);\n  }\n\n  remove(key: StorageKeys) {\n    const keyToStore = this.createKeyWithPrefix(key);\n    this.oidcSecurityStorage.remove(keyToStore);\n  }\n\n  resetStorageFlowData() {\n    this.remove('session_state');\n    this.remove('storageSilentRenewRunning');\n    this.remove('codeVerifier');\n    this.remove('userData');\n    this.remove('storageCustomRequestParams');\n    this.remove('storageCustomParamsRefresh');\n    this.remove('access_token_expires_at');\n  }\n\n  resetAuthStateInStorage() {\n    this.remove('authzData');\n    this.remove('authnResult');\n  }\n\n  getAccessToken(): any {\n    return this.read('authzData');\n  }\n\n  getIdToken(): any {\n    return this.read('authnResult')?.id_token;\n  }\n\n  getRefreshToken(): any {\n    return this.read('authnResult')?.refresh_token;\n  }\n\n  private createKeyWithPrefix(key: string) {\n    const config = this.configurationProvider.getOpenIDConfiguration();\n    const prefix = config?.clientId || '';\n    return `${prefix}_${key}`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LogLevel } from './log-level';\n\n@Injectable()\nexport class LoggerService {\n  constructor(private configurationProvider: ConfigurationProvider) {}\n\n  logError(message: any, ...args: any[]) {\n    if (this.loggingIsTurnedOff()) {\n      return;\n    }\n\n    if (!!args && args.length) {\n      console.error(message, ...args);\n    } else {\n      console.error(message);\n    }\n  }\n\n  logWarning(message: any, ...args: any[]) {\n    if (!this.logLevelIsSet()) {\n      return;\n    }\n\n    if (this.loggingIsTurnedOff()) {\n      return;\n    }\n\n    if (!this.currentLogLevelIsEqualOrSmallerThan(LogLevel.Warn)) {\n      return;\n    }\n\n    if (!!args && args.length) {\n      console.warn(message, ...args);\n    } else {\n      console.warn(message);\n    }\n  }\n\n  logDebug(message: any, ...args: any[]) {\n    if (!this.logLevelIsSet()) {\n      return;\n    }\n\n    if (this.loggingIsTurnedOff()) {\n      return;\n    }\n\n    if (!this.currentLogLevelIsEqualOrSmallerThan(LogLevel.Debug)) {\n      return;\n    }\n\n    if (!!args && args.length) {\n      console.log(message, ...args);\n    } else {\n      console.log(message);\n    }\n  }\n\n  private currentLogLevelIsEqualOrSmallerThan(logLevelToCompare: LogLevel) {\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\n    return logLevel <= logLevelToCompare;\n  }\n\n  private logLevelIsSet() {\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\n\n    if (logLevel === null) {\n      return false;\n    }\n\n    if (logLevel === undefined) {\n      return false;\n    }\n\n    return true;\n  }\n\n  private loggingIsTurnedOff() {\n    const { logLevel } = this.configurationProvider.getOpenIDConfiguration() || {};\n\n    return logLevel === LogLevel.None;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ReplaySubject } from 'rxjs';\nimport { EventTypes } from './event-types';\nimport { OidcClientNotification } from './notification';\n\n@Injectable()\nexport class PublicEventsService {\n  private notify = new ReplaySubject<OidcClientNotification<any>>(1);\n\n  /**\n   * Fires a new event.\n   *\n   * @param type The event type.\n   * @param value The event value.\n   */\n  fireEvent<T>(type: EventTypes, value?: T) {\n    this.notify.next({ type, value });\n  }\n\n  /**\n   * Wires up the event notification observable.\n   */\n  registerForEvents() {\n    return this.notify.asObservable();\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { LoggerService } from '../../logging/logger.service';\n\nconst PARTS_OF_TOKEN = 3;\n@Injectable()\nexport class TokenHelperService {\n  constructor(private readonly loggerService: LoggerService) {}\n\n  getTokenExpirationDate(dataIdToken: any): Date {\n    if (!dataIdToken.hasOwnProperty('exp')) {\n      return new Date(new Date().toUTCString());\n    }\n\n    const date = new Date(0); // The 0 here is the key, which sets the date to the epoch\n    date.setUTCSeconds(dataIdToken.exp);\n\n    return date;\n  }\n\n  getHeaderFromToken(token: any, encoded: boolean) {\n    if (!this.tokenIsValid(token)) {\n      return {};\n    }\n\n    return this.getPartOfToken(token, 0, encoded);\n  }\n\n  getPayloadFromToken(token: any, encoded: boolean) {\n    if (!this.tokenIsValid(token)) {\n      return {};\n    }\n\n    return this.getPartOfToken(token, 1, encoded);\n  }\n\n  getSignatureFromToken(token: any, encoded: boolean) {\n    if (!this.tokenIsValid(token)) {\n      return {};\n    }\n\n    return this.getPartOfToken(token, 2, encoded);\n  }\n\n  private getPartOfToken(token: string, index: number, encoded: boolean) {\n    const partOfToken = this.extractPartOfToken(token, index);\n\n    if (encoded) {\n      return partOfToken;\n    }\n\n    const result = this.urlBase64Decode(partOfToken);\n    return JSON.parse(result);\n  }\n\n  private urlBase64Decode(str: string) {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n\n    switch (output.length % 4) {\n      case 0:\n        break;\n      case 2:\n        output += '==';\n        break;\n      case 3:\n        output += '=';\n        break;\n      default:\n        throw Error('Illegal base64url string!');\n    }\n\n    const decoded = typeof window !== 'undefined' ? window.atob(output) : Buffer.from(output, 'base64').toString('binary');\n\n    try {\n      // Going backwards: from bytestream, to percent-encoding, to original string.\n      return decodeURIComponent(\n        decoded\n          .split('')\n          .map((c: string) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\n          .join('')\n      );\n    } catch (err) {\n      return decoded;\n    }\n  }\n\n  private tokenIsValid(token: string) {\n    if (!token) {\n      this.loggerService.logError(`token '${token}' is not valid --> token falsy`);\n      return false;\n    }\n\n    if (!(token as string).includes('.')) {\n      this.loggerService.logError(`token '${token}' is not valid --> no dots included`);\n      return false;\n    }\n\n    const parts = token.split('.');\n\n    if (parts.length !== PARTS_OF_TOKEN) {\n      this.loggerService.logError(`token '${token}' is not valid --> token has to have exactly ${PARTS_OF_TOKEN - 1} dots`);\n      return false;\n    }\n\n    return true;\n  }\n\n  private extractPartOfToken(token: string, index: number) {\n    return token.split('.')[index];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { hextob64u, KEYUTIL, KJUR } from 'jsrsasign-reduced';\nimport { LoggerService } from '../logging/logger.service';\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\n\n// http://openid.net/specs/openid-connect-implicit-1_0.html\n\n// id_token\n// id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\n// MUST exactly match the value of the iss (issuer) Claim.\n//\n// id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\n// by the iss (issuer) Claim as an audience.The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience,\n// or if it contains additional audiences not trusted by the Client.\n//\n// id_token C3: If the ID Token contains multiple audiences, the Client SHOULD verify that an azp Claim is present.\n//\n// id_token C4: If an azp (authorized party) Claim is present, the Client SHOULD verify that its client_id is the Claim Value.\n//\n// id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the\n// alg Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\n//\n// id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the OpenID Connect\n// Core 1.0\n// [OpenID.Core] specification.\n//\n// id_token C7: The current time MUST be before the time represented by the exp Claim (possibly allowing for some small leeway to account\n// for clock skew).\n//\n// id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\n// limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\n//\n// id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one that was sent\n// in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.The precise method for detecting replay attacks\n// is Client specific.\n//\n// id_token C10: If the acr Claim was requested, the Client SHOULD check that the asserted Claim Value is appropriate.\n// The meaning and processing of acr Claim Values is out of scope for this document.\n//\n// id_token C11: When a max_age request is made, the Client SHOULD check the auth_time Claim value and request re- authentication\n// if it determines too much time has elapsed since the last End- User authentication.\n\n// Access Token Validation\n// access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\n// for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\n// access_token C2: Take the left- most half of the hash and base64url- encode it.\n// access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash is present\n// in the ID Token.\n\n@Injectable()\nexport class TokenValidationService {\n  static refreshTokenNoncePlaceholder = '--RefreshToken--';\n  keyAlgorithms: string[] = ['HS256', 'HS384', 'HS512', 'RS256', 'RS384', 'RS512', 'ES256', 'ES384', 'PS256', 'PS384', 'PS512'];\n\n  constructor(private tokenHelperService: TokenHelperService, private loggerService: LoggerService) {}\n\n  // id_token C7: The current time MUST be before the time represented by the exp Claim\n  // (possibly allowing for some small leeway to account for clock skew).\n  hasIdTokenExpired(token: string, offsetSeconds?: number): boolean {\n    const decoded = this.tokenHelperService.getPayloadFromToken(token, false);\n\n    return !this.validateIdTokenExpNotExpired(decoded, offsetSeconds);\n  }\n\n  // id_token C7: The current time MUST be before the time represented by the exp Claim\n  // (possibly allowing for some small leeway to account for clock skew).\n  validateIdTokenExpNotExpired(decodedIdToken: string, offsetSeconds?: number): boolean {\n    const tokenExpirationDate = this.tokenHelperService.getTokenExpirationDate(decodedIdToken);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (!tokenExpirationDate) {\n      return false;\n    }\n\n    const tokenExpirationValue = tokenExpirationDate.valueOf();\n    const nowWithOffset = new Date(new Date().toUTCString()).valueOf() + offsetSeconds * 1000;\n    const tokenNotExpired = tokenExpirationValue > nowWithOffset;\n\n    this.loggerService.logDebug(`Has id_token expired: ${!tokenNotExpired}, ${tokenExpirationValue} > ${nowWithOffset}`);\n\n    // Token not expired?\n    return tokenNotExpired;\n  }\n\n  validateAccessTokenNotExpired(accessTokenExpiresAt: Date, offsetSeconds?: number): boolean {\n    // value is optional, so if it does not exist, then it has not expired\n    if (!accessTokenExpiresAt) {\n      return true;\n    }\n\n    offsetSeconds = offsetSeconds || 0;\n    const accessTokenExpirationValue = accessTokenExpiresAt.valueOf();\n    const nowWithOffset = new Date(new Date().toUTCString()).valueOf() + offsetSeconds * 1000;\n    const tokenNotExpired = accessTokenExpirationValue > nowWithOffset;\n\n    this.loggerService.logDebug(`Has access_token expired: ${!tokenNotExpired}, ${accessTokenExpirationValue} > ${nowWithOffset}`);\n\n    // access token not expired?\n    return tokenNotExpired;\n  }\n\n  // iss\n  // REQUIRED. Issuer Identifier for the Issuer of the response.The iss value is a case-sensitive URL using the\n  // https scheme that contains scheme, host,\n  // and optionally, port number and path components and no query or fragment components.\n  //\n  // sub\n  // REQUIRED. Subject Identifier.Locally unique and never reassigned identifier within the Issuer for the End- User,\n  // which is intended to be consumed by the Client, e.g., 24400320 or AItOawmwtWwcT0k51BayewNvutrJUqsvl6qs7A4.\n  // It MUST NOT exceed 255 ASCII characters in length.The sub value is a case-sensitive string.\n  //\n  // aud\n  // REQUIRED. Audience(s) that this ID Token is intended for. It MUST contain the OAuth 2.0 client_id of the Relying Party as an\n  // audience value.\n  // It MAY also contain identifiers for other audiences.In the general case, the aud value is an array of case-sensitive strings.\n  // In the common special case when there is one audience, the aud value MAY be a single case-sensitive string.\n  //\n  // exp\n  // REQUIRED. Expiration time on or after which the ID Token MUST NOT be accepted for processing.\n  // The processing of this parameter requires that the current date/ time MUST be before the expiration date/ time listed in the value.\n  // Implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.\n  // Its value is a JSON [RFC7159] number representing the number of seconds from 1970- 01 - 01T00: 00:00Z as measured in UTC until\n  // the date/ time.\n  // See RFC 3339 [RFC3339] for details regarding date/ times in general and UTC in particular.\n  //\n  // iat\n  // REQUIRED. Time at which the JWT was issued. Its value is a JSON number representing the number of seconds from\n  // 1970- 01 - 01T00: 00: 00Z as measured\n  // in UTC until the date/ time.\n  validateRequiredIdToken(dataIdToken: any): boolean {\n    let validated = true;\n    if (!dataIdToken.hasOwnProperty('iss')) {\n      validated = false;\n      this.loggerService.logWarning('iss is missing, this is required in the id_token');\n    }\n\n    if (!dataIdToken.hasOwnProperty('sub')) {\n      validated = false;\n      this.loggerService.logWarning('sub is missing, this is required in the id_token');\n    }\n\n    if (!dataIdToken.hasOwnProperty('aud')) {\n      validated = false;\n      this.loggerService.logWarning('aud is missing, this is required in the id_token');\n    }\n\n    if (!dataIdToken.hasOwnProperty('exp')) {\n      validated = false;\n      this.loggerService.logWarning('exp is missing, this is required in the id_token');\n    }\n\n    if (!dataIdToken.hasOwnProperty('iat')) {\n      validated = false;\n      this.loggerService.logWarning('iat is missing, this is required in the id_token');\n    }\n\n    return validated;\n  }\n\n  // id_token C8: The iat Claim can be used to reject tokens that were issued too far away from the current time,\n  // limiting the amount of time that nonces need to be stored to prevent attacks.The acceptable range is Client specific.\n  validateIdTokenIatMaxOffset(dataIdToken: any, maxOffsetAllowedInSeconds: number, disableIatOffsetValidation: boolean): boolean {\n    if (disableIatOffsetValidation) {\n      return true;\n    }\n\n    if (!dataIdToken.hasOwnProperty('iat')) {\n      return false;\n    }\n\n    const dateTimeIatIdToken = new Date(0); // The 0 here is the key, which sets the date to the epoch\n    dateTimeIatIdToken.setUTCSeconds(dataIdToken.iat);\n    maxOffsetAllowedInSeconds = maxOffsetAllowedInSeconds || 0;\n\n    const nowInUtc = new Date(new Date().toUTCString());\n    const diff = nowInUtc.valueOf() - dateTimeIatIdToken.valueOf();\n    const maxOffsetAllowedInMilliseconds = maxOffsetAllowedInSeconds * 1000;\n\n    this.loggerService.logDebug(`validate id token iat max offset ${diff} < ${maxOffsetAllowedInMilliseconds}`);\n\n    if (diff > 0) {\n      return diff < maxOffsetAllowedInMilliseconds;\n    }\n\n    return -diff < maxOffsetAllowedInMilliseconds;\n  }\n\n  // id_token C9: The value of the nonce Claim MUST be checked to verify that it is the same value as the one\n  // that was sent in the Authentication Request.The Client SHOULD check the nonce value for replay attacks.\n  // The precise method for detecting replay attacks is Client specific.\n\n  // However the nonce claim SHOULD not be present for the refresh_token grant type\n  // https://bitbucket.org/openid/connect/issues/1025/ambiguity-with-how-nonce-is-handled-on\n  // The current spec is ambiguous and Keycloak does send it.\n  validateIdTokenNonce(dataIdToken: any, localNonce: any, ignoreNonceAfterRefresh: boolean): boolean {\n    const isFromRefreshToken =\n      (dataIdToken.nonce === undefined || ignoreNonceAfterRefresh) && localNonce === TokenValidationService.refreshTokenNoncePlaceholder;\n    if (!isFromRefreshToken && dataIdToken.nonce !== localNonce) {\n      this.loggerService.logDebug('Validate_id_token_nonce failed, dataIdToken.nonce: ' + dataIdToken.nonce + ' local_nonce:' + localNonce);\n      return false;\n    }\n\n    return true;\n  }\n\n  // id_token C1: The Issuer Identifier for the OpenID Provider (which is typically obtained during Discovery)\n  // MUST exactly match the value of the iss (issuer) Claim.\n  validateIdTokenIss(dataIdToken: any, authWellKnownEndpointsIssuer: any): boolean {\n    if ((dataIdToken.iss as string) !== (authWellKnownEndpointsIssuer as string)) {\n      this.loggerService.logDebug(\n        'Validate_id_token_iss failed, dataIdToken.iss: ' +\n          dataIdToken.iss +\n          ' authWellKnownEndpoints issuer:' +\n          authWellKnownEndpointsIssuer\n      );\n      return false;\n    }\n\n    return true;\n  }\n\n  // id_token C2: The Client MUST validate that the aud (audience) Claim contains its client_id value registered at the Issuer identified\n  // by the iss (issuer) Claim as an audience.\n  // The ID Token MUST be rejected if the ID Token does not list the Client as a valid audience, or if it contains additional audiences\n  // not trusted by the Client.\n  validateIdTokenAud(dataIdToken: any, aud: any): boolean {\n    if (Array.isArray(dataIdToken.aud)) {\n      const result = dataIdToken.aud.includes(aud);\n\n      if (!result) {\n        this.loggerService.logDebug('Validate_id_token_aud array failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\n        return false;\n      }\n\n      return true;\n    } else if (dataIdToken.aud !== aud) {\n      this.loggerService.logDebug('Validate_id_token_aud failed, dataIdToken.aud: ' + dataIdToken.aud + ' client_id:' + aud);\n\n      return false;\n    }\n\n    return true;\n  }\n\n  validateIdTokenAzpExistsIfMoreThanOneAud(dataIdToken: any): boolean {\n    if (!dataIdToken) {\n      return false;\n    }\n\n    if (Array.isArray(dataIdToken.aud) && dataIdToken.aud.length > 1 && !dataIdToken.azp) {\n      return false;\n    }\n\n    return true;\n  }\n\n  // If an azp (authorized party) Claim is present, the Client SHOULD verify that its client_id is the Claim Value.\n  validateIdTokenAzpValid(dataIdToken: any, clientId: string): boolean {\n    if (!dataIdToken?.azp) {\n      return true;\n    }\n\n    if (dataIdToken.azp === clientId) {\n      return true;\n    }\n\n    return false;\n  }\n\n  validateStateFromHashCallback(state: any, localState: any): boolean {\n    if ((state as string) !== (localState as string)) {\n      this.loggerService.logDebug('ValidateStateFromHashCallback failed, state: ' + state + ' local_state:' + localState);\n      return false;\n    }\n\n    return true;\n  }\n\n  // id_token C5: The Client MUST validate the signature of the ID Token according to JWS [JWS] using the algorithm specified in the alg\n  // Header Parameter of the JOSE Header.The Client MUST use the keys provided by the Issuer.\n  // id_token C6: The alg value SHOULD be RS256. Validation of tokens using other signing algorithms is described in the\n  // OpenID Connect Core 1.0 [OpenID.Core] specification.\n  validateSignatureIdToken(idToken: any, jwtkeys: any): boolean {\n    if (!jwtkeys || !jwtkeys.keys) {\n      return false;\n    }\n\n    const headerData = this.tokenHelperService.getHeaderFromToken(idToken, false);\n\n    if (Object.keys(headerData).length === 0 && headerData.constructor === Object) {\n      this.loggerService.logWarning('id token has no header data');\n      return false;\n    }\n\n    const kid = headerData.kid;\n    const alg = headerData.alg;\n\n    if (!this.keyAlgorithms.includes(alg as string)) {\n      this.loggerService.logWarning('alg not supported', alg);\n      return false;\n    }\n\n    let jwtKtyToUse = 'RSA';\n    if ((alg as string).charAt(0) === 'E') {\n      jwtKtyToUse = 'EC';\n    }\n\n    let isValid = false;\n\n    // No kid in the Jose header\n    if (!kid) {\n      let keyToValidate;\n\n      // If only one key, use it\n      if (jwtkeys.keys.length === 1 && (jwtkeys.keys[0].kty as string) === jwtKtyToUse) {\n        keyToValidate = jwtkeys.keys[0];\n      } else {\n        // More than one key\n        // Make sure there's exactly 1 key candidate\n        // kty \"RSA\" and \"EC\" uses \"sig\"\n        let amountOfMatchingKeys = 0;\n        for (const key of jwtkeys.keys) {\n          if ((key.kty as string) === jwtKtyToUse && (key.use as string) === 'sig') {\n            amountOfMatchingKeys++;\n            keyToValidate = key;\n          }\n        }\n\n        if (amountOfMatchingKeys > 1) {\n          this.loggerService.logWarning('no ID Token kid claim in JOSE header and multiple supplied in jwks_uri');\n          return false;\n        }\n      }\n\n      if (!keyToValidate) {\n        this.loggerService.logWarning('no keys found, incorrect Signature, validation failed for id_token');\n        return false;\n      }\n\n      //isValid = KJUR.jws.JWS.verify(idToken, KEYUTIL.getKey(keyToValidate), [alg]);\n      // TODO: HERE\n      // Modifichiamo in true perchè non funziona la validazione\n\n      if (!isValid) {\n        this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\n      }\n\n      return isValid;\n    } else {\n      // kid in the Jose header of id_token\n      for (const key of jwtkeys.keys) {\n        if ((key.kid as string) === (kid as string)) {\n          const publicKey = KEYUTIL.getKey(key);\n          isValid = KJUR.jws.JWS.verify(idToken, publicKey, [alg]);\n          if (!isValid) {\n            this.loggerService.logWarning('incorrect Signature, validation failed for id_token');\n          }\n          return isValid;\n        }\n      }\n    }\n\n    return isValid;\n  }\n\n  // Accepts ID Token without 'kid' claim in JOSE header if only one JWK supplied in 'jwks_url'\n  //// private validate_no_kid_in_header_only_one_allowed_in_jwtkeys(header_data: any, jwtkeys: any): boolean {\n  ////    this.oidcSecurityCommon.logDebug('amount of jwtkeys.keys: ' + jwtkeys.keys.length);\n  ////    if (!header_data.hasOwnProperty('kid')) {\n  ////        // no kid defined in Jose header\n  ////        if (jwtkeys.keys.length != 1) {\n  ////            this.oidcSecurityCommon.logDebug('jwtkeys.keys.length != 1 and no kid in header');\n  ////            return false;\n  ////        }\n  ////    }\n\n  ////    return true;\n  //// }\n\n  // Access Token Validation\n  // access_token C1: Hash the octets of the ASCII representation of the access_token with the hash algorithm specified in JWA[JWA]\n  // for the alg Header Parameter of the ID Token's JOSE Header. For instance, if the alg is RS256, the hash algorithm used is SHA-256.\n  // access_token C2: Take the left- most half of the hash and base64url- encode it.\n  // access_token C3: The value of at_hash in the ID Token MUST match the value produced in the previous step if at_hash\n  // is present in the ID Token.\n  validateIdTokenAtHash(accessToken: any, atHash: any, idTokenAlg: string): boolean {\n    this.loggerService.logDebug('at_hash from the server:' + atHash);\n\n    // 'sha256' 'sha384' 'sha512'\n    let sha = 'sha256';\n    if (idTokenAlg.includes('384')) {\n      sha = 'sha384';\n    } else if (idTokenAlg.includes('512')) {\n      sha = 'sha512';\n    }\n\n    const testData = this.generateAtHash('' + accessToken, sha);\n    this.loggerService.logDebug('at_hash client validation not decoded:' + testData);\n    if (testData === (atHash as string)) {\n      return true; // isValid;\n    } else {\n      const testValue = this.generateAtHash('' + decodeURIComponent(accessToken), sha);\n      this.loggerService.logDebug('-gen access--' + testValue);\n      if (testValue === (atHash as string)) {\n        return true; // isValid\n      }\n    }\n\n    return false;\n  }\n\n  generateCodeChallenge(codeVerifier: any): string {\n    const hash = KJUR.crypto.Util.hashString(codeVerifier, 'sha256');\n    const testData = hextob64u(hash);\n\n    return testData;\n  }\n\n  private generateAtHash(accessToken: any, sha: string): string {\n    const hash = KJUR.crypto.Util.hashString(accessToken, sha);\n    const first128bits = hash.substr(0, hash.length / 2);\n    const testData = hextob64u(first128bits);\n\n    return testData;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { EventTypes } from '../public-events/event-types';\nimport { PublicEventsService } from '../public-events/public-events.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { TokenValidationService } from '../validation/token-validation.service';\nimport { AuthorizationResult } from './authorization-result';\n\n@Injectable()\nexport class AuthStateService {\n  private authorizedInternal$ = new BehaviorSubject<boolean>(false);\n\n  get authorized$() {\n    return this.authorizedInternal$.asObservable().pipe(distinctUntilChanged());\n  }\n\n  private get isAuthorized() {\n    return !!this.storagePersistenceService.getAccessToken() && !!this.storagePersistenceService.getIdToken();\n  }\n\n  constructor(\n    private storagePersistenceService: StoragePersistenceService,\n    private loggerService: LoggerService,\n    private publicEventsService: PublicEventsService,\n    private configurationProvider: ConfigurationProvider,\n    private tokenValidationService: TokenValidationService\n  ) {}\n\n  setAuthorizedAndFireEvent(): void {\n    this.authorizedInternal$.next(true);\n  }\n\n  setUnauthorizedAndFireEvent(): void {\n    this.storagePersistenceService.resetAuthStateInStorage();\n    this.authorizedInternal$.next(false);\n  }\n\n  updateAndPublishAuthState(authorizationResult: AuthorizationResult) {\n    this.publicEventsService.fireEvent<AuthorizationResult>(EventTypes.NewAuthorizationResult, authorizationResult);\n  }\n\n  setAuthorizationData(accessToken: any, authResult: any) {\n    this.loggerService.logDebug(accessToken);\n    this.loggerService.logDebug('storing the accessToken');\n\n    this.storagePersistenceService.write('authzData', accessToken);\n    this.persistAccessTokenExpirationTime(authResult);\n    this.setAuthorizedAndFireEvent();\n  }\n\n  getAccessToken(): string {\n    if (!this.isAuthorized) {\n      return '';\n    }\n\n    const token = this.storagePersistenceService.getAccessToken();\n    return this.decodeURIComponentSafely(token);\n  }\n\n  getIdToken(): string {\n    if (!this.isAuthorized) {\n      return '';\n    }\n\n    const token = this.storagePersistenceService.getIdToken();\n    return this.decodeURIComponentSafely(token);\n  }\n\n  getRefreshToken(): string {\n    if (!this.isAuthorized) {\n      return '';\n    }\n\n    const token = this.storagePersistenceService.getRefreshToken();\n    return this.decodeURIComponentSafely(token);\n  }\n\n  areAuthStorageTokensValid() {\n    if (!this.isAuthorized) {\n      return false;\n    }\n\n    if (this.hasIdTokenExpired()) {\n      this.loggerService.logDebug('persisted id_token is expired');\n      return false;\n    }\n\n    if (this.hasAccessTokenExpiredIfExpiryExists()) {\n      this.loggerService.logDebug('persisted access_token is expired');\n      return false;\n    }\n\n    this.loggerService.logDebug('persisted id_token and access token are valid');\n    return true;\n  }\n\n  hasIdTokenExpired() {\n    const tokenToCheck = this.storagePersistenceService.getIdToken();\n    const { renewTimeBeforeTokenExpiresInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n\n    const idTokenExpired = this.tokenValidationService.hasIdTokenExpired(tokenToCheck, renewTimeBeforeTokenExpiresInSeconds);\n\n    if (idTokenExpired) {\n      this.publicEventsService.fireEvent<boolean>(EventTypes.IdTokenExpired, idTokenExpired);\n    }\n\n    return idTokenExpired;\n  }\n\n  hasAccessTokenExpiredIfExpiryExists() {\n    const { renewTimeBeforeTokenExpiresInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n    const accessTokenExpiresIn = this.storagePersistenceService.read('access_token_expires_at');\n    const accessTokenHasNotExpired = this.tokenValidationService.validateAccessTokenNotExpired(\n      accessTokenExpiresIn,\n      renewTimeBeforeTokenExpiresInSeconds\n    );\n\n    const hasExpired = !accessTokenHasNotExpired;\n\n    if (hasExpired) {\n      this.publicEventsService.fireEvent<boolean>(EventTypes.TokenExpired, hasExpired);\n    }\n\n    return hasExpired;\n  }\n\n  private decodeURIComponentSafely(token: string) {\n    if (token) {\n      return decodeURIComponent(token);\n    } else {\n      return '';\n    }\n  }\n\n  private persistAccessTokenExpirationTime(authResult: any) {\n    if (authResult?.expires_in) {\n      const accessTokenExpiryTime = new Date(new Date().toUTCString()).valueOf() + authResult.expires_in * 1000;\n      this.storagePersistenceService.write('access_token_expires_at', accessTokenExpiryTime);\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nconst STORAGE_KEY = 'redirect';\n\n@Injectable()\nexport class AutoLoginService {\n  /**\n   * Gets the stored redirect route from storage.\n   */\n  getStoredRedirectRoute(): string {\n    return localStorage.getItem(STORAGE_KEY);\n  }\n\n  /**\n   * Saves the redirect url to storage.\n   *\n   * @param url The redirect url to save.\n   */\n  saveStoredRedirectRoute(url: string): void {\n    localStorage.setItem(STORAGE_KEY, url);\n  }\n\n  /**\n   * Removes the redirect url from storage.\n   */\n  deleteStoredRedirectRoute(): void {\n    localStorage.removeItem(STORAGE_KEY);\n  }\n}\n","import { HttpParameterCodec } from '@angular/common/http';\n\nexport class UriEncoder implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { LoggerService } from '../../logging/logger.service';\n\n@Injectable()\nexport class RandomService {\n  constructor(@Inject(DOCUMENT) private readonly doc: any, private loggerService: LoggerService) {}\n\n  createRandom(requiredLength: number): string {\n    if (requiredLength <= 0) {\n      return '';\n    }\n\n    if (requiredLength > 0 && requiredLength < 7) {\n      this.loggerService.logWarning(`RandomService called with ${requiredLength} but 7 chars is the minimum, returning 10 chars`);\n      requiredLength = 10;\n    }\n\n    const length = requiredLength - 6;\n    const arr = new Uint8Array(Math.floor((length || length) / 2));\n    if (this.getCrypto()) {\n      this.getCrypto().getRandomValues(arr);\n    }\n\n    return Array.from(arr, this.toHex).join('') + this.randomString(7);\n  }\n\n  private toHex(dec) {\n    return ('0' + dec.toString(16)).substr(-2);\n  }\n\n  private randomString(length): string {\n    let result = '';\n    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    const values = new Uint32Array(length);\n    if (this.getCrypto()) {\n      this.getCrypto().getRandomValues(values);\n      for (let i = 0; i < length; i++) {\n        result += characters[values[i] % characters.length];\n      }\n    }\n\n    return result;\n  }\n\n  private getCrypto() {\n    // support for IE,  (window.crypto || window.msCrypto)\n    return this.doc.defaultView.crypto || (this.doc.defaultView as any).msCrypto;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { RandomService } from './random/random.service';\n\n@Injectable()\nexport class FlowsDataService {\n  constructor(\n    private storagePersistenceService: StoragePersistenceService,\n    private randomService: RandomService,\n    private configurationProvider: ConfigurationProvider,\n    private loggerService: LoggerService\n  ) {}\n\n  createNonce(): string {\n    const nonce = this.randomService.createRandom(40);\n    this.setNonce(nonce);\n    return nonce;\n  }\n\n  setNonce(nonce: string) {\n    this.storagePersistenceService.write('authNonce', nonce);\n  }\n\n  getAuthStateControl(): any {\n    return this.storagePersistenceService.read('authStateControl');\n  }\n\n  setAuthStateControl(authStateControl: string) {\n    this.storagePersistenceService.write('authStateControl', authStateControl);\n  }\n\n  getExistingOrCreateAuthStateControl(): any {\n    let state = this.storagePersistenceService.read('authStateControl');\n    if (!state) {\n      state = this.randomService.createRandom(40);\n      this.storagePersistenceService.write('authStateControl', state);\n    }\n    return state;\n  }\n\n  setSessionState(sessionState: any) {\n    this.storagePersistenceService.write('session_state', sessionState);\n  }\n\n  resetStorageFlowData() {\n    this.storagePersistenceService.resetStorageFlowData();\n  }\n\n  getCodeVerifier() {\n    return this.storagePersistenceService.read('codeVerifier');\n  }\n\n  createCodeVerifier() {\n    const codeVerifier = this.randomService.createRandom(67);\n    this.storagePersistenceService.write('codeVerifier', codeVerifier);\n    return codeVerifier;\n  }\n\n  isSilentRenewRunning() {\n    const storageObject = JSON.parse(this.storagePersistenceService.read('storageSilentRenewRunning'));\n\n    if (storageObject) {\n      const { silentRenewTimeoutInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n      const timeOutInMilliseconds = silentRenewTimeoutInSeconds * 1000;\n      const dateOfLaunchedProcessUtc = Date.parse(storageObject.dateOfLaunchedProcessUtc);\n      const currentDateUtc = Date.parse(new Date().toISOString());\n      const elapsedTimeInMilliseconds = Math.abs(currentDateUtc - dateOfLaunchedProcessUtc);\n      const isProbablyStuck = elapsedTimeInMilliseconds > timeOutInMilliseconds;\n\n      if (isProbablyStuck) {\n        this.loggerService.logDebug('silent renew process is probably stuck, state will be reset.');\n        this.resetSilentRenewRunning();\n        return false;\n      }\n\n      return storageObject.state === 'running';\n    }\n\n    return false;\n  }\n\n  setSilentRenewRunning() {\n    const storageObject = {\n      state: 'running',\n      dateOfLaunchedProcessUtc: new Date().toISOString(),\n    };\n\n    this.storagePersistenceService.write('storageSilentRenewRunning', JSON.stringify(storageObject));\n  }\n\n  resetSilentRenewRunning() {\n    this.storagePersistenceService.write('storageSilentRenewRunning', '');\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../../config/config.provider';\n\n@Injectable()\nexport class FlowHelper {\n  constructor(private configurationProvider: ConfigurationProvider) {}\n\n  isCurrentFlowCodeFlow() {\n    return this.currentFlowIs('code');\n  }\n\n  isCurrentFlowAnyImplicitFlow() {\n    return this.isCurrentFlowImplicitFlowWithAccessToken() || this.isCurrentFlowImplicitFlowWithoutAccessToken();\n  }\n\n  isCurrentFlowCodeFlowWithRefreshTokens() {\n    const { useRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (this.isCurrentFlowCodeFlow() && useRefreshToken) {\n      return true;\n    }\n\n    return false;\n  }\n\n  isCurrentFlowImplicitFlowWithAccessToken() {\n    return this.currentFlowIs('id_token token');\n  }\n\n  isCurrentFlowImplicitFlowWithoutAccessToken() {\n    return this.currentFlowIs('id_token');\n  }\n\n  currentFlowIs(flowTypes: string[] | string) {\n    const { responseType } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (Array.isArray(flowTypes)) {\n      return flowTypes.some((x) => responseType === x);\n    }\n\n    return responseType === flowTypes;\n  }\n}\n","import { HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { oneLineTrim } from 'common-tags';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { FlowsDataService } from '../../flows/flows-data.service';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\nimport { TokenValidationService } from '../../validation/token-validation.service';\nimport { FlowHelper } from '../flowHelper/flow-helper.service';\nimport { UriEncoder } from './uri-encoder';\n\nconst CALLBACK_PARAMS_TO_CHECK = ['code', 'state', 'token', 'id_token'];\n@Injectable()\nexport class UrlService {\n  constructor(\n    private readonly configurationProvider: ConfigurationProvider,\n    private readonly loggerService: LoggerService,\n    private readonly flowsDataService: FlowsDataService,\n    private readonly flowHelper: FlowHelper,\n    private tokenValidationService: TokenValidationService,\n    private storagePersistenceService: StoragePersistenceService\n  ) {}\n\n  getUrlParameter(urlToCheck: any, name: any): string {\n    if (!urlToCheck) {\n      return '';\n    }\n\n    if (!name) {\n      return '';\n    }\n\n    name = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n    const regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)');\n    const results = regex.exec(urlToCheck);\n    return results === null ? '' : decodeURIComponent(results[1]);\n  }\n\n  isCallbackFromSts(currentUrl: string): boolean {\n    return CALLBACK_PARAMS_TO_CHECK.some((x) => !!this.getUrlParameter(currentUrl, x));\n  }\n\n  getRefreshSessionSilentRenewUrl(customParams?: { [key: string]: string | number | boolean }): string {\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\n      return this.createUrlCodeFlowWithSilentRenew(customParams);\n    }\n\n    return this.createUrlImplicitFlowWithSilentRenew(customParams) || '';\n  }\n\n  getAuthorizeParUrl(requestUri: string): string {\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n    if (!authWellKnownEndPoints) {\n      this.loggerService.logError('authWellKnownEndpoints is undefined');\n      return null;\n    }\n\n    const authorizationEndpoint = authWellKnownEndPoints.authorizationEndpoint;\n\n    if (!authorizationEndpoint) {\n      this.loggerService.logError(`Can not create an authorize url when authorizationEndpoint is '${authorizationEndpoint}'`);\n      return null;\n    }\n\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!clientId) {\n      this.loggerService.logError(`createAuthorizeUrl could not add clientId because it was: `, clientId);\n      return null;\n    }\n\n    const urlParts = authorizationEndpoint.split('?');\n    const authorizationUrl = urlParts[0];\n\n    let params = new HttpParams({\n      fromString: urlParts[1],\n      encoder: new UriEncoder(),\n    });\n\n    params = params.set('request_uri', requestUri);\n    params = params.append('client_id', clientId);\n\n    return `${authorizationUrl}?${params}`;\n  }\n\n  getAuthorizeUrl(customParams?: { [key: string]: string | number | boolean }): string {\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\n      return this.createUrlCodeFlowAuthorize(customParams);\n    }\n\n    return this.createUrlImplicitFlowAuthorize(customParams) || '';\n  }\n\n  createEndSessionUrl(idTokenHint: string, customParamsEndSession?: { [p: string]: string | number | boolean }): string {\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const endSessionEndpoint = authWellKnownEndPoints?.endSessionEndpoint;\n\n    if (!endSessionEndpoint) {\n      return null;\n    }\n\n    const urlParts = endSessionEndpoint.split('?');\n\n    const authorizationEndsessionUrl = urlParts[0];\n\n    let params = new HttpParams({\n      fromString: urlParts[1],\n      encoder: new UriEncoder(),\n    });\n    params = params.set('id_token_hint', idTokenHint);\n\n    if (customParamsEndSession) {\n      for (const [key, value] of Object.entries({ ...customParamsEndSession })) {\n        params = params.append(key, value.toString());\n      }\n    }\n\n    const postLogoutRedirectUri = this.getPostLogoutRedirectUrl();\n\n    if (postLogoutRedirectUri) {\n      params = params.append('post_logout_redirect_uri', postLogoutRedirectUri);\n    }\n\n    return `${authorizationEndsessionUrl}?${params}`;\n  }\n\n  createRevocationEndpointBodyAccessToken(token: any): string {\n    const clientId = this.getClientId();\n\n    if (!clientId) {\n      return null;\n    }\n\n    return `client_id=${clientId}&token=${token}&token_type_hint=access_token`;\n  }\n\n  createRevocationEndpointBodyRefreshToken(token: any): string {\n    const clientId = this.getClientId();\n\n    if (!clientId) {\n      return null;\n    }\n\n    return `client_id=${clientId}&token=${token}&token_type_hint=refresh_token`;\n  }\n\n  getRevocationEndpointUrl(): string {\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const revocationEndpoint = authWellKnownEndPoints?.revocationEndpoint;\n\n    if (!revocationEndpoint) {\n      return null;\n    }\n\n    const urlParts = revocationEndpoint.split('?');\n\n    const revocationEndpointUrl = urlParts[0];\n    return revocationEndpointUrl;\n  }\n\n  createBodyForCodeFlowCodeRequest(code: string, customTokenParams?: { [p: string]: string | number | boolean }): string {\n    const codeVerifier = this.flowsDataService.getCodeVerifier();\n    if (!codeVerifier) {\n      this.loggerService.logError(`CodeVerifier is not set `, codeVerifier);\n      return null;\n    }\n\n    const clientId = this.getClientId();\n\n    if (!clientId) {\n      return null;\n    }\n\n    let dataForBody = oneLineTrim`grant_type=authorization_code\n            &client_id=${clientId}\n            &code_verifier=${codeVerifier}\n            &code=${code}`;\n\n    if (customTokenParams) {\n      const customParamText = this.composeCustomParams({ ...customTokenParams });\n      dataForBody = oneLineTrim`${dataForBody}${customParamText}`;\n    }\n\n    const silentRenewUrl = this.getSilentRenewUrl();\n\n    if (this.flowsDataService.isSilentRenewRunning() && silentRenewUrl) {\n      return oneLineTrim`${dataForBody}&redirect_uri=${silentRenewUrl}`;\n    }\n\n    const redirectUrl = this.getRedirectUrl();\n\n    if (!redirectUrl) {\n      return null;\n    }\n\n    return oneLineTrim`${dataForBody}&redirect_uri=${redirectUrl}`;\n  }\n\n  createBodyForCodeFlowRefreshTokensRequest(\n    refreshToken: string,\n    customParamsRefresh?: { [key: string]: string | number | boolean }\n  ): string {\n    const clientId = this.getClientId();\n\n    if (!clientId) {\n      return null;\n    }\n\n    let dataForBody = oneLineTrim`grant_type=refresh_token\n            &client_id=${clientId}\n            &refresh_token=${refreshToken}`;\n\n    if (customParamsRefresh) {\n      const customParamText = this.composeCustomParams({ ...customParamsRefresh });\n      dataForBody = `${dataForBody}${customParamText}`;\n    }\n\n    return dataForBody;\n  }\n\n  createBodyForParCodeFlowRequest(customParamsRequest?: { [key: string]: string | number | boolean }): string {\n    const redirectUrl = this.getRedirectUrl();\n\n    if (!redirectUrl) {\n      return null;\n    }\n\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    const nonce = this.flowsDataService.createNonce();\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\n\n    // code_challenge with \"S256\"\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\n\n    const { clientId, responseType, scope, hdParam, customParams } = this.configurationProvider.getOpenIDConfiguration();\n\n    let dataForBody = oneLineTrim`client_id=${clientId}\n            &redirect_uri=${redirectUrl}\n            &response_type=${responseType}\n            &scope=${scope}\n            &nonce=${nonce}\n            &state=${state}\n            &code_challenge=${codeChallenge}\n            &code_challenge_method=S256`;\n\n    if (hdParam) {\n      dataForBody = `${dataForBody}&hd=${hdParam}`;\n    }\n\n    if (customParams) {\n      const customParamText = this.composeCustomParams({ ...customParams });\n      dataForBody = `${dataForBody}${customParamText}`;\n    }\n\n    if (customParamsRequest) {\n      const customParamText = this.composeCustomParams({ ...customParamsRequest });\n      dataForBody = `${dataForBody}${customParamText}`;\n    }\n\n    return dataForBody;\n  }\n\n  private createAuthorizeUrl(\n    codeChallenge: string,\n    redirectUrl: string,\n    nonce: string,\n    state: string,\n    prompt?: string,\n    customRequestParams?: { [key: string]: string | number | boolean }\n  ): string {\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const authorizationEndpoint = authWellKnownEndPoints?.authorizationEndpoint;\n\n    if (!authorizationEndpoint) {\n      this.loggerService.logError(`Can not create an authorize url when authorizationEndpoint is '${authorizationEndpoint}'`);\n      return null;\n    }\n\n    const { clientId, responseType, scope, hdParam, customParams } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!clientId) {\n      this.loggerService.logError(`createAuthorizeUrl could not add clientId because it was: `, clientId);\n      return null;\n    }\n\n    if (!responseType) {\n      this.loggerService.logError(`createAuthorizeUrl could not add responseType because it was: `, responseType);\n      return null;\n    }\n\n    if (!scope) {\n      this.loggerService.logError(`createAuthorizeUrl could not add scope because it was: `, scope);\n      return null;\n    }\n\n    const urlParts = authorizationEndpoint.split('?');\n    const authorizationUrl = urlParts[0];\n\n    let params = new HttpParams({\n      fromString: urlParts[1],\n      encoder: new UriEncoder(),\n    });\n\n    params = params.set('client_id', clientId);\n    params = params.append('redirect_uri', redirectUrl);\n    params = params.append('response_type', responseType);\n    params = params.append('scope', scope);\n    params = params.append('nonce', nonce);\n    params = params.append('state', state);\n\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\n      params = params.append('code_challenge', codeChallenge);\n      params = params.append('code_challenge_method', 'S256');\n    }\n\n    if (prompt) {\n      params = params.append('prompt', prompt);\n    }\n\n    if (hdParam) {\n      params = params.append('hd', hdParam);\n    }\n\n    if (customParams) {\n      for (const [key, value] of Object.entries({ ...customParams })) {\n        params = params.append(key, value.toString());\n      }\n    }\n\n    if (customRequestParams) {\n      for (const [key, value] of Object.entries({ ...customRequestParams })) {\n        params = params.append(key, value.toString());\n      }\n    }\n\n    return `${authorizationUrl}?${params}`;\n  }\n\n  private createUrlImplicitFlowWithSilentRenew(customParams?: { [key: string]: string | number | boolean }): string {\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    const nonce = this.flowsDataService.createNonce();\n\n    const silentRenewUrl = this.getSilentRenewUrl();\n\n    if (!silentRenewUrl) {\n      return null;\n    }\n\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ', state);\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    if (authWellKnownEndPoints) {\n      return this.createAuthorizeUrl('', silentRenewUrl, nonce, state, 'none', customParams);\n    }\n\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\n    return null;\n  }\n\n  private createUrlCodeFlowWithSilentRenew(customParams?: { [key: string]: string | number | boolean }): string {\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    const nonce = this.flowsDataService.createNonce();\n\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ' + state);\n\n    // code_challenge with \"S256\"\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\n\n    const silentRenewUrl = this.getSilentRenewUrl();\n\n    if (!silentRenewUrl) {\n      return null;\n    }\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    if (authWellKnownEndPoints) {\n      return this.createAuthorizeUrl(codeChallenge, silentRenewUrl, nonce, state, 'none', customParams);\n    }\n\n    this.loggerService.logWarning('authWellKnownEndpoints is undefined');\n    return null;\n  }\n\n  private createUrlImplicitFlowAuthorize(customParams?: { [key: string]: string | number | boolean }): string {\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    const nonce = this.flowsDataService.createNonce();\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\n\n    const redirectUrl = this.getRedirectUrl();\n\n    if (!redirectUrl) {\n      return null;\n    }\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    if (authWellKnownEndPoints) {\n      return this.createAuthorizeUrl('', redirectUrl, nonce, state, null, customParams);\n    }\n\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\n    return null;\n  }\n\n  private createUrlCodeFlowAuthorize(customParams?: { [key: string]: string | number | boolean }): string {\n    const state = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    const nonce = this.flowsDataService.createNonce();\n    this.loggerService.logDebug('Authorize created. adding myautostate: ' + state);\n\n    const redirectUrl = this.getRedirectUrl();\n\n    if (!redirectUrl) {\n      return null;\n    }\n\n    // code_challenge with \"S256\"\n    const codeVerifier = this.flowsDataService.createCodeVerifier();\n    const codeChallenge = this.tokenValidationService.generateCodeChallenge(codeVerifier);\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    if (authWellKnownEndPoints) {\n      return this.createAuthorizeUrl(codeChallenge, redirectUrl, nonce, state, null, customParams);\n    }\n\n    this.loggerService.logError('authWellKnownEndpoints is undefined');\n    return null;\n  }\n\n  private getRedirectUrl(): string {\n    const { redirectUrl } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!redirectUrl) {\n      this.loggerService.logError(`could not get redirectUrl, was: `, redirectUrl);\n      return null;\n    }\n\n    return redirectUrl;\n  }\n\n  private getSilentRenewUrl(): string {\n    const { silentRenewUrl } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!silentRenewUrl) {\n      this.loggerService.logError(`could not get silentRenewUrl, was: `, silentRenewUrl);\n      return null;\n    }\n\n    return silentRenewUrl;\n  }\n\n  private getPostLogoutRedirectUrl(): string {\n    const { postLogoutRedirectUri } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!postLogoutRedirectUri) {\n      this.loggerService.logError(`could not get postLogoutRedirectUri, was: `, postLogoutRedirectUri);\n      return null;\n    }\n\n    return postLogoutRedirectUri;\n  }\n\n  private getClientId(): string {\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!clientId) {\n      this.loggerService.logError(`could not get clientId, was: `, clientId);\n      return null;\n    }\n\n    return clientId;\n  }\n\n  private composeCustomParams(customParams: { [key: string]: string | number | boolean }) {\n    let customParamText = '';\n\n    for (const [key, value] of Object.entries(customParams)) {\n      customParamText = customParamText.concat(`&${key}=${value.toString()}`);\n    }\n\n    return customParamText;\n  }\n}\n","import { HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable, of, throwError, timer } from 'rxjs';\nimport { catchError, mergeMap, retryWhen, switchMap } from 'rxjs/operators';\nimport { DataService } from '../../api/data.service';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { TokenValidationService } from '../../validation/token-validation.service';\nimport { CallbackContext } from '../callback-context';\nimport { FlowsDataService } from '../flows-data.service';\n\n@Injectable()\nexport class CodeFlowCallbackHandlerService {\n  constructor(\n    private readonly urlService: UrlService,\n    private readonly loggerService: LoggerService,\n    private readonly tokenValidationService: TokenValidationService,\n    private readonly flowsDataService: FlowsDataService,\n    private readonly configurationProvider: ConfigurationProvider,\n    private readonly storagePersistenceService: StoragePersistenceService,\n    private readonly dataService: DataService\n  ) {}\n\n  // STEP 1 Code Flow\n  codeFlowCallback(urlToCheck: string): Observable<CallbackContext> {\n    const code = this.urlService.getUrlParameter(urlToCheck, 'code');\n    const state = this.urlService.getUrlParameter(urlToCheck, 'state');\n    const sessionState = this.urlService.getUrlParameter(urlToCheck, 'session_state') || null;\n\n    if (!state) {\n      this.loggerService.logDebug('no state in url');\n      return throwError('no state in url');\n    }\n\n    if (!code) {\n      this.loggerService.logDebug('no code in url');\n      return throwError('no code in url');\n    }\n\n    this.loggerService.logDebug('running validation for callback', urlToCheck);\n\n    const initialCallbackContext = {\n      code,\n      refreshToken: null,\n      state,\n      sessionState,\n      authResult: null,\n      isRenewProcess: false,\n      jwtKeys: null,\n      validationResult: null,\n      existingIdToken: null,\n    };\n\n    return of(initialCallbackContext);\n  }\n\n  // STEP 2 Code Flow //  Code Flow Silent Renew starts here\n  codeFlowCodeRequest(callbackContext: CallbackContext): Observable<CallbackContext> {\n    const authStateControl = this.flowsDataService.getAuthStateControl();\n\n    const isStateCorrect = this.tokenValidationService.validateStateFromHashCallback(callbackContext.state, authStateControl);\n\n    if (!isStateCorrect) {\n      this.loggerService.logWarning('codeFlowCodeRequest incorrect state');\n      return throwError('codeFlowCodeRequest incorrect state');\n    }\n\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const tokenEndpoint = authWellKnown?.tokenEndpoint;\n    if (!tokenEndpoint) {\n      return throwError('Token Endpoint not defined');\n    }\n\n    let headers: HttpHeaders = new HttpHeaders();\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\n\n    const config = this.configurationProvider.getOpenIDConfiguration();\n\n    const bodyForCodeFlow = this.urlService.createBodyForCodeFlowCodeRequest(callbackContext.code, config?.customTokenParams);\n\n    return this.dataService.post(tokenEndpoint, bodyForCodeFlow, headers).pipe(\n      switchMap((response) => {\n        let authResult: any = new Object();\n        authResult = response;\n        authResult.state = callbackContext.state;\n        authResult.session_state = callbackContext.sessionState;\n\n        callbackContext.authResult = authResult;\n        return of(callbackContext);\n      }),\n      retryWhen((error) => this.handleRefreshRetry(error)),\n      catchError((error) => {\n        const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\n        const errorMessage = `OidcService code request ${stsServer}`;\n        this.loggerService.logError(errorMessage, error);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  private handleRefreshRetry(errors: Observable<any>): Observable<any> {\n    return errors.pipe(\n      mergeMap((error) => {\n        // retry token refresh if there is no internet connection\n        if (error && error instanceof HttpErrorResponse && error.error instanceof ProgressEvent && error.error.type === 'error') {\n          const { stsServer, refreshTokenRetryInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n          const errorMessage = `OidcService code request ${stsServer} - no internet connection`;\n          this.loggerService.logWarning(errorMessage, error);\n          return timer(refreshTokenRetryInSeconds * 1000);\n        }\n        return throwError(error);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, of, throwError } from 'rxjs';\nimport { map, retry, switchMap } from 'rxjs/operators';\nimport { DataService } from '../api/data.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { EventTypes } from '../public-events/event-types';\nimport { PublicEventsService } from '../public-events/public-events.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\n\n@Injectable()\nexport class UserService {\n  private userDataInternal$ = new BehaviorSubject<any>(null);\n\n  get userData$() {\n    return this.userDataInternal$.asObservable();\n  }\n\n  constructor(\n    private oidcDataService: DataService,\n    private storagePersistenceService: StoragePersistenceService,\n    private eventService: PublicEventsService,\n    private loggerService: LoggerService,\n    private tokenHelperService: TokenHelperService,\n    private flowHelper: FlowHelper,\n    private configurationProvider: ConfigurationProvider\n  ) {}\n\n  // TODO CHECK PARAMETERS\n  //  validationResult.idToken can be the complete validationResult\n  getAndPersistUserDataInStore(isRenewProcess = false, idToken?: any, decodedIdToken?: any): Observable<any> {\n    idToken = idToken || this.storagePersistenceService.getIdToken();\n    decodedIdToken = decodedIdToken || this.tokenHelperService.getPayloadFromToken(idToken, false);\n\n    const existingUserDataFromStorage = this.getUserDataFromStore();\n    const haveUserData = !!existingUserDataFromStorage;\n    const isCurrentFlowImplicitFlowWithAccessToken = this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken();\n    const isCurrentFlowCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\n\n    const accessToken = this.storagePersistenceService.getAccessToken();\n    if (!(isCurrentFlowImplicitFlowWithAccessToken || isCurrentFlowCodeFlow)) {\n      this.loggerService.logDebug('authorizedCallback id_token flow');\n      this.loggerService.logDebug('accessToken', accessToken);\n\n      this.setUserDataToStore(decodedIdToken);\n      return of(decodedIdToken);\n    }\n\n    const { renewUserInfoAfterTokenRenew } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!isRenewProcess || renewUserInfoAfterTokenRenew || !haveUserData) {\n      return this.getUserDataOidcFlowAndSave(decodedIdToken.sub).pipe(\n        switchMap((userData) => {\n          this.loggerService.logDebug('Received user data', userData);\n          if (!!userData) {\n            this.loggerService.logDebug('accessToken', accessToken);\n            return of(userData);\n          } else {\n            return throwError('no user data, request failed');\n          }\n        })\n      );\n    }\n\n    return of(existingUserDataFromStorage);\n  }\n\n  getUserDataFromStore(): any {\n    return this.storagePersistenceService.read('userData') || null;\n  }\n\n  publishUserDataIfExists() {\n    const userData = this.getUserDataFromStore();\n    if (userData) {\n      this.userDataInternal$.next(userData);\n      this.eventService.fireEvent(EventTypes.UserDataChanged, userData);\n    }\n  }\n\n  setUserDataToStore(value: any): void {\n    this.storagePersistenceService.write('userData', value);\n    this.userDataInternal$.next(value);\n    this.eventService.fireEvent(EventTypes.UserDataChanged, value);\n  }\n\n  resetUserDataInStore(): void {\n    this.storagePersistenceService.remove('userData');\n    this.eventService.fireEvent(EventTypes.UserDataChanged, null);\n    this.userDataInternal$.next(null);\n  }\n\n  private getUserDataOidcFlowAndSave(idTokenSub: any): Observable<any> {\n    return this.getIdentityUserData().pipe(\n      map((data: any) => {\n        if (this.validateUserDataSubIdToken(idTokenSub, data?.sub)) {\n          this.setUserDataToStore(data);\n          return data;\n        } else {\n          // something went wrong, userdata sub does not match that from id_token\n          this.loggerService.logWarning('authorizedCallback, User data sub does not match sub in id_token');\n          this.loggerService.logDebug('authorizedCallback, token(s) validation failed, resetting');\n          this.resetUserDataInStore();\n          return null;\n        }\n      })\n    );\n  }\n\n  private getIdentityUserData(): Observable<any> {\n    const token = this.storagePersistenceService.getAccessToken();\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n    if (!authWellKnownEndPoints) {\n      this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined');\n      return throwError('authWellKnownEndpoints is undefined');\n    }\n\n    const userinfoEndpoint = authWellKnownEndPoints.userinfoEndpoint;\n\n    if (!userinfoEndpoint) {\n      this.loggerService.logError(\n        'init check session: authWellKnownEndpoints.userinfo_endpoint is undefined; set auto_userinfo = false in config'\n      );\n      // TODO: HERE\n      // Bisogna modificare il path e far intervenire proxy\n      if (window.location.href.includes('localhost')) {\n        let myArray = userinfoEndpoint.split('/');\n        myArray.splice(0, 3);\n        let pathModified = myArray.join('/');\n        console.log(myArray.join('/'));\n\n        return this.oidcDataService.get(pathModified, token).pipe(retry(2));\n      }\n      return throwError('authWellKnownEndpoints.userinfo_endpoint is undefined');\n    }\n\n    return this.oidcDataService.get(userinfoEndpoint, token).pipe(retry(2));\n  }\n\n  private validateUserDataSubIdToken(idTokenSub: any, userdataSub: any): boolean {\n    if (!idTokenSub) {\n      return false;\n    }\n\n    if (!userdataSub) {\n      return false;\n    }\n\n    if ((idTokenSub as string) !== (userdataSub as string)) {\n      this.loggerService.logDebug('validateUserDataSubIdToken failed', idTokenSub, userdataSub);\n      return false;\n    }\n\n    return true;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { UserService } from '../userData/user-service';\nimport { FlowsDataService } from './flows-data.service';\n\n@Injectable()\nexport class ResetAuthDataService {\n  constructor(\n    private readonly authStateService: AuthStateService,\n    private readonly flowsDataService: FlowsDataService,\n    private readonly userService: UserService\n  ) {}\n\n  resetAuthorizationData(): void {\n    this.userService.resetUserDataInStore();\n    this.flowsDataService.resetStorageFlowData();\n    this.authStateService.setUnauthorizedAndFireEvent();\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { Observable, of } from 'rxjs';\nimport { LoggerService } from '../../logging/logger.service';\nimport { CallbackContext } from '../callback-context';\nimport { FlowsDataService } from '../flows-data.service';\nimport { ResetAuthDataService } from '../reset-auth-data.service';\n\n@Injectable()\nexport class ImplicitFlowCallbackHandlerService {\n  constructor(\n    private readonly resetAuthDataService: ResetAuthDataService,\n    private readonly loggerService: LoggerService,\n    private readonly flowsDataService: FlowsDataService,\n    @Inject(DOCUMENT) private readonly doc: any\n  ) {}\n\n  // STEP 1 Code Flow\n  // STEP 1 Implicit Flow\n  implicitFlowCallback(hash?: string): Observable<CallbackContext> {\n    const isRenewProcessData = this.flowsDataService.isSilentRenewRunning();\n\n    this.loggerService.logDebug('BEGIN authorizedCallback, no auth data');\n    if (!isRenewProcessData) {\n      this.resetAuthDataService.resetAuthorizationData();\n    }\n\n    hash = hash || this.doc.location.hash.substr(1);\n\n    const authResult: any = hash.split('&').reduce((resultData: any, item: string) => {\n      const parts = item.split('=');\n      resultData[parts.shift() as string] = parts.join('=');\n      return resultData;\n    }, {});\n\n    const callbackContext = {\n      code: null,\n      refreshToken: null,\n      state: null,\n      sessionState: null,\n      authResult,\n      isRenewProcess: isRenewProcessData,\n      jwtKeys: null,\n      validationResult: null,\n      existingIdToken: null,\n    };\n\n    return of(callbackContext);\n  }\n}\n","/* eslint-disable no-shadow */\nexport enum AuthorizedState {\n  Authorized = 'Authorized',\n  Unauthorized = 'Unauthorized',\n  Unknown = 'Unknown',\n}\n","/* eslint-disable no-shadow */\nexport enum ValidationResult {\n  NotSet = 'NotSet',\n  StatesDoNotMatch = 'StatesDoNotMatch',\n  SignatureFailed = 'SignatureFailed',\n  IncorrectNonce = 'IncorrectNonce',\n  RequiredPropertyMissing = 'RequiredPropertyMissing',\n  MaxOffsetExpired = 'MaxOffsetExpired',\n  IssDoesNotMatchIssuer = 'IssDoesNotMatchIssuer',\n  NoAuthWellKnownEndPoints = 'NoAuthWellKnownEndPoints',\n  IncorrectAud = 'IncorrectAud',\n  IncorrectIdTokenClaimsAfterRefresh = 'IncorrectIdTokenClaimsAfterRefresh',\n  IncorrectAzp = 'IncorrectAzp',\n  TokenExpired = 'TokenExpired',\n  IncorrectAtHash = 'IncorrectAtHash',\n  Ok = 'Ok',\n  LoginRequired = 'LoginRequired',\n  SecureTokenServerError = 'SecureTokenServerError',\n}\n","import { HttpResponse } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { throwError } from 'rxjs';\nimport { catchError, retry } from 'rxjs/operators';\nimport { DataService } from '../api/data.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { JwtKeys } from '../validation/jwtkeys';\n\n@Injectable()\nexport class SigninKeyDataService {\n  constructor(\n    private storagePersistenceService: StoragePersistenceService,\n    private loggerService: LoggerService,\n    private dataService: DataService\n  ) {}\n\n  getSigningKeys() {\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const jwksUri = authWellKnownEndPoints?.jwksUri;\n    if (!jwksUri) {\n      const error = `getSigningKeys: authWellKnownEndpoints.jwksUri is: '${jwksUri}'`;\n      this.loggerService.logWarning(error);\n      return throwError(error);\n    }\n\n    this.loggerService.logDebug('Getting signinkeys from ', jwksUri);\n\n    return this.dataService.get<JwtKeys>(jwksUri).pipe(retry(2), catchError(this.handleErrorGetSigningKeys));\n  }\n\n  private handleErrorGetSigningKeys(errorResponse: HttpResponse<any> | any) {\n    let errMsg = '';\n    if (errorResponse instanceof HttpResponse) {\n      const body = errorResponse.body || {};\n      const err = JSON.stringify(body);\n      const { status, statusText } = errorResponse;\n      errMsg = `${status || ''} - ${statusText || ''} ${err || ''}`;\n    } else {\n      const { message } = errorResponse;\n      errMsg = !!message ? message : `${errorResponse}`;\n    }\n    this.loggerService.logError(errMsg);\n    return throwError(new Error(errMsg));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { catchError, switchMap, tap } from 'rxjs/operators';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { AuthorizedState } from '../../authState/authorized-state';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\nimport { JwtKeys } from '../../validation/jwtkeys';\nimport { ValidationResult } from '../../validation/validation-result';\nimport { CallbackContext } from '../callback-context';\nimport { FlowsDataService } from '../flows-data.service';\nimport { ResetAuthDataService } from '../reset-auth-data.service';\nimport { SigninKeyDataService } from '../signin-key-data.service';\n\nconst JWT_KEYS = 'jwtKeys';\n\n@Injectable()\nexport class HistoryJwtKeysCallbackHandlerService {\n  constructor(\n    private readonly loggerService: LoggerService,\n    private readonly configurationProvider: ConfigurationProvider,\n    private readonly authStateService: AuthStateService,\n    private readonly flowsDataService: FlowsDataService,\n    private readonly signInKeyDataService: SigninKeyDataService,\n    private readonly storagePersistenceService: StoragePersistenceService,\n    private readonly resetAuthDataService: ResetAuthDataService\n  ) {}\n\n  // STEP 3 Code Flow, STEP 2 Implicit Flow, STEP 3 Refresh Token\n  callbackHistoryAndResetJwtKeys(callbackContext: CallbackContext): Observable<CallbackContext> {\n    this.storagePersistenceService.write('authnResult', callbackContext.authResult);\n\n    if (this.historyCleanUpTurnedOn() && !callbackContext.isRenewProcess) {\n      this.resetBrowserHistory();\n    } else {\n      this.loggerService.logDebug('history clean up inactive');\n    }\n\n    if (callbackContext.authResult.error) {\n      const errorMessage = `authorizedCallbackProcedure came with error: ${callbackContext.authResult.error}`;\n      this.loggerService.logDebug(errorMessage);\n      this.resetAuthDataService.resetAuthorizationData();\n      this.flowsDataService.setNonce('');\n      this.handleResultErrorFromCallback(callbackContext.authResult, callbackContext.isRenewProcess);\n      return throwError(errorMessage);\n    }\n\n    this.loggerService.logDebug(callbackContext.authResult);\n    this.loggerService.logDebug('authorizedCallback created, begin token validation');\n\n    return this.signInKeyDataService.getSigningKeys().pipe(\n      tap((jwtKeys: JwtKeys) => this.storeSigningKeys(jwtKeys)),\n      catchError((err) => {\n        // fallback: try to load jwtKeys from storage\n        const storedJwtKeys = this.readSigningKeys();\n        if (!!storedJwtKeys) {\n          this.loggerService.logWarning(`Failed to retrieve signing keys, fallback to stored keys`);\n          return of(storedJwtKeys);\n        }\n\n        return throwError(err);\n      }),\n      switchMap((jwtKeys) => {\n        if (jwtKeys) {\n          callbackContext.jwtKeys = jwtKeys;\n\n          return of(callbackContext);\n        }\n\n        const errorMessage = `Failed to retrieve signing key`;\n        this.loggerService.logWarning(errorMessage);\n        return throwError(errorMessage);\n      }),\n      catchError((err) => {\n        const errorMessage = `Failed to retrieve signing key with error: ${err}`;\n        this.loggerService.logWarning(errorMessage);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  private handleResultErrorFromCallback(result: any, isRenewProcess: boolean) {\n    let validationResult = ValidationResult.SecureTokenServerError;\n\n    if ((result.error as string) === 'login_required') {\n      validationResult = ValidationResult.LoginRequired;\n    }\n\n    this.authStateService.updateAndPublishAuthState({\n      authorizationState: AuthorizedState.Unauthorized,\n      validationResult,\n      isRenewProcess,\n    });\n  }\n\n  private historyCleanUpTurnedOn() {\n    const { historyCleanupOff } = this.configurationProvider.getOpenIDConfiguration();\n    return !historyCleanupOff;\n  }\n\n  private resetBrowserHistory() {\n    window.history.replaceState({}, window.document.title, window.location.origin + window.location.pathname);\n  }\n\n  private storeSigningKeys(jwtKeys: JwtKeys) {\n    this.storagePersistenceService.write(JWT_KEYS, jwtKeys);\n  }\n\n  private readSigningKeys() {\n    return this.storagePersistenceService.read(JWT_KEYS);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { AuthorizedState } from '../../authState/authorized-state';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { UserService } from '../../userData/user-service';\nimport { StateValidationResult } from '../../validation/state-validation-result';\nimport { CallbackContext } from '../callback-context';\nimport { FlowsDataService } from '../flows-data.service';\nimport { ResetAuthDataService } from '../reset-auth-data.service';\n\n@Injectable()\nexport class UserCallbackHandlerService {\n  constructor(\n    private readonly loggerService: LoggerService,\n    private readonly configurationProvider: ConfigurationProvider,\n    private readonly authStateService: AuthStateService,\n    private readonly flowsDataService: FlowsDataService,\n    private readonly userService: UserService,\n    private readonly resetAuthDataService: ResetAuthDataService\n  ) {}\n\n  // STEP 5 userData\n  callbackUser(callbackContext: CallbackContext): Observable<CallbackContext> {\n    const { isRenewProcess, validationResult, authResult, refreshToken } = callbackContext;\n    const { autoUserinfo, renewUserInfoAfterTokenRenew } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!autoUserinfo) {\n      if (!isRenewProcess || renewUserInfoAfterTokenRenew) {\n        // userData is set to the id_token decoded, auto get user data set to false\n        if (validationResult.decodedIdToken) {\n          this.userService.setUserDataToStore(validationResult.decodedIdToken);\n        }\n      }\n\n      if (!isRenewProcess && !refreshToken) {\n        this.flowsDataService.setSessionState(authResult.session_state);\n      }\n\n      this.publishAuthorizedState(validationResult, isRenewProcess);\n      return of(callbackContext);\n    }\n\n    return this.userService.getAndPersistUserDataInStore(isRenewProcess, validationResult.idToken, validationResult.decodedIdToken).pipe(\n      switchMap((userData) => {\n        if (!!userData) {\n          if (!refreshToken) {\n            this.flowsDataService.setSessionState(authResult.session_state);\n          }\n\n          this.publishAuthorizedState(validationResult, isRenewProcess);\n\n          return of(callbackContext);\n        } else {\n          this.resetAuthDataService.resetAuthorizationData();\n          this.publishUnauthorizedState(validationResult, isRenewProcess);\n          const errorMessage = `Called for userData but they were ${userData}`;\n          this.loggerService.logWarning(errorMessage);\n          return throwError(errorMessage);\n        }\n      }),\n      catchError((err) => {\n        const errorMessage = `Failed to retrieve user info with error:  ${err}`;\n        this.loggerService.logWarning(errorMessage);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  private publishAuthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\n    this.authStateService.updateAndPublishAuthState({\n      authorizationState: AuthorizedState.Authorized,\n      validationResult: stateValidationResult.state,\n      isRenewProcess,\n    });\n  }\n\n  private publishUnauthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\n    this.authStateService.updateAndPublishAuthState({\n      authorizationState: AuthorizedState.Unauthorized,\n      validationResult: stateValidationResult.state,\n      isRenewProcess,\n    });\n  }\n}\n","import { ValidationResult } from './validation-result';\n\nexport class StateValidationResult {\n  constructor(\n    public accessToken = '',\n    public idToken = '',\n    public authResponseIsValid = false,\n    public decodedIdToken: any = {},\n    public state: ValidationResult = ValidationResult.NotSet\n  ) {}\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class EqualityService {\n  isStringEqualOrNonOrderedArrayEqual(value1: string | any[], value2: string | any[]) {\n    if (this.isNullOrUndefined(value1)) {\n      return false;\n    }\n\n    if (this.isNullOrUndefined(value2)) {\n      return false;\n    }\n\n    if (this.oneValueIsStringAndTheOtherIsArray(value1, value2)) {\n      return false;\n    }\n\n    if (this.bothValuesAreStrings(value1, value2)) {\n      return value1 === value2;\n    }\n\n    if (this.bothValuesAreArrays(value1, value2)) {\n      return this.arraysHaveEqualContent(value1 as any[], value2 as any[]);\n    }\n\n    return false;\n  }\n\n  areEqual(value1: string | any[] | any | null | undefined, value2: string | any[] | any | null | undefined) {\n    if (!value1 || !value2) {\n      return false;\n    }\n\n    if (this.bothValuesAreArrays(value1, value2)) {\n      return this.arraysStrictEqual(value1 as any[], value2 as any[]);\n    }\n\n    if (this.bothValuesAreStrings(value1, value2)) {\n      return value1 === value2;\n    }\n\n    if (this.bothValuesAreObjects(value1, value2)) {\n      return JSON.stringify(value1).toLowerCase() === JSON.stringify(value2).toLowerCase();\n    }\n\n    if (this.oneValueIsStringAndTheOtherIsArray(value1, value2)) {\n      if (Array.isArray(value1) && this.valueIsString(value2)) {\n        return value1[0] === value2;\n      }\n      if (Array.isArray(value2) && this.valueIsString(value1)) {\n        return value2[0] === value1;\n      }\n    }\n  }\n\n  private oneValueIsStringAndTheOtherIsArray(value1: string | any | any[], value2: string | any | any[]) {\n    return (Array.isArray(value1) && this.valueIsString(value2)) || (Array.isArray(value2) && this.valueIsString(value1));\n  }\n\n  private bothValuesAreObjects(value1: string | any | any[], value2: string | any | any[]) {\n    return this.valueIsObject(value1) && this.valueIsObject(value2);\n  }\n\n  private bothValuesAreStrings(value1: string | any | any[], value2: string | any | any[]) {\n    return this.valueIsString(value1) && this.valueIsString(value2);\n  }\n\n  private bothValuesAreArrays(value1: string | any | any[], value2: string | any | any[]) {\n    return Array.isArray(value1) && Array.isArray(value2);\n  }\n\n  private valueIsString(value: any) {\n    return typeof value === 'string' || value instanceof String;\n  }\n\n  private valueIsObject(value: any) {\n    return typeof value === 'object';\n  }\n\n  private arraysStrictEqual(arr1: Array<string>, arr2: Array<string>) {\n    if (arr1.length !== arr2.length) {\n      return false;\n    }\n\n    for (let i = arr1.length; i--; ) {\n      if (arr1[i] !== arr2[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  private arraysHaveEqualContent(arr1: Array<string>, arr2: Array<string>) {\n    if (arr1.length !== arr2.length) {\n      return false;\n    }\n\n    return arr1.some((v) => arr2.includes(v));\n  }\n\n  private isNullOrUndefined(val: any) {\n    return val === null || val === undefined;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { CallbackContext } from '../flows/callback-context';\nimport { LoggerService } from '../logging/logger.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { EqualityService } from '../utils/equality/equality.service';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { TokenHelperService } from '../utils/tokenHelper/oidc-token-helper.service';\nimport { StateValidationResult } from './state-validation-result';\nimport { TokenValidationService } from './token-validation.service';\nimport { ValidationResult } from './validation-result';\n\n@Injectable()\nexport class StateValidationService {\n  constructor(\n    private storagePersistenceService: StoragePersistenceService,\n    private tokenValidationService: TokenValidationService,\n    private tokenHelperService: TokenHelperService,\n    private loggerService: LoggerService,\n    private configurationProvider: ConfigurationProvider,\n    private equalityService: EqualityService,\n    private flowHelper: FlowHelper\n  ) {}\n\n  getValidatedStateResult(callbackContext: CallbackContext): StateValidationResult {\n    if (!callbackContext) {\n      return new StateValidationResult('', '', false, {});\n    }\n\n    if (callbackContext.authResult.error) {\n      return new StateValidationResult('', '', false, {});\n    }\n\n    return this.validateState(callbackContext);\n  }\n\n  validateState(callbackContext): StateValidationResult {\n    const toReturn = new StateValidationResult();\n    const authStateControl = this.storagePersistenceService.read('authStateControl');\n\n    if (!this.tokenValidationService.validateStateFromHashCallback(callbackContext.authResult.state, authStateControl)) {\n      this.loggerService.logWarning('authorizedCallback incorrect state');\n      toReturn.state = ValidationResult.StatesDoNotMatch;\n      this.handleUnsuccessfulValidation();\n      return toReturn;\n    }\n\n    const isCurrentFlowImplicitFlowWithAccessToken = this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken();\n    const isCurrentFlowCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\n\n    if (isCurrentFlowImplicitFlowWithAccessToken || isCurrentFlowCodeFlow) {\n      toReturn.accessToken = callbackContext.authResult.access_token;\n    }\n\n    if (callbackContext.authResult.id_token) {\n      const {\n        clientId,\n        issValidationOff,\n        maxIdTokenIatOffsetAllowedInSeconds,\n        disableIatOffsetValidation,\n        ignoreNonceAfterRefresh,\n      } = this.configurationProvider.getOpenIDConfiguration();\n\n      toReturn.idToken = callbackContext.authResult.id_token;\n\n      toReturn.decodedIdToken = this.tokenHelperService.getPayloadFromToken(toReturn.idToken, false);\n\n      if (!this.tokenValidationService.validateSignatureIdToken(toReturn.idToken, callbackContext.jwtKeys)) {\n        this.loggerService.logDebug('authorizedCallback Signature validation failed id_token');\n        toReturn.state = ValidationResult.SignatureFailed;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      const authNonce = this.storagePersistenceService.read('authNonce');\n\n      if (!this.tokenValidationService.validateIdTokenNonce(toReturn.decodedIdToken, authNonce, ignoreNonceAfterRefresh)) {\n        this.loggerService.logWarning('authorizedCallback incorrect nonce');\n        toReturn.state = ValidationResult.IncorrectNonce;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.tokenValidationService.validateRequiredIdToken(toReturn.decodedIdToken)) {\n        this.loggerService.logDebug('authorizedCallback Validation, one of the REQUIRED properties missing from id_token');\n        toReturn.state = ValidationResult.RequiredPropertyMissing;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (\n        !this.tokenValidationService.validateIdTokenIatMaxOffset(\n          toReturn.decodedIdToken,\n          maxIdTokenIatOffsetAllowedInSeconds,\n          disableIatOffsetValidation\n        )\n      ) {\n        this.loggerService.logWarning('authorizedCallback Validation, iat rejected id_token was issued too far away from the current time');\n        toReturn.state = ValidationResult.MaxOffsetExpired;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n      if (authWellKnownEndPoints) {\n        if (issValidationOff) {\n          this.loggerService.logDebug('iss validation is turned off, this is not recommended!');\n        } else if (\n          !issValidationOff &&\n          !this.tokenValidationService.validateIdTokenIss(toReturn.decodedIdToken, authWellKnownEndPoints.issuer)\n        ) {\n          this.loggerService.logWarning('authorizedCallback incorrect iss does not match authWellKnownEndpoints issuer');\n          toReturn.state = ValidationResult.IssDoesNotMatchIssuer;\n          this.handleUnsuccessfulValidation();\n          return toReturn;\n        }\n      } else {\n        this.loggerService.logWarning('authWellKnownEndpoints is undefined');\n        toReturn.state = ValidationResult.NoAuthWellKnownEndPoints;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.tokenValidationService.validateIdTokenAud(toReturn.decodedIdToken, clientId)) {\n        this.loggerService.logWarning('authorizedCallback incorrect aud');\n        toReturn.state = ValidationResult.IncorrectAud;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.tokenValidationService.validateIdTokenAzpExistsIfMoreThanOneAud(toReturn.decodedIdToken)) {\n        this.loggerService.logWarning('authorizedCallback missing azp');\n        toReturn.state = ValidationResult.IncorrectAzp;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.tokenValidationService.validateIdTokenAzpValid(toReturn.decodedIdToken, clientId)) {\n        this.loggerService.logWarning('authorizedCallback incorrect azp');\n        toReturn.state = ValidationResult.IncorrectAzp;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.isIdTokenAfterRefreshTokenRequestValid(callbackContext, toReturn.decodedIdToken)) {\n        this.loggerService.logWarning('authorizedCallback pre, post id_token claims do not match in refresh');\n        toReturn.state = ValidationResult.IncorrectIdTokenClaimsAfterRefresh;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n\n      if (!this.tokenValidationService.validateIdTokenExpNotExpired(toReturn.decodedIdToken)) {\n        this.loggerService.logWarning('authorizedCallback id token expired');\n        toReturn.state = ValidationResult.TokenExpired;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n    } else {\n      this.loggerService.logDebug('No id_token found, skipping id_token validation');\n    }\n\n    // flow id_token\n    if (!isCurrentFlowImplicitFlowWithAccessToken && !isCurrentFlowCodeFlow) {\n      toReturn.authResponseIsValid = true;\n      toReturn.state = ValidationResult.Ok;\n      this.handleSuccessfulValidation();\n      this.handleUnsuccessfulValidation();\n      return toReturn;\n    }\n\n    // only do check if id_token returned, no always the case when using refresh tokens\n    if (callbackContext.authResult.id_token) {\n      const idTokenHeader = this.tokenHelperService.getHeaderFromToken(toReturn.idToken, false);\n\n      // The at_hash is optional for the code flow\n      if (isCurrentFlowCodeFlow && !(toReturn.decodedIdToken.at_hash as string)) {\n        this.loggerService.logDebug('Code Flow active, and no at_hash in the id_token, skipping check!');\n      } else if (\n        !this.tokenValidationService.validateIdTokenAtHash(\n          toReturn.accessToken,\n          toReturn.decodedIdToken.at_hash,\n          idTokenHeader.alg // 'RSA256'\n        ) ||\n        !toReturn.accessToken\n      ) {\n        this.loggerService.logWarning('authorizedCallback incorrect at_hash');\n        toReturn.state = ValidationResult.IncorrectAtHash;\n        this.handleUnsuccessfulValidation();\n        return toReturn;\n      }\n    }\n\n    toReturn.authResponseIsValid = true;\n    toReturn.state = ValidationResult.Ok;\n    this.handleSuccessfulValidation();\n    return toReturn;\n  }\n\n  private isIdTokenAfterRefreshTokenRequestValid(callbackContext: CallbackContext, newIdToken: any): boolean {\n    const { useRefreshToken, disableRefreshIdTokenAuthTimeValidation } = this.configurationProvider.getOpenIDConfiguration();\n    if (!useRefreshToken) {\n      return true;\n    }\n\n    if (!callbackContext.existingIdToken) {\n      return true;\n    }\n    const decodedIdToken = this.tokenHelperService.getPayloadFromToken(callbackContext.existingIdToken, false);\n\n    // Upon successful validation of the Refresh Token, the response body is the Token Response of Section 3.1.3.3\n    // except that it might not contain an id_token.\n\n    // If an ID Token is returned as a result of a token refresh request, the following requirements apply:\n\n    // its iss Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\n    if (decodedIdToken.iss !== newIdToken.iss) {\n      this.loggerService.logDebug(`iss do not match: ${decodedIdToken.iss} ${newIdToken.iss}`);\n      return false;\n    }\n    // its azp Claim Value MUST be the same as in the ID Token issued when the original authentication occurred;\n    //   if no azp Claim was present in the original ID Token, one MUST NOT be present in the new ID Token, and\n    // otherwise, the same rules apply as apply when issuing an ID Token at the time of the original authentication.\n    if (decodedIdToken.azp !== newIdToken.azp) {\n      this.loggerService.logDebug(`azp do not match: ${decodedIdToken.azp} ${newIdToken.azp}`);\n      return false;\n    }\n    // its sub Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\n    if (decodedIdToken.sub !== newIdToken.sub) {\n      this.loggerService.logDebug(`sub do not match: ${decodedIdToken.sub} ${newIdToken.sub}`);\n      return false;\n    }\n\n    // its aud Claim Value MUST be the same as in the ID Token issued when the original authentication occurred,\n    if (!this.equalityService.isStringEqualOrNonOrderedArrayEqual(decodedIdToken?.aud, newIdToken?.aud)) {\n      this.loggerService.logDebug(`aud in new id_token is not valid: '${decodedIdToken?.aud}' '${newIdToken.aud}'`);\n      return false;\n    }\n\n    if (disableRefreshIdTokenAuthTimeValidation) {\n      return true;\n    }\n\n    // its iat Claim MUST represent the time that the new ID Token is issued,\n    // if the ID Token contains an auth_time Claim, its value MUST represent the time of the original authentication\n    // - not the time that the new ID token is issued,\n    if (decodedIdToken.auth_time !== newIdToken.auth_time) {\n      this.loggerService.logDebug(`auth_time do not match: ${decodedIdToken.auth_time} ${newIdToken.auth_time}`);\n      return false;\n    }\n\n    return true;\n  }\n\n  private handleSuccessfulValidation(): void {\n    const { autoCleanStateAfterAuthentication } = this.configurationProvider.getOpenIDConfiguration();\n    this.storagePersistenceService.write('authNonce', '');\n\n    if (autoCleanStateAfterAuthentication) {\n      this.storagePersistenceService.write('authStateControl', '');\n    }\n    this.loggerService.logDebug('AuthorizedCallback token(s) validated, continue');\n  }\n\n  private handleUnsuccessfulValidation(): void {\n    const { autoCleanStateAfterAuthentication } = this.configurationProvider.getOpenIDConfiguration();\n    this.storagePersistenceService.write('authNonce', '');\n\n    if (autoCleanStateAfterAuthentication) {\n      this.storagePersistenceService.write('authStateControl', '');\n    }\n    this.loggerService.logDebug('AuthorizedCallback token(s) invalid');\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { AuthorizedState } from '../../authState/authorized-state';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StateValidationResult } from '../../validation/state-validation-result';\nimport { StateValidationService } from '../../validation/state-validation.service';\nimport { CallbackContext } from '../callback-context';\nimport { ResetAuthDataService } from '../reset-auth-data.service';\n\n@Injectable()\nexport class StateValidationCallbackHandlerService {\n  constructor(\n    private readonly loggerService: LoggerService,\n    private readonly stateValidationService: StateValidationService,\n    private readonly authStateService: AuthStateService,\n    private readonly resetAuthDataService: ResetAuthDataService,\n    @Inject(DOCUMENT) private readonly doc: any\n  ) {}\n\n  // STEP 4 All flows\n\n  callbackStateValidation(callbackContext: CallbackContext): Observable<CallbackContext> {\n    const validationResult = this.stateValidationService.getValidatedStateResult(callbackContext);\n    callbackContext.validationResult = validationResult;\n\n    if (validationResult.authResponseIsValid) {\n      this.authStateService.setAuthorizationData(validationResult.accessToken, callbackContext.authResult);\n      return of(callbackContext);\n    } else {\n      const errorMessage = `authorizedCallback, token(s) validation failed, resetting. Hash: ${this.doc.location.hash}`;\n      this.loggerService.logWarning(errorMessage);\n      this.resetAuthDataService.resetAuthorizationData();\n      this.publishUnauthorizedState(callbackContext.validationResult, callbackContext.isRenewProcess);\n      return throwError(errorMessage);\n    }\n  }\n\n  private publishUnauthorizedState(stateValidationResult: StateValidationResult, isRenewProcess: boolean) {\n    this.authStateService.updateAndPublishAuthState({\n      authorizationState: AuthorizedState.Unauthorized,\n      validationResult: stateValidationResult.state,\n      isRenewProcess,\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { LoggerService } from '../../logging/logger.service';\nimport { TokenValidationService } from '../../validation/token-validation.service';\nimport { CallbackContext } from '../callback-context';\nimport { FlowsDataService } from '../flows-data.service';\n\n@Injectable()\nexport class RefreshSessionCallbackHandlerService {\n  constructor(\n    private readonly loggerService: LoggerService,\n    private readonly authStateService: AuthStateService,\n    private readonly flowsDataService: FlowsDataService\n  ) {}\n\n  // STEP 1 Refresh session\n  refreshSessionWithRefreshTokens(): Observable<CallbackContext> {\n    const stateData = this.flowsDataService.getExistingOrCreateAuthStateControl();\n    this.loggerService.logDebug('RefreshSession created. adding myautostate: ' + stateData);\n    const refreshToken = this.authStateService.getRefreshToken();\n    const idToken = this.authStateService.getIdToken();\n\n    if (refreshToken) {\n      const callbackContext = {\n        code: null,\n        refreshToken,\n        state: stateData,\n        sessionState: null,\n        authResult: null,\n        isRenewProcess: true,\n        jwtKeys: null,\n        validationResult: null,\n        existingIdToken: idToken,\n      };\n\n      this.loggerService.logDebug('found refresh code, obtaining new credentials with refresh code');\n      // Nonce is not used with refresh tokens; but Keycloak may send it anyway\n      this.flowsDataService.setNonce(TokenValidationService.refreshTokenNoncePlaceholder);\n\n      return of(callbackContext);\n    } else {\n      const errorMessage = 'no refresh token found, please login';\n      this.loggerService.logError(errorMessage);\n      return throwError(errorMessage);\n    }\n  }\n}\n","import { HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable, of, throwError, timer } from 'rxjs';\nimport { catchError, mergeMap, retryWhen, switchMap } from 'rxjs/operators';\nimport { DataService } from '../../api/data.service';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { CallbackContext } from '../callback-context';\n\n@Injectable()\nexport class RefreshTokenCallbackHandlerService {\n  constructor(\n    private readonly urlService: UrlService,\n    private readonly loggerService: LoggerService,\n    private readonly configurationProvider: ConfigurationProvider,\n    private readonly dataService: DataService,\n    private readonly storagePersistenceService: StoragePersistenceService\n  ) {}\n\n  // STEP 2 Refresh Token\n  refreshTokensRequestTokens(\n    callbackContext: CallbackContext,\n    customParamsRefresh?: { [key: string]: string | number | boolean }\n  ): Observable<CallbackContext> {\n    let headers: HttpHeaders = new HttpHeaders();\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\n\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const tokenEndpoint = authWellKnown?.tokenEndpoint;\n    if (!tokenEndpoint) {\n      return throwError('Token Endpoint not defined');\n    }\n\n    const data = this.urlService.createBodyForCodeFlowRefreshTokensRequest(callbackContext.refreshToken, customParamsRefresh);\n\n    return this.dataService.post(tokenEndpoint, data, headers).pipe(\n      switchMap((response: any) => {\n        this.loggerService.logDebug('token refresh response: ', response);\n        let authResult: any = new Object();\n        authResult = response;\n        authResult.state = callbackContext.state;\n\n        callbackContext.authResult = authResult;\n        return of(callbackContext);\n      }),\n      retryWhen((error) => this.handleRefreshRetry(error)),\n      catchError((error) => {\n        const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\n        const errorMessage = `OidcService code request ${stsServer}`;\n        this.loggerService.logError(errorMessage, error);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  private handleRefreshRetry(errors: Observable<any>): Observable<any> {\n    return errors.pipe(\n      mergeMap((error) => {\n        // retry token refresh if there is no internet connection\n        if (error && error instanceof HttpErrorResponse && error.error instanceof ProgressEvent && error.error.type === 'error') {\n          const { stsServer, refreshTokenRetryInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n          const errorMessage = `OidcService code request ${stsServer} - no internet connection`;\n          this.loggerService.logWarning(errorMessage, error);\n          return timer(refreshTokenRetryInSeconds * 1000);\n        }\n        return throwError(error);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { CallbackContext } from './callback-context';\nimport { CodeFlowCallbackHandlerService } from './callback-handling/code-flow-callback-handler.service';\nimport { HistoryJwtKeysCallbackHandlerService } from './callback-handling/history-jwt-keys-callback-handler.service';\nimport { ImplicitFlowCallbackHandlerService } from './callback-handling/implicit-flow-callback-handler.service';\nimport { RefreshSessionCallbackHandlerService } from './callback-handling/refresh-session-callback-handler.service';\nimport { RefreshTokenCallbackHandlerService } from './callback-handling/refresh-token-callback-handler.service';\nimport { StateValidationCallbackHandlerService } from './callback-handling/state-validation-callback-handler.service';\nimport { UserCallbackHandlerService } from './callback-handling/user-callback-handler.service';\n\n@Injectable()\nexport class FlowsService {\n  constructor(\n    private readonly codeFlowCallbackHandlerService: CodeFlowCallbackHandlerService,\n    private readonly implicitFlowCallbackHandlerService: ImplicitFlowCallbackHandlerService,\n    private readonly historyJwtKeysCallbackHandlerService: HistoryJwtKeysCallbackHandlerService,\n    private readonly userHandlerService: UserCallbackHandlerService,\n    private readonly stateValidationCallbackHandlerService: StateValidationCallbackHandlerService,\n    private readonly refreshSessionCallbackHandlerService: RefreshSessionCallbackHandlerService,\n    private readonly refreshTokenCallbackHandlerService: RefreshTokenCallbackHandlerService\n  ) {}\n\n  processCodeFlowCallback(urlToCheck: string): Observable<CallbackContext> {\n    return this.codeFlowCallbackHandlerService.codeFlowCallback(urlToCheck).pipe(\n      switchMap((callbackContext) => this.codeFlowCallbackHandlerService.codeFlowCodeRequest(callbackContext)),\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\n    );\n  }\n\n  processSilentRenewCodeFlowCallback(firstContext: CallbackContext): Observable<CallbackContext> {\n    return this.codeFlowCallbackHandlerService.codeFlowCodeRequest(firstContext).pipe(\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\n    );\n  }\n\n  processImplicitFlowCallback(hash?: string): Observable<CallbackContext> {\n    return this.implicitFlowCallbackHandlerService.implicitFlowCallback(hash).pipe(\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\n    );\n  }\n\n  processRefreshToken(customParamsRefresh?: { [key: string]: string | number | boolean }): Observable<CallbackContext> {\n    return this.refreshSessionCallbackHandlerService.refreshSessionWithRefreshTokens().pipe(\n      switchMap((callbackContext) =>\n        this.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(callbackContext, customParamsRefresh)\n      ),\n      switchMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext)),\n      switchMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext)),\n      switchMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext))\n    );\n  }\n}\n","import { Injectable, NgZone } from '@angular/core';\nimport { Observable, Subscription } from 'rxjs';\n\n@Injectable({ providedIn: 'root' })\nexport class IntervallService {\n  runTokenValidationRunning: Subscription = null;\n\n  constructor(private zone: NgZone) {}\n\n  stopPeriodicallTokenCheck(): void {\n    if (this.runTokenValidationRunning) {\n      this.runTokenValidationRunning.unsubscribe();\n      this.runTokenValidationRunning = null;\n    }\n  }\n\n  startPeriodicTokenCheck(repeatAfterSeconds: number) {\n    const millisecondsDelayBetweenTokenCheck = repeatAfterSeconds * 1000;\n\n    return new Observable((subscriber) => {\n      let intervalId;\n      this.zone.runOutsideAngular(() => {\n        intervalId = setInterval(() => this.zone.run(() => subscriber.next()), millisecondsDelayBetweenTokenCheck);\n      });\n\n      return () => {\n        clearInterval(intervalId);\n      };\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { throwError } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { FlowsDataService } from '../flows/flows-data.service';\nimport { FlowsService } from '../flows/flows.service';\nimport { IntervallService } from './intervall.service';\n\n@Injectable({ providedIn: 'root' })\nexport class ImplicitFlowCallbackService {\n  constructor(\n    private flowsService: FlowsService,\n    private configurationProvider: ConfigurationProvider,\n    private router: Router,\n    private flowsDataService: FlowsDataService,\n    private intervalService: IntervallService\n  ) {}\n\n  authorizedImplicitFlowCallback(hash?: string) {\n    const isRenewProcess = this.flowsDataService.isSilentRenewRunning();\n    const { triggerAuthorizationResultEvent, postLoginRoute, unauthorizedRoute } = this.configurationProvider.getOpenIDConfiguration();\n\n    return this.flowsService.processImplicitFlowCallback(hash).pipe(\n      tap((callbackContext) => {\n        if (!triggerAuthorizationResultEvent && !callbackContext.isRenewProcess) {\n          this.router.navigateByUrl(postLoginRoute);\n        }\n      }),\n      catchError((error) => {\n        this.flowsDataService.resetSilentRenewRunning();\n        this.intervalService.stopPeriodicallTokenCheck();\n        if (!triggerAuthorizationResultEvent && !isRenewProcess) {\n          this.router.navigateByUrl(unauthorizedRoute);\n        }\n        return throwError(error);\n      })\n    );\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { LoggerService } from '../logging/logger.service';\n\n@Injectable()\nexport class IFrameService {\n  constructor(@Inject(DOCUMENT) private readonly doc: any, private loggerService: LoggerService) {}\n\n  getExistingIFrame(identifier: string): HTMLIFrameElement | null {\n    const iFrameOnParent = this.getIFrameFromParentWindow(identifier);\n    if (this.isIFrameElement(iFrameOnParent)) {\n      return iFrameOnParent;\n    }\n\n    const iFrameOnSelf = this.getIFrameFromWindow(identifier);\n    if (this.isIFrameElement(iFrameOnSelf)) {\n      return iFrameOnSelf;\n    }\n    return null;\n  }\n\n  addIFrameToWindowBody(identifier: string): HTMLIFrameElement {\n    const sessionIframe = this.doc.createElement('iframe');\n    sessionIframe.id = identifier;\n    sessionIframe.title = identifier;\n    this.loggerService.logDebug(sessionIframe);\n    sessionIframe.style.display = 'none';\n    this.doc.body.appendChild(sessionIframe);\n    return sessionIframe;\n  }\n\n  private getIFrameFromParentWindow(identifier: string): HTMLIFrameElement | null {\n    try {\n      const iFrameElement = this.doc.defaultView.parent.document.getElementById(identifier);\n      if (this.isIFrameElement(iFrameElement)) {\n        return iFrameElement;\n      }\n      return null;\n    } catch (e) {\n      return null;\n    }\n  }\n\n  private getIFrameFromWindow(identifier: string): HTMLIFrameElement | null {\n    const iFrameElement = this.doc.getElementById(identifier);\n    if (this.isIFrameElement(iFrameElement)) {\n      return iFrameElement;\n    }\n    return null;\n  }\n\n  private isIFrameElement(element: HTMLElement | null): element is HTMLIFrameElement {\n    return !!element && element instanceof HTMLIFrameElement;\n  }\n}\n","import { Injectable, NgZone } from '@angular/core';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { EventTypes } from '../public-events/event-types';\nimport { PublicEventsService } from '../public-events/public-events.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { IFrameService } from './existing-iframe.service';\n\nconst IFRAME_FOR_CHECK_SESSION_IDENTIFIER = 'myiFrameForCheckSession';\n\n// http://openid.net/specs/openid-connect-session-1_0-ID4.html\n\n@Injectable()\nexport class CheckSessionService {\n  private checkSessionReceived = false;\n  private scheduledHeartBeatRunning: any;\n  private lastIFrameRefresh = 0;\n  private outstandingMessages = 0;\n  private heartBeatInterval = 3000;\n  private iframeRefreshInterval = 60000;\n  private checkSessionChangedInternal$ = new BehaviorSubject<boolean>(false);\n\n  get checkSessionChanged$() {\n    return this.checkSessionChangedInternal$.asObservable();\n  }\n\n  constructor(\n    private storagePersistenceService: StoragePersistenceService,\n    private loggerService: LoggerService,\n    private iFrameService: IFrameService,\n    private eventService: PublicEventsService,\n    private configurationProvider: ConfigurationProvider,\n    private zone: NgZone\n  ) {}\n\n  isCheckSessionConfigured() {\n    const { startCheckSession } = this.configurationProvider.getOpenIDConfiguration();\n    return startCheckSession;\n  }\n\n  start(): void {\n    if (!!this.scheduledHeartBeatRunning) {\n      return;\n    }\n\n    const { clientId } = this.configurationProvider.getOpenIDConfiguration();\n    this.pollServerSession(clientId);\n  }\n\n  stop(): void {\n    if (!this.scheduledHeartBeatRunning) {\n      return;\n    }\n\n    this.clearScheduledHeartBeat();\n    this.checkSessionReceived = false;\n  }\n\n  serverStateChanged() {\n    const { startCheckSession } = this.configurationProvider.getOpenIDConfiguration();\n    return startCheckSession && this.checkSessionReceived;\n  }\n\n  getExistingIframe() {\n    return this.iFrameService.getExistingIFrame(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\n  }\n\n  private init(): Observable<any> {\n    if (this.lastIFrameRefresh + this.iframeRefreshInterval > Date.now()) {\n      return of(undefined);\n    }\n\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n    if (!authWellKnownEndPoints) {\n      this.loggerService.logWarning('init check session: authWellKnownEndpoints is undefined. Returning.');\n      return of();\n    }\n\n    const existingIframe = this.getOrCreateIframe();\n    const checkSessionIframe = authWellKnownEndPoints.checkSessionIframe;\n\n    if (checkSessionIframe) {\n      existingIframe.contentWindow.location.replace(checkSessionIframe);\n    } else {\n      this.loggerService.logWarning('init check session: checkSessionIframe is not configured to run');\n    }\n\n    return new Observable((observer) => {\n      existingIframe.onload = () => {\n        this.lastIFrameRefresh = Date.now();\n        observer.next();\n        observer.complete();\n      };\n    });\n  }\n\n  private pollServerSession(clientId: string) {\n    this.outstandingMessages = 0;\n    const pollServerSessionRecur = () => {\n      this.init()\n        .pipe(take(1))\n        .subscribe(() => {\n          const existingIframe = this.getExistingIframe();\n          if (existingIframe && clientId) {\n            this.loggerService.logDebug(existingIframe);\n            const sessionState = this.storagePersistenceService.read('session_state');\n            const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n            if (sessionState && authWellKnownEndPoints?.checkSessionIframe) {\n              const iframeOrigin = new URL(authWellKnownEndPoints.checkSessionIframe)?.origin;\n              this.outstandingMessages++;\n              existingIframe.contentWindow.postMessage(clientId + ' ' + sessionState, iframeOrigin);\n            } else {\n              this.loggerService.logDebug(`OidcSecurityCheckSession pollServerSession session_state is '${sessionState}'`);\n              this.loggerService.logDebug(`AuthWellKnownEndPoints is '${JSON.stringify(authWellKnownEndPoints)}'`);\n              this.checkSessionChangedInternal$.next(true);\n            }\n          } else {\n            this.loggerService.logWarning('OidcSecurityCheckSession pollServerSession checkSession IFrame does not exist');\n            this.loggerService.logDebug(clientId);\n            this.loggerService.logDebug(existingIframe);\n          }\n\n          // after sending three messages with no response, fail.\n          if (this.outstandingMessages > 3) {\n            this.loggerService.logError(\n              `OidcSecurityCheckSession not receiving check session response messages.\n                            Outstanding messages: ${this.outstandingMessages}. Server unreachable?`\n            );\n          }\n\n          this.zone.runOutsideAngular(() => {\n            this.scheduledHeartBeatRunning = setTimeout(() => this.zone.run(pollServerSessionRecur), this.heartBeatInterval);\n          });\n        });\n    };\n\n    pollServerSessionRecur();\n  }\n\n  private clearScheduledHeartBeat() {\n    clearTimeout(this.scheduledHeartBeatRunning);\n    this.scheduledHeartBeatRunning = null;\n  }\n\n  private messageHandler(e: any) {\n    const existingIFrame = this.getExistingIframe();\n    const authWellKnownEndPoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    const startsWith = !!authWellKnownEndPoints?.checkSessionIframe?.startsWith(e.origin);\n    this.outstandingMessages = 0;\n    if (existingIFrame && startsWith && e.source === existingIFrame.contentWindow) {\n      if (e.data === 'error') {\n        this.loggerService.logWarning('error from checksession messageHandler');\n      } else if (e.data === 'changed') {\n        this.loggerService.logDebug(e);\n        this.checkSessionReceived = true;\n        this.eventService.fireEvent(EventTypes.CheckSessionReceived, e.data);\n        this.checkSessionChangedInternal$.next(true);\n      } else {\n        this.eventService.fireEvent(EventTypes.CheckSessionReceived, e.data);\n        this.loggerService.logDebug(e.data + ' from checksession messageHandler');\n      }\n    }\n  }\n\n  private bindMessageEventToIframe() {\n    const iframeMessageEvent = this.messageHandler.bind(this);\n    window.addEventListener('message', iframeMessageEvent, false);\n  }\n\n  private getOrCreateIframe() {\n    const existingIframe = this.getExistingIframe();\n\n    if (!existingIframe) {\n      const frame = this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_CHECK_SESSION_IDENTIFIER);\n      this.bindMessageEventToIframe();\n      return frame;\n    }\n\n    return existingIframe;\n  }\n}\n","import { HttpParams } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { of, Subject, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { AuthorizedState } from '../authState/authorized-state';\nimport { ImplicitFlowCallbackService } from '../callback/implicit-flow-callback.service';\nimport { IntervallService } from '../callback/intervall.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { CallbackContext } from '../flows/callback-context';\nimport { FlowsDataService } from '../flows/flows-data.service';\nimport { FlowsService } from '../flows/flows.service';\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { ValidationResult } from '../validation/validation-result';\nimport { IFrameService } from './existing-iframe.service';\n\nconst IFRAME_FOR_SILENT_RENEW_IDENTIFIER = 'myiFrameForSilentRenew';\n\n@Injectable()\nexport class SilentRenewService {\n  private refreshSessionWithIFrameCompletedInternal$ = new Subject<CallbackContext>();\n\n  get refreshSessionWithIFrameCompleted$() {\n    return this.refreshSessionWithIFrameCompletedInternal$.asObservable();\n  }\n\n  constructor(\n    private configurationProvider: ConfigurationProvider,\n    private iFrameService: IFrameService,\n    private flowsService: FlowsService,\n    private resetAuthDataService: ResetAuthDataService,\n    private flowsDataService: FlowsDataService,\n    private authStateService: AuthStateService,\n    private loggerService: LoggerService,\n    private flowHelper: FlowHelper,\n    private implicitFlowCallbackService: ImplicitFlowCallbackService,\n    private intervalService: IntervallService\n  ) {}\n\n  getOrCreateIframe(): HTMLIFrameElement {\n    const existingIframe = this.getExistingIframe();\n\n    if (!existingIframe) {\n      return this.iFrameService.addIFrameToWindowBody(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\n    }\n\n    return existingIframe;\n  }\n\n  isSilentRenewConfigured() {\n    const { useRefreshToken, silentRenew } = this.configurationProvider.getOpenIDConfiguration();\n    return !useRefreshToken && silentRenew;\n  }\n\n  codeFlowCallbackSilentRenewIframe(urlParts) {\n    const params = new HttpParams({\n      fromString: urlParts[1],\n    });\n\n    const error = params.get('error');\n\n    if (error) {\n      this.authStateService.updateAndPublishAuthState({\n        authorizationState: AuthorizedState.Unauthorized,\n        validationResult: ValidationResult.LoginRequired,\n        isRenewProcess: true,\n      });\n      this.resetAuthDataService.resetAuthorizationData();\n      this.flowsDataService.setNonce('');\n      this.intervalService.stopPeriodicallTokenCheck();\n      return throwError(error);\n    }\n\n    const code = params.get('code');\n    const state = params.get('state');\n    const sessionState = params.get('session_state');\n\n    const callbackContext = {\n      code,\n      refreshToken: null,\n      state,\n      sessionState,\n      authResult: null,\n      isRenewProcess: true,\n      jwtKeys: null,\n      validationResult: null,\n      existingIdToken: null,\n    };\n\n    return this.flowsService.processSilentRenewCodeFlowCallback(callbackContext).pipe(\n      catchError((errorFromFlow) => {\n        this.intervalService.stopPeriodicallTokenCheck();\n        this.resetAuthDataService.resetAuthorizationData();\n        return throwError(errorFromFlow);\n      })\n    );\n  }\n\n  silentRenewEventHandler(e: CustomEvent) {\n    this.loggerService.logDebug('silentRenewEventHandler');\n    if (!e.detail) {\n      return;\n    }\n\n    let callback$ = of(null);\n\n    const isCodeFlow = this.flowHelper.isCurrentFlowCodeFlow();\n\n    if (isCodeFlow) {\n      const urlParts = e.detail.toString().split('?');\n      callback$ = this.codeFlowCallbackSilentRenewIframe(urlParts);\n    } else {\n      callback$ = this.implicitFlowCallbackService.authorizedImplicitFlowCallback(e.detail);\n    }\n\n    callback$.subscribe(\n      (callbackContext) => {\n        this.refreshSessionWithIFrameCompletedInternal$.next(callbackContext);\n        this.flowsDataService.resetSilentRenewRunning();\n      },\n      (err: any) => {\n        this.loggerService.logError('Error: ' + err);\n        this.refreshSessionWithIFrameCompletedInternal$.next(null);\n        this.flowsDataService.resetSilentRenewRunning();\n      }\n    );\n  }\n\n  private getExistingIframe() {\n    return this.iFrameService.getExistingIFrame(IFRAME_FOR_SILENT_RENEW_IDENTIFIER);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { throwError } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { FlowsDataService } from '../flows/flows-data.service';\nimport { FlowsService } from '../flows/flows.service';\nimport { IntervallService } from './intervall.service';\n\n@Injectable({ providedIn: 'root' })\nexport class CodeFlowCallbackService {\n  constructor(\n    private flowsService: FlowsService,\n    private flowsDataService: FlowsDataService,\n    private intervallService: IntervallService,\n    private configurationProvider: ConfigurationProvider,\n    private router: Router\n  ) {}\n\n  authorizedCallbackWithCode(urlToCheck: string) {\n    const isRenewProcess = this.flowsDataService.isSilentRenewRunning();\n    const { triggerAuthorizationResultEvent, postLoginRoute, unauthorizedRoute } = this.configurationProvider.getOpenIDConfiguration();\n\n    return this.flowsService.processCodeFlowCallback(urlToCheck).pipe(\n      tap((callbackContext) => {\n        if (!triggerAuthorizationResultEvent && !callbackContext.isRenewProcess) {\n          this.router.navigateByUrl(postLoginRoute);\n        }\n      }),\n      catchError((error) => {\n        this.flowsDataService.resetSilentRenewRunning();\n        this.intervallService.stopPeriodicallTokenCheck();\n        if (!triggerAuthorizationResultEvent && !isRenewProcess) {\n          this.router.navigateByUrl(unauthorizedRoute);\n        }\n        return throwError(error);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { CallbackContext } from '../flows/callback-context';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { UrlService } from '../utils/url/url.service';\nimport { CodeFlowCallbackService } from './code-flow-callback.service';\nimport { ImplicitFlowCallbackService } from './implicit-flow-callback.service';\n\n@Injectable({ providedIn: 'root' })\nexport class CallbackService {\n  private stsCallbackInternal$ = new Subject();\n\n  get stsCallback$() {\n    return this.stsCallbackInternal$.asObservable();\n  }\n\n  constructor(\n    private urlService: UrlService,\n    private flowHelper: FlowHelper,\n    private implicitFlowCallbackService: ImplicitFlowCallbackService,\n    private codeFlowCallbackService: CodeFlowCallbackService\n  ) {}\n\n  isCallback(currentUrl: string): boolean {\n    return this.urlService.isCallbackFromSts(currentUrl);\n  }\n\n  handleCallbackAndFireEvents(currentCallbackUrl: string): Observable<CallbackContext> {\n    let callback$: Observable<any>;\n\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\n      callback$ = this.codeFlowCallbackService.authorizedCallbackWithCode(currentCallbackUrl);\n    } else if (this.flowHelper.isCurrentFlowAnyImplicitFlow()) {\n      callback$ = this.implicitFlowCallbackService.authorizedImplicitFlowCallback();\n    }\n\n    return callback$.pipe(tap(() => this.stsCallbackInternal$.next()));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { map, retry } from 'rxjs/operators';\nimport { DataService } from '../api/data.service';\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\n\nconst WELL_KNOWN_SUFFIX = `/.well-known/openid-configuration`;\n\n@Injectable()\nexport class AuthWellKnownDataService {\n  constructor(private readonly http: DataService) {}\n\n  getWellKnownEndPointsFromUrl(authWellknownEndpoint: string) {\n    return this.getWellKnownDocument(authWellknownEndpoint).pipe(\n      map(\n        (wellKnownEndpoints) =>\n          ({\n            issuer: wellKnownEndpoints.issuer,\n            jwksUri: wellKnownEndpoints.jwks_uri,\n            authorizationEndpoint: wellKnownEndpoints.authorization_endpoint,\n            tokenEndpoint: wellKnownEndpoints.token_endpoint,\n            userinfoEndpoint: wellKnownEndpoints.userinfo_endpoint,\n            endSessionEndpoint: wellKnownEndpoints.end_session_endpoint,\n            checkSessionIframe: wellKnownEndpoints.check_session_iframe,\n            revocationEndpoint: wellKnownEndpoints.revocation_endpoint,\n            introspectionEndpoint: wellKnownEndpoints.introspection_endpoint,\n            parEndpoint: wellKnownEndpoints.pushed_authorization_request_endpoint,\n          } as AuthWellKnownEndpoints)\n      )\n    );\n  }\n\n  private getWellKnownDocument(wellKnownEndpoint: string) {\n    let url = wellKnownEndpoint;\n\n    if (!wellKnownEndpoint.includes(WELL_KNOWN_SUFFIX)) {\n      url = `${wellKnownEndpoint}${WELL_KNOWN_SUFFIX}`;\n    }\n\n    return this.http.get<any>(url).pipe(retry(2));\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { of, throwError } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { EventTypes } from '../public-events/event-types';\nimport { PublicEventsService } from '../public-events/public-events.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { AuthWellKnownDataService } from './auth-well-known-data.service';\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\nimport { PublicConfiguration } from './public-configuration';\n\n@Injectable()\nexport class AuthWellKnownService {\n  constructor(\n    private publicEventsService: PublicEventsService,\n    private dataService: AuthWellKnownDataService,\n    private storagePersistenceService: StoragePersistenceService\n  ) {}\n\n  getAuthWellKnownEndPoints(authWellknownEndpointUrl: string) {\n    const alreadySavedWellKnownEndpoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n    if (!!alreadySavedWellKnownEndpoints) {\n      return of(alreadySavedWellKnownEndpoints);\n    }\n\n    return this.getWellKnownEndPointsFromUrl(authWellknownEndpointUrl).pipe(\n      tap((mappedWellKnownEndpoints) => this.storeWellKnownEndpoints(mappedWellKnownEndpoints)),\n      catchError((error) => {\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoadingFailed, null);\n        return throwError(error);\n      })\n    );\n  }\n\n  storeWellKnownEndpoints(mappedWellKnownEndpoints: AuthWellKnownEndpoints) {\n    this.storagePersistenceService.write('authWellKnownEndPoints', mappedWellKnownEndpoints);\n  }\n\n  private getWellKnownEndPointsFromUrl(authWellknownEndpoint: string) {\n    return this.dataService.getWellKnownEndPointsFromUrl(authWellknownEndpoint);\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable, Renderer2, RendererFactory2 } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { LoggerService } from '../logging/logger.service';\nimport { UrlService } from '../utils/url/url.service';\nimport { SilentRenewService } from './silent-renew.service';\n\n@Injectable({ providedIn: 'root' })\nexport class RefreshSessionIframeService {\n  private renderer: Renderer2;\n\n  constructor(\n    @Inject(DOCUMENT) private readonly doc: any,\n    private loggerService: LoggerService,\n    private urlService: UrlService,\n    private silentRenewService: SilentRenewService,\n    rendererFactory: RendererFactory2\n  ) {\n    this.renderer = rendererFactory.createRenderer(null, null);\n  }\n\n  refreshSessionWithIframe(customParams?: { [key: string]: string | number | boolean }): Observable<boolean> {\n    this.loggerService.logDebug('BEGIN refresh session Authorize Iframe renew');\n    const url = this.urlService.getRefreshSessionSilentRenewUrl(customParams);\n    return this.sendAuthorizeRequestUsingSilentRenew(url);\n  }\n\n  private sendAuthorizeRequestUsingSilentRenew(url: string): Observable<boolean> {\n    const sessionIframe = this.silentRenewService.getOrCreateIframe();\n    this.initSilentRenewRequest();\n    this.loggerService.logDebug('sendAuthorizeRequestUsingSilentRenew for URL:' + url);\n\n    return new Observable((observer) => {\n      const onLoadHandler = () => {\n        sessionIframe.removeEventListener('load', onLoadHandler);\n        this.loggerService.logDebug('removed event listener from IFrame');\n        observer.next(true);\n        observer.complete();\n      };\n      sessionIframe.addEventListener('load', onLoadHandler);\n      sessionIframe.contentWindow.location.replace(url);\n    });\n  }\n\n  private initSilentRenewRequest(): void {\n    const instanceId = Math.random();\n\n    const initDestroyHandler = this.renderer.listen('window', 'oidc-silent-renew-init', (e: CustomEvent) => {\n      if (e.detail !== instanceId) {\n        initDestroyHandler();\n        renewDestroyHandler();\n      }\n    });\n    const renewDestroyHandler = this.renderer.listen('window', 'oidc-silent-renew-message', (e) =>\n      this.silentRenewService.silentRenewEventHandler(e)\n    );\n\n    this.doc.defaultView.dispatchEvent(\n      new CustomEvent('oidc-silent-renew-init', {\n        detail: instanceId,\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { CallbackContext } from '../flows/callback-context';\nimport { FlowsService } from '../flows/flows.service';\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { IntervallService } from './intervall.service';\n\n@Injectable({ providedIn: 'root' })\nexport class RefreshSessionRefreshTokenService {\n  constructor(\n    private loggerService: LoggerService,\n    private resetAuthDataService: ResetAuthDataService,\n    private flowsService: FlowsService,\n    private intervalService: IntervallService\n  ) {}\n\n  refreshSessionWithRefreshTokens(customParamsRefresh?: { [key: string]: string | number | boolean }): Observable<CallbackContext> {\n    this.loggerService.logDebug('BEGIN refresh session Authorize');\n\n    return this.flowsService.processRefreshToken(customParamsRefresh).pipe(\n      catchError((error) => {\n        this.intervalService.stopPeriodicallTokenCheck();\n        this.resetAuthDataService.resetAuthorizationData();\n        return throwError(error);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { forkJoin, Observable, of, throwError, TimeoutError, timer } from 'rxjs';\nimport { map, mergeMap, retryWhen, switchMap, take, timeout } from 'rxjs/operators';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { AuthWellKnownService } from '../config/auth-well-known.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { CallbackContext } from '../flows/callback-context';\nimport { FlowsDataService } from '../flows/flows-data.service';\nimport { RefreshSessionIframeService } from '../iframe/refresh-session-iframe.service';\nimport { SilentRenewService } from '../iframe/silent-renew.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { TokenResponse } from '../tokens/token-response';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { RefreshSessionRefreshTokenService } from './refresh-session-refresh-token.service';\n\nexport const MAX_RETRY_ATTEMPTS = 3;\n@Injectable({ providedIn: 'root' })\nexport class RefreshSessionService {\n  constructor(\n    private flowHelper: FlowHelper,\n    private configurationProvider: ConfigurationProvider,\n    private flowsDataService: FlowsDataService,\n    private loggerService: LoggerService,\n    private silentRenewService: SilentRenewService,\n    private authStateService: AuthStateService,\n    private authWellKnownService: AuthWellKnownService,\n    private refreshSessionIframeService: RefreshSessionIframeService,\n    private refreshSessionRefreshTokenService: RefreshSessionRefreshTokenService\n  ) {}\n\n  forceRefreshSession(extraCustomParams?: { [key: string]: string | number | boolean }): Observable<TokenResponse | null> {\n    if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\n      const { customParamsRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\n      const mergedParams = { ...extraCustomParams, ...customParamsRefreshToken };\n      return this.startRefreshSession(mergedParams).pipe(\n        map(() => {\n          const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\n          if (isAuthenticated) {\n            return {\n              idToken: this.authStateService.getIdToken(),\n              accessToken: this.authStateService.getAccessToken(),\n            };\n          }\n\n          return null;\n        })\n      );\n    }\n\n    const { silentRenewTimeoutInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n    const timeOutTime = silentRenewTimeoutInSeconds * 1000;\n\n    return forkJoin([\n      this.startRefreshSession(extraCustomParams),\n      this.silentRenewService.refreshSessionWithIFrameCompleted$.pipe(take(1)),\n    ]).pipe(\n      timeout(timeOutTime),\n      retryWhen(this.timeoutRetryStrategy.bind(this)),\n      map(([_, callbackContext]) => {\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\n        if (isAuthenticated) {\n          return {\n            idToken: callbackContext?.authResult?.id_token,\n            accessToken: callbackContext?.authResult?.access_token,\n          };\n        }\n\n        return null;\n      })\n    );\n  }\n\n  private startRefreshSession(extraCustomParams?: {\n    [key: string]: string | number | boolean;\n  }): Observable<boolean | CallbackContext | null> {\n    const isSilentRenewRunning = this.flowsDataService.isSilentRenewRunning();\n    this.loggerService.logDebug(`Checking: silentRenewRunning: ${isSilentRenewRunning}`);\n    const shouldBeExecuted = !isSilentRenewRunning;\n\n    if (!shouldBeExecuted) {\n      return of(null);\n    }\n\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration() || {};\n\n    if (!authWellknownEndpoint) {\n      this.loggerService.logError('no authwellknownendpoint given!');\n      return of(null);\n    }\n\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\n      switchMap(() => {\n        this.flowsDataService.setSilentRenewRunning();\n\n        if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\n          // Refresh Session using Refresh tokens\n          return this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(extraCustomParams);\n        }\n\n        return this.refreshSessionIframeService.refreshSessionWithIframe(extraCustomParams);\n      })\n    );\n  }\n\n  private timeoutRetryStrategy(errorAttempts: Observable<any>): Observable<number> {\n    return errorAttempts.pipe(\n      mergeMap((error, index) => {\n        const scalingDuration = 1000;\n        const currentAttempt = index + 1;\n\n        if (!(error instanceof TimeoutError) || currentAttempt > MAX_RETRY_ATTEMPTS) {\n          return throwError(error);\n        }\n\n        this.loggerService.logDebug(`forceRefreshSession timeout. Attempt #${currentAttempt}`);\n\n        this.flowsDataService.resetSilentRenewRunning();\n        return timer(currentAttempt * scalingDuration);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { of, throwError } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { FlowsDataService } from '../flows/flows-data.service';\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\nimport { RefreshSessionIframeService } from '../iframe/refresh-session-iframe.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { UserService } from '../userData/user-service';\nimport { FlowHelper } from '../utils/flowHelper/flow-helper.service';\nimport { IntervallService } from './intervall.service';\nimport { RefreshSessionRefreshTokenService } from './refresh-session-refresh-token.service';\n\n@Injectable({ providedIn: 'root' })\nexport class PeriodicallyTokenCheckService {\n  constructor(\n    private resetAuthDataService: ResetAuthDataService,\n    private flowHelper: FlowHelper,\n    private configurationProvider: ConfigurationProvider,\n    private flowsDataService: FlowsDataService,\n    private loggerService: LoggerService,\n    private userService: UserService,\n    private authStateService: AuthStateService,\n    private refreshSessionIframeService: RefreshSessionIframeService,\n    private refreshSessionRefreshTokenService: RefreshSessionRefreshTokenService,\n    private intervalService: IntervallService,\n    private storagePersistenceService: StoragePersistenceService\n  ) {}\n\n  startTokenValidationPeriodically(repeatAfterSeconds: number) {\n    const { silentRenew } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!!this.intervalService.runTokenValidationRunning || !silentRenew) {\n      return;\n    }\n\n    this.loggerService.logDebug(`starting token validation check every ${repeatAfterSeconds}s`);\n\n    const periodicallyCheck$ = this.intervalService.startPeriodicTokenCheck(repeatAfterSeconds).pipe(\n      switchMap(() => {\n        const idToken = this.authStateService.getIdToken();\n        const isSilentRenewRunning = this.flowsDataService.isSilentRenewRunning();\n        const userDataFromStore = this.userService.getUserDataFromStore();\n\n        this.loggerService.logDebug(\n          `Checking: silentRenewRunning: ${isSilentRenewRunning} id_token: ${!!idToken} userData: ${!!userDataFromStore}`\n        );\n\n        const shouldBeExecuted = userDataFromStore && !isSilentRenewRunning && idToken;\n\n        if (!shouldBeExecuted) {\n          return of(null);\n        }\n\n        const idTokenHasExpired = this.authStateService.hasIdTokenExpired();\n        const accessTokenHasExpired = this.authStateService.hasAccessTokenExpiredIfExpiryExists();\n\n        if (!idTokenHasExpired && !accessTokenHasExpired) {\n          return of(null);\n        }\n\n        const config = this.configurationProvider.getOpenIDConfiguration();\n\n        if (!config?.silentRenew) {\n          this.resetAuthDataService.resetAuthorizationData();\n          return of(null);\n        }\n\n        this.loggerService.logDebug('starting silent renew...');\n\n        this.flowsDataService.setSilentRenewRunning();\n\n        if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\n          // Retrieve Dynamically Set Custom Params for refresh body\n          const customParamsRefresh: { [key: string]: string | number | boolean } =\n            this.storagePersistenceService.read('storageCustomParamsRefresh') || {};\n\n          const { customParamsRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\n\n          const mergedParams = { ...customParamsRefresh, ...customParamsRefreshToken };\n\n          // Refresh Session using Refresh tokens\n          return this.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(mergedParams);\n        }\n\n        // Retrieve Dynamically Set Custom Params\n        const customParams: { [key: string]: string | number | boolean } = this.storagePersistenceService.read(\n          'storageCustomRequestParams'\n        );\n\n        return this.refreshSessionIframeService.refreshSessionWithIframe(customParams);\n      })\n    );\n\n    this.intervalService.runTokenValidationRunning = periodicallyCheck$\n      .pipe(\n        catchError(() => {\n          this.flowsDataService.resetSilentRenewRunning();\n          return throwError('periodically check failed');\n        })\n      )\n      .subscribe(\n        () => {\n          this.loggerService.logDebug('silent renew, periodic check finished!');\n          if (this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()) {\n            this.flowsDataService.resetSilentRenewRunning();\n          }\n        },\n        (err) => {\n          this.loggerService.logError('silent renew failed!', err);\n        }\n      );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\nimport { PopupOptions } from './popup-options';\nimport { PopupResult } from './popup-result';\n\n@Injectable({ providedIn: 'root' })\nexport class PopUpService {\n  private STORAGE_IDENTIFIER = 'popupauth';\n  private popUp: Window;\n  private handle: number;\n  private resultInternal$ = new Subject<PopupResult>();\n\n  get result$(): Observable<PopupResult> {\n    return this.resultInternal$.asObservable();\n  }\n\n  isCurrentlyInPopup(): boolean {\n    const popup = sessionStorage.getItem(this.STORAGE_IDENTIFIER);\n    return !!window.opener && window.opener !== window && !!popup;\n  }\n\n  openPopUp(url: string, popupOptions?: PopupOptions): void {\n    const optionsToPass = this.getOptions(popupOptions);\n    this.popUp = window.open(url, '_blank', optionsToPass);\n    this.popUp.sessionStorage.setItem(this.STORAGE_IDENTIFIER, 'true');\n\n    const listener = (event: MessageEvent): void => {\n      if (!event?.data || typeof event.data !== 'string') {\n        return;\n      }\n\n      this.resultInternal$.next({ userClosed: false, receivedUrl: event.data });\n\n      this.cleanUp(listener);\n    };\n\n    window.addEventListener('message', listener, false);\n\n    this.handle = window.setInterval(() => {\n      if (this.popUp.closed) {\n        this.resultInternal$.next({ userClosed: true });\n\n        this.cleanUp(listener);\n      }\n    }, 200);\n  }\n\n  sendMessageToMainWindow(url: string): void {\n    if (window.opener) {\n      this.sendMessage(url, window.location.href);\n    }\n  }\n\n  private cleanUp(listener: any): void {\n    window.removeEventListener('message', listener, false);\n\n    window.clearInterval(this.handle);\n\n    if (this.popUp) {\n      this.popUp.sessionStorage?.removeItem(this.STORAGE_IDENTIFIER);\n      this.popUp.close();\n      this.popUp = null;\n    }\n  }\n\n  private sendMessage(url: string, href: string): void {\n    window.opener.postMessage(url, href);\n  }\n\n  private getOptions(popupOptions?: PopupOptions): string {\n    const popupDefaultOptions = { width: 500, height: 500, left: 50, top: 50 };\n\n    const options = { ...popupDefaultOptions, ...(popupOptions || {}) };\n\n    return Object.entries(options)\n      .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)\n      .join(',');\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map, switchMap, tap } from 'rxjs/operators';\nimport { AuthStateService } from './authState/auth-state.service';\nimport { AutoLoginService } from './auto-login/auto-login-service';\nimport { CallbackService } from './callback/callback.service';\nimport { PeriodicallyTokenCheckService } from './callback/periodically-token-check.service';\nimport { RefreshSessionService } from './callback/refresh-session.service';\nimport { ConfigurationProvider } from './config/config.provider';\nimport { CheckSessionService } from './iframe/check-session.service';\nimport { SilentRenewService } from './iframe/silent-renew.service';\nimport { LoggerService } from './logging/logger.service';\nimport { PopUpService } from './login/popup/popup.service';\nimport { UserService } from './userData/user-service';\n\n@Injectable()\nexport class CheckAuthService {\n  constructor(\n    @Inject(DOCUMENT) private readonly doc: any,\n    private checkSessionService: CheckSessionService,\n    private silentRenewService: SilentRenewService,\n    private userService: UserService,\n    private loggerService: LoggerService,\n    private configurationProvider: ConfigurationProvider,\n    private authStateService: AuthStateService,\n    private callbackService: CallbackService,\n    private refreshSessionService: RefreshSessionService,\n    private periodicallyTokenCheckService: PeriodicallyTokenCheckService,\n    private popupService: PopUpService,\n    private autoLoginService: AutoLoginService,\n    private router: Router\n  ) {}\n\n  checkAuth(url?: string): Observable<boolean> {\n    if (!this.configurationProvider.hasValidConfig()) {\n      this.loggerService.logError('Please provide a configuration before setting up the module');\n      return of(false);\n    }\n\n    const { stsServer } = this.configurationProvider.getOpenIDConfiguration();\n\n    this.loggerService.logDebug('STS server: ', stsServer);\n\n    const currentUrl = url || this.doc.defaultView.location.toString();\n\n    if (this.popupService.isCurrentlyInPopup()) {\n      this.popupService.sendMessageToMainWindow(currentUrl);\n      return of(null);\n    }\n\n    const isCallback = this.callbackService.isCallback(currentUrl);\n\n    this.loggerService.logDebug('currentUrl to check auth with: ', currentUrl);\n\n    const callback$ = isCallback ? this.callbackService.handleCallbackAndFireEvents(currentUrl) : of(null);\n\n    return callback$.pipe(\n      map(() => {\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\n        if (isAuthenticated) {\n          this.startCheckSessionAndValidation();\n\n          if (!isCallback) {\n            this.authStateService.setAuthorizedAndFireEvent();\n            this.userService.publishUserDataIfExists();\n          }\n        }\n\n        this.loggerService.logDebug('checkAuth completed fired events, auth: ' + isAuthenticated);\n\n        return isAuthenticated;\n      }),\n      tap(() => {\n        const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\n\n        if (isAuthenticated) {\n          const savedRouteForRedirect = this.autoLoginService.getStoredRedirectRoute();\n\n          if (savedRouteForRedirect) {\n            this.autoLoginService.deleteStoredRedirectRoute();\n            this.router.navigateByUrl(savedRouteForRedirect);\n          }\n        }\n      }),\n      catchError((error) => {\n        this.loggerService.logError(error);\n        return of(false);\n      })\n    );\n  }\n\n  checkAuthIncludingServer(): Observable<boolean> {\n    return this.checkAuth().pipe(\n      switchMap((isAuthenticated) => {\n        if (isAuthenticated) {\n          return of(isAuthenticated);\n        }\n\n        return this.refreshSessionService.forceRefreshSession().pipe(\n          map((result) => !!result?.idToken && !!result?.accessToken),\n          switchMap((isAuth) => {\n            if (isAuth) {\n              this.startCheckSessionAndValidation();\n            }\n\n            return of(isAuth);\n          })\n        );\n      })\n    );\n  }\n\n  private startCheckSessionAndValidation() {\n    if (this.checkSessionService.isCheckSessionConfigured()) {\n      this.checkSessionService.start();\n    }\n\n    const { tokenRefreshInSeconds } = this.configurationProvider.getOpenIDConfiguration();\n\n    this.periodicallyTokenCheckService.startTokenValidationPeriodically(tokenRefreshInSeconds);\n\n    if (this.silentRenewService.isSilentRenewConfigured()) {\n      this.silentRenewService.getOrCreateIframe();\n    }\n  }\n}\n","import { OpenIdConfiguration } from '../config/openid-configuration';\n\nexport interface Rule {\n  validate(passedConfig: OpenIdConfiguration): RuleValidationResult;\n}\n\nexport interface RuleValidationResult {\n  result: boolean;\n  messages: string[];\n  level: Level;\n}\n\nexport const POSITIVE_VALIDATION_RESULT = {\n  result: true,\n  messages: [],\n  level: null,\n};\n\nexport type Level = 'warning' | 'error';\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\n\nexport const ensureClientId = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\n  if (!passedConfig.clientId) {\n    return {\n      result: false,\n      messages: ['The clientId is required and missing from your config!'],\n      level: 'error',\n    };\n  }\n\n  return POSITIVE_VALIDATION_RESULT;\n};\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\n\nexport const ensureRedirectRule = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\n  if (!passedConfig.redirectUrl) {\n    return {\n      result: false,\n      messages: ['The redirectURL is required and missing from your config'],\n      level: 'error',\n    };\n  }\n\n  return POSITIVE_VALIDATION_RESULT;\n};\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\n\nexport const ensureSilentRenewUrlWhenNoRefreshTokenUsed = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\n  const usesSilentRenew = passedConfig.silentRenew;\n  const usesRefreshToken = passedConfig.useRefreshToken;\n  const hasSilentRenewUrl = passedConfig.silentRenewUrl;\n\n  if (usesSilentRenew && !usesRefreshToken && !hasSilentRenewUrl) {\n    return {\n      result: false,\n      messages: ['Please provide a silent renew URL if using renew and not refresh tokens'],\n      level: 'error',\n    };\n  }\n\n  return POSITIVE_VALIDATION_RESULT;\n};\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\n\nexport const ensureStsServer = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\n  if (!passedConfig.stsServer) {\n    return {\n      result: false,\n      messages: ['The STS URL MUST be provided in the configuration!'],\n      level: 'error',\n    };\n  }\n\n  return POSITIVE_VALIDATION_RESULT;\n};\n","import { OpenIdConfiguration } from '../../config/openid-configuration';\nimport { POSITIVE_VALIDATION_RESULT, RuleValidationResult } from '../rule';\n\nexport const useOfflineScopeWithSilentRenew = (passedConfig: OpenIdConfiguration): RuleValidationResult => {\n  const hasRefreshToken = passedConfig.useRefreshToken;\n  const hasSilentRenew = passedConfig.silentRenew;\n  const scope = passedConfig.scope || '';\n  const hasOfflineScope = scope.split(' ').includes('offline_access');\n\n  if (hasRefreshToken && hasSilentRenew && !hasOfflineScope) {\n    return {\n      result: false,\n      messages: ['When using silent renew and refresh tokens please set the `offline_access` scope'],\n      level: 'warning',\n    };\n  }\n\n  return POSITIVE_VALIDATION_RESULT;\n};\n","import { ensureClientId } from './ensure-clientId.rule';\nimport { ensureRedirectRule } from './ensure-redirect-url.rule';\nimport { ensureSilentRenewUrlWhenNoRefreshTokenUsed } from './ensure-silentRenewUrl-with-no-refreshtokens.rule';\nimport { ensureStsServer } from './ensure-sts-server.rule';\nimport { useOfflineScopeWithSilentRenew } from './use-offline-scope-with-silent-renew.rule';\n\nexport const allRules = [\n  ensureStsServer,\n  useOfflineScopeWithSilentRenew,\n  ensureRedirectRule,\n  ensureClientId,\n  ensureSilentRenewUrlWhenNoRefreshTokenUsed,\n];\n","import { Injectable } from '@angular/core';\nimport { OpenIdConfiguration } from '../angular-auth-oidc-client';\nimport { LoggerService } from '../logging/logger.service';\nimport { Level, RuleValidationResult } from './rule';\nimport { allRules } from './rules';\n\n@Injectable()\nexport class ConfigValidationService {\n  constructor(private loggerService: LoggerService) {}\n\n  validateConfig(passedConfig: OpenIdConfiguration): boolean {\n    const allValidationResults = allRules.map((rule) => rule(passedConfig));\n\n    const allMessages = allValidationResults.filter((x) => x.messages.length > 0);\n\n    const allErrorMessages = this.getAllMessagesOfType('error', allMessages);\n    const allWarnings = this.getAllMessagesOfType('warning', allMessages);\n    allErrorMessages.map((message) => this.loggerService.logError(message));\n    allWarnings.map((message) => this.loggerService.logWarning(message));\n\n    return allErrorMessages.length === 0;\n  }\n\n  private getAllMessagesOfType(type: Level, results: RuleValidationResult[]) {\n    const allMessages = results.filter((x) => x.level === type).map((result) => result.messages);\n    return allMessages.reduce((acc, val) => acc.concat(val), []);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { throwError } from 'rxjs';\nimport { catchError, tap } from 'rxjs/operators';\nimport { ConfigValidationService } from '../config-validation/config-validation.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { EventTypes } from '../public-events/event-types';\nimport { PublicEventsService } from '../public-events/public-events.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { AuthWellKnownEndpoints } from './auth-well-known-endpoints';\nimport { AuthWellKnownService } from './auth-well-known.service';\nimport { OpenIdConfiguration } from './openid-configuration';\nimport { PublicConfiguration } from './public-configuration';\n\n@Injectable()\nexport class OidcConfigService {\n  constructor(\n    private loggerService: LoggerService,\n    private publicEventsService: PublicEventsService,\n    private configurationProvider: ConfigurationProvider,\n    private authWellKnownService: AuthWellKnownService,\n    private storagePersistenceService: StoragePersistenceService,\n    private configValidationService: ConfigValidationService\n  ) {}\n\n  withConfig(passedConfig: OpenIdConfiguration, passedAuthWellKnownEndpoints?: AuthWellKnownEndpoints): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.configValidationService.validateConfig(passedConfig)) {\n        this.loggerService.logError('Validation of config rejected with errors. Config is NOT set.');\n        resolve();\n      }\n\n      if (!passedConfig.authWellknownEndpoint) {\n        passedConfig.authWellknownEndpoint = passedConfig.stsServer;\n      }\n\n      const usedConfig = this.configurationProvider.setConfig(passedConfig);\n\n      const alreadyExistingAuthWellKnownEndpoints = this.storagePersistenceService.read('authWellKnownEndPoints');\n      if (!!alreadyExistingAuthWellKnownEndpoints) {\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\n          configuration: passedConfig,\n          wellknown: alreadyExistingAuthWellKnownEndpoints,\n        });\n\n        resolve();\n      }\n\n      if (!!passedAuthWellKnownEndpoints) {\n        this.authWellKnownService.storeWellKnownEndpoints(passedAuthWellKnownEndpoints);\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\n          configuration: passedConfig,\n          wellknown: passedAuthWellKnownEndpoints,\n        });\n\n        resolve();\n      }\n      if (usedConfig.eagerLoadAuthWellKnownEndpoints) {\n        this.authWellKnownService\n          .getAuthWellKnownEndPoints(usedConfig.authWellknownEndpoint)\n          .pipe(\n            catchError((error) => {\n              this.loggerService.logError('Getting auth well known endpoints failed on start', error);\n              return throwError(error);\n            }),\n            tap((wellknownEndPoints) =>\n              this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\n                configuration: passedConfig,\n                wellknown: wellknownEndPoints,\n              })\n            )\n          )\n          .subscribe(\n            () => resolve(),\n            () => reject()\n          );\n      } else {\n        this.publicEventsService.fireEvent<PublicConfiguration>(EventTypes.ConfigLoaded, {\n          configuration: passedConfig,\n          wellknown: null,\n        });\n        resolve();\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { LoggerService } from '../../logging/logger.service';\nimport { FlowHelper } from '../../utils/flowHelper/flow-helper.service';\n\n@Injectable()\nexport class ResponseTypeValidationService {\n  constructor(private loggerService: LoggerService, private flowHelper: FlowHelper) {}\n\n  hasConfigValidResponseType(): boolean {\n    if (this.flowHelper.isCurrentFlowAnyImplicitFlow()) {\n      return true;\n    }\n\n    if (this.flowHelper.isCurrentFlowCodeFlow()) {\n      return true;\n    }\n\n    this.loggerService.logWarning('module configured incorrectly, invalid response_type. Check the responseType in the config');\n    return false;\n  }\n}\n","import { DOCUMENT } from '@angular/common';\nimport { Inject, Injectable } from '@angular/core';\n\n@Injectable({ providedIn: 'root' })\nexport class RedirectService {\n  constructor(@Inject(DOCUMENT) private readonly doc: any) {}\n\n  redirectTo(url) {\n    this.doc.location.href = url;\n  }\n}\n","import { HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, map, retry } from 'rxjs/operators';\nimport { DataService } from '../../api/data.service';\nimport { LoggerService } from '../../logging/logger.service';\nimport { StoragePersistenceService } from '../../storage/storage-persistence.service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { ParResponse } from './par-response';\n\n@Injectable()\nexport class ParService {\n  constructor(\n    private loggerService: LoggerService,\n    private urlService: UrlService,\n    private dataService: DataService,\n    private storagePersistenceService: StoragePersistenceService\n  ) {}\n\n  postParRequest(customParams?: { [key: string]: string | number | boolean }): Observable<ParResponse> {\n    let headers: HttpHeaders = new HttpHeaders();\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\n\n    const authWellKnown = this.storagePersistenceService.read('authWellKnownEndPoints');\n\n    if (!authWellKnown) {\n      return throwError('Could not read PAR endpoint because authWellKnownEndPoints are not given');\n    }\n\n    const parEndpoint = authWellKnown.parEndpoint;\n    if (!parEndpoint) {\n      return throwError('Could not read PAR endpoint from authWellKnownEndpoints');\n    }\n\n    const data = this.urlService.createBodyForParCodeFlowRequest(customParams);\n\n    return this.dataService.post(parEndpoint, data, headers).pipe(\n      retry(2),\n      map((response: any) => {\n        this.loggerService.logDebug('par response: ', response);\n\n        return {\n          expiresIn: response.expires_in,\n          requestUri: response.request_uri,\n        };\n      }),\n      catchError((error) => {\n        const errorMessage = `There was an error on ParService postParRequest`;\n        this.loggerService.logError(errorMessage, error);\n        return throwError(errorMessage);\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { map, switchMap, take } from 'rxjs/operators';\nimport { AuthOptions } from '../../auth-options';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { CheckAuthService } from '../../check-auth.service';\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { UserService } from '../../userData/user-service';\nimport { RedirectService } from '../../utils/redirect/redirect.service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { LoginResponse } from '../login-response';\nimport { PopupOptions } from '../popup/popup-options';\nimport { PopUpService } from '../popup/popup.service';\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\nimport { ParResponse } from './par-response';\nimport { ParService } from './par.service';\n\n@Injectable()\nexport class ParLoginService {\n  constructor(\n    private loggerService: LoggerService,\n    private responseTypeValidationService: ResponseTypeValidationService,\n    private urlService: UrlService,\n    private redirectService: RedirectService,\n    private configurationProvider: ConfigurationProvider,\n    private authWellKnownService: AuthWellKnownService,\n    private popupService: PopUpService,\n    private checkAuthService: CheckAuthService,\n    private userService: UserService,\n    private authStateService: AuthStateService,\n    private parService: ParService\n  ) {}\n\n  loginPar(authOptions?: AuthOptions): void {\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\n      this.loggerService.logError('Invalid response type!');\n      return;\n    }\n\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!authWellknownEndpoint) {\n      this.loggerService.logError('no authWellknownEndpoint given!');\n      return;\n    }\n\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow, no auth data');\n\n    const { urlHandler, customParams } = authOptions || {};\n\n    this.authWellKnownService\n      .getAuthWellKnownEndPoints(authWellknownEndpoint)\n      .pipe(switchMap(() => this.parService.postParRequest(customParams)))\n      .subscribe((response) => {\n        this.loggerService.logDebug('par response: ', response);\n\n        const url = this.urlService.getAuthorizeParUrl(response.requestUri);\n\n        this.loggerService.logDebug('par request url: ', url);\n\n        if (!url) {\n          this.loggerService.logError(`Could not create url with param ${response.requestUri}: '${url}'`);\n          return;\n        }\n\n        if (urlHandler) {\n          urlHandler(url);\n        } else {\n          this.redirectService.redirectTo(url);\n        }\n      });\n  }\n\n  loginWithPopUpPar(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\n      const errorMessage = 'Invalid response type!';\n      this.loggerService.logError(errorMessage);\n      return throwError(errorMessage);\n    }\n\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!authWellknownEndpoint) {\n      const errorMessage = 'no authWellknownEndpoint given!';\n      this.loggerService.logError(errorMessage);\n      return throwError(errorMessage);\n    }\n\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow with popup, no auth data');\n\n    const { customParams } = authOptions || {};\n\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\n      switchMap(() => this.parService.postParRequest(customParams)),\n      switchMap((response: ParResponse) => {\n        this.loggerService.logDebug('par response: ', response);\n\n        const url = this.urlService.getAuthorizeParUrl(response.requestUri);\n\n        this.loggerService.logDebug('par request url: ', url);\n\n        if (!url) {\n          const errorMessage = `Could not create url with param ${response.requestUri}: 'url'`;\n          this.loggerService.logError(errorMessage);\n          return throwError(errorMessage);\n        }\n\n        this.popupService.openPopUp(url, popupOptions);\n\n        return this.popupService.result$.pipe(\n          take(1),\n          switchMap((result) =>\n            result.userClosed === true\n              ? of({ isAuthenticated: false, errorMessage: 'User closed popup' })\n              : this.checkAuthService.checkAuth(result.receivedUrl).pipe(\n                  map((isAuthenticated) => ({\n                    isAuthenticated,\n                    userData: this.userService.getUserDataFromStore(),\n                    accessToken: this.authStateService.getAccessToken(),\n                  }))\n                )\n          )\n        );\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { map, switchMap, take } from 'rxjs/operators';\nimport { AuthOptions } from '../../auth-options';\nimport { AuthStateService } from '../../authState/auth-state.service';\nimport { CheckAuthService } from '../../check-auth.service';\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { UserService } from '../../userData/user-service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { LoginResponse } from '../login-response';\nimport { PopupOptions } from '../popup/popup-options';\nimport { PopUpService } from '../popup/popup.service';\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\n\n@Injectable()\nexport class PopUpLoginService {\n  constructor(\n    private loggerService: LoggerService,\n    private responseTypeValidationService: ResponseTypeValidationService,\n    private urlService: UrlService,\n    private configurationProvider: ConfigurationProvider,\n    private authWellKnownService: AuthWellKnownService,\n    private popupService: PopUpService,\n    private checkAuthService: CheckAuthService,\n    private userService: UserService,\n    private authStateService: AuthStateService\n  ) {}\n\n  loginWithPopUpStandard(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\n      const errorMessage = 'Invalid response type!';\n      this.loggerService.logError(errorMessage);\n      return throwError(errorMessage);\n    }\n\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!authWellknownEndpoint) {\n      const errorMessage = 'no authWellknownEndpoint given!';\n      this.loggerService.logError(errorMessage);\n      return throwError(errorMessage);\n    }\n\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow with popup, no auth data');\n\n    return this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).pipe(\n      switchMap(() => {\n        const { customParams } = authOptions || {};\n\n        const authUrl = this.urlService.getAuthorizeUrl(customParams);\n\n        this.popupService.openPopUp(authUrl, popupOptions);\n\n        return this.popupService.result$.pipe(\n          take(1),\n          switchMap((result) =>\n            result.userClosed === true\n              ? of({ isAuthenticated: false, errorMessage: 'User closed popup' })\n              : this.checkAuthService.checkAuth(result.receivedUrl).pipe(\n                  map((isAuthenticated) => ({\n                    isAuthenticated,\n                    userData: this.userService.getUserDataFromStore(),\n                    accessToken: this.authStateService.getAccessToken(),\n                  }))\n                )\n          )\n        );\n      })\n    );\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { AuthOptions } from '../../auth-options';\nimport { AuthWellKnownService } from '../../config/auth-well-known.service';\nimport { ConfigurationProvider } from '../../config/config.provider';\nimport { LoggerService } from '../../logging/logger.service';\nimport { RedirectService } from '../../utils/redirect/redirect.service';\nimport { UrlService } from '../../utils/url/url.service';\nimport { ResponseTypeValidationService } from '../response-type-validation/response-type-validation.service';\n\n@Injectable()\nexport class StandardLoginService {\n  constructor(\n    private loggerService: LoggerService,\n    private responseTypeValidationService: ResponseTypeValidationService,\n    private urlService: UrlService,\n    private redirectService: RedirectService,\n    private configurationProvider: ConfigurationProvider,\n    private authWellKnownService: AuthWellKnownService\n  ) {}\n\n  loginStandard(authOptions?: AuthOptions): void {\n    if (!this.responseTypeValidationService.hasConfigValidResponseType()) {\n      this.loggerService.logError('Invalid response type!');\n      return;\n    }\n\n    const { authWellknownEndpoint } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!authWellknownEndpoint) {\n      this.loggerService.logError('no authWellknownEndpoint given!');\n      return;\n    }\n\n    this.loggerService.logDebug('BEGIN Authorize OIDC Flow, no auth data');\n\n    this.authWellKnownService.getAuthWellKnownEndPoints(authWellknownEndpoint).subscribe(() => {\n      const { urlHandler, customParams } = authOptions || {};\n\n      const url = this.urlService.getAuthorizeUrl(customParams);\n\n      if (!url) {\n        this.loggerService.logError('Could not create url', url);\n        return;\n      }\n\n      if (urlHandler) {\n        urlHandler(url);\n      } else {\n        this.redirectService.redirectTo(url);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { AuthOptions } from '../auth-options';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoginResponse } from './login-response';\nimport { ParLoginService } from './par/par-login.service';\nimport { PopUpLoginService } from './popup/popup-login.service';\nimport { PopupOptions } from './popup/popup-options';\nimport { StandardLoginService } from './standard/standard-login.service';\n\n@Injectable()\nexport class LoginService {\n  constructor(\n    private configurationProvider: ConfigurationProvider,\n    private parLoginService: ParLoginService,\n    private popUpLoginService: PopUpLoginService,\n    private standardLoginService: StandardLoginService\n  ) {}\n\n  login(authOptions?: AuthOptions): void {\n    const { usePushedAuthorisationRequests } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (usePushedAuthorisationRequests) {\n      return this.parLoginService.loginPar(authOptions);\n    } else {\n      return this.standardLoginService.loginStandard(authOptions);\n    }\n  }\n\n  loginWithPopUp(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\n    const { usePushedAuthorisationRequests } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (usePushedAuthorisationRequests) {\n      return this.parLoginService.loginWithPopUpPar(authOptions, popupOptions);\n    } else {\n      return this.popUpLoginService.loginWithPopUpStandard(authOptions, popupOptions);\n    }\n  }\n}\n","import { HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable, of, throwError } from 'rxjs';\nimport { catchError, retry, switchMap, tap } from 'rxjs/operators';\nimport { DataService } from '../api/data.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { ResetAuthDataService } from '../flows/reset-auth-data.service';\nimport { CheckSessionService } from '../iframe/check-session.service';\nimport { LoggerService } from '../logging/logger.service';\nimport { StoragePersistenceService } from '../storage/storage-persistence.service';\nimport { UrlService } from '../utils/url/url.service';\n\n@Injectable()\nexport class LogoffRevocationService {\n  constructor(\n    private dataService: DataService,\n    private storagePersistenceService: StoragePersistenceService,\n    private loggerService: LoggerService,\n    private urlService: UrlService,\n    private checkSessionService: CheckSessionService,\n    private resetAuthDataService: ResetAuthDataService,\n    // TODO: HERE\n    //private redirectService: RedirectService,\n    private configurationProvider: ConfigurationProvider\n  ) {}\n\n  // Logs out on the server and the local client.\n  // If the server state has changed, checksession, then only a local logout.\n  logoff(urlHandler?: (url: string) => any): void {\n    this.loggerService.logDebug('logoff, remove auth ');\n    const endSessionUrl = this.getEndSessionUrl();\n    this.resetAuthDataService.resetAuthorizationData();\n\n    if (!endSessionUrl) {\n      this.loggerService.logDebug('only local login cleaned up, no end_session_endpoint');\n      return;\n    }\n\n    if (this.checkSessionService.serverStateChanged()) {\n      this.loggerService.logDebug('only local login cleaned up, server session has changed');\n    } else if (urlHandler) {\n      urlHandler(endSessionUrl);\n    } else {\n      // TODO: HERE\n      //this.redirectService.redirectTo(endSessionUrl);\n      this.dataService.get(endSessionUrl).subscribe(\n        (result) => {\n          console.log(result);\n        },\n        (error) => {\n          console.log('error', error);\n        }\n      );\n    }\n  }\n\n  logoffLocal(): void {\n    this.resetAuthDataService.resetAuthorizationData();\n    this.checkSessionService.stop();\n  }\n\n  // The refresh token and and the access token are revoked on the server. If the refresh token does not exist\n  // only the access token is revoked. Then the logout run.\n  logoffAndRevokeTokens(urlHandler?: (url: string) => any): Observable<any> {\n    if (!this.storagePersistenceService.read('authWellKnownEndPoints')?.revocationEndpoint) {\n      this.loggerService.logDebug('revocation endpoint not supported');\n      this.logoff(urlHandler);\n    }\n\n    if (this.storagePersistenceService.getRefreshToken()) {\n      return this.revokeRefreshToken().pipe(\n        switchMap((result) => this.revokeAccessToken(result)),\n        catchError((error) => {\n          const errorMessage = `revoke token failed`;\n          this.loggerService.logError(errorMessage, error);\n          return throwError(errorMessage);\n        }),\n        tap(() => this.logoff(urlHandler))\n      );\n    } else {\n      return this.revokeAccessToken().pipe(\n        catchError((error) => {\n          const errorMessage = `revoke access token failed`;\n          this.loggerService.logError(errorMessage, error);\n          return throwError(errorMessage);\n        }),\n        tap(() => this.logoff(urlHandler))\n      );\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7009\n  // revokes an access token on the STS. If no token is provided, then the token from\n  // the storage is revoked. You can pass any token to revoke. This makes it possible to\n  // manage your own tokens. The is a public API.\n  revokeAccessToken(accessToken?: any): Observable<any> {\n    const accessTok = accessToken || this.storagePersistenceService.getAccessToken();\n    const body = this.urlService.createRevocationEndpointBodyAccessToken(accessTok);\n    const url = this.urlService.getRevocationEndpointUrl();\n\n    let headers: HttpHeaders = new HttpHeaders();\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\n\n    return this.dataService.post(url, body, headers).pipe(\n      retry(2),\n      switchMap((response: any) => {\n        this.loggerService.logDebug('revocation endpoint post response: ', response);\n        return of(response);\n      }),\n      catchError((error) => {\n        const errorMessage = `Revocation request failed`;\n        this.loggerService.logError(errorMessage, error);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  // https://tools.ietf.org/html/rfc7009\n  // revokes an refresh token on the STS. This is only required in the code flow with refresh tokens.\n  // If no token is provided, then the token from the storage is revoked. You can pass any token to revoke.\n  // This makes it possible to manage your own tokens.\n  revokeRefreshToken(refreshToken?: any): Observable<any> {\n    const refreshTok = refreshToken || this.storagePersistenceService.getRefreshToken();\n    const body = this.urlService.createRevocationEndpointBodyRefreshToken(refreshTok);\n    const url = this.urlService.getRevocationEndpointUrl();\n\n    let headers: HttpHeaders = new HttpHeaders();\n    headers = headers.set('Content-Type', 'application/x-www-form-urlencoded');\n\n    return this.dataService.post(url, body, headers).pipe(\n      retry(2),\n      switchMap((response: any) => {\n        this.loggerService.logDebug('revocation endpoint post response: ', response);\n        return of(response);\n      }),\n      catchError((error) => {\n        const errorMessage = `Revocation request failed`;\n        this.loggerService.logError(errorMessage, error);\n        return throwError(errorMessage);\n      })\n    );\n  }\n\n  getEndSessionUrl(customParams?: { [key: string]: string | number | boolean }): string | null {\n    const idToken = this.storagePersistenceService.getIdToken();\n\n    const { customParamsEndSession } = this.configurationProvider.getOpenIDConfiguration();\n\n    const mergedParams = { ...customParams, ...customParamsEndSession };\n\n    return this.urlService.createEndSessionUrl(idToken, mergedParams);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { AuthOptions } from './auth-options';\nimport { AuthStateService } from './authState/auth-state.service';\nimport { CallbackService } from './callback/callback.service';\nimport { RefreshSessionService } from './callback/refresh-session.service';\nimport { CheckAuthService } from './check-auth.service';\nimport { ConfigurationProvider } from './config/config.provider';\nimport { PublicConfiguration } from './config/public-configuration';\nimport { FlowsDataService } from './flows/flows-data.service';\nimport { CheckSessionService } from './iframe/check-session.service';\nimport { LoginResponse } from './login/login-response';\nimport { LoginService } from './login/login.service';\nimport { PopupOptions } from './login/popup/popup-options';\nimport { LogoffRevocationService } from './logoffRevoke/logoff-revocation.service';\nimport { StoragePersistenceService } from './storage/storage-persistence.service';\nimport { TokenResponse } from './tokens/token-response';\nimport { UserService } from './userData/user-service';\nimport { TokenHelperService } from './utils/tokenHelper/oidc-token-helper.service';\n\n@Injectable()\nexport class OidcSecurityService {\n  /**\n   * Gets the currently active OpenID configuration.\n   */\n  get configuration(): PublicConfiguration {\n    const openIDConfiguration = this.configurationProvider.getOpenIDConfiguration();\n\n    return {\n      configuration: openIDConfiguration,\n      wellknown: this.storagePersistenceService.read('authWellKnownEndPoints'),\n    };\n  }\n\n  /**\n   * Provides information about the user after they have logged in.\n   */\n  get userData$(): Observable<any> {\n    return this.userService.userData$;\n  }\n\n  /**\n   * Emits each time an authorization event occurs. Returns true if the user is authenticated and false if they are not.\n   */\n  get isAuthenticated$(): Observable<boolean> {\n    return this.authStateService.authorized$;\n  }\n\n  /**\n   * Emits each time the server sends a CheckSession event and the value changed. This property will always return\n   * true.\n   */\n  get checkSessionChanged$(): Observable<boolean> {\n    return this.checkSessionService.checkSessionChanged$;\n  }\n\n  /**\n   * Emits on possible STS callback. The observable will never contain a value.\n   */\n  get stsCallback$(): Observable<any> {\n    return this.callbackService.stsCallback$;\n  }\n\n  constructor(\n    private checkSessionService: CheckSessionService,\n    private checkAuthService: CheckAuthService,\n    private userService: UserService,\n    private tokenHelperService: TokenHelperService,\n    private configurationProvider: ConfigurationProvider,\n    private authStateService: AuthStateService,\n    private flowsDataService: FlowsDataService,\n    private callbackService: CallbackService,\n    private logoffRevocationService: LogoffRevocationService,\n    private loginService: LoginService,\n    private storagePersistenceService: StoragePersistenceService,\n    private refreshSessionService: RefreshSessionService\n  ) {}\n\n  /**\n   * Starts the complete setup flow. Calling will start the entire authentication flow, and the returned observable\n   * will denote whether the user was successfully authenticated.\n   *\n   * @param url The url to perform the authorization on the behalf of.\n   */\n  checkAuth(url?: string): Observable<boolean> {\n    return this.checkAuthService.checkAuth(url);\n  }\n\n  /**\n   * Checks the server for an authenticated session using the iframe silent renew if not locally authenticated.\n   */\n  checkAuthIncludingServer(): Observable<boolean> {\n    return this.checkAuthService.checkAuthIncludingServer();\n  }\n\n  /**\n   * Returns the access token for the login scenario.\n   */\n  getToken(): string {\n    return this.authStateService.getAccessToken();\n  }\n\n  /**\n   * Returns the ID token for the login scenario.\n   */\n  getIdToken(): string {\n    return this.authStateService.getIdToken();\n  }\n\n  /**\n   * Returns the refresh token, if present, for the login scenario.\n   */\n  getRefreshToken(): string {\n    return this.authStateService.getRefreshToken();\n  }\n\n  /**\n   * Returns the payload from the ID token.\n   *\n   * @param encode Set to true if the payload is base64 encoded\n   */\n  getPayloadFromIdToken(encode = false): any {\n    const token = this.getIdToken();\n    return this.tokenHelperService.getPayloadFromToken(token, encode);\n  }\n\n  /**\n   * Sets a custom state for the authorize request.\n   *\n   * @param state The state to set.\n   */\n  setState(state: string): void {\n    this.flowsDataService.setAuthStateControl(state);\n  }\n\n  /**\n   * Gets the state value used for the authorize request.\n   */\n  getState(): string {\n    return this.flowsDataService.getAuthStateControl();\n  }\n\n  /**\n   * Redirects the user to the STS to begin the authentication process.\n   *\n   * @param authOptions The custom options for the the authentication request.\n   */\n  // Code Flow with PCKE or Implicit Flow\n  authorize(authOptions?: AuthOptions): void {\n    if (authOptions?.customParams) {\n      this.storagePersistenceService.write('storageCustomRequestParams', authOptions.customParams);\n    }\n\n    this.loginService.login(authOptions);\n  }\n\n  /**\n   * Opens the STS in a new window to begin the authentication process.\n   *\n   * @param authOptions The custom options for the authentication request.\n   * @param popupOptions The configuration for the popup window.\n   */\n  authorizeWithPopUp(authOptions?: AuthOptions, popupOptions?: PopupOptions): Observable<LoginResponse> {\n    if (authOptions?.customParams) {\n      this.storagePersistenceService.write('storageCustomRequestParams', authOptions.customParams);\n    }\n\n    return this.loginService.loginWithPopUp(authOptions, popupOptions);\n  }\n\n  /**\n   * Manually refreshes the session.\n   *\n   * @param customParams Custom parameters to pass to the refresh request.\n   */\n  forceRefreshSession(customParams?: { [key: string]: string | number | boolean }): Observable<TokenResponse> {\n    const { useRefreshToken } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (customParams) {\n      if (useRefreshToken) {\n        this.storagePersistenceService.write('storageCustomParamsRefresh', customParams);\n      } else {\n        this.storagePersistenceService.write('storageCustomRequestParams', customParams);\n      }\n    }\n\n    return this.refreshSessionService.forceRefreshSession(customParams);\n  }\n\n  /**\n   * Revokes the refresh token (if present) and the access token on the server and then performs the logoff operation.\n   *\n   * @param urlHandler An optional url handler for the logoff request.\n   */\n  // The refresh token and and the access token are revoked on the server. If the refresh token does not exist\n  // only the access token is revoked. Then the logout run.\n  logoffAndRevokeTokens(urlHandler?: (url: string) => any): Observable<any> {\n    return this.logoffRevocationService.logoffAndRevokeTokens(urlHandler);\n  }\n\n  /**\n   * Logs out on the server and the local client. If the server state has changed, confirmed via checksession,\n   * then only a local logout is performed.\n   *\n   * @param urlHandler\n   */\n  logoff(urlHandler?: (url: string) => any): void {\n    return this.logoffRevocationService.logoff(urlHandler);\n  }\n\n  /**\n   * Logs the user out of the application without logging them out of the server.\n   */\n  logoffLocal(): void {\n    return this.logoffRevocationService.logoffLocal();\n  }\n\n  /**\n   * Revokes an access token on the STS. This is only required in the code flow with refresh tokens. If no token is\n   * provided, then the token from the storage is revoked. You can pass any token to revoke.\n   * https://tools.ietf.org/html/rfc7009\n   *\n   * @param accessToken The access token to revoke.\n   */\n  revokeAccessToken(accessToken?: any): Observable<any> {\n    return this.logoffRevocationService.revokeAccessToken(accessToken);\n  }\n\n  /**\n   * Revokes a refresh token on the STS. This is only required in the code flow with refresh tokens. If no token is\n   * provided, then the token from the storage is revoked. You can pass any token to revoke.\n   * https://tools.ietf.org/html/rfc7009\n   *\n   * @param refreshToken The access token to revoke.\n   */\n  revokeRefreshToken(refreshToken?: any): Observable<any> {\n    return this.logoffRevocationService.revokeRefreshToken(refreshToken);\n  }\n\n  /**\n   * Creates the end session URL which can be used to implement an alternate server logout.\n   */\n  getEndSessionUrl(customParams?: { [key: string]: string | number | boolean }): string | null {\n    return this.logoffRevocationService.getEndSessionUrl(customParams);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from '../logging/logger.service';\nimport { AbstractSecurityStorage } from './abstract-security-storage';\n\n@Injectable()\nexport class BrowserStorageService implements AbstractSecurityStorage {\n  constructor(private configProvider: ConfigurationProvider, private loggerService: LoggerService) {}\n\n  read(key: string): any {\n    if (!this.hasStorage()) {\n      this.loggerService.logDebug(`Wanted to read '${key}' but Storage was undefined`);\n      return false;\n    }\n\n    const item = this.getStorage()?.getItem(key);\n\n    if (!item) {\n      this.loggerService.logDebug(`Wanted to read '${key}' but nothing was found`);\n      return null;\n    }\n\n    return JSON.parse(item);\n  }\n\n  write(key: string, value: any): boolean {\n    if (!this.hasStorage()) {\n      this.loggerService.logDebug(`Wanted to write '${key}/${value}' but Storage was falsy`);\n      return false;\n    }\n\n    const storage = this.getStorage();\n    if (!storage) {\n      this.loggerService.logDebug(`Wanted to write '${key}/${value}' but Storage was falsy`);\n      return false;\n    }\n\n    value = value || null;\n\n    storage.setItem(`${key}`, JSON.stringify(value));\n    return true;\n  }\n\n  remove(key: string): boolean {\n    if (!this.hasStorage()) {\n      this.loggerService.logDebug(`Wanted to remove '${key}' but Storage was falsy`);\n      return false;\n    }\n\n    const storage = this.getStorage();\n    if (!storage) {\n      this.loggerService.logDebug(`Wanted to write '${key}' but Storage was falsy`);\n      return false;\n    }\n\n    storage.removeItem(`${key}`);\n    return true;\n  }\n\n  private getStorage() {\n    const config = this.configProvider.getOpenIDConfiguration();\n    if (!config) {\n      return null;\n    }\n\n    return config.storage;\n  }\n\n  private hasStorage() {\n    return typeof Storage !== 'undefined';\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { NgModule } from '@angular/core';\nimport { DataService } from './api/data.service';\nimport { HttpBaseService } from './api/http-base.service';\nimport { AuthStateService } from './authState/auth-state.service';\nimport { AutoLoginService } from './auto-login/auto-login-service';\nimport { ImplicitFlowCallbackService } from './callback/implicit-flow-callback.service';\nimport { CheckAuthService } from './check-auth.service';\nimport { ConfigValidationService } from './config-validation/config-validation.service';\nimport { AuthWellKnownDataService } from './config/auth-well-known-data.service';\nimport { AuthWellKnownService } from './config/auth-well-known.service';\nimport { ConfigurationProvider } from './config/config.provider';\nimport { OidcConfigService } from './config/config.service';\nimport { CodeFlowCallbackHandlerService } from './flows/callback-handling/code-flow-callback-handler.service';\nimport { HistoryJwtKeysCallbackHandlerService } from './flows/callback-handling/history-jwt-keys-callback-handler.service';\nimport { ImplicitFlowCallbackHandlerService } from './flows/callback-handling/implicit-flow-callback-handler.service';\nimport { RefreshSessionCallbackHandlerService } from './flows/callback-handling/refresh-session-callback-handler.service';\nimport { RefreshTokenCallbackHandlerService } from './flows/callback-handling/refresh-token-callback-handler.service';\nimport { StateValidationCallbackHandlerService } from './flows/callback-handling/state-validation-callback-handler.service';\nimport { UserCallbackHandlerService } from './flows/callback-handling/user-callback-handler.service';\nimport { FlowsDataService } from './flows/flows-data.service';\nimport { FlowsService } from './flows/flows.service';\nimport { RandomService } from './flows/random/random.service';\nimport { ResetAuthDataService } from './flows/reset-auth-data.service';\nimport { SigninKeyDataService } from './flows/signin-key-data.service';\nimport { CheckSessionService } from './iframe/check-session.service';\nimport { IFrameService } from './iframe/existing-iframe.service';\nimport { SilentRenewService } from './iframe/silent-renew.service';\nimport { LoggerService } from './logging/logger.service';\nimport { LoginService } from './login/login.service';\nimport { ParLoginService } from './login/par/par-login.service';\nimport { ParService } from './login/par/par.service';\nimport { PopUpLoginService } from './login/popup/popup-login.service';\nimport { ResponseTypeValidationService } from './login/response-type-validation/response-type-validation.service';\nimport { StandardLoginService } from './login/standard/standard-login.service';\nimport { LogoffRevocationService } from './logoffRevoke/logoff-revocation.service';\nimport { OidcSecurityService } from './oidc.security.service';\nimport { PublicEventsService } from './public-events/public-events.service';\nimport { AbstractSecurityStorage } from './storage/abstract-security-storage';\nimport { BrowserStorageService } from './storage/browser-storage.service';\nimport { StoragePersistenceService } from './storage/storage-persistence.service';\nimport { UserService } from './userData/user-service';\nimport { EqualityService } from './utils/equality/equality.service';\nimport { FlowHelper } from './utils/flowHelper/flow-helper.service';\nimport { PlatformProvider } from './utils/platform-provider/platform.provider';\nimport { TokenHelperService } from './utils/tokenHelper/oidc-token-helper.service';\nimport { UrlService } from './utils/url/url.service';\nimport { StateValidationService } from './validation/state-validation.service';\nimport { TokenValidationService } from './validation/token-validation.service';\n\n@NgModule({\n  imports: [CommonModule, HttpClientModule],\n  declarations: [],\n  exports: [],\n})\nexport class AuthModule {\n  static forRoot(token: Token = {}) {\n    return {\n      ngModule: AuthModule,\n      providers: [\n        OidcConfigService,\n        PublicEventsService,\n        FlowHelper,\n        OidcSecurityService,\n        TokenValidationService,\n        PlatformProvider,\n        CheckSessionService,\n        FlowsDataService,\n        FlowsService,\n        SilentRenewService,\n        ConfigurationProvider,\n        LogoffRevocationService,\n        UserService,\n        RandomService,\n        HttpBaseService,\n        UrlService,\n        AuthStateService,\n        SigninKeyDataService,\n        StoragePersistenceService,\n        TokenHelperService,\n        LoggerService,\n        IFrameService,\n        EqualityService,\n        LoginService,\n        ParService,\n        AuthWellKnownDataService,\n        AuthWellKnownService,\n        DataService,\n        StateValidationService,\n        ConfigValidationService,\n        CheckAuthService,\n        ResetAuthDataService,\n        ImplicitFlowCallbackService,\n        HistoryJwtKeysCallbackHandlerService,\n        ResponseTypeValidationService,\n        UserCallbackHandlerService,\n        StateValidationCallbackHandlerService,\n        RefreshSessionCallbackHandlerService,\n        RefreshTokenCallbackHandlerService,\n        CodeFlowCallbackHandlerService,\n        ImplicitFlowCallbackHandlerService,\n        ParLoginService,\n        PopUpLoginService,\n        StandardLoginService,\n        AutoLoginService,\n        {\n          provide: AbstractSecurityStorage,\n          useClass: token.storage || BrowserStorageService,\n        },\n      ],\n    };\n  }\n}\n\nexport type Type<T> = new (...args: any[]) => T;\n\nexport interface Token {\n  storage?: Type<any>;\n}\n","import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot, CanActivate, CanLoad, Route, Router, RouterStateSnapshot, UrlSegment } from '@angular/router';\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { AutoLoginService } from '../auto-login/auto-login-service';\nimport { CheckAuthService } from '../check-auth.service';\nimport { LoginService } from '../login/login.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AutoLoginGuard implements CanActivate, CanLoad {\n  constructor(\n    private autoLoginService: AutoLoginService,\n    private authStateService: AuthStateService,\n    private checkAuthService: CheckAuthService,\n    private loginService: LoginService,\n    private router: Router\n  ) {}\n\n  canLoad(route: Route, segments: UrlSegment[]): Observable<boolean> {\n    const routeToRedirect = segments.join('/');\n\n    return this.checkAuth(routeToRedirect);\n  }\n\n  canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean> {\n    return this.checkAuth(state.url);\n  }\n\n  private checkAuth(url: string) {\n    const isAuthenticated = this.authStateService.areAuthStorageTokensValid();\n\n    if (isAuthenticated) {\n      return of(true);\n    }\n\n    return this.checkAuthService.checkAuth().pipe(\n      map((isAuthorized) => {\n        const storedRoute = this.autoLoginService.getStoredRedirectRoute();\n\n        if (isAuthorized) {\n          if (storedRoute) {\n            this.autoLoginService.deleteStoredRedirectRoute();\n            this.router.navigateByUrl(storedRoute);\n          }\n          return true;\n        }\n\n        this.autoLoginService.saveStoredRedirectRoute(url);\n        this.loginService.login();\n        return false;\n      })\n    );\n  }\n}\n","import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { AuthStateService } from '../authState/auth-state.service';\nimport { ConfigurationProvider } from '../config/config.provider';\nimport { LoggerService } from './../logging/logger.service';\n\n@Injectable()\nexport class AuthInterceptor implements HttpInterceptor {\n  constructor(\n    private authStateService: AuthStateService,\n    private configurationProvider: ConfigurationProvider,\n    private loggerService: LoggerService\n  ) {}\n\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    // Ensure we send the token only to routes which are secured\n    const { secureRoutes } = this.configurationProvider.getOpenIDConfiguration();\n\n    if (!secureRoutes) {\n      this.loggerService.logDebug(`No routes to check configured`);\n      return next.handle(req);\n    }\n\n    const matchingRoute = secureRoutes.find((x) => req.url.startsWith(x));\n\n    if (!matchingRoute) {\n      this.loggerService.logDebug(`Did not find matching route for ${req.url}`);\n      return next.handle(req);\n    }\n\n    this.loggerService.logDebug(`'${req.url}' matches configured route '${matchingRoute}'`);\n\n    const token = this.authStateService.getAccessToken();\n\n    if (!token) {\n      this.loggerService.logDebug(`Wanted to add token to ${req.url} but found no token: '${token}'`);\n      return next.handle(req);\n    }\n\n    this.loggerService.logDebug(`'${req.url}' matches configured route '${matchingRoute}', adding token`);\n    req = req.clone({\n      headers: req.headers.set('Authorization', 'Bearer ' + token),\n    });\n\n    return next.handle(req);\n  }\n}\n","// Public classes.\n\nexport * from './auth-options';\nexport * from './auth.module';\nexport * from './authState/authorization-result';\nexport * from './authState/authorized-state';\nexport * from './auto-login/auto-login.guard';\nexport * from './config/auth-well-known-endpoints';\nexport * from './config/config.service';\nexport * from './config/openid-configuration';\nexport * from './config/public-configuration';\nexport * from './interceptor/auth.interceptor';\nexport * from './logging/log-level';\nexport * from './logging/logger.service';\nexport * from './oidc.security.service';\nexport * from './public-events/event-types';\nexport * from './public-events/notification';\nexport * from './public-events/public-events.service';\nexport * from './storage/abstract-security-storage';\nexport * from './utils/tokenHelper/oidc-token-helper.service';\nexport * from './validation/jwtkeys';\nexport * from './validation/state-validation-result';\nexport * from './validation/token-validation.service';\nexport * from './validation/validation-result';\n","/*\n * Public API Surface of angular-auth-oidc-client\n */\n\nexport * from './lib/angular-auth-oidc-client';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}