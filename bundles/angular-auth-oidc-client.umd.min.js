!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/common/http"),require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("jsrsasign-reduced"),require("common-tags"),require("@angular/router")):"function"==typeof define&&define.amd?define("angular-auth-oidc-client",["exports","@angular/common","@angular/common/http","@angular/core","rxjs","rxjs/operators","jsrsasign-reduced","common-tags","@angular/router"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["angular-auth-oidc-client"]={},e.ng.common,e.ng.common.http,e.ng.core,e.rxjs,e.rxjs.operators,e["jsrsasign-reduced"],e["common-tags"],e.ng.router)}(this,(function(e,t,r,n,i,o,s,a,c){"use strict";var u,l=function(){function e(e){this.http=e}return e.prototype.get=function(e,t){return this.http.get(e,t)},e.prototype.post=function(e,t,r){return this.http.post(e,t,r)},e}();l.ɵfac=function(e){return new(e||l)(n.ɵɵinject(r.HttpClient))},l.ɵprov=n.ɵɵdefineInjectable({token:l,factory:l.ɵfac}),(u=e.LogLevel||(e.LogLevel={}))[u.None=0]="None",u[u.Debug=1]="Debug",u[u.Warn=2]="Warn",u[u.Error=3]="Error";var h={stsServer:"https://please_set",authWellknownEndpoint:"",redirectUrl:"https://please_set",clientId:"please_set",responseType:"code",scope:"openid email profile",hdParam:"",postLogoutRedirectUri:"https://please_set",startCheckSession:!1,silentRenew:!1,silentRenewUrl:"https://please_set",silentRenewTimeoutInSeconds:20,renewTimeBeforeTokenExpiresInSeconds:0,useRefreshToken:!1,usePushedAuthorisationRequests:!1,ignoreNonceAfterRefresh:!1,postLoginRoute:"/",forbiddenRoute:"/forbidden",unauthorizedRoute:"/unauthorized",autoUserinfo:!0,autoCleanStateAfterAuthentication:!0,triggerAuthorizationResultEvent:!1,logLevel:e.LogLevel.Warn,issValidationOff:!1,historyCleanupOff:!1,maxIdTokenIatOffsetAllowedInSeconds:120,disableIatOffsetValidation:!1,storage:"undefined"!=typeof Storage?sessionStorage:null,customParams:{},customParamsRefreshToken:{},customParamsEndSession:{},eagerLoadAuthWellKnownEndpoints:!0,disableRefreshIdTokenAuthTimeValidation:!1,tokenRefreshInSeconds:4,refreshTokenRetryInSeconds:3,ngswBypass:!1},d=function(){function e(e){this.platformId=e}return Object.defineProperty(e.prototype,"isBrowser",{get:function(){return t.isPlatformBrowser(this.platformId)},enumerable:!1,configurable:!0}),e}();d.ɵfac=function(e){return new(e||d)(n.ɵɵinject(n.PLATFORM_ID))},d.ɵprov=n.ɵɵdefineInjectable({token:d,factory:d.ɵfac});var g=function(){function e(e){this.platformProvider=e}return e.prototype.hasValidConfig=function(){return!!this.openIdConfigurationInternal},e.prototype.getOpenIDConfiguration=function(){return this.openIdConfigurationInternal||null},e.prototype.setConfig=function(e){return this.openIdConfigurationInternal=Object.assign(Object.assign({},h),e),(null==e?void 0:e.storage)&&console.warn("PLEASE NOTE: The storage in the config will be deprecated in future versions:\n                Please pass the custom storage in forRoot() as documented"),this.setSpecialCases(this.openIdConfigurationInternal),this.openIdConfigurationInternal},e.prototype.setSpecialCases=function(e){this.platformProvider.isBrowser||(e.startCheckSession=!1,e.silentRenew=!1,e.useRefreshToken=!1,e.usePushedAuthorisationRequests=!1)},e}();g.ɵfac=function(e){return new(e||g)(n.ɵɵinject(d))},g.ɵprov=n.ɵɵdefineInjectable({token:g,factory:g.ɵfac});var f,v="ngsw-bypass",p=function(){function e(e,t){this.httpClient=e,this.configurationProvider=t}return e.prototype.get=function(e,t){var n=this.prepareHeaders(t),i=new r.HttpParams;return this.configurationProvider.getOpenIDConfiguration().ngswBypass&&(i=i.set(v,"")),this.httpClient.get(e,{headers:n,params:i})},e.prototype.post=function(e,t,n){var i=n||this.prepareHeaders(),o=new r.HttpParams;return this.configurationProvider.getOpenIDConfiguration().ngswBypass&&(o=o.set(v,"")),this.httpClient.post(e,t,{headers:i,params:o})},e.prototype.prepareHeaders=function(e){var t=new r.HttpHeaders;return t=(t=t.set("Accept","application/json")).set("Access-Control-Allow-Origin","*"),e&&(t=t.set("Authorization","Bearer "+decodeURIComponent(e))),t},e}();p.ɵfac=function(e){return new(e||p)(n.ɵɵinject(l),n.ɵɵinject(g))},p.ɵprov=n.ɵɵdefineInjectable({token:p,factory:p.ɵfac}),(f=e.EventTypes||(e.EventTypes={}))[f.ConfigLoaded=0]="ConfigLoaded",f[f.ConfigLoadingFailed=1]="ConfigLoadingFailed",f[f.CheckSessionReceived=2]="CheckSessionReceived",f[f.UserDataChanged=3]="UserDataChanged",f[f.NewAuthorizationResult=4]="NewAuthorizationResult",f[f.TokenExpired=5]="TokenExpired",f[f.IdTokenExpired=6]="IdTokenExpired";var S=function(){};S.ɵfac=function(e){return new(e||S)},S.ɵprov=n.ɵɵdefineInjectable({token:S,factory:S.ɵfac});var w=function(){function e(e,t){this.oidcSecurityStorage=e,this.configurationProvider=t}return e.prototype.read=function(e){var t=this.createKeyWithPrefix(e);return this.oidcSecurityStorage.read(t)},e.prototype.write=function(e,t){var r=this.createKeyWithPrefix(e);this.oidcSecurityStorage.write(r,t)},e.prototype.remove=function(e){var t=this.createKeyWithPrefix(e);this.oidcSecurityStorage.remove(t)},e.prototype.resetStorageFlowData=function(){this.remove("session_state"),this.remove("storageSilentRenewRunning"),this.remove("codeVerifier"),this.remove("userData"),this.remove("storageCustomRequestParams"),this.remove("storageCustomParamsRefresh"),this.remove("access_token_expires_at")},e.prototype.resetAuthStateInStorage=function(){this.remove("authzData"),this.remove("authnResult")},e.prototype.getAccessToken=function(){return this.read("authzData")},e.prototype.getIdToken=function(){var e;return null===(e=this.read("authnResult"))||void 0===e?void 0:e.id_token},e.prototype.getRefreshToken=function(){var e;return null===(e=this.read("authnResult"))||void 0===e?void 0:e.refresh_token},e.prototype.createKeyWithPrefix=function(e){var t=this.configurationProvider.getOpenIDConfiguration();return((null==t?void 0:t.clientId)||"")+"_"+e},e}();w.ɵfac=function(e){return new(e||w)(n.ɵɵinject(S),n.ɵɵinject(g))},w.ɵprov=n.ɵɵdefineInjectable({token:w,factory:w.ɵfac});Object.create;function k(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function I(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function m(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.create;var b=function(){function t(e){this.configurationProvider=e}return t.prototype.logError=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.loggingIsTurnedOff()||(t&&t.length?console.error.apply(console,I([e],t)):console.error(e))},t.prototype.logWarning=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.logLevelIsSet()&&(this.loggingIsTurnedOff()||this.currentLogLevelIsEqualOrSmallerThan(e.LogLevel.Warn)&&(r&&r.length?console.warn.apply(console,I([t],r)):console.warn(t)))},t.prototype.logDebug=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.logLevelIsSet()&&(this.loggingIsTurnedOff()||this.currentLogLevelIsEqualOrSmallerThan(e.LogLevel.Debug)&&(r&&r.length?console.log.apply(console,I([t],r)):console.log(t)))},t.prototype.currentLogLevelIsEqualOrSmallerThan=function(e){return(this.configurationProvider.getOpenIDConfiguration()||{}).logLevel<=e},t.prototype.logLevelIsSet=function(){var e=(this.configurationProvider.getOpenIDConfiguration()||{}).logLevel;return null!==e&&void 0!==e},t.prototype.loggingIsTurnedOff=function(){return(this.configurationProvider.getOpenIDConfiguration()||{}).logLevel===e.LogLevel.None},t}();b.ɵfac=function(e){return new(e||b)(n.ɵɵinject(g))},b.ɵprov=n.ɵɵdefineInjectable({token:b,factory:b.ɵfac});var R=function(){function e(){this.notify=new i.ReplaySubject(1)}return e.prototype.fireEvent=function(e,t){this.notify.next({type:e,value:t})},e.prototype.registerForEvents=function(){return this.notify.asObservable()},e}();R.ɵfac=function(e){return new(e||R)},R.ɵprov=n.ɵɵdefineInjectable({token:R,factory:R.ɵfac});var C=function(){function e(e){this.loggerService=e}return e.prototype.getTokenExpirationDate=function(e){if(!e.hasOwnProperty("exp"))return new Date((new Date).toUTCString());var t=new Date(0);return t.setUTCSeconds(e.exp),t},e.prototype.getHeaderFromToken=function(e,t){return this.tokenIsValid(e)?this.getPartOfToken(e,0,t):{}},e.prototype.getPayloadFromToken=function(e,t){return this.tokenIsValid(e)?this.getPartOfToken(e,1,t):{}},e.prototype.getSignatureFromToken=function(e,t){return this.tokenIsValid(e)?this.getPartOfToken(e,2,t):{}},e.prototype.getPartOfToken=function(e,t,r){var n=this.extractPartOfToken(e,t);if(r)return n;var i=this.urlBase64Decode(n);return JSON.parse(i)},e.prototype.urlBase64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("Illegal base64url string!")}var r="undefined"!=typeof window?window.atob(t):Buffer.from(t,"base64").toString("binary");try{return decodeURIComponent(r.split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}catch(e){return r}},e.prototype.tokenIsValid=function(e){return e?e.includes(".")?3===e.split(".").length||(this.loggerService.logError("token '"+e+"' is not valid --\x3e token has to have exactly 2 dots"),!1):(this.loggerService.logError("token '"+e+"' is not valid --\x3e no dots included"),!1):(this.loggerService.logError("token '"+e+"' is not valid --\x3e token falsy"),!1)},e.prototype.extractPartOfToken=function(e,t){return e.split(".")[t]},e}();C.ɵfac=function(e){return new(e||C)(n.ɵɵinject(b))},C.ɵprov=n.ɵɵdefineInjectable({token:C,factory:C.ɵfac});var E=function(){function e(e,t){this.tokenHelperService=e,this.loggerService=t,this.keyAlgorithms=["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","PS256","PS384","PS512"]}return e.prototype.hasIdTokenExpired=function(e,t){var r=this.tokenHelperService.getPayloadFromToken(e,!1);return!this.validateIdTokenExpNotExpired(r,t)},e.prototype.validateIdTokenExpNotExpired=function(e,t){var r=this.tokenHelperService.getTokenExpirationDate(e);if(t=t||0,!r)return!1;var n=r.valueOf(),i=new Date((new Date).toUTCString()).valueOf()+1e3*t,o=n>i;return this.loggerService.logDebug("Has id_token expired: "+!o+", "+n+" > "+i),o},e.prototype.validateAccessTokenNotExpired=function(e,t){if(!e)return!0;t=t||0;var r=e.valueOf(),n=new Date((new Date).toUTCString()).valueOf()+1e3*t,i=r>n;return this.loggerService.logDebug("Has access_token expired: "+!i+", "+r+" > "+n),i},e.prototype.validateRequiredIdToken=function(e){var t=!0;return e.hasOwnProperty("iss")||(t=!1,this.loggerService.logWarning("iss is missing, this is required in the id_token")),e.hasOwnProperty("sub")||(t=!1,this.loggerService.logWarning("sub is missing, this is required in the id_token")),e.hasOwnProperty("aud")||(t=!1,this.loggerService.logWarning("aud is missing, this is required in the id_token")),e.hasOwnProperty("exp")||(t=!1,this.loggerService.logWarning("exp is missing, this is required in the id_token")),e.hasOwnProperty("iat")||(t=!1,this.loggerService.logWarning("iat is missing, this is required in the id_token")),t},e.prototype.validateIdTokenIatMaxOffset=function(e,t,r){if(r)return!0;if(!e.hasOwnProperty("iat"))return!1;var n=new Date(0);n.setUTCSeconds(e.iat),t=t||0;var i=new Date((new Date).toUTCString()).valueOf()-n.valueOf(),o=1e3*t;return this.loggerService.logDebug("validate id token iat max offset "+i+" < "+o),i>0?i<o:-i<o},e.prototype.validateIdTokenNonce=function(t,r,n){return!((void 0!==t.nonce&&!n||r!==e.refreshTokenNoncePlaceholder)&&t.nonce!==r)||(this.loggerService.logDebug("Validate_id_token_nonce failed, dataIdToken.nonce: "+t.nonce+" local_nonce:"+r),!1)},e.prototype.validateIdTokenIss=function(e,t){return e.iss===t||(this.loggerService.logDebug("Validate_id_token_iss failed, dataIdToken.iss: "+e.iss+" authWellKnownEndpoints issuer:"+t),!1)},e.prototype.validateIdTokenAud=function(e,t){return Array.isArray(e.aud)?!!e.aud.includes(t)||(this.loggerService.logDebug("Validate_id_token_aud array failed, dataIdToken.aud: "+e.aud+" client_id:"+t),!1):e.aud===t||(this.loggerService.logDebug("Validate_id_token_aud failed, dataIdToken.aud: "+e.aud+" client_id:"+t),!1)},e.prototype.validateIdTokenAzpExistsIfMoreThanOneAud=function(e){return!!e&&!(Array.isArray(e.aud)&&e.aud.length>1&&!e.azp)},e.prototype.validateIdTokenAzpValid=function(e,t){return!(null==e?void 0:e.azp)||e.azp===t},e.prototype.validateStateFromHashCallback=function(e,t){return e===t||(this.loggerService.logDebug("ValidateStateFromHashCallback failed, state: "+e+" local_state:"+t),!1)},e.prototype.validateSignatureIdToken=function(e,t){var r,n,i,o;if(!t||!t.keys)return!1;var a=this.tokenHelperService.getHeaderFromToken(e,!1);if(0===Object.keys(a).length&&a.constructor===Object)return this.loggerService.logWarning("id token has no header data"),!1;var c=a.kid,u=a.alg;if(!this.keyAlgorithms.includes(u))return this.loggerService.logWarning("alg not supported",u),!1;var l="RSA";"E"===u.charAt(0)&&(l="EC");var h=!1;if(!c){var d=void 0;if(1===t.keys.length&&t.keys[0].kty===l)d=t.keys[0];else{var g=0;try{for(var f=k(t.keys),v=f.next();!v.done;v=f.next()){(w=v.value).kty===l&&"sig"===w.use&&(g++,d=w)}}catch(e){r={error:e}}finally{try{v&&!v.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}if(g>1)return this.loggerService.logWarning("no ID Token kid claim in JOSE header and multiple supplied in jwks_uri"),!1}return d?(h||this.loggerService.logWarning("incorrect Signature, validation failed for id_token"),h):(this.loggerService.logWarning("no keys found, incorrect Signature, validation failed for id_token"),!1)}try{for(var p=k(t.keys),S=p.next();!S.done;S=p.next()){var w;if((w=S.value).kid===c){var y=s.KEYUTIL.getKey(w);return(h=s.KJUR.jws.JWS.verify(e,y,[u]))||this.loggerService.logWarning("incorrect Signature, validation failed for id_token"),h}}}catch(e){i={error:e}}finally{try{S&&!S.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}return h},e.prototype.validateIdTokenAtHash=function(e,t,r){this.loggerService.logDebug("at_hash from the server:"+t);var n="sha256";r.includes("384")?n="sha384":r.includes("512")&&(n="sha512");var i=this.generateAtHash(""+e,n);if(this.loggerService.logDebug("at_hash client validation not decoded:"+i),i===t)return!0;var o=this.generateAtHash(""+decodeURIComponent(e),n);return this.loggerService.logDebug("-gen access--"+o),o===t},e.prototype.generateCodeChallenge=function(e){var t=s.KJUR.crypto.Util.hashString(e,"sha256");return s.hextob64u(t)},e.prototype.generateAtHash=function(e,t){var r=s.KJUR.crypto.Util.hashString(e,t),n=r.substr(0,r.length/2);return s.hextob64u(n)},e}();E.refreshTokenNoncePlaceholder="--RefreshToken--",E.ɵfac=function(e){return new(e||E)(n.ɵɵinject(C),n.ɵɵinject(b))},E.ɵprov=n.ɵɵdefineInjectable({token:E,factory:E.ɵfac});var j=function(){function t(e,t,r,n,o){this.storagePersistenceService=e,this.loggerService=t,this.publicEventsService=r,this.configurationProvider=n,this.tokenValidationService=o,this.authorizedInternal$=new i.BehaviorSubject(!1)}return Object.defineProperty(t.prototype,"authorized$",{get:function(){return this.authorizedInternal$.asObservable().pipe(o.distinctUntilChanged())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAuthorized",{get:function(){return!!this.storagePersistenceService.getAccessToken()&&!!this.storagePersistenceService.getIdToken()},enumerable:!1,configurable:!0}),t.prototype.setAuthorizedAndFireEvent=function(){this.authorizedInternal$.next(!0)},t.prototype.setUnauthorizedAndFireEvent=function(){this.storagePersistenceService.resetAuthStateInStorage(),this.authorizedInternal$.next(!1)},t.prototype.updateAndPublishAuthState=function(t){this.publicEventsService.fireEvent(e.EventTypes.NewAuthorizationResult,t)},t.prototype.setAuthorizationData=function(e,t){this.loggerService.logDebug(e),this.loggerService.logDebug("storing the accessToken"),this.storagePersistenceService.write("authzData",e),this.persistAccessTokenExpirationTime(t),this.setAuthorizedAndFireEvent()},t.prototype.getAccessToken=function(){if(!this.isAuthorized)return"";var e=this.storagePersistenceService.getAccessToken();return this.decodeURIComponentSafely(e)},t.prototype.getIdToken=function(){if(!this.isAuthorized)return"";var e=this.storagePersistenceService.getIdToken();return this.decodeURIComponentSafely(e)},t.prototype.getRefreshToken=function(){if(!this.isAuthorized)return"";var e=this.storagePersistenceService.getRefreshToken();return this.decodeURIComponentSafely(e)},t.prototype.areAuthStorageTokensValid=function(){return!!this.isAuthorized&&(this.hasIdTokenExpired()?(this.loggerService.logDebug("persisted id_token is expired"),!1):this.hasAccessTokenExpiredIfExpiryExists()?(this.loggerService.logDebug("persisted access_token is expired"),!1):(this.loggerService.logDebug("persisted id_token and access token are valid"),!0))},t.prototype.hasIdTokenExpired=function(){var t=this.storagePersistenceService.getIdToken(),r=this.configurationProvider.getOpenIDConfiguration().renewTimeBeforeTokenExpiresInSeconds,n=this.tokenValidationService.hasIdTokenExpired(t,r);return n&&this.publicEventsService.fireEvent(e.EventTypes.IdTokenExpired,n),n},t.prototype.hasAccessTokenExpiredIfExpiryExists=function(){var t=this.configurationProvider.getOpenIDConfiguration().renewTimeBeforeTokenExpiresInSeconds,r=this.storagePersistenceService.read("access_token_expires_at"),n=!this.tokenValidationService.validateAccessTokenNotExpired(r,t);return n&&this.publicEventsService.fireEvent(e.EventTypes.TokenExpired,n),n},t.prototype.decodeURIComponentSafely=function(e){return e?decodeURIComponent(e):""},t.prototype.persistAccessTokenExpirationTime=function(e){if(null==e?void 0:e.expires_in){var t=new Date((new Date).toUTCString()).valueOf()+1e3*e.expires_in;this.storagePersistenceService.write("access_token_expires_at",t)}},t}();j.ɵfac=function(e){return new(e||j)(n.ɵɵinject(w),n.ɵɵinject(b),n.ɵɵinject(R),n.ɵɵinject(g),n.ɵɵinject(E))},j.ɵprov=n.ɵɵdefineInjectable({token:j,factory:j.ɵfac});var T="redirect",P=function(){function e(){}return e.prototype.getStoredRedirectRoute=function(){return localStorage.getItem(T)},e.prototype.saveStoredRedirectRoute=function(e){localStorage.setItem(T,e)},e.prototype.deleteStoredRedirectRoute=function(){localStorage.removeItem(T)},e}();P.ɵfac=function(e){return new(e||P)},P.ɵprov=n.ɵɵdefineInjectable({token:P,factory:P.ɵfac});var D=function(){function e(){}return e.prototype.encodeKey=function(e){return encodeURIComponent(e)},e.prototype.encodeValue=function(e){return encodeURIComponent(e)},e.prototype.decodeKey=function(e){return decodeURIComponent(e)},e.prototype.decodeValue=function(e){return decodeURIComponent(e)},e}(),A=function(){function e(e,t){this.doc=e,this.loggerService=t}return e.prototype.createRandom=function(e){if(e<=0)return"";e>0&&e<7&&(this.loggerService.logWarning("RandomService called with "+e+" but 7 chars is the minimum, returning 10 chars"),e=10);var t=e-6,r=new Uint8Array(Math.floor((t||t)/2));return this.getCrypto()&&this.getCrypto().getRandomValues(r),Array.from(r,this.toHex).join("")+this.randomString(7)},e.prototype.toHex=function(e){return("0"+e.toString(16)).substr(-2)},e.prototype.randomString=function(e){var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=new Uint32Array(e);if(this.getCrypto()){this.getCrypto().getRandomValues(n);for(var i=0;i<e;i++)t+=r[n[i]%r.length]}return t},e.prototype.getCrypto=function(){return this.doc.defaultView.crypto||this.doc.defaultView.msCrypto},e}();A.ɵfac=function(e){return new(e||A)(n.ɵɵinject(t.DOCUMENT),n.ɵɵinject(b))},A.ɵprov=n.ɵɵdefineInjectable({token:A,factory:A.ɵfac});var O=function(){function e(e,t,r,n){this.storagePersistenceService=e,this.randomService=t,this.configurationProvider=r,this.loggerService=n}return e.prototype.createNonce=function(){var e=this.randomService.createRandom(40);return this.setNonce(e),e},e.prototype.setNonce=function(e){this.storagePersistenceService.write("authNonce",e)},e.prototype.getAuthStateControl=function(){return this.storagePersistenceService.read("authStateControl")},e.prototype.setAuthStateControl=function(e){this.storagePersistenceService.write("authStateControl",e)},e.prototype.getExistingOrCreateAuthStateControl=function(){var e=this.storagePersistenceService.read("authStateControl");return e||(e=this.randomService.createRandom(40),this.storagePersistenceService.write("authStateControl",e)),e},e.prototype.setSessionState=function(e){this.storagePersistenceService.write("session_state",e)},e.prototype.resetStorageFlowData=function(){this.storagePersistenceService.resetStorageFlowData()},e.prototype.getCodeVerifier=function(){return this.storagePersistenceService.read("codeVerifier")},e.prototype.createCodeVerifier=function(){var e=this.randomService.createRandom(67);return this.storagePersistenceService.write("codeVerifier",e),e},e.prototype.isSilentRenewRunning=function(){var e=JSON.parse(this.storagePersistenceService.read("storageSilentRenewRunning"));if(e){var t=1e3*this.configurationProvider.getOpenIDConfiguration().silentRenewTimeoutInSeconds,r=Date.parse(e.dateOfLaunchedProcessUtc),n=Date.parse((new Date).toISOString());return Math.abs(n-r)>t?(this.loggerService.logDebug("silent renew process is probably stuck, state will be reset."),this.resetSilentRenewRunning(),!1):"running"===e.state}return!1},e.prototype.setSilentRenewRunning=function(){var e={state:"running",dateOfLaunchedProcessUtc:(new Date).toISOString()};this.storagePersistenceService.write("storageSilentRenewRunning",JSON.stringify(e))},e.prototype.resetSilentRenewRunning=function(){this.storagePersistenceService.write("storageSilentRenewRunning","")},e}();O.ɵfac=function(e){return new(e||O)(n.ɵɵinject(w),n.ɵɵinject(A),n.ɵɵinject(g),n.ɵɵinject(b))},O.ɵprov=n.ɵɵdefineInjectable({token:O,factory:O.ɵfac});var U=function(){function e(e){this.configurationProvider=e}return e.prototype.isCurrentFlowCodeFlow=function(){return this.currentFlowIs("code")},e.prototype.isCurrentFlowAnyImplicitFlow=function(){return this.isCurrentFlowImplicitFlowWithAccessToken()||this.isCurrentFlowImplicitFlowWithoutAccessToken()},e.prototype.isCurrentFlowCodeFlowWithRefreshTokens=function(){var e=this.configurationProvider.getOpenIDConfiguration().useRefreshToken;return!(!this.isCurrentFlowCodeFlow()||!e)},e.prototype.isCurrentFlowImplicitFlowWithAccessToken=function(){return this.currentFlowIs("id_token token")},e.prototype.isCurrentFlowImplicitFlowWithoutAccessToken=function(){return this.currentFlowIs("id_token")},e.prototype.currentFlowIs=function(e){var t=this.configurationProvider.getOpenIDConfiguration().responseType;return Array.isArray(e)?e.some((function(e){return t===e})):t===e},e}();U.ɵfac=function(e){return new(e||U)(n.ɵɵinject(g))},U.ɵprov=n.ɵɵdefineInjectable({token:U,factory:U.ɵfac});var F,W,_,z,V,x,H=["code","state","token","id_token"],K=function(){function e(e,t,r,n,i,o){this.configurationProvider=e,this.loggerService=t,this.flowsDataService=r,this.flowHelper=n,this.tokenValidationService=i,this.storagePersistenceService=o}return e.prototype.getUrlParameter=function(e,t){if(!e)return"";if(!t)return"";t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===r?"":decodeURIComponent(r[1])},e.prototype.isCallbackFromSts=function(e){var t=this;return H.some((function(r){return!!t.getUrlParameter(e,r)}))},e.prototype.getRefreshSessionSilentRenewUrl=function(e){return this.flowHelper.isCurrentFlowCodeFlow()?this.createUrlCodeFlowWithSilentRenew(e):this.createUrlImplicitFlowWithSilentRenew(e)||""},e.prototype.getAuthorizeParUrl=function(e){var t=this.storagePersistenceService.read("authWellKnownEndPoints");if(!t)return this.loggerService.logError("authWellKnownEndpoints is undefined"),null;var n=t.authorizationEndpoint;if(!n)return this.loggerService.logError("Can not create an authorize url when authorizationEndpoint is '"+n+"'"),null;var i=this.configurationProvider.getOpenIDConfiguration().clientId;if(!i)return this.loggerService.logError("createAuthorizeUrl could not add clientId because it was: ",i),null;var o=n.split("?"),s=o[0],a=new r.HttpParams({fromString:o[1],encoder:new D});return s+"?"+(a=(a=a.set("request_uri",e)).append("client_id",i))},e.prototype.getAuthorizeUrl=function(e){return this.flowHelper.isCurrentFlowCodeFlow()?this.createUrlCodeFlowAuthorize(e):this.createUrlImplicitFlowAuthorize(e)||""},e.prototype.createEndSessionUrl=function(e,t){var n,i,o=this.storagePersistenceService.read("authWellKnownEndPoints"),s=null==o?void 0:o.endSessionEndpoint;if(!s)return null;var a=s.split("?"),c=a[0],u=new r.HttpParams({fromString:a[1],encoder:new D});if(u=u.set("id_token_hint",e),t)try{for(var l=k(Object.entries(Object.assign({},t))),h=l.next();!h.done;h=l.next()){var d=y(h.value,2),g=d[0],f=d[1];u=u.append(g,f.toString())}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}var v=this.getPostLogoutRedirectUrl();return v&&(u=u.append("post_logout_redirect_uri",v)),c+"?"+u},e.prototype.createRevocationEndpointBodyAccessToken=function(e){var t=this.getClientId();return t?"client_id="+t+"&token="+e+"&token_type_hint=access_token":null},e.prototype.createRevocationEndpointBodyRefreshToken=function(e){var t=this.getClientId();return t?"client_id="+t+"&token="+e+"&token_type_hint=refresh_token":null},e.prototype.getRevocationEndpointUrl=function(){var e=this.storagePersistenceService.read("authWellKnownEndPoints"),t=null==e?void 0:e.revocationEndpoint;return t?t.split("?")[0]:null},e.prototype.createBodyForCodeFlowCodeRequest=function(e,t){var r=this.flowsDataService.getCodeVerifier();if(!r)return this.loggerService.logError("CodeVerifier is not set ",r),null;var n=this.getClientId();if(!n)return null;var i=a.oneLineTrim(F||(F=m(["grant_type=authorization_code\n            &client_id=","\n            &code_verifier=","\n            &code=",""],["grant_type=authorization_code\n            &client_id=","\n            &code_verifier=","\n            &code=",""])),n,r,e);if(t){var o=this.composeCustomParams(Object.assign({},t));i=a.oneLineTrim(W||(W=m(["","",""],["","",""])),i,o)}var s=this.getSilentRenewUrl();if(this.flowsDataService.isSilentRenewRunning()&&s)return a.oneLineTrim(_||(_=m(["","&redirect_uri=",""],["","&redirect_uri=",""])),i,s);var c=this.getRedirectUrl();return c?a.oneLineTrim(z||(z=m(["","&redirect_uri=",""],["","&redirect_uri=",""])),i,c):null},e.prototype.createBodyForCodeFlowRefreshTokensRequest=function(e,t){var r=this.getClientId();if(!r)return null;var n=a.oneLineTrim(V||(V=m(["grant_type=refresh_token\n            &client_id=","\n            &refresh_token=",""],["grant_type=refresh_token\n            &client_id=","\n            &refresh_token=",""])),r,e);t&&(n=""+n+this.composeCustomParams(Object.assign({},t)));return n},e.prototype.createBodyForParCodeFlowRequest=function(e){var t=this.getRedirectUrl();if(!t)return null;var r=this.flowsDataService.getExistingOrCreateAuthStateControl(),n=this.flowsDataService.createNonce();this.loggerService.logDebug("Authorize created. adding myautostate: "+r);var i=this.flowsDataService.createCodeVerifier(),o=this.tokenValidationService.generateCodeChallenge(i),s=this.configurationProvider.getOpenIDConfiguration(),c=s.clientId,u=s.responseType,l=s.scope,h=s.hdParam,d=s.customParams,g=a.oneLineTrim(x||(x=m(["client_id=","\n            &redirect_uri=","\n            &response_type=","\n            &scope=","\n            &nonce=","\n            &state=","\n            &code_challenge=","\n            &code_challenge_method=S256"],["client_id=","\n            &redirect_uri=","\n            &response_type=","\n            &scope=","\n            &nonce=","\n            &state=","\n            &code_challenge=","\n            &code_challenge_method=S256"])),c,t,u,l,n,r,o);(h&&(g=g+"&hd="+h),d)&&(g=""+g+this.composeCustomParams(Object.assign({},d)));e&&(g=""+g+this.composeCustomParams(Object.assign({},e)));return g},e.prototype.createAuthorizeUrl=function(e,t,n,i,o,s){var a,c,u,l,h=this.storagePersistenceService.read("authWellKnownEndPoints"),d=null==h?void 0:h.authorizationEndpoint;if(!d)return this.loggerService.logError("Can not create an authorize url when authorizationEndpoint is '"+d+"'"),null;var g=this.configurationProvider.getOpenIDConfiguration(),f=g.clientId,v=g.responseType,p=g.scope,S=g.hdParam,w=g.customParams;if(!f)return this.loggerService.logError("createAuthorizeUrl could not add clientId because it was: ",f),null;if(!v)return this.loggerService.logError("createAuthorizeUrl could not add responseType because it was: ",v),null;if(!p)return this.loggerService.logError("createAuthorizeUrl could not add scope because it was: ",p),null;var I=d.split("?"),m=I[0],b=new r.HttpParams({fromString:I[1],encoder:new D});if(b=(b=(b=(b=(b=(b=b.set("client_id",f)).append("redirect_uri",t)).append("response_type",v)).append("scope",p)).append("nonce",n)).append("state",i),this.flowHelper.isCurrentFlowCodeFlow()&&(b=(b=b.append("code_challenge",e)).append("code_challenge_method","S256")),o&&(b=b.append("prompt",o)),S&&(b=b.append("hd",S)),w)try{for(var R=k(Object.entries(Object.assign({},w))),C=R.next();!C.done;C=R.next()){var E=y(C.value,2),j=E[0],T=E[1];b=b.append(j,T.toString())}}catch(e){a={error:e}}finally{try{C&&!C.done&&(c=R.return)&&c.call(R)}finally{if(a)throw a.error}}if(s)try{for(var P=k(Object.entries(Object.assign({},s))),A=P.next();!A.done;A=P.next()){var O=y(A.value,2);j=O[0],T=O[1];b=b.append(j,T.toString())}}catch(e){u={error:e}}finally{try{A&&!A.done&&(l=P.return)&&l.call(P)}finally{if(u)throw u.error}}return m+"?"+b},e.prototype.createUrlImplicitFlowWithSilentRenew=function(e){var t=this.flowsDataService.getExistingOrCreateAuthStateControl(),r=this.flowsDataService.createNonce(),n=this.getSilentRenewUrl();return n?(this.loggerService.logDebug("RefreshSession created. adding myautostate: ",t),this.storagePersistenceService.read("authWellKnownEndPoints")?this.createAuthorizeUrl("",n,r,t,"none",e):(this.loggerService.logError("authWellKnownEndpoints is undefined"),null)):null},e.prototype.createUrlCodeFlowWithSilentRenew=function(e){var t=this.flowsDataService.getExistingOrCreateAuthStateControl(),r=this.flowsDataService.createNonce();this.loggerService.logDebug("RefreshSession created. adding myautostate: "+t);var n=this.flowsDataService.createCodeVerifier(),i=this.tokenValidationService.generateCodeChallenge(n),o=this.getSilentRenewUrl();return o?this.storagePersistenceService.read("authWellKnownEndPoints")?this.createAuthorizeUrl(i,o,r,t,"none",e):(this.loggerService.logWarning("authWellKnownEndpoints is undefined"),null):null},e.prototype.createUrlImplicitFlowAuthorize=function(e){var t=this.flowsDataService.getExistingOrCreateAuthStateControl(),r=this.flowsDataService.createNonce();this.loggerService.logDebug("Authorize created. adding myautostate: "+t);var n=this.getRedirectUrl();return n?this.storagePersistenceService.read("authWellKnownEndPoints")?this.createAuthorizeUrl("",n,r,t,null,e):(this.loggerService.logError("authWellKnownEndpoints is undefined"),null):null},e.prototype.createUrlCodeFlowAuthorize=function(e){var t=this.flowsDataService.getExistingOrCreateAuthStateControl(),r=this.flowsDataService.createNonce();this.loggerService.logDebug("Authorize created. adding myautostate: "+t);var n=this.getRedirectUrl();if(!n)return null;var i=this.flowsDataService.createCodeVerifier(),o=this.tokenValidationService.generateCodeChallenge(i);return this.storagePersistenceService.read("authWellKnownEndPoints")?this.createAuthorizeUrl(o,n,r,t,null,e):(this.loggerService.logError("authWellKnownEndpoints is undefined"),null)},e.prototype.getRedirectUrl=function(){var e=this.configurationProvider.getOpenIDConfiguration().redirectUrl;return e||(this.loggerService.logError("could not get redirectUrl, was: ",e),null)},e.prototype.getSilentRenewUrl=function(){var e=this.configurationProvider.getOpenIDConfiguration().silentRenewUrl;return e||(this.loggerService.logError("could not get silentRenewUrl, was: ",e),null)},e.prototype.getPostLogoutRedirectUrl=function(){var e=this.configurationProvider.getOpenIDConfiguration().postLogoutRedirectUri;return e||(this.loggerService.logError("could not get postLogoutRedirectUri, was: ",e),null)},e.prototype.getClientId=function(){var e=this.configurationProvider.getOpenIDConfiguration().clientId;return e||(this.loggerService.logError("could not get clientId, was: ",e),null)},e.prototype.composeCustomParams=function(e){var t,r,n="";try{for(var i=k(Object.entries(e)),o=i.next();!o.done;o=i.next()){var s=y(o.value,2),a=s[0],c=s[1];n=n.concat("&"+a+"="+c.toString())}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},e}();K.ɵfac=function(e){return new(e||K)(n.ɵɵinject(g),n.ɵɵinject(b),n.ɵɵinject(O),n.ɵɵinject(U),n.ɵɵinject(E),n.ɵɵinject(w))},K.ɵprov=n.ɵɵdefineInjectable({token:K,factory:K.ɵfac});var M=function(){function e(e,t,r,n,i,o,s){this.urlService=e,this.loggerService=t,this.tokenValidationService=r,this.flowsDataService=n,this.configurationProvider=i,this.storagePersistenceService=o,this.dataService=s}return e.prototype.codeFlowCallback=function(e){var t=this.urlService.getUrlParameter(e,"code"),r=this.urlService.getUrlParameter(e,"state"),n=this.urlService.getUrlParameter(e,"session_state")||null;if(!r)return this.loggerService.logDebug("no state in url"),i.throwError("no state in url");if(!t)return this.loggerService.logDebug("no code in url"),i.throwError("no code in url");this.loggerService.logDebug("running validation for callback",e);var o={code:t,refreshToken:null,state:r,sessionState:n,authResult:null,isRenewProcess:!1,jwtKeys:null,validationResult:null,existingIdToken:null};return i.of(o)},e.prototype.codeFlowCodeRequest=function(e){var t=this,n=this.flowsDataService.getAuthStateControl();if(!this.tokenValidationService.validateStateFromHashCallback(e.state,n))return this.loggerService.logWarning("codeFlowCodeRequest incorrect state"),i.throwError("codeFlowCodeRequest incorrect state");var s=this.storagePersistenceService.read("authWellKnownEndPoints"),a=null==s?void 0:s.tokenEndpoint;if(!a)return i.throwError("Token Endpoint not defined");var c=new r.HttpHeaders;c=c.set("Content-Type","application/x-www-form-urlencoded");var u=this.configurationProvider.getOpenIDConfiguration(),l=this.urlService.createBodyForCodeFlowCodeRequest(e.code,null==u?void 0:u.customTokenParams);return this.dataService.post(a,l,c).pipe(o.switchMap((function(t){var r=new Object;return(r=t).state=e.state,r.session_state=e.sessionState,e.authResult=r,i.of(e)})),o.retryWhen((function(e){return t.handleRefreshRetry(e)})),o.catchError((function(e){var r="OidcService code request "+t.configurationProvider.getOpenIDConfiguration().stsServer;return t.loggerService.logError(r,e),i.throwError(r)})))},e.prototype.handleRefreshRetry=function(e){var t=this;return e.pipe(o.mergeMap((function(e){if(e&&e instanceof r.HttpErrorResponse&&e.error instanceof ProgressEvent&&"error"===e.error.type){var n=t.configurationProvider.getOpenIDConfiguration(),o=n.stsServer,s=n.refreshTokenRetryInSeconds,a="OidcService code request "+o+" - no internet connection";return t.loggerService.logWarning(a,e),i.timer(1e3*s)}return i.throwError(e)})))},e}();M.ɵfac=function(e){return new(e||M)(n.ɵɵinject(K),n.ɵɵinject(b),n.ɵɵinject(E),n.ɵɵinject(O),n.ɵɵinject(g),n.ɵɵinject(w),n.ɵɵinject(p))},M.ɵprov=n.ɵɵdefineInjectable({token:M,factory:M.ɵfac});var L=function(){function t(e,t,r,n,o,s,a){this.oidcDataService=e,this.storagePersistenceService=t,this.eventService=r,this.loggerService=n,this.tokenHelperService=o,this.flowHelper=s,this.configurationProvider=a,this.userDataInternal$=new i.BehaviorSubject(null)}return Object.defineProperty(t.prototype,"userData$",{get:function(){return this.userDataInternal$.asObservable()},enumerable:!1,configurable:!0}),t.prototype.getAndPersistUserDataInStore=function(e,t,r){var n=this;void 0===e&&(e=!1),t=t||this.storagePersistenceService.getIdToken(),r=r||this.tokenHelperService.getPayloadFromToken(t,!1);var s=this.getUserDataFromStore(),a=!!s,c=this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken(),u=this.flowHelper.isCurrentFlowCodeFlow(),l=this.storagePersistenceService.getAccessToken();if(!c&&!u)return this.loggerService.logDebug("authorizedCallback id_token flow"),this.loggerService.logDebug("accessToken",l),this.setUserDataToStore(r),i.of(r);var h=this.configurationProvider.getOpenIDConfiguration().renewUserInfoAfterTokenRenew;return e&&!h&&a?i.of(s):this.getUserDataOidcFlowAndSave(r.sub).pipe(o.switchMap((function(e){return n.loggerService.logDebug("Received user data",e),e?(n.loggerService.logDebug("accessToken",l),i.of(e)):i.throwError("no user data, request failed")})))},t.prototype.getUserDataFromStore=function(){return this.storagePersistenceService.read("userData")||null},t.prototype.publishUserDataIfExists=function(){var t=this.getUserDataFromStore();t&&(this.userDataInternal$.next(t),this.eventService.fireEvent(e.EventTypes.UserDataChanged,t))},t.prototype.setUserDataToStore=function(t){this.storagePersistenceService.write("userData",t),this.userDataInternal$.next(t),this.eventService.fireEvent(e.EventTypes.UserDataChanged,t)},t.prototype.resetUserDataInStore=function(){this.storagePersistenceService.remove("userData"),this.eventService.fireEvent(e.EventTypes.UserDataChanged,null),this.userDataInternal$.next(null)},t.prototype.getUserDataOidcFlowAndSave=function(e){var t=this;return this.getIdentityUserData().pipe(o.map((function(r){return t.validateUserDataSubIdToken(e,null==r?void 0:r.sub)?(t.setUserDataToStore(r),r):(t.loggerService.logWarning("authorizedCallback, User data sub does not match sub in id_token"),t.loggerService.logDebug("authorizedCallback, token(s) validation failed, resetting"),t.resetUserDataInStore(),null)})))},t.prototype.getIdentityUserData=function(){var e=this.storagePersistenceService.getAccessToken(),t=this.storagePersistenceService.read("authWellKnownEndPoints");if(!t)return this.loggerService.logWarning("init check session: authWellKnownEndpoints is undefined"),i.throwError("authWellKnownEndpoints is undefined");var r=t.userinfoEndpoint;if(!r){if(this.loggerService.logError("init check session: authWellKnownEndpoints.userinfo_endpoint is undefined; set auto_userinfo = false in config"),window.location.href.includes("localhost")){var n=r.split("/");n.splice(0,3);var s=n.join("/");return console.log(n.join("/")),this.oidcDataService.get(s,e).pipe(o.retry(2))}return i.throwError("authWellKnownEndpoints.userinfo_endpoint is undefined")}return this.oidcDataService.get(r,e).pipe(o.retry(2))},t.prototype.validateUserDataSubIdToken=function(e,t){return!!e&&(!!t&&(e===t||(this.loggerService.logDebug("validateUserDataSubIdToken failed",e,t),!1)))},t}();L.ɵfac=function(e){return new(e||L)(n.ɵɵinject(p),n.ɵɵinject(w),n.ɵɵinject(R),n.ɵɵinject(b),n.ɵɵinject(C),n.ɵɵinject(U),n.ɵɵinject(g))},L.ɵprov=n.ɵɵdefineInjectable({token:L,factory:L.ɵfac});var q=function(){function e(e,t,r){this.authStateService=e,this.flowsDataService=t,this.userService=r}return e.prototype.resetAuthorizationData=function(){this.userService.resetUserDataInStore(),this.flowsDataService.resetStorageFlowData(),this.authStateService.setUnauthorizedAndFireEvent()},e}();q.ɵfac=function(e){return new(e||q)(n.ɵɵinject(j),n.ɵɵinject(O),n.ɵɵinject(L))},q.ɵprov=n.ɵɵdefineInjectable({token:q,factory:q.ɵfac});var N,B,$=function(){function e(e,t,r,n){this.resetAuthDataService=e,this.loggerService=t,this.flowsDataService=r,this.doc=n}return e.prototype.implicitFlowCallback=function(e){var t=this.flowsDataService.isSilentRenewRunning();this.loggerService.logDebug("BEGIN authorizedCallback, no auth data"),t||this.resetAuthDataService.resetAuthorizationData();var r={code:null,refreshToken:null,state:null,sessionState:null,authResult:(e=e||this.doc.location.hash.substr(1)).split("&").reduce((function(e,t){var r=t.split("=");return e[r.shift()]=r.join("="),e}),{}),isRenewProcess:t,jwtKeys:null,validationResult:null,existingIdToken:null};return i.of(r)},e}();$.ɵfac=function(e){return new(e||$)(n.ɵɵinject(q),n.ɵɵinject(b),n.ɵɵinject(O),n.ɵɵinject(t.DOCUMENT))},$.ɵprov=n.ɵɵdefineInjectable({token:$,factory:$.ɵfac}),(N=e.AuthorizedState||(e.AuthorizedState={})).Authorized="Authorized",N.Unauthorized="Unauthorized",N.Unknown="Unknown",(B=e.ValidationResult||(e.ValidationResult={})).NotSet="NotSet",B.StatesDoNotMatch="StatesDoNotMatch",B.SignatureFailed="SignatureFailed",B.IncorrectNonce="IncorrectNonce",B.RequiredPropertyMissing="RequiredPropertyMissing",B.MaxOffsetExpired="MaxOffsetExpired",B.IssDoesNotMatchIssuer="IssDoesNotMatchIssuer",B.NoAuthWellKnownEndPoints="NoAuthWellKnownEndPoints",B.IncorrectAud="IncorrectAud",B.IncorrectIdTokenClaimsAfterRefresh="IncorrectIdTokenClaimsAfterRefresh",B.IncorrectAzp="IncorrectAzp",B.TokenExpired="TokenExpired",B.IncorrectAtHash="IncorrectAtHash",B.Ok="Ok",B.LoginRequired="LoginRequired",B.SecureTokenServerError="SecureTokenServerError";var J=function(){function e(e,t,r){this.storagePersistenceService=e,this.loggerService=t,this.dataService=r}return e.prototype.getSigningKeys=function(){var e=this.storagePersistenceService.read("authWellKnownEndPoints"),t=null==e?void 0:e.jwksUri;if(!t){var r="getSigningKeys: authWellKnownEndpoints.jwksUri is: '"+t+"'";return this.loggerService.logWarning(r),i.throwError(r)}return this.loggerService.logDebug("Getting signinkeys from ",t),this.dataService.get(t).pipe(o.retry(2),o.catchError(this.handleErrorGetSigningKeys))},e.prototype.handleErrorGetSigningKeys=function(e){var t="";if(e instanceof r.HttpResponse){var n=e.body||{},o=JSON.stringify(n);t=(e.status||"")+" - "+(e.statusText||"")+" "+(o||"")}else{var s=e.message;t=s||""+e}return this.loggerService.logError(t),i.throwError(new Error(t))},e}();J.ɵfac=function(e){return new(e||J)(n.ɵɵinject(w),n.ɵɵinject(b),n.ɵɵinject(p))},J.ɵprov=n.ɵɵdefineInjectable({token:J,factory:J.ɵfac});var G="jwtKeys",Z=function(){function t(e,t,r,n,i,o,s){this.loggerService=e,this.configurationProvider=t,this.authStateService=r,this.flowsDataService=n,this.signInKeyDataService=i,this.storagePersistenceService=o,this.resetAuthDataService=s}return t.prototype.callbackHistoryAndResetJwtKeys=function(e){var t=this;if(this.storagePersistenceService.write("authnResult",e.authResult),this.historyCleanUpTurnedOn()&&!e.isRenewProcess?this.resetBrowserHistory():this.loggerService.logDebug("history clean up inactive"),e.authResult.error){var r="authorizedCallbackProcedure came with error: "+e.authResult.error;return this.loggerService.logDebug(r),this.resetAuthDataService.resetAuthorizationData(),this.flowsDataService.setNonce(""),this.handleResultErrorFromCallback(e.authResult,e.isRenewProcess),i.throwError(r)}return this.loggerService.logDebug(e.authResult),this.loggerService.logDebug("authorizedCallback created, begin token validation"),this.signInKeyDataService.getSigningKeys().pipe(o.tap((function(e){return t.storeSigningKeys(e)})),o.catchError((function(e){var r=t.readSigningKeys();return r?(t.loggerService.logWarning("Failed to retrieve signing keys, fallback to stored keys"),i.of(r)):i.throwError(e)})),o.switchMap((function(r){if(r)return e.jwtKeys=r,i.of(e);var n="Failed to retrieve signing key";return t.loggerService.logWarning(n),i.throwError(n)})),o.catchError((function(e){var r="Failed to retrieve signing key with error: "+e;return t.loggerService.logWarning(r),i.throwError(r)})))},t.prototype.handleResultErrorFromCallback=function(t,r){var n=e.ValidationResult.SecureTokenServerError;"login_required"===t.error&&(n=e.ValidationResult.LoginRequired),this.authStateService.updateAndPublishAuthState({authorizationState:e.AuthorizedState.Unauthorized,validationResult:n,isRenewProcess:r})},t.prototype.historyCleanUpTurnedOn=function(){return!this.configurationProvider.getOpenIDConfiguration().historyCleanupOff},t.prototype.resetBrowserHistory=function(){window.history.replaceState({},window.document.title,window.location.origin+window.location.pathname)},t.prototype.storeSigningKeys=function(e){this.storagePersistenceService.write(G,e)},t.prototype.readSigningKeys=function(){return this.storagePersistenceService.read(G)},t}();Z.ɵfac=function(e){return new(e||Z)(n.ɵɵinject(b),n.ɵɵinject(g),n.ɵɵinject(j),n.ɵɵinject(O),n.ɵɵinject(J),n.ɵɵinject(w),n.ɵɵinject(q))},Z.ɵprov=n.ɵɵdefineInjectable({token:Z,factory:Z.ɵfac});var Q=function(){function t(e,t,r,n,i,o){this.loggerService=e,this.configurationProvider=t,this.authStateService=r,this.flowsDataService=n,this.userService=i,this.resetAuthDataService=o}return t.prototype.callbackUser=function(e){var t=this,r=e.isRenewProcess,n=e.validationResult,s=e.authResult,a=e.refreshToken,c=this.configurationProvider.getOpenIDConfiguration(),u=c.autoUserinfo,l=c.renewUserInfoAfterTokenRenew;return u?this.userService.getAndPersistUserDataInStore(r,n.idToken,n.decodedIdToken).pipe(o.switchMap((function(o){if(o)return a||t.flowsDataService.setSessionState(s.session_state),t.publishAuthorizedState(n,r),i.of(e);t.resetAuthDataService.resetAuthorizationData(),t.publishUnauthorizedState(n,r);var c="Called for userData but they were "+o;return t.loggerService.logWarning(c),i.throwError(c)})),o.catchError((function(e){var r="Failed to retrieve user info with error:  "+e;return t.loggerService.logWarning(r),i.throwError(r)}))):(r&&!l||n.decodedIdToken&&this.userService.setUserDataToStore(n.decodedIdToken),r||a||this.flowsDataService.setSessionState(s.session_state),this.publishAuthorizedState(n,r),i.of(e))},t.prototype.publishAuthorizedState=function(t,r){this.authStateService.updateAndPublishAuthState({authorizationState:e.AuthorizedState.Authorized,validationResult:t.state,isRenewProcess:r})},t.prototype.publishUnauthorizedState=function(t,r){this.authStateService.updateAndPublishAuthState({authorizationState:e.AuthorizedState.Unauthorized,validationResult:t.state,isRenewProcess:r})},t}();Q.ɵfac=function(e){return new(e||Q)(n.ɵɵinject(b),n.ɵɵinject(g),n.ɵɵinject(j),n.ɵɵinject(O),n.ɵɵinject(L),n.ɵɵinject(q))},Q.ɵprov=n.ɵɵdefineInjectable({token:Q,factory:Q.ɵfac});var Y=function(t,r,n,i,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===n&&(n=!1),void 0===i&&(i={}),void 0===o&&(o=e.ValidationResult.NotSet),this.accessToken=t,this.idToken=r,this.authResponseIsValid=n,this.decodedIdToken=i,this.state=o},X=function(){function e(){}return e.prototype.isStringEqualOrNonOrderedArrayEqual=function(e,t){return!this.isNullOrUndefined(e)&&(!this.isNullOrUndefined(t)&&(!this.oneValueIsStringAndTheOtherIsArray(e,t)&&(this.bothValuesAreStrings(e,t)?e===t:!!this.bothValuesAreArrays(e,t)&&this.arraysHaveEqualContent(e,t))))},e.prototype.areEqual=function(e,t){if(!e||!t)return!1;if(this.bothValuesAreArrays(e,t))return this.arraysStrictEqual(e,t);if(this.bothValuesAreStrings(e,t))return e===t;if(this.bothValuesAreObjects(e,t))return JSON.stringify(e).toLowerCase()===JSON.stringify(t).toLowerCase();if(this.oneValueIsStringAndTheOtherIsArray(e,t)){if(Array.isArray(e)&&this.valueIsString(t))return e[0]===t;if(Array.isArray(t)&&this.valueIsString(e))return t[0]===e}},e.prototype.oneValueIsStringAndTheOtherIsArray=function(e,t){return Array.isArray(e)&&this.valueIsString(t)||Array.isArray(t)&&this.valueIsString(e)},e.prototype.bothValuesAreObjects=function(e,t){return this.valueIsObject(e)&&this.valueIsObject(t)},e.prototype.bothValuesAreStrings=function(e,t){return this.valueIsString(e)&&this.valueIsString(t)},e.prototype.bothValuesAreArrays=function(e,t){return Array.isArray(e)&&Array.isArray(t)},e.prototype.valueIsString=function(e){return"string"==typeof e||e instanceof String},e.prototype.valueIsObject=function(e){return"object"==typeof e},e.prototype.arraysStrictEqual=function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0},e.prototype.arraysHaveEqualContent=function(e,t){return e.length===t.length&&e.some((function(e){return t.includes(e)}))},e.prototype.isNullOrUndefined=function(e){return null==e},e}();X.ɵfac=function(e){return new(e||X)},X.ɵprov=n.ɵɵdefineInjectable({token:X,factory:X.ɵfac});var ee=function(){function t(e,t,r,n,i,o,s){this.storagePersistenceService=e,this.tokenValidationService=t,this.tokenHelperService=r,this.loggerService=n,this.configurationProvider=i,this.equalityService=o,this.flowHelper=s}return t.prototype.getValidatedStateResult=function(e){return e?e.authResult.error?new Y("","",!1,{}):this.validateState(e):new Y("","",!1,{})},t.prototype.validateState=function(t){var r=new Y,n=this.storagePersistenceService.read("authStateControl");if(!this.tokenValidationService.validateStateFromHashCallback(t.authResult.state,n))return this.loggerService.logWarning("authorizedCallback incorrect state"),r.state=e.ValidationResult.StatesDoNotMatch,this.handleUnsuccessfulValidation(),r;var i=this.flowHelper.isCurrentFlowImplicitFlowWithAccessToken(),o=this.flowHelper.isCurrentFlowCodeFlow();if((i||o)&&(r.accessToken=t.authResult.access_token),t.authResult.id_token){var s=this.configurationProvider.getOpenIDConfiguration(),a=s.clientId,c=s.issValidationOff,u=s.maxIdTokenIatOffsetAllowedInSeconds,l=s.disableIatOffsetValidation,h=s.ignoreNonceAfterRefresh;if(r.idToken=t.authResult.id_token,r.decodedIdToken=this.tokenHelperService.getPayloadFromToken(r.idToken,!1),!this.tokenValidationService.validateSignatureIdToken(r.idToken,t.jwtKeys))return this.loggerService.logDebug("authorizedCallback Signature validation failed id_token"),r.state=e.ValidationResult.SignatureFailed,this.handleUnsuccessfulValidation(),r;var d=this.storagePersistenceService.read("authNonce");if(!this.tokenValidationService.validateIdTokenNonce(r.decodedIdToken,d,h))return this.loggerService.logWarning("authorizedCallback incorrect nonce"),r.state=e.ValidationResult.IncorrectNonce,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateRequiredIdToken(r.decodedIdToken))return this.loggerService.logDebug("authorizedCallback Validation, one of the REQUIRED properties missing from id_token"),r.state=e.ValidationResult.RequiredPropertyMissing,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateIdTokenIatMaxOffset(r.decodedIdToken,u,l))return this.loggerService.logWarning("authorizedCallback Validation, iat rejected id_token was issued too far away from the current time"),r.state=e.ValidationResult.MaxOffsetExpired,this.handleUnsuccessfulValidation(),r;var g=this.storagePersistenceService.read("authWellKnownEndPoints");if(!g)return this.loggerService.logWarning("authWellKnownEndpoints is undefined"),r.state=e.ValidationResult.NoAuthWellKnownEndPoints,this.handleUnsuccessfulValidation(),r;if(c)this.loggerService.logDebug("iss validation is turned off, this is not recommended!");else if(!c&&!this.tokenValidationService.validateIdTokenIss(r.decodedIdToken,g.issuer))return this.loggerService.logWarning("authorizedCallback incorrect iss does not match authWellKnownEndpoints issuer"),r.state=e.ValidationResult.IssDoesNotMatchIssuer,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateIdTokenAud(r.decodedIdToken,a))return this.loggerService.logWarning("authorizedCallback incorrect aud"),r.state=e.ValidationResult.IncorrectAud,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateIdTokenAzpExistsIfMoreThanOneAud(r.decodedIdToken))return this.loggerService.logWarning("authorizedCallback missing azp"),r.state=e.ValidationResult.IncorrectAzp,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateIdTokenAzpValid(r.decodedIdToken,a))return this.loggerService.logWarning("authorizedCallback incorrect azp"),r.state=e.ValidationResult.IncorrectAzp,this.handleUnsuccessfulValidation(),r;if(!this.isIdTokenAfterRefreshTokenRequestValid(t,r.decodedIdToken))return this.loggerService.logWarning("authorizedCallback pre, post id_token claims do not match in refresh"),r.state=e.ValidationResult.IncorrectIdTokenClaimsAfterRefresh,this.handleUnsuccessfulValidation(),r;if(!this.tokenValidationService.validateIdTokenExpNotExpired(r.decodedIdToken))return this.loggerService.logWarning("authorizedCallback id token expired"),r.state=e.ValidationResult.TokenExpired,this.handleUnsuccessfulValidation(),r}else this.loggerService.logDebug("No id_token found, skipping id_token validation");if(!i&&!o)return r.authResponseIsValid=!0,r.state=e.ValidationResult.Ok,this.handleSuccessfulValidation(),this.handleUnsuccessfulValidation(),r;if(t.authResult.id_token){var f=this.tokenHelperService.getHeaderFromToken(r.idToken,!1);if(o&&!r.decodedIdToken.at_hash)this.loggerService.logDebug("Code Flow active, and no at_hash in the id_token, skipping check!");else if(!this.tokenValidationService.validateIdTokenAtHash(r.accessToken,r.decodedIdToken.at_hash,f.alg)||!r.accessToken)return this.loggerService.logWarning("authorizedCallback incorrect at_hash"),r.state=e.ValidationResult.IncorrectAtHash,this.handleUnsuccessfulValidation(),r}return r.authResponseIsValid=!0,r.state=e.ValidationResult.Ok,this.handleSuccessfulValidation(),r},t.prototype.isIdTokenAfterRefreshTokenRequestValid=function(e,t){var r=this.configurationProvider.getOpenIDConfiguration(),n=r.useRefreshToken,i=r.disableRefreshIdTokenAuthTimeValidation;if(!n)return!0;if(!e.existingIdToken)return!0;var o=this.tokenHelperService.getPayloadFromToken(e.existingIdToken,!1);return o.iss!==t.iss?(this.loggerService.logDebug("iss do not match: "+o.iss+" "+t.iss),!1):o.azp!==t.azp?(this.loggerService.logDebug("azp do not match: "+o.azp+" "+t.azp),!1):o.sub!==t.sub?(this.loggerService.logDebug("sub do not match: "+o.sub+" "+t.sub),!1):this.equalityService.isStringEqualOrNonOrderedArrayEqual(null==o?void 0:o.aud,null==t?void 0:t.aud)?!!i||(o.auth_time===t.auth_time||(this.loggerService.logDebug("auth_time do not match: "+o.auth_time+" "+t.auth_time),!1)):(this.loggerService.logDebug("aud in new id_token is not valid: '"+(null==o?void 0:o.aud)+"' '"+t.aud+"'"),!1)},t.prototype.handleSuccessfulValidation=function(){var e=this.configurationProvider.getOpenIDConfiguration().autoCleanStateAfterAuthentication;this.storagePersistenceService.write("authNonce",""),e&&this.storagePersistenceService.write("authStateControl",""),this.loggerService.logDebug("AuthorizedCallback token(s) validated, continue")},t.prototype.handleUnsuccessfulValidation=function(){var e=this.configurationProvider.getOpenIDConfiguration().autoCleanStateAfterAuthentication;this.storagePersistenceService.write("authNonce",""),e&&this.storagePersistenceService.write("authStateControl",""),this.loggerService.logDebug("AuthorizedCallback token(s) invalid")},t}();ee.ɵfac=function(e){return new(e||ee)(n.ɵɵinject(w),n.ɵɵinject(E),n.ɵɵinject(C),n.ɵɵinject(b),n.ɵɵinject(g),n.ɵɵinject(X),n.ɵɵinject(U))},ee.ɵprov=n.ɵɵdefineInjectable({token:ee,factory:ee.ɵfac});var te=function(){function t(e,t,r,n,i){this.loggerService=e,this.stateValidationService=t,this.authStateService=r,this.resetAuthDataService=n,this.doc=i}return t.prototype.callbackStateValidation=function(e){var t=this.stateValidationService.getValidatedStateResult(e);if(e.validationResult=t,t.authResponseIsValid)return this.authStateService.setAuthorizationData(t.accessToken,e.authResult),i.of(e);var r="authorizedCallback, token(s) validation failed, resetting. Hash: "+this.doc.location.hash;return this.loggerService.logWarning(r),this.resetAuthDataService.resetAuthorizationData(),this.publishUnauthorizedState(e.validationResult,e.isRenewProcess),i.throwError(r)},t.prototype.publishUnauthorizedState=function(t,r){this.authStateService.updateAndPublishAuthState({authorizationState:e.AuthorizedState.Unauthorized,validationResult:t.state,isRenewProcess:r})},t}();te.ɵfac=function(e){return new(e||te)(n.ɵɵinject(b),n.ɵɵinject(ee),n.ɵɵinject(j),n.ɵɵinject(q),n.ɵɵinject(t.DOCUMENT))},te.ɵprov=n.ɵɵdefineInjectable({token:te,factory:te.ɵfac});var re=function(){function e(e,t,r){this.loggerService=e,this.authStateService=t,this.flowsDataService=r}return e.prototype.refreshSessionWithRefreshTokens=function(){var e=this.flowsDataService.getExistingOrCreateAuthStateControl();this.loggerService.logDebug("RefreshSession created. adding myautostate: "+e);var t=this.authStateService.getRefreshToken(),r=this.authStateService.getIdToken();if(t){var n={code:null,refreshToken:t,state:e,sessionState:null,authResult:null,isRenewProcess:!0,jwtKeys:null,validationResult:null,existingIdToken:r};return this.loggerService.logDebug("found refresh code, obtaining new credentials with refresh code"),this.flowsDataService.setNonce(E.refreshTokenNoncePlaceholder),i.of(n)}var o="no refresh token found, please login";return this.loggerService.logError(o),i.throwError(o)},e}();re.ɵfac=function(e){return new(e||re)(n.ɵɵinject(b),n.ɵɵinject(j),n.ɵɵinject(O))},re.ɵprov=n.ɵɵdefineInjectable({token:re,factory:re.ɵfac});var ne=function(){function e(e,t,r,n,i){this.urlService=e,this.loggerService=t,this.configurationProvider=r,this.dataService=n,this.storagePersistenceService=i}return e.prototype.refreshTokensRequestTokens=function(e,t){var n=this,s=new r.HttpHeaders;s=s.set("Content-Type","application/x-www-form-urlencoded");var a=this.storagePersistenceService.read("authWellKnownEndPoints"),c=null==a?void 0:a.tokenEndpoint;if(!c)return i.throwError("Token Endpoint not defined");var u=this.urlService.createBodyForCodeFlowRefreshTokensRequest(e.refreshToken,t);return this.dataService.post(c,u,s).pipe(o.switchMap((function(t){n.loggerService.logDebug("token refresh response: ",t);var r=new Object;return(r=t).state=e.state,e.authResult=r,i.of(e)})),o.retryWhen((function(e){return n.handleRefreshRetry(e)})),o.catchError((function(e){var t="OidcService code request "+n.configurationProvider.getOpenIDConfiguration().stsServer;return n.loggerService.logError(t,e),i.throwError(t)})))},e.prototype.handleRefreshRetry=function(e){var t=this;return e.pipe(o.mergeMap((function(e){if(e&&e instanceof r.HttpErrorResponse&&e.error instanceof ProgressEvent&&"error"===e.error.type){var n=t.configurationProvider.getOpenIDConfiguration(),o=n.stsServer,s=n.refreshTokenRetryInSeconds,a="OidcService code request "+o+" - no internet connection";return t.loggerService.logWarning(a,e),i.timer(1e3*s)}return i.throwError(e)})))},e}();ne.ɵfac=function(e){return new(e||ne)(n.ɵɵinject(K),n.ɵɵinject(b),n.ɵɵinject(g),n.ɵɵinject(p),n.ɵɵinject(w))},ne.ɵprov=n.ɵɵdefineInjectable({token:ne,factory:ne.ɵfac});var ie=function(){function e(e,t,r,n,i,o,s){this.codeFlowCallbackHandlerService=e,this.implicitFlowCallbackHandlerService=t,this.historyJwtKeysCallbackHandlerService=r,this.userHandlerService=n,this.stateValidationCallbackHandlerService=i,this.refreshSessionCallbackHandlerService=o,this.refreshTokenCallbackHandlerService=s}return e.prototype.processCodeFlowCallback=function(e){var t=this;return this.codeFlowCallbackHandlerService.codeFlowCallback(e).pipe(o.switchMap((function(e){return t.codeFlowCallbackHandlerService.codeFlowCodeRequest(e)})),o.switchMap((function(e){return t.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(e)})),o.switchMap((function(e){return t.stateValidationCallbackHandlerService.callbackStateValidation(e)})),o.switchMap((function(e){return t.userHandlerService.callbackUser(e)})))},e.prototype.processSilentRenewCodeFlowCallback=function(e){var t=this;return this.codeFlowCallbackHandlerService.codeFlowCodeRequest(e).pipe(o.switchMap((function(e){return t.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(e)})),o.switchMap((function(e){return t.stateValidationCallbackHandlerService.callbackStateValidation(e)})),o.switchMap((function(e){return t.userHandlerService.callbackUser(e)})))},e.prototype.processImplicitFlowCallback=function(e){var t=this;return this.implicitFlowCallbackHandlerService.implicitFlowCallback(e).pipe(o.switchMap((function(e){return t.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(e)})),o.switchMap((function(e){return t.stateValidationCallbackHandlerService.callbackStateValidation(e)})),o.switchMap((function(e){return t.userHandlerService.callbackUser(e)})))},e.prototype.processRefreshToken=function(e){var t=this;return this.refreshSessionCallbackHandlerService.refreshSessionWithRefreshTokens().pipe(o.switchMap((function(r){return t.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(r,e)})),o.switchMap((function(e){return t.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(e)})),o.switchMap((function(e){return t.stateValidationCallbackHandlerService.callbackStateValidation(e)})),o.switchMap((function(e){return t.userHandlerService.callbackUser(e)})))},e}();ie.ɵfac=function(e){return new(e||ie)(n.ɵɵinject(M),n.ɵɵinject($),n.ɵɵinject(Z),n.ɵɵinject(Q),n.ɵɵinject(te),n.ɵɵinject(re),n.ɵɵinject(ne))},ie.ɵprov=n.ɵɵdefineInjectable({token:ie,factory:ie.ɵfac});var oe=function(){function e(e){this.zone=e,this.runTokenValidationRunning=null}return e.prototype.stopPeriodicallTokenCheck=function(){this.runTokenValidationRunning&&(this.runTokenValidationRunning.unsubscribe(),this.runTokenValidationRunning=null)},e.prototype.startPeriodicTokenCheck=function(e){var t=this,r=1e3*e;return new i.Observable((function(e){var n;return t.zone.runOutsideAngular((function(){n=setInterval((function(){return t.zone.run((function(){return e.next()}))}),r)})),function(){clearInterval(n)}}))},e}();oe.ɵfac=function(e){return new(e||oe)(n.ɵɵinject(n.NgZone))},oe.ɵprov=n.ɵɵdefineInjectable({token:oe,factory:oe.ɵfac,providedIn:"root"});var se=function(){function e(e,t,r,n,i){this.flowsService=e,this.configurationProvider=t,this.router=r,this.flowsDataService=n,this.intervalService=i}return e.prototype.authorizedImplicitFlowCallback=function(e){var t=this,r=this.flowsDataService.isSilentRenewRunning(),n=this.configurationProvider.getOpenIDConfiguration(),s=n.triggerAuthorizationResultEvent,a=n.postLoginRoute,c=n.unauthorizedRoute;return this.flowsService.processImplicitFlowCallback(e).pipe(o.tap((function(e){s||e.isRenewProcess||t.router.navigateByUrl(a)})),o.catchError((function(e){return t.flowsDataService.resetSilentRenewRunning(),t.intervalService.stopPeriodicallTokenCheck(),s||r||t.router.navigateByUrl(c),i.throwError(e)})))},e}();se.ɵfac=function(e){return new(e||se)(n.ɵɵinject(ie),n.ɵɵinject(g),n.ɵɵinject(c.Router),n.ɵɵinject(O),n.ɵɵinject(oe))},se.ɵprov=n.ɵɵdefineInjectable({token:se,factory:se.ɵfac,providedIn:"root"});var ae=function(){function e(e,t){this.doc=e,this.loggerService=t}return e.prototype.getExistingIFrame=function(e){var t=this.getIFrameFromParentWindow(e);if(this.isIFrameElement(t))return t;var r=this.getIFrameFromWindow(e);return this.isIFrameElement(r)?r:null},e.prototype.addIFrameToWindowBody=function(e){var t=this.doc.createElement("iframe");return t.id=e,t.title=e,this.loggerService.logDebug(t),t.style.display="none",this.doc.body.appendChild(t),t},e.prototype.getIFrameFromParentWindow=function(e){try{var t=this.doc.defaultView.parent.document.getElementById(e);return this.isIFrameElement(t)?t:null}catch(e){return null}},e.prototype.getIFrameFromWindow=function(e){var t=this.doc.getElementById(e);return this.isIFrameElement(t)?t:null},e.prototype.isIFrameElement=function(e){return!!e&&e instanceof HTMLIFrameElement},e}();ae.ɵfac=function(e){return new(e||ae)(n.ɵɵinject(t.DOCUMENT),n.ɵɵinject(b))},ae.ɵprov=n.ɵɵdefineInjectable({token:ae,factory:ae.ɵfac});var ce="myiFrameForCheckSession",ue=function(){function t(e,t,r,n,o,s){this.storagePersistenceService=e,this.loggerService=t,this.iFrameService=r,this.eventService=n,this.configurationProvider=o,this.zone=s,this.checkSessionReceived=!1,this.lastIFrameRefresh=0,this.outstandingMessages=0,this.heartBeatInterval=3e3,this.iframeRefreshInterval=6e4,this.checkSessionChangedInternal$=new i.BehaviorSubject(!1)}return Object.defineProperty(t.prototype,"checkSessionChanged$",{get:function(){return this.checkSessionChangedInternal$.asObservable()},enumerable:!1,configurable:!0}),t.prototype.isCheckSessionConfigured=function(){return this.configurationProvider.getOpenIDConfiguration().startCheckSession},t.prototype.start=function(){if(!this.scheduledHeartBeatRunning){var e=this.configurationProvider.getOpenIDConfiguration().clientId;this.pollServerSession(e)}},t.prototype.stop=function(){this.scheduledHeartBeatRunning&&(this.clearScheduledHeartBeat(),this.checkSessionReceived=!1)},t.prototype.serverStateChanged=function(){return this.configurationProvider.getOpenIDConfiguration().startCheckSession&&this.checkSessionReceived},t.prototype.getExistingIframe=function(){return this.iFrameService.getExistingIFrame(ce)},t.prototype.init=function(){var e=this;if(this.lastIFrameRefresh+this.iframeRefreshInterval>Date.now())return i.of(void 0);var t=this.storagePersistenceService.read("authWellKnownEndPoints");if(!t)return this.loggerService.logWarning("init check session: authWellKnownEndpoints is undefined. Returning."),i.of();var r=this.getOrCreateIframe(),n=t.checkSessionIframe;return n?r.contentWindow.location.replace(n):this.loggerService.logWarning("init check session: checkSessionIframe is not configured to run"),new i.Observable((function(t){r.onload=function(){e.lastIFrameRefresh=Date.now(),t.next(),t.complete()}}))},t.prototype.pollServerSession=function(e){var t=this;this.outstandingMessages=0;var r=function(){t.init().pipe(o.take(1)).subscribe((function(){var n,i=t.getExistingIframe();if(i&&e){t.loggerService.logDebug(i);var o=t.storagePersistenceService.read("session_state"),s=t.storagePersistenceService.read("authWellKnownEndPoints");if(o&&(null==s?void 0:s.checkSessionIframe)){var a=null===(n=new URL(s.checkSessionIframe))||void 0===n?void 0:n.origin;t.outstandingMessages++,i.contentWindow.postMessage(e+" "+o,a)}else t.loggerService.logDebug("OidcSecurityCheckSession pollServerSession session_state is '"+o+"'"),t.loggerService.logDebug("AuthWellKnownEndPoints is '"+JSON.stringify(s)+"'"),t.checkSessionChangedInternal$.next(!0)}else t.loggerService.logWarning("OidcSecurityCheckSession pollServerSession checkSession IFrame does not exist"),t.loggerService.logDebug(e),t.loggerService.logDebug(i);t.outstandingMessages>3&&t.loggerService.logError("OidcSecurityCheckSession not receiving check session response messages.\n                            Outstanding messages: "+t.outstandingMessages+". Server unreachable?"),t.zone.runOutsideAngular((function(){t.scheduledHeartBeatRunning=setTimeout((function(){return t.zone.run(r)}),t.heartBeatInterval)}))}))};r()},t.prototype.clearScheduledHeartBeat=function(){clearTimeout(this.scheduledHeartBeatRunning),this.scheduledHeartBeatRunning=null},t.prototype.messageHandler=function(t){var r,n=this.getExistingIframe(),i=this.storagePersistenceService.read("authWellKnownEndPoints"),o=!!(null===(r=null==i?void 0:i.checkSessionIframe)||void 0===r?void 0:r.startsWith(t.origin));this.outstandingMessages=0,n&&o&&t.source===n.contentWindow&&("error"===t.data?this.loggerService.logWarning("error from checksession messageHandler"):"changed"===t.data?(this.loggerService.logDebug(t),this.checkSessionReceived=!0,this.eventService.fireEvent(e.EventTypes.CheckSessionReceived,t.data),this.checkSessionChangedInternal$.next(!0)):(this.eventService.fireEvent(e.EventTypes.CheckSessionReceived,t.data),this.loggerService.logDebug(t.data+" from checksession messageHandler")))},t.prototype.bindMessageEventToIframe=function(){var e=this.messageHandler.bind(this);window.addEventListener("message",e,!1)},t.prototype.getOrCreateIframe=function(){var e=this.getExistingIframe();if(!e){var t=this.iFrameService.addIFrameToWindowBody(ce);return this.bindMessageEventToIframe(),t}return e},t}();ue.ɵfac=function(e){return new(e||ue)(n.ɵɵinject(w),n.ɵɵinject(b),n.ɵɵinject(ae),n.ɵɵinject(R),n.ɵɵinject(g),n.ɵɵinject(n.NgZone))},ue.ɵprov=n.ɵɵdefineInjectable({token:ue,factory:ue.ɵfac});var le="myiFrameForSilentRenew",he=function(){function t(e,t,r,n,o,s,a,c,u,l){this.configurationProvider=e,this.iFrameService=t,this.flowsService=r,this.resetAuthDataService=n,this.flowsDataService=o,this.authStateService=s,this.loggerService=a,this.flowHelper=c,this.implicitFlowCallbackService=u,this.intervalService=l,this.refreshSessionWithIFrameCompletedInternal$=new i.Subject}return Object.defineProperty(t.prototype,"refreshSessionWithIFrameCompleted$",{get:function(){return this.refreshSessionWithIFrameCompletedInternal$.asObservable()},enumerable:!1,configurable:!0}),t.prototype.getOrCreateIframe=function(){var e=this.getExistingIframe();return e||this.iFrameService.addIFrameToWindowBody(le)},t.prototype.isSilentRenewConfigured=function(){var e=this.configurationProvider.getOpenIDConfiguration(),t=e.useRefreshToken,r=e.silentRenew;return!t&&r},t.prototype.codeFlowCallbackSilentRenewIframe=function(t){var n=this,s=new r.HttpParams({fromString:t[1]}),a=s.get("error");if(a)return this.authStateService.updateAndPublishAuthState({authorizationState:e.AuthorizedState.Unauthorized,validationResult:e.ValidationResult.LoginRequired,isRenewProcess:!0}),this.resetAuthDataService.resetAuthorizationData(),this.flowsDataService.setNonce(""),this.intervalService.stopPeriodicallTokenCheck(),i.throwError(a);var c={code:s.get("code"),refreshToken:null,state:s.get("state"),sessionState:s.get("session_state"),authResult:null,isRenewProcess:!0,jwtKeys:null,validationResult:null,existingIdToken:null};return this.flowsService.processSilentRenewCodeFlowCallback(c).pipe(o.catchError((function(e){return n.intervalService.stopPeriodicallTokenCheck(),n.resetAuthDataService.resetAuthorizationData(),i.throwError(e)})))},t.prototype.silentRenewEventHandler=function(e){var t=this;if(this.loggerService.logDebug("silentRenewEventHandler"),e.detail){var r=i.of(null);if(this.flowHelper.isCurrentFlowCodeFlow()){var n=e.detail.toString().split("?");r=this.codeFlowCallbackSilentRenewIframe(n)}else r=this.implicitFlowCallbackService.authorizedImplicitFlowCallback(e.detail);r.subscribe((function(e){t.refreshSessionWithIFrameCompletedInternal$.next(e),t.flowsDataService.resetSilentRenewRunning()}),(function(e){t.loggerService.logError("Error: "+e),t.refreshSessionWithIFrameCompletedInternal$.next(null),t.flowsDataService.resetSilentRenewRunning()}))}},t.prototype.getExistingIframe=function(){return this.iFrameService.getExistingIFrame(le)},t}();he.ɵfac=function(e){return new(e||he)(n.ɵɵinject(g),n.ɵɵinject(ae),n.ɵɵinject(ie),n.ɵɵinject(q),n.ɵɵinject(O),n.ɵɵinject(j),n.ɵɵinject(b),n.ɵɵinject(U),n.ɵɵinject(se),n.ɵɵinject(oe))},he.ɵprov=n.ɵɵdefineInjectable({token:he,factory:he.ɵfac});var de=function(){function e(e,t,r,n,i){this.flowsService=e,this.flowsDataService=t,this.intervallService=r,this.configurationProvider=n,this.router=i}return e.prototype.authorizedCallbackWithCode=function(e){var t=this,r=this.flowsDataService.isSilentRenewRunning(),n=this.configurationProvider.getOpenIDConfiguration(),s=n.triggerAuthorizationResultEvent,a=n.postLoginRoute,c=n.unauthorizedRoute;return this.flowsService.processCodeFlowCallback(e).pipe(o.tap((function(e){s||e.isRenewProcess||t.router.navigateByUrl(a)})),o.catchError((function(e){return t.flowsDataService.resetSilentRenewRunning(),t.intervallService.stopPeriodicallTokenCheck(),s||r||t.router.navigateByUrl(c),i.throwError(e)})))},e}();de.ɵfac=function(e){return new(e||de)(n.ɵɵinject(ie),n.ɵɵinject(O),n.ɵɵinject(oe),n.ɵɵinject(g),n.ɵɵinject(c.Router))},de.ɵprov=n.ɵɵdefineInjectable({token:de,factory:de.ɵfac,providedIn:"root"});var ge=function(){function e(e,t,r,n){this.urlService=e,this.flowHelper=t,this.implicitFlowCallbackService=r,this.codeFlowCallbackService=n,this.stsCallbackInternal$=new i.Subject}return Object.defineProperty(e.prototype,"stsCallback$",{get:function(){return this.stsCallbackInternal$.asObservable()},enumerable:!1,configurable:!0}),e.prototype.isCallback=function(e){return this.urlService.isCallbackFromSts(e)},e.prototype.handleCallbackAndFireEvents=function(e){var t,r=this;return this.flowHelper.isCurrentFlowCodeFlow()?t=this.codeFlowCallbackService.authorizedCallbackWithCode(e):this.flowHelper.isCurrentFlowAnyImplicitFlow()&&(t=this.implicitFlowCallbackService.authorizedImplicitFlowCallback()),t.pipe(o.tap((function(){return r.stsCallbackInternal$.next()})))},e}();ge.ɵfac=function(e){return new(e||ge)(n.ɵɵinject(K),n.ɵɵinject(U),n.ɵɵinject(se),n.ɵɵinject(de))},ge.ɵprov=n.ɵɵdefineInjectable({token:ge,factory:ge.ɵfac,providedIn:"root"});var fe="/.well-known/openid-configuration",ve=function(){function e(e){this.http=e}return e.prototype.getWellKnownEndPointsFromUrl=function(e){return this.getWellKnownDocument(e).pipe(o.map((function(e){return{issuer:e.issuer,jwksUri:e.jwks_uri,authorizationEndpoint:e.authorization_endpoint,tokenEndpoint:e.token_endpoint,userinfoEndpoint:e.userinfo_endpoint,endSessionEndpoint:e.end_session_endpoint,checkSessionIframe:e.check_session_iframe,revocationEndpoint:e.revocation_endpoint,introspectionEndpoint:e.introspection_endpoint,parEndpoint:e.pushed_authorization_request_endpoint}})))},e.prototype.getWellKnownDocument=function(e){var t=e;return e.includes(fe)||(t=""+e+fe),this.http.get(t).pipe(o.retry(2))},e}();ve.ɵfac=function(e){return new(e||ve)(n.ɵɵinject(p))},ve.ɵprov=n.ɵɵdefineInjectable({token:ve,factory:ve.ɵfac});var pe=function(){function t(e,t,r){this.publicEventsService=e,this.dataService=t,this.storagePersistenceService=r}return t.prototype.getAuthWellKnownEndPoints=function(t){var r=this,n=this.storagePersistenceService.read("authWellKnownEndPoints");return n?i.of(n):this.getWellKnownEndPointsFromUrl(t).pipe(o.tap((function(e){return r.storeWellKnownEndpoints(e)})),o.catchError((function(t){return r.publicEventsService.fireEvent(e.EventTypes.ConfigLoadingFailed,null),i.throwError(t)})))},t.prototype.storeWellKnownEndpoints=function(e){this.storagePersistenceService.write("authWellKnownEndPoints",e)},t.prototype.getWellKnownEndPointsFromUrl=function(e){return this.dataService.getWellKnownEndPointsFromUrl(e)},t}();pe.ɵfac=function(e){return new(e||pe)(n.ɵɵinject(R),n.ɵɵinject(ve),n.ɵɵinject(w))},pe.ɵprov=n.ɵɵdefineInjectable({token:pe,factory:pe.ɵfac});var Se=function(){function e(e,t,r,n,i){this.doc=e,this.loggerService=t,this.urlService=r,this.silentRenewService=n,this.renderer=i.createRenderer(null,null)}return e.prototype.refreshSessionWithIframe=function(e){this.loggerService.logDebug("BEGIN refresh session Authorize Iframe renew");var t=this.urlService.getRefreshSessionSilentRenewUrl(e);return this.sendAuthorizeRequestUsingSilentRenew(t)},e.prototype.sendAuthorizeRequestUsingSilentRenew=function(e){var t=this,r=this.silentRenewService.getOrCreateIframe();return this.initSilentRenewRequest(),this.loggerService.logDebug("sendAuthorizeRequestUsingSilentRenew for URL:"+e),new i.Observable((function(n){var i=function(){r.removeEventListener("load",i),t.loggerService.logDebug("removed event listener from IFrame"),n.next(!0),n.complete()};r.addEventListener("load",i),r.contentWindow.location.replace(e)}))},e.prototype.initSilentRenewRequest=function(){var e=this,t=Math.random(),r=this.renderer.listen("window","oidc-silent-renew-init",(function(e){e.detail!==t&&(r(),n())})),n=this.renderer.listen("window","oidc-silent-renew-message",(function(t){return e.silentRenewService.silentRenewEventHandler(t)}));this.doc.defaultView.dispatchEvent(new CustomEvent("oidc-silent-renew-init",{detail:t}))},e}();Se.ɵfac=function(e){return new(e||Se)(n.ɵɵinject(t.DOCUMENT),n.ɵɵinject(b),n.ɵɵinject(K),n.ɵɵinject(he),n.ɵɵinject(n.RendererFactory2))},Se.ɵprov=n.ɵɵdefineInjectable({token:Se,factory:Se.ɵfac,providedIn:"root"});var we=function(){function e(e,t,r,n){this.loggerService=e,this.resetAuthDataService=t,this.flowsService=r,this.intervalService=n}return e.prototype.refreshSessionWithRefreshTokens=function(e){var t=this;return this.loggerService.logDebug("BEGIN refresh session Authorize"),this.flowsService.processRefreshToken(e).pipe(o.catchError((function(e){return t.intervalService.stopPeriodicallTokenCheck(),t.resetAuthDataService.resetAuthorizationData(),i.throwError(e)})))},e}();we.ɵfac=function(e){return new(e||we)(n.ɵɵinject(b),n.ɵɵinject(q),n.ɵɵinject(ie),n.ɵɵinject(oe))},we.ɵprov=n.ɵɵdefineInjectable({token:we,factory:we.ɵfac,providedIn:"root"});var ke=function(){function e(e,t,r,n,i,o,s,a,c){this.flowHelper=e,this.configurationProvider=t,this.flowsDataService=r,this.loggerService=n,this.silentRenewService=i,this.authStateService=o,this.authWellKnownService=s,this.refreshSessionIframeService=a,this.refreshSessionRefreshTokenService=c}return e.prototype.forceRefreshSession=function(e){var t=this;if(this.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()){var r=this.configurationProvider.getOpenIDConfiguration().customParamsRefreshToken,n=Object.assign(Object.assign({},e),r);return this.startRefreshSession(n).pipe(o.map((function(){return t.authStateService.areAuthStorageTokensValid()?{idToken:t.authStateService.getIdToken(),accessToken:t.authStateService.getAccessToken()}:null})))}var s=1e3*this.configurationProvider.getOpenIDConfiguration().silentRenewTimeoutInSeconds;return i.forkJoin([this.startRefreshSession(e),this.silentRenewService.refreshSessionWithIFrameCompleted$.pipe(o.take(1))]).pipe(o.timeout(s),o.retryWhen(this.timeoutRetryStrategy.bind(this)),o.map((function(e){var r,n,i=y(e,2),o=(i[0],i[1]);return t.authStateService.areAuthStorageTokensValid()?{idToken:null===(r=null==o?void 0:o.authResult)||void 0===r?void 0:r.id_token,accessToken:null===(n=null==o?void 0:o.authResult)||void 0===n?void 0:n.access_token}:null})))},e.prototype.startRefreshSession=function(e){var t=this,r=this.flowsDataService.isSilentRenewRunning();if(this.loggerService.logDebug("Checking: silentRenewRunning: "+r),!!r)return i.of(null);var n=(this.configurationProvider.getOpenIDConfiguration()||{}).authWellknownEndpoint;return n?this.authWellKnownService.getAuthWellKnownEndPoints(n).pipe(o.switchMap((function(){return t.flowsDataService.setSilentRenewRunning(),t.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()?t.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(e):t.refreshSessionIframeService.refreshSessionWithIframe(e)}))):(this.loggerService.logError("no authwellknownendpoint given!"),i.of(null))},e.prototype.timeoutRetryStrategy=function(e){var t=this;return e.pipe(o.mergeMap((function(e,r){var n=r+1;return!(e instanceof i.TimeoutError)||n>3?i.throwError(e):(t.loggerService.logDebug("forceRefreshSession timeout. Attempt #"+n),t.flowsDataService.resetSilentRenewRunning(),i.timer(1e3*n))})))},e}();ke.ɵfac=function(e){return new(e||ke)(n.ɵɵinject(U),n.ɵɵinject(g),n.ɵɵinject(O),n.ɵɵinject(b),n.ɵɵinject(he),n.ɵɵinject(j),n.ɵɵinject(pe),n.ɵɵinject(Se),n.ɵɵinject(we))},ke.ɵprov=n.ɵɵdefineInjectable({token:ke,factory:ke.ɵfac,providedIn:"root"});var ye=function(){function e(e,t,r,n,i,o,s,a,c,u,l){this.resetAuthDataService=e,this.flowHelper=t,this.configurationProvider=r,this.flowsDataService=n,this.loggerService=i,this.userService=o,this.authStateService=s,this.refreshSessionIframeService=a,this.refreshSessionRefreshTokenService=c,this.intervalService=u,this.storagePersistenceService=l}return e.prototype.startTokenValidationPeriodically=function(e){var t=this,r=this.configurationProvider.getOpenIDConfiguration().silentRenew;if(!this.intervalService.runTokenValidationRunning&&r){this.loggerService.logDebug("starting token validation check every "+e+"s");var n=this.intervalService.startPeriodicTokenCheck(e).pipe(o.switchMap((function(){var e=t.authStateService.getIdToken(),r=t.flowsDataService.isSilentRenewRunning(),n=t.userService.getUserDataFromStore();if(t.loggerService.logDebug("Checking: silentRenewRunning: "+r+" id_token: "+!!e+" userData: "+!!n),!(n&&!r&&e))return i.of(null);var o=t.authStateService.hasIdTokenExpired(),s=t.authStateService.hasAccessTokenExpiredIfExpiryExists();if(!o&&!s)return i.of(null);var a=t.configurationProvider.getOpenIDConfiguration();if(!(null==a?void 0:a.silentRenew))return t.resetAuthDataService.resetAuthorizationData(),i.of(null);if(t.loggerService.logDebug("starting silent renew..."),t.flowsDataService.setSilentRenewRunning(),t.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()){var c=t.storagePersistenceService.read("storageCustomParamsRefresh")||{},u=t.configurationProvider.getOpenIDConfiguration().customParamsRefreshToken,l=Object.assign(Object.assign({},c),u);return t.refreshSessionRefreshTokenService.refreshSessionWithRefreshTokens(l)}var h=t.storagePersistenceService.read("storageCustomRequestParams");return t.refreshSessionIframeService.refreshSessionWithIframe(h)})));this.intervalService.runTokenValidationRunning=n.pipe(o.catchError((function(){return t.flowsDataService.resetSilentRenewRunning(),i.throwError("periodically check failed")}))).subscribe((function(){t.loggerService.logDebug("silent renew, periodic check finished!"),t.flowHelper.isCurrentFlowCodeFlowWithRefreshTokens()&&t.flowsDataService.resetSilentRenewRunning()}),(function(e){t.loggerService.logError("silent renew failed!",e)}))}},e}();ye.ɵfac=function(e){return new(e||ye)(n.ɵɵinject(q),n.ɵɵinject(U),n.ɵɵinject(g),n.ɵɵinject(O),n.ɵɵinject(b),n.ɵɵinject(L),n.ɵɵinject(j),n.ɵɵinject(Se),n.ɵɵinject(we),n.ɵɵinject(oe),n.ɵɵinject(w))},ye.ɵprov=n.ɵɵdefineInjectable({token:ye,factory:ye.ɵfac,providedIn:"root"});var Ie=function(){function e(){this.STORAGE_IDENTIFIER="popupauth",this.resultInternal$=new i.Subject}return Object.defineProperty(e.prototype,"result$",{get:function(){return this.resultInternal$.asObservable()},enumerable:!1,configurable:!0}),e.prototype.isCurrentlyInPopup=function(){var e=sessionStorage.getItem(this.STORAGE_IDENTIFIER);return!!window.opener&&window.opener!==window&&!!e},e.prototype.openPopUp=function(e,t){var r=this,n=this.getOptions(t);this.popUp=window.open(e,"_blank",n),this.popUp.sessionStorage.setItem(this.STORAGE_IDENTIFIER,"true");var i=function(e){(null==e?void 0:e.data)&&"string"==typeof e.data&&(r.resultInternal$.next({userClosed:!1,receivedUrl:e.data}),r.cleanUp(i))};window.addEventListener("message",i,!1),this.handle=window.setInterval((function(){r.popUp.closed&&(r.resultInternal$.next({userClosed:!0}),r.cleanUp(i))}),200)},e.prototype.sendMessageToMainWindow=function(e){window.opener&&this.sendMessage(e,window.location.href)},e.prototype.cleanUp=function(e){var t;window.removeEventListener("message",e,!1),window.clearInterval(this.handle),this.popUp&&(null===(t=this.popUp.sessionStorage)||void 0===t||t.removeItem(this.STORAGE_IDENTIFIER),this.popUp.close(),this.popUp=null)},e.prototype.sendMessage=function(e,t){window.opener.postMessage(e,t)},e.prototype.getOptions=function(e){var t=Object.assign(Object.assign({},{width:500,height:500,left:50,top:50}),e||{});return Object.entries(t).map((function(e){var t=y(e,2),r=t[0],n=t[1];return encodeURIComponent(r)+"="+encodeURIComponent(n)})).join(",")},e}();Ie.ɵfac=function(e){return new(e||Ie)},Ie.ɵprov=n.ɵɵdefineInjectable({token:Ie,factory:Ie.ɵfac,providedIn:"root"});var me=function(){function e(e,t,r,n,i,o,s,a,c,u,l,h,d){this.doc=e,this.checkSessionService=t,this.silentRenewService=r,this.userService=n,this.loggerService=i,this.configurationProvider=o,this.authStateService=s,this.callbackService=a,this.refreshSessionService=c,this.periodicallyTokenCheckService=u,this.popupService=l,this.autoLoginService=h,this.router=d}return e.prototype.checkAuth=function(e){var t=this;if(!this.configurationProvider.hasValidConfig())return this.loggerService.logError("Please provide a configuration before setting up the module"),i.of(!1);var r=this.configurationProvider.getOpenIDConfiguration().stsServer;this.loggerService.logDebug("STS server: ",r);var n=e||this.doc.defaultView.location.toString();if(this.popupService.isCurrentlyInPopup())return this.popupService.sendMessageToMainWindow(n),i.of(null);var s=this.callbackService.isCallback(n);return this.loggerService.logDebug("currentUrl to check auth with: ",n),(s?this.callbackService.handleCallbackAndFireEvents(n):i.of(null)).pipe(o.map((function(){var e=t.authStateService.areAuthStorageTokensValid();return e&&(t.startCheckSessionAndValidation(),s||(t.authStateService.setAuthorizedAndFireEvent(),t.userService.publishUserDataIfExists())),t.loggerService.logDebug("checkAuth completed fired events, auth: "+e),e})),o.tap((function(){if(t.authStateService.areAuthStorageTokensValid()){var e=t.autoLoginService.getStoredRedirectRoute();e&&(t.autoLoginService.deleteStoredRedirectRoute(),t.router.navigateByUrl(e))}})),o.catchError((function(e){return t.loggerService.logError(e),i.of(!1)})))},e.prototype.checkAuthIncludingServer=function(){var e=this;return this.checkAuth().pipe(o.switchMap((function(t){return t?i.of(t):e.refreshSessionService.forceRefreshSession().pipe(o.map((function(e){return!!(null==e?void 0:e.idToken)&&!!(null==e?void 0:e.accessToken)})),o.switchMap((function(t){return t&&e.startCheckSessionAndValidation(),i.of(t)})))})))},e.prototype.startCheckSessionAndValidation=function(){this.checkSessionService.isCheckSessionConfigured()&&this.checkSessionService.start();var e=this.configurationProvider.getOpenIDConfiguration().tokenRefreshInSeconds;this.periodicallyTokenCheckService.startTokenValidationPeriodically(e),this.silentRenewService.isSilentRenewConfigured()&&this.silentRenewService.getOrCreateIframe()},e}();me.ɵfac=function(e){return new(e||me)(n.ɵɵinject(t.DOCUMENT),n.ɵɵinject(ue),n.ɵɵinject(he),n.ɵɵinject(L),n.ɵɵinject(b),n.ɵɵinject(g),n.ɵɵinject(j),n.ɵɵinject(ge),n.ɵɵinject(ke),n.ɵɵinject(ye),n.ɵɵinject(Ie),n.ɵɵinject(P),n.ɵɵinject(c.Router))},me.ɵprov=n.ɵɵdefineInjectable({token:me,factory:me.ɵfac});var be={result:!0,messages:[],level:null},Re=[function(e){return e.stsServer?be:{result:!1,messages:["The STS URL MUST be provided in the configuration!"],level:"error"}},function(e){var t=e.useRefreshToken,r=e.silentRenew,n=(e.scope||"").split(" ").includes("offline_access");return t&&r&&!n?{result:!1,messages:["When using silent renew and refresh tokens please set the `offline_access` scope"],level:"warning"}:be},function(e){return e.redirectUrl?be:{result:!1,messages:["The redirectURL is required and missing from your config"],level:"error"}},function(e){return e.clientId?be:{result:!1,messages:["The clientId is required and missing from your config!"],level:"error"}},function(e){var t=e.silentRenew,r=e.useRefreshToken,n=e.silentRenewUrl;return!t||r||n?be:{result:!1,messages:["Please provide a silent renew URL if using renew and not refresh tokens"],level:"error"}}],Ce=function(){function e(e){this.loggerService=e}return e.prototype.validateConfig=function(e){var t=this,r=Re.map((function(t){return t(e)})).filter((function(e){return e.messages.length>0})),n=this.getAllMessagesOfType("error",r),i=this.getAllMessagesOfType("warning",r);return n.map((function(e){return t.loggerService.logError(e)})),i.map((function(e){return t.loggerService.logWarning(e)})),0===n.length},e.prototype.getAllMessagesOfType=function(e,t){return t.filter((function(t){return t.level===e})).map((function(e){return e.messages})).reduce((function(e,t){return e.concat(t)}),[])},e}();Ce.ɵfac=function(e){return new(e||Ce)(n.ɵɵinject(b))},Ce.ɵprov=n.ɵɵdefineInjectable({token:Ce,factory:Ce.ɵfac});var Ee=function(){function t(e,t,r,n,i,o){this.loggerService=e,this.publicEventsService=t,this.configurationProvider=r,this.authWellKnownService=n,this.storagePersistenceService=i,this.configValidationService=o}return t.prototype.withConfig=function(t,r){var n=this;return new Promise((function(s,a){n.configValidationService.validateConfig(t)||(n.loggerService.logError("Validation of config rejected with errors. Config is NOT set."),s()),t.authWellknownEndpoint||(t.authWellknownEndpoint=t.stsServer);var c=n.configurationProvider.setConfig(t),u=n.storagePersistenceService.read("authWellKnownEndPoints");u&&(n.publicEventsService.fireEvent(e.EventTypes.ConfigLoaded,{configuration:t,wellknown:u}),s()),r&&(n.authWellKnownService.storeWellKnownEndpoints(r),n.publicEventsService.fireEvent(e.EventTypes.ConfigLoaded,{configuration:t,wellknown:r}),s()),c.eagerLoadAuthWellKnownEndpoints?n.authWellKnownService.getAuthWellKnownEndPoints(c.authWellknownEndpoint).pipe(o.catchError((function(e){return n.loggerService.logError("Getting auth well known endpoints failed on start",e),i.throwError(e)})),o.tap((function(r){return n.publicEventsService.fireEvent(e.EventTypes.ConfigLoaded,{configuration:t,wellknown:r})}))).subscribe((function(){return s()}),(function(){return a()})):(n.publicEventsService.fireEvent(e.EventTypes.ConfigLoaded,{configuration:t,wellknown:null}),s())}))},t}();Ee.ɵfac=function(e){return new(e||Ee)(n.ɵɵinject(b),n.ɵɵinject(R),n.ɵɵinject(g),n.ɵɵinject(pe),n.ɵɵinject(w),n.ɵɵinject(Ce))},Ee.ɵprov=n.ɵɵdefineInjectable({token:Ee,factory:Ee.ɵfac});var je=function(){function e(e,t){this.loggerService=e,this.flowHelper=t}return e.prototype.hasConfigValidResponseType=function(){return!!this.flowHelper.isCurrentFlowAnyImplicitFlow()||(!!this.flowHelper.isCurrentFlowCodeFlow()||(this.loggerService.logWarning("module configured incorrectly, invalid response_type. Check the responseType in the config"),!1))},e}();je.ɵfac=function(e){return new(e||je)(n.ɵɵinject(b),n.ɵɵinject(U))},je.ɵprov=n.ɵɵdefineInjectable({token:je,factory:je.ɵfac});var Te=function(){function e(e){this.doc=e}return e.prototype.redirectTo=function(e){this.doc.location.href=e},e}();Te.ɵfac=function(e){return new(e||Te)(n.ɵɵinject(t.DOCUMENT))},Te.ɵprov=n.ɵɵdefineInjectable({token:Te,factory:Te.ɵfac,providedIn:"root"});var Pe=function(){function e(e,t,r,n){this.loggerService=e,this.urlService=t,this.dataService=r,this.storagePersistenceService=n}return e.prototype.postParRequest=function(e){var t=this,n=new r.HttpHeaders;n=n.set("Content-Type","application/x-www-form-urlencoded");var s=this.storagePersistenceService.read("authWellKnownEndPoints");if(!s)return i.throwError("Could not read PAR endpoint because authWellKnownEndPoints are not given");var a=s.parEndpoint;if(!a)return i.throwError("Could not read PAR endpoint from authWellKnownEndpoints");var c=this.urlService.createBodyForParCodeFlowRequest(e);return this.dataService.post(a,c,n).pipe(o.retry(2),o.map((function(e){return t.loggerService.logDebug("par response: ",e),{expiresIn:e.expires_in,requestUri:e.request_uri}})),o.catchError((function(e){var r="There was an error on ParService postParRequest";return t.loggerService.logError(r,e),i.throwError(r)})))},e}();Pe.ɵfac=function(e){return new(e||Pe)(n.ɵɵinject(b),n.ɵɵinject(K),n.ɵɵinject(p),n.ɵɵinject(w))},Pe.ɵprov=n.ɵɵdefineInjectable({token:Pe,factory:Pe.ɵfac});var De=function(){function e(e,t,r,n,i,o,s,a,c,u,l){this.loggerService=e,this.responseTypeValidationService=t,this.urlService=r,this.redirectService=n,this.configurationProvider=i,this.authWellKnownService=o,this.popupService=s,this.checkAuthService=a,this.userService=c,this.authStateService=u,this.parService=l}return e.prototype.loginPar=function(e){var t=this;if(this.responseTypeValidationService.hasConfigValidResponseType()){var r=this.configurationProvider.getOpenIDConfiguration().authWellknownEndpoint;if(r){this.loggerService.logDebug("BEGIN Authorize OIDC Flow, no auth data");var n=e||{},i=n.urlHandler,s=n.customParams;this.authWellKnownService.getAuthWellKnownEndPoints(r).pipe(o.switchMap((function(){return t.parService.postParRequest(s)}))).subscribe((function(e){t.loggerService.logDebug("par response: ",e);var r=t.urlService.getAuthorizeParUrl(e.requestUri);t.loggerService.logDebug("par request url: ",r),r?i?i(r):t.redirectService.redirectTo(r):t.loggerService.logError("Could not create url with param "+e.requestUri+": '"+r+"'")}))}else this.loggerService.logError("no authWellknownEndpoint given!")}else this.loggerService.logError("Invalid response type!")},e.prototype.loginWithPopUpPar=function(e,t){var r=this;if(!this.responseTypeValidationService.hasConfigValidResponseType()){var n="Invalid response type!";return this.loggerService.logError(n),i.throwError(n)}var s=this.configurationProvider.getOpenIDConfiguration().authWellknownEndpoint;if(!s){n="no authWellknownEndpoint given!";return this.loggerService.logError(n),i.throwError(n)}this.loggerService.logDebug("BEGIN Authorize OIDC Flow with popup, no auth data");var a=(e||{}).customParams;return this.authWellKnownService.getAuthWellKnownEndPoints(s).pipe(o.switchMap((function(){return r.parService.postParRequest(a)})),o.switchMap((function(e){r.loggerService.logDebug("par response: ",e);var n=r.urlService.getAuthorizeParUrl(e.requestUri);if(r.loggerService.logDebug("par request url: ",n),!n){var s="Could not create url with param "+e.requestUri+": 'url'";return r.loggerService.logError(s),i.throwError(s)}return r.popupService.openPopUp(n,t),r.popupService.result$.pipe(o.take(1),o.switchMap((function(e){return!0===e.userClosed?i.of({isAuthenticated:!1,errorMessage:"User closed popup"}):r.checkAuthService.checkAuth(e.receivedUrl).pipe(o.map((function(e){return{isAuthenticated:e,userData:r.userService.getUserDataFromStore(),accessToken:r.authStateService.getAccessToken()}})))})))})))},e}();De.ɵfac=function(e){return new(e||De)(n.ɵɵinject(b),n.ɵɵinject(je),n.ɵɵinject(K),n.ɵɵinject(Te),n.ɵɵinject(g),n.ɵɵinject(pe),n.ɵɵinject(Ie),n.ɵɵinject(me),n.ɵɵinject(L),n.ɵɵinject(j),n.ɵɵinject(Pe))},De.ɵprov=n.ɵɵdefineInjectable({token:De,factory:De.ɵfac});var Ae=function(){function e(e,t,r,n,i,o,s,a,c){this.loggerService=e,this.responseTypeValidationService=t,this.urlService=r,this.configurationProvider=n,this.authWellKnownService=i,this.popupService=o,this.checkAuthService=s,this.userService=a,this.authStateService=c}return e.prototype.loginWithPopUpStandard=function(e,t){var r=this;if(!this.responseTypeValidationService.hasConfigValidResponseType()){var n="Invalid response type!";return this.loggerService.logError(n),i.throwError(n)}var s=this.configurationProvider.getOpenIDConfiguration().authWellknownEndpoint;if(!s){n="no authWellknownEndpoint given!";return this.loggerService.logError(n),i.throwError(n)}return this.loggerService.logDebug("BEGIN Authorize OIDC Flow with popup, no auth data"),this.authWellKnownService.getAuthWellKnownEndPoints(s).pipe(o.switchMap((function(){var n=(e||{}).customParams,s=r.urlService.getAuthorizeUrl(n);return r.popupService.openPopUp(s,t),r.popupService.result$.pipe(o.take(1),o.switchMap((function(e){return!0===e.userClosed?i.of({isAuthenticated:!1,errorMessage:"User closed popup"}):r.checkAuthService.checkAuth(e.receivedUrl).pipe(o.map((function(e){return{isAuthenticated:e,userData:r.userService.getUserDataFromStore(),accessToken:r.authStateService.getAccessToken()}})))})))})))},e}();Ae.ɵfac=function(e){return new(e||Ae)(n.ɵɵinject(b),n.ɵɵinject(je),n.ɵɵinject(K),n.ɵɵinject(g),n.ɵɵinject(pe),n.ɵɵinject(Ie),n.ɵɵinject(me),n.ɵɵinject(L),n.ɵɵinject(j))},Ae.ɵprov=n.ɵɵdefineInjectable({token:Ae,factory:Ae.ɵfac});var Oe=function(){function e(e,t,r,n,i,o){this.loggerService=e,this.responseTypeValidationService=t,this.urlService=r,this.redirectService=n,this.configurationProvider=i,this.authWellKnownService=o}return e.prototype.loginStandard=function(e){var t=this;if(this.responseTypeValidationService.hasConfigValidResponseType()){var r=this.configurationProvider.getOpenIDConfiguration().authWellknownEndpoint;r?(this.loggerService.logDebug("BEGIN Authorize OIDC Flow, no auth data"),this.authWellKnownService.getAuthWellKnownEndPoints(r).subscribe((function(){var r=e||{},n=r.urlHandler,i=r.customParams,o=t.urlService.getAuthorizeUrl(i);o?n?n(o):t.redirectService.redirectTo(o):t.loggerService.logError("Could not create url",o)}))):this.loggerService.logError("no authWellknownEndpoint given!")}else this.loggerService.logError("Invalid response type!")},e}();Oe.ɵfac=function(e){return new(e||Oe)(n.ɵɵinject(b),n.ɵɵinject(je),n.ɵɵinject(K),n.ɵɵinject(Te),n.ɵɵinject(g),n.ɵɵinject(pe))},Oe.ɵprov=n.ɵɵdefineInjectable({token:Oe,factory:Oe.ɵfac});var Ue=function(){function e(e,t,r,n){this.configurationProvider=e,this.parLoginService=t,this.popUpLoginService=r,this.standardLoginService=n}return e.prototype.login=function(e){return this.configurationProvider.getOpenIDConfiguration().usePushedAuthorisationRequests?this.parLoginService.loginPar(e):this.standardLoginService.loginStandard(e)},e.prototype.loginWithPopUp=function(e,t){return this.configurationProvider.getOpenIDConfiguration().usePushedAuthorisationRequests?this.parLoginService.loginWithPopUpPar(e,t):this.popUpLoginService.loginWithPopUpStandard(e,t)},e}();Ue.ɵfac=function(e){return new(e||Ue)(n.ɵɵinject(g),n.ɵɵinject(De),n.ɵɵinject(Ae),n.ɵɵinject(Oe))},Ue.ɵprov=n.ɵɵdefineInjectable({token:Ue,factory:Ue.ɵfac});var Fe=function(){function e(e,t,r,n,i,o,s){this.dataService=e,this.storagePersistenceService=t,this.loggerService=r,this.urlService=n,this.checkSessionService=i,this.resetAuthDataService=o,this.configurationProvider=s}return e.prototype.logoff=function(e){this.loggerService.logDebug("logoff, remove auth ");var t=this.getEndSessionUrl();this.resetAuthDataService.resetAuthorizationData(),t?this.checkSessionService.serverStateChanged()?this.loggerService.logDebug("only local login cleaned up, server session has changed"):e?e(t):this.dataService.get(t).subscribe((function(e){console.log(e)}),(function(e){console.log("error",e)})):this.loggerService.logDebug("only local login cleaned up, no end_session_endpoint")},e.prototype.logoffLocal=function(){this.resetAuthDataService.resetAuthorizationData(),this.checkSessionService.stop()},e.prototype.logoffAndRevokeTokens=function(e){var t,r=this;return(null===(t=this.storagePersistenceService.read("authWellKnownEndPoints"))||void 0===t?void 0:t.revocationEndpoint)||(this.loggerService.logDebug("revocation endpoint not supported"),this.logoff(e)),this.storagePersistenceService.getRefreshToken()?this.revokeRefreshToken().pipe(o.switchMap((function(e){return r.revokeAccessToken(e)})),o.catchError((function(e){var t="revoke token failed";return r.loggerService.logError(t,e),i.throwError(t)})),o.tap((function(){return r.logoff(e)}))):this.revokeAccessToken().pipe(o.catchError((function(e){var t="revoke access token failed";return r.loggerService.logError(t,e),i.throwError(t)})),o.tap((function(){return r.logoff(e)})))},e.prototype.revokeAccessToken=function(e){var t=this,n=e||this.storagePersistenceService.getAccessToken(),s=this.urlService.createRevocationEndpointBodyAccessToken(n),a=this.urlService.getRevocationEndpointUrl(),c=new r.HttpHeaders;return c=c.set("Content-Type","application/x-www-form-urlencoded"),this.dataService.post(a,s,c).pipe(o.retry(2),o.switchMap((function(e){return t.loggerService.logDebug("revocation endpoint post response: ",e),i.of(e)})),o.catchError((function(e){var r="Revocation request failed";return t.loggerService.logError(r,e),i.throwError(r)})))},e.prototype.revokeRefreshToken=function(e){var t=this,n=e||this.storagePersistenceService.getRefreshToken(),s=this.urlService.createRevocationEndpointBodyRefreshToken(n),a=this.urlService.getRevocationEndpointUrl(),c=new r.HttpHeaders;return c=c.set("Content-Type","application/x-www-form-urlencoded"),this.dataService.post(a,s,c).pipe(o.retry(2),o.switchMap((function(e){return t.loggerService.logDebug("revocation endpoint post response: ",e),i.of(e)})),o.catchError((function(e){var r="Revocation request failed";return t.loggerService.logError(r,e),i.throwError(r)})))},e.prototype.getEndSessionUrl=function(e){var t=this.storagePersistenceService.getIdToken(),r=this.configurationProvider.getOpenIDConfiguration().customParamsEndSession,n=Object.assign(Object.assign({},e),r);return this.urlService.createEndSessionUrl(t,n)},e}();Fe.ɵfac=function(e){return new(e||Fe)(n.ɵɵinject(p),n.ɵɵinject(w),n.ɵɵinject(b),n.ɵɵinject(K),n.ɵɵinject(ue),n.ɵɵinject(q),n.ɵɵinject(g))},Fe.ɵprov=n.ɵɵdefineInjectable({token:Fe,factory:Fe.ɵfac});var We=function(){function e(e,t,r,n,i,o,s,a,c,u,l,h){this.checkSessionService=e,this.checkAuthService=t,this.userService=r,this.tokenHelperService=n,this.configurationProvider=i,this.authStateService=o,this.flowsDataService=s,this.callbackService=a,this.logoffRevocationService=c,this.loginService=u,this.storagePersistenceService=l,this.refreshSessionService=h}return Object.defineProperty(e.prototype,"configuration",{get:function(){return{configuration:this.configurationProvider.getOpenIDConfiguration(),wellknown:this.storagePersistenceService.read("authWellKnownEndPoints")}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userData$",{get:function(){return this.userService.userData$},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAuthenticated$",{get:function(){return this.authStateService.authorized$},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"checkSessionChanged$",{get:function(){return this.checkSessionService.checkSessionChanged$},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stsCallback$",{get:function(){return this.callbackService.stsCallback$},enumerable:!1,configurable:!0}),e.prototype.checkAuth=function(e){return this.checkAuthService.checkAuth(e)},e.prototype.checkAuthIncludingServer=function(){return this.checkAuthService.checkAuthIncludingServer()},e.prototype.getToken=function(){return this.authStateService.getAccessToken()},e.prototype.getIdToken=function(){return this.authStateService.getIdToken()},e.prototype.getRefreshToken=function(){return this.authStateService.getRefreshToken()},e.prototype.getPayloadFromIdToken=function(e){void 0===e&&(e=!1);var t=this.getIdToken();return this.tokenHelperService.getPayloadFromToken(t,e)},e.prototype.setState=function(e){this.flowsDataService.setAuthStateControl(e)},e.prototype.getState=function(){return this.flowsDataService.getAuthStateControl()},e.prototype.authorize=function(e){(null==e?void 0:e.customParams)&&this.storagePersistenceService.write("storageCustomRequestParams",e.customParams),this.loginService.login(e)},e.prototype.authorizeWithPopUp=function(e,t){return(null==e?void 0:e.customParams)&&this.storagePersistenceService.write("storageCustomRequestParams",e.customParams),this.loginService.loginWithPopUp(e,t)},e.prototype.forceRefreshSession=function(e){var t=this.configurationProvider.getOpenIDConfiguration().useRefreshToken;return e&&(t?this.storagePersistenceService.write("storageCustomParamsRefresh",e):this.storagePersistenceService.write("storageCustomRequestParams",e)),this.refreshSessionService.forceRefreshSession(e)},e.prototype.logoffAndRevokeTokens=function(e){return this.logoffRevocationService.logoffAndRevokeTokens(e)},e.prototype.logoff=function(e){return this.logoffRevocationService.logoff(e)},e.prototype.logoffLocal=function(){return this.logoffRevocationService.logoffLocal()},e.prototype.revokeAccessToken=function(e){return this.logoffRevocationService.revokeAccessToken(e)},e.prototype.revokeRefreshToken=function(e){return this.logoffRevocationService.revokeRefreshToken(e)},e.prototype.getEndSessionUrl=function(e){return this.logoffRevocationService.getEndSessionUrl(e)},e}();We.ɵfac=function(e){return new(e||We)(n.ɵɵinject(ue),n.ɵɵinject(me),n.ɵɵinject(L),n.ɵɵinject(C),n.ɵɵinject(g),n.ɵɵinject(j),n.ɵɵinject(O),n.ɵɵinject(ge),n.ɵɵinject(Fe),n.ɵɵinject(Ue),n.ɵɵinject(w),n.ɵɵinject(ke))},We.ɵprov=n.ɵɵdefineInjectable({token:We,factory:We.ɵfac});var _e=function(){function e(e,t){this.configProvider=e,this.loggerService=t}return e.prototype.read=function(e){var t;if(!this.hasStorage())return this.loggerService.logDebug("Wanted to read '"+e+"' but Storage was undefined"),!1;var r=null===(t=this.getStorage())||void 0===t?void 0:t.getItem(e);return r?JSON.parse(r):(this.loggerService.logDebug("Wanted to read '"+e+"' but nothing was found"),null)},e.prototype.write=function(e,t){if(!this.hasStorage())return this.loggerService.logDebug("Wanted to write '"+e+"/"+t+"' but Storage was falsy"),!1;var r=this.getStorage();return r?(t=t||null,r.setItem(""+e,JSON.stringify(t)),!0):(this.loggerService.logDebug("Wanted to write '"+e+"/"+t+"' but Storage was falsy"),!1)},e.prototype.remove=function(e){if(!this.hasStorage())return this.loggerService.logDebug("Wanted to remove '"+e+"' but Storage was falsy"),!1;var t=this.getStorage();return t?(t.removeItem(""+e),!0):(this.loggerService.logDebug("Wanted to write '"+e+"' but Storage was falsy"),!1)},e.prototype.getStorage=function(){var e=this.configProvider.getOpenIDConfiguration();return e?e.storage:null},e.prototype.hasStorage=function(){return"undefined"!=typeof Storage},e}();_e.ɵfac=function(e){return new(e||_e)(n.ɵɵinject(g),n.ɵɵinject(b))},_e.ɵprov=n.ɵɵdefineInjectable({token:_e,factory:_e.ɵfac});var ze=function(){function e(){}return e.forRoot=function(t){return void 0===t&&(t={}),{ngModule:e,providers:[Ee,R,U,We,E,d,ue,O,ie,he,g,Fe,L,A,l,K,j,J,w,C,b,ae,X,Ue,Pe,ve,pe,p,ee,Ce,me,q,se,Z,je,Q,te,re,ne,M,$,De,Ae,Oe,P,{provide:S,useClass:t.storage||_e}]}},e}();ze.ɵmod=n.ɵɵdefineNgModule({type:ze}),ze.ɵinj=n.ɵɵdefineInjector({factory:function(e){return new(e||ze)},imports:[[t.CommonModule,r.HttpClientModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.ɵɵsetNgModuleScope(ze,{imports:[t.CommonModule,r.HttpClientModule]});var Ve=function(){function e(e,t,r,n,i){this.autoLoginService=e,this.authStateService=t,this.checkAuthService=r,this.loginService=n,this.router=i}return e.prototype.canLoad=function(e,t){var r=t.join("/");return this.checkAuth(r)},e.prototype.canActivate=function(e,t){return this.checkAuth(t.url)},e.prototype.checkAuth=function(e){var t=this;return this.authStateService.areAuthStorageTokensValid()?i.of(!0):this.checkAuthService.checkAuth().pipe(o.map((function(r){var n=t.autoLoginService.getStoredRedirectRoute();return r?(n&&(t.autoLoginService.deleteStoredRedirectRoute(),t.router.navigateByUrl(n)),!0):(t.autoLoginService.saveStoredRedirectRoute(e),t.loginService.login(),!1)})))},e}();Ve.ɵfac=function(e){return new(e||Ve)(n.ɵɵinject(P),n.ɵɵinject(j),n.ɵɵinject(me),n.ɵɵinject(Ue),n.ɵɵinject(c.Router))},Ve.ɵprov=n.ɵɵdefineInjectable({token:Ve,factory:Ve.ɵfac,providedIn:"root"});var xe=function(){function e(e,t,r){this.authStateService=e,this.configurationProvider=t,this.loggerService=r}return e.prototype.intercept=function(e,t){var r=this.configurationProvider.getOpenIDConfiguration().secureRoutes;if(!r)return this.loggerService.logDebug("No routes to check configured"),t.handle(e);var n=r.find((function(t){return e.url.startsWith(t)}));if(!n)return this.loggerService.logDebug("Did not find matching route for "+e.url),t.handle(e);this.loggerService.logDebug("'"+e.url+"' matches configured route '"+n+"'");var i=this.authStateService.getAccessToken();return i?(this.loggerService.logDebug("'"+e.url+"' matches configured route '"+n+"', adding token"),e=e.clone({headers:e.headers.set("Authorization","Bearer "+i)}),t.handle(e)):(this.loggerService.logDebug("Wanted to add token to "+e.url+" but found no token: '"+i+"'"),t.handle(e))},e}();xe.ɵfac=function(e){return new(e||xe)(n.ɵɵinject(j),n.ɵɵinject(g),n.ɵɵinject(b))},xe.ɵprov=n.ɵɵdefineInjectable({token:xe,factory:xe.ɵfac}),e.AbstractSecurityStorage=S,e.AuthInterceptor=xe,e.AuthModule=ze,e.AutoLoginGuard=Ve,e.LoggerService=b,e.OidcConfigService=Ee,e.OidcSecurityService=We,e.PublicEventsService=R,e.StateValidationResult=Y,e.TokenHelperService=C,e.TokenValidationService=E,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-auth-oidc-client.umd.min.js.map